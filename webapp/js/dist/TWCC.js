/*!
 * clipboard.js v2.0.0
 * https://zenorocha.github.io/clipboard.js
 * 
 * Licensed MIT © Zeno Rocha
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ClipboardJS=e():t.ClipboardJS=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=3)}([function(t,e,n){var o,r,i;!function(a,c){r=[t,n(7)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i)}(0,function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(t){return t&&t.__esModule?t:{default:t}}(e),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),a=function(){function t(e){n(this,t),this.resolveOptions(e),this.initSelection()}return i(t,[{key:"resolveOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=t.action,this.container=t.container,this.emitter=t.emitter,this.target=t.target,this.text=t.text,this.trigger=t.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var t=this,e="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return t.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[e?"right":"left"]="-9999px";var n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=(0,o.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,o.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var t=void 0;try{t=document.execCommand(this.action)}catch(e){t=!1}this.handleResult(t)}},{key:"handleResult",value:function(t){this.emitter.emit(t?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=t,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(t){if(void 0!==t){if(!t||"object"!==(void 0===t?"undefined":r(t))||1!==t.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&t.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(t.hasAttribute("readonly")||t.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=t}},get:function(){return this._target}}]),t}();t.exports=a})},function(t,e,n){function o(t,e,n){if(!t&&!e&&!n)throw new Error("Missing required arguments");if(!c.string(e))throw new TypeError("Second argument must be a String");if(!c.fn(n))throw new TypeError("Third argument must be a Function");if(c.node(t))return r(t,e,n);if(c.nodeList(t))return i(t,e,n);if(c.string(t))return a(t,e,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function r(t,e,n){return t.addEventListener(e,n),{destroy:function(){t.removeEventListener(e,n)}}}function i(t,e,n){return Array.prototype.forEach.call(t,function(t){t.addEventListener(e,n)}),{destroy:function(){Array.prototype.forEach.call(t,function(t){t.removeEventListener(e,n)})}}}function a(t,e,n){return u(document.body,t,e,n)}var c=n(6),u=n(5);t.exports=o},function(t,e){function n(){}n.prototype={on:function(t,e,n){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){function o(){r.off(t,o),e.apply(n,arguments)}var r=this;return o._=e,this.on(t,o,n)},emit:function(t){var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),o=0,r=n.length;for(o;o<r;o++)n[o].fn.apply(n[o].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),o=n[t],r=[];if(o&&e)for(var i=0,a=o.length;i<a;i++)o[i].fn!==e&&o[i].fn._!==e&&r.push(o[i]);return r.length?n[t]=r:delete n[t],this}},t.exports=n},function(t,e,n){var o,r,i;!function(a,c){r=[t,n(0),n(2),n(1)],o=c,void 0!==(i="function"==typeof o?o.apply(e,r):o)&&(t.exports=i)}(0,function(t,e,n,o){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function u(t,e){var n="data-clipboard-"+t;if(e.hasAttribute(n))return e.getAttribute(n)}var l=r(e),s=r(n),f=r(o),d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),p=function(t){function e(t,n){i(this,e);var o=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.resolveOptions(n),o.listenClick(t),o}return c(e,t),h(e,[{key:"resolveOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof t.action?t.action:this.defaultAction,this.target="function"==typeof t.target?t.target:this.defaultTarget,this.text="function"==typeof t.text?t.text:this.defaultText,this.container="object"===d(t.container)?t.container:document.body}},{key:"listenClick",value:function(t){var e=this;this.listener=(0,f.default)(t,"click",function(t){return e.onClick(t)})}},{key:"onClick",value:function(t){var e=t.delegateTarget||t.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new l.default({action:this.action(e),target:this.target(e),text:this.text(e),container:this.container,trigger:e,emitter:this})}},{key:"defaultAction",value:function(t){return u("action",t)}},{key:"defaultTarget",value:function(t){var e=u("target",t);if(e)return document.querySelector(e)}},{key:"defaultText",value:function(t){return u("text",t)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],e="string"==typeof t?[t]:t,n=!!document.queryCommandSupported;return e.forEach(function(t){n=n&&!!document.queryCommandSupported(t)}),n}}]),e}(s.default);t.exports=p})},function(t,e){function n(t,e){for(;t&&t.nodeType!==o;){if("function"==typeof t.matches&&t.matches(e))return t;t=t.parentNode}}var o=9;if("undefined"!=typeof Element&&!Element.prototype.matches){var r=Element.prototype;r.matches=r.matchesSelector||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector||r.webkitMatchesSelector}t.exports=n},function(t,e,n){function o(t,e,n,o,r){var a=i.apply(this,arguments);return t.addEventListener(n,a,r),{destroy:function(){t.removeEventListener(n,a,r)}}}function r(t,e,n,r,i){return"function"==typeof t.addEventListener?o.apply(null,arguments):"function"==typeof n?o.bind(null,document).apply(null,arguments):("string"==typeof t&&(t=document.querySelectorAll(t)),Array.prototype.map.call(t,function(t){return o(t,e,n,r,i)}))}function i(t,e,n,o){return function(n){n.delegateTarget=a(n.target,e),n.delegateTarget&&o.call(t,n)}}var a=n(4);t.exports=r},function(t,e){e.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},e.nodeList=function(t){var n=Object.prototype.toString.call(t);return void 0!==t&&("[object NodeList]"===n||"[object HTMLCollection]"===n)&&"length"in t&&(0===t.length||e.node(t[0]))},e.string=function(t){return"string"==typeof t||t instanceof String},e.fn=function(t){return"[object Function]"===Object.prototype.toString.call(t)}},function(t,e){function n(t){var e;if("SELECT"===t.nodeName)t.focus(),e=t.value;else if("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName){var n=t.hasAttribute("readonly");n||t.setAttribute("readonly",""),t.select(),t.setSelectionRange(0,t.value.length),n||t.removeAttribute("readonly"),e=t.value}else{t.hasAttribute("contenteditable")&&t.focus();var o=window.getSelection(),r=document.createRange();r.selectNodeContents(t),o.removeAllRanges(),o.addRange(r),e=o.toString()}return e}t.exports=n}])});;/**
 * This file is part of TWCC.
 *
 * TWCC is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * TWCC is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with TWCC.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @copyright Copyright (c) 2010-2014 Clément Ronzon
 * @license http://www.gnu.org/licenses/agpl.txt
 */

(function($) {
    "use strict";
    /*global window, document, jQuery */

    if (window.TWCCHistory !== undefined) {
        return;
    }

    var instance,
    init = function(opts) {

        var _options = $.extend(true, {}, opts),
            _array,
            _index,
            _enabled = true,
            _cookieName = _options.system.historyCookie,
            _min = 0,
            _max = _options.system.historyLimit;

        function _cleanWgs84(obj) {
            var wgs84, idx;
            if(obj === null || typeof(obj) != 'object') return obj;
            wgs84 = obj.constructor();
            for (idx in obj) {
                if (obj.hasOwnProperty(idx)) wgs84[idx] = _cleanWgs84(obj[idx]);
            }
            return wgs84;
        }
        function _importArray() {
            _array = _options.utils.getCookieContent(_cookieName);
            if ($.isEmptyObject(_array)) {
                _array = [];
            }
            _setIndexAt(_getMaxPosition());
        }
        function _getArray() {
            return _array;
        }
        function _exportArray() {
            _options.utils.setCookieContent(_cookieName, _getArray());
        }
        function _setArray(value) {
            _array = value;
        }
        function _toggle(enabled) {
            _enabled = enabled;
        }
        function _getMaxPosition() {
            return _getArray().length - 1;
        }
        function _setIndexAt(idx) {
            _index = Math.min(Math.abs(idx), _max);
            _options.utils.trigger($('body'), 'history.indexchanged', {
                currentIndex: idx,
                maxIndex: _getMaxPosition(),
                currentValue: _getCurrentValue()
            });
        }
        function _resetIndex() {
            _setIndexAt(_getMaxPosition());
        }
        function _getCurrentValue() {
            return _getArray()[_index];
        }
        function _push(value) {
            _array.push(value);
        }
        function _moveTo(idx) {
            _setIndexAt(idx);
            return _getCurrentValue();
        }
        function _sliceContent() {
            _setArray(_getArray().slice(_min, _index+1));
        }
        function _limit() {
            _setArray(_getArray().slice(-_max));
        }
        function _add(value) {
            if (_enabled && value) {
                value.wgs84 = _cleanWgs84(value.wgs84);
                if (JSON.stringify(value) !== JSON.stringify(_getCurrentValue())) {
                    _sliceContent();
                    _push(value);
                    _limit();
                    _resetIndex();
                    _exportArray();
                }
            }
        }
        function _moveToPrevious() {
            if (_index > _min) {
                return _moveTo(_index - 1);
            } else {
                return _getCurrentValue();
            }
        }
        function _moveToNext() {
            if (_index < _getMaxPosition()) {
                return _moveTo(_index + 1);
            } else {
                return _getCurrentValue();
            }
        }

        function _init() {
            _importArray();
        }

        _init();
        return {
            toggle: _toggle,
            isEnabled: function() {return _enabled;},
            add: _add,
            moveToPrevious: _moveToPrevious,
            moveToNext: _moveToNext,
            getCurrentValue: _getCurrentValue
        };
    };

    // exports
    window.TWCCHistory = {
        getInstance: function (opts) {
            instance = instance || init(opts);
            return instance;
        }
    };
})(jQuery);;/**
 * This file is part of TWCC.
 *
 * TWCC is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * TWCC is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with TWCC.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @copyright Copyright (c) 2010-2014 Clément Ronzon
 * @license http://www.gnu.org/licenses/agpl.txt
 */


(function ($, App) {
    "use strict";
    /*global window, jQuery, App */

    var _converterWidget, _wmm,
        _cityLocations = App.locations.capitals;

    $.fn.extend({
        // Return a stack sorted
        sort: function () {
            return this.pushStack([].sort.apply(this, arguments), []);
        },
        //Return options sorted
        sortOptions: function (sortCallback) {
            jQuery('option', this).sort(sortCallback).appendTo(this);
            return this;
        },
        // Return groups sorted
        sortGroups: function (sortCallback) {
            jQuery('optgroup', this).sort(sortCallback).appendTo(this);
            return this;
        },
        // Return the selected node with its options sorted by text (ASC)
        sortOptionsByText: function () {
            return this.sortOptions(function (x, y) {
                var xText = jQuery(x).text().toUpperCase(),
                    yText = jQuery(y).text().toUpperCase();
                return (xText < yText) ? -1 : (xText > yText) ? 1 : 0;
            });
        },
        // Return the selected node with its options sorted by text (ASC)
        sortOptgroupsByLabel: function () {
            return this.sortGroups(function (x, y) {
                var xText = jQuery(x).prop('label').toUpperCase(),
                    yText = jQuery(y).prop('label').toUpperCase();
                return (xText < yText) ? -1 : (xText > yText) ? 1 : 0;
            });
        },
        // Return the selected node with its options sorted by text (ASC)
        sortGrpsNOptionsByText: function () {
            var me = this;
            $('optgroup', this).each(function (idx) {
                $('optgroup:eq(' + idx + ')', me).sortOptionsByText();
            });
            return this.sortOptgroupsByLabel();
        },
        // Get a cross domain content through a proxy (GET method only)
        getXDomain: function (options) {
            var proxy = App.system.httpServer + '/' + App.system.dirWsIncludes + 'proxy.php',
                params = options.data ? '?' + $.param(options.data, true) : '';
            return $.ajax($.extend({
                dataType: 'script'
            }, options, {
                url: proxy,
                cache: true,
                data: {u: options.url + params}
            }));
        }
    });

    function _newDeferred(processName, timeOutMs, retryNumber) {
        var dfd = new $.Deferred(function () {
            _trigger($('body'), 'main.start', {name: processName});
        });
        timeOutMs = timeOutMs || App.system.timeout;
        retryNumber = retryNumber || 0;
        // Reject when taking too long
        setTimeout(function timingOut() {
            if (retryNumber > 0) {
                retryNumber--;
                dfd.notify("retry");
                setTimeout(timingOut, timeOutMs);
            } else {
                dfd.reject(processName + " timed out");
            }
        }, timeOutMs);
        // Send loading message every half-second
        setTimeout(function loading() {
            if (dfd.state() === "pending") {
                dfd.notify(processName + " pending");
                setTimeout(loading, 500);
            }
        }, 1);
        _addToQueue(dfd, processName);
        return dfd;
    }

    function _addToQueue(dfd, processName) {
        $.when(dfd).then(
            function () {
                _trigger($('body'), 'main.succeeded', {name: processName});
            },
            function (message) {
                _trigger($('body'), 'main.failed', {name: processName, message: message});
            },
            function (message) {
                _trigger($('body'), 'main.progress', {name: processName, message: message});
            }
        );
    }

    function _t(translationName) {
        return App.translations.hasOwnProperty(translationName) ? App.translations[translationName] : translationName;
    }

    function _trigger($anchor, eventName, data) {
        $anchor.trigger(eventName, {data: data});
    }

    function _sendMsg(b, f, c) {
        var t, u;
        f = f ? f : App.system.applicationNoreply;
        u = App.system.httpServer + '/' + App.system.dirWsIncludes + 's.php';
        t = $.ajax({type: 'POST', url: u, async: false, cache: false, data: 'ff=g'}).responseText;
        if (t.length < 10) {
            alert(_t('messageNotSent') + t);
            return false;
        } else {
            _setCookie(App.system.tokenName, t);
            $.post(u, {ff: 'd', f: f, b: b, l: App.context.languageCode}, function (code) {
                if (typeof(c) == 'function') c(code);
            });
            return true;
        }
    }

    function _getCookie(name) {
        return $.cookie(name);
    }

    function _setCookie(name, content, expires) {
        expires = expires || 30;
        $.cookie(name, content, {expires: expires});
    }

    function _setCookieContent(name, content, expires) {
        _setCookie(name, JSON.stringify(content), expires);
    }

    function _getCookieContent(name) {
        var cookieString = _getCookie(name);
        return cookieString ? $.parseJSON(_getCookie(name)) : {};
    }

    function _setCookieParam(name, id, value, expires) {
        var cookieContent = _getCookieContent(name);
        cookieContent[id] = value;
        _setCookieContent(name, cookieContent, expires);
    }

    function _getCookieParam(name, id) {
        var cookieContent = _getCookieContent(name);
        return cookieContent[id];
    }

    function _setPreferenceCookie(prefId, prefValue) {
        _setCookieParam(App.system.preferencesCookie, prefId, prefValue, 7);
    }

    function _getPreferenceCookie(prefId) {
        return _getCookieParam(App.system.preferencesCookie, prefId);
    }

    function _addOptionToSelect(groupLabel, srsCode, $select, definitionString) {
        var definition = proj4.defs(srsCode),
            label = definition ? definition.title || srsCode : _getTitleFromDefinitionString(definitionString, srsCode),
            optgroupSelector = 'optgroup[label="' + groupLabel + '"]';
        if (!$select.find(optgroupSelector).length) {
            $select.append($('<optgroup>', {label: groupLabel}));
        }
        $select.find(optgroupSelector).append($('<option>', {val: srsCode, text: label}));
    }

    function _bindMapEvents() {
        var $map = $('#map');
        $map.on('linestring.edit_end', function (evt, response) {
            _transformLonLatArray(response.data);
        });
        $map.on('map.click', function (evt, response) {
            _transformLonLat(response.data);
        });
        $map.on('marker.drag_end', function (evt, response) {
            _transformLonLat(response.data);
        });
        $map.on('linestring.add_vertice', function (evt, response) {
            if (_isCsvMode()) {
                var wgs84 = _getWgs84();
                wgs84.push(_lonLatToXy(response.data));
                _transformWgs84Array(wgs84);
            }
        });
        $map.on('linestring.remove_vertice', function (evt, response) {
            if (_isCsvMode()) {
                var xy = _lonLatToXy(response.data);
                var wgs84 = _getWgs84().filter(function (vertice) {
                    return !(vertice.x === xy.x && vertice.y === xy.y);
                });
                _transformWgs84Array(wgs84);
            }
        });
        $map.on('place.changed', function (evt, response) {
            _transformLonLat(response.data);
        });
        $map.on('map.layer.change', function (evt, response) {
            var strs = response.data.split(' ');
            var layers = _getPreferenceCookie('layers') || {};
            if (strs.indexOf('on') > -1 || strs.indexOf('off') > -1) {
                if (!layers.hasOwnProperty('opt')) {
                    layers.opt = {};
                }
                layers.opt[strs[1]] = strs[2] === 'on';
            } else {
                layers.base = {};
                layers.base[strs[0]] = strs[1];
            }
            _setPreferenceCookie('layers', layers);
        });
    }

    function _getTitleFromDefinitionString(definitionString, srsCode) {
        var testReg = /\+title=/ig,
            replaceReg = /.*\+title=([^\+]+).*/ig;
        return testReg.test(definitionString) ? definitionString.replace(replaceReg, '$1') : srsCode;
    }

    /*function _getStaticMapUrl() {
        var staticMapURL = "https://maps.googleapis.com/maps/api/staticmap?",
            wgs84 = _getWgs84();
        staticMapURL += "&zoom=" + _getZoom();
        staticMapURL += "&size=640x640";
        staticMapURL += "&visual_refresh=true";
        staticMapURL += "&language=" + App.context.languageCode;
        if (wgs84.length == 1) {
            staticMapURL += "&markers=" + wgs84[0].y + "," + wgs84[0].x;
        } else {
            var tmp = [];
            $.each(wgs84, function(index, value) {
                tmp.push(value.y + "," + value.x);
            });
            staticMapURL += "&path=geodesic:true|" + tmp.join("|");
        }
        staticMapURL += "&sensor=false";
        return staticMapURL;
    }

    function _openStaticMap() {
        window.open(_getStaticMapUrl(), '_blank');
    }*/

    function _getRandomCityLocation() {
        var idx = App.math.getRandomInteger(0, _cityLocations.length - 1),
            x = _cityLocations[idx].lng,
            y = _cityLocations[idx].lat;
        return {x: x, y: y};
    }

    function _getWgs84() {
        return _converterWidget.wgs84().slice();
    }

    function _transformLonLatArray(lonLatArray) {
        if (!_isCsvMode()) {
            App.TWCCUi.setCsvMode(true);
        }
        _transformWgs84Array(lonLatArray.map(_lonLatToXy));
    }

    function _transformLonLat(lonLat) {
        _transformWgs84Array([_lonLatToXy(lonLat)]);
    }

    function _transformWgs84Array(wgs84) {
        _converterWidget.transform({wgs84: wgs84});
    }

    function _lonLatToXy(lonLat) {
        return {x: lonLat[0], y: lonLat[1]};
    }

    function _isCsvMode() {
        return _converterWidget.csv();
    }

    function _getConvergenceConvention() {
        return App.TWCCUi.getConvergenceConvention();
    }

    function _getZoom() {
        var view = App.map.getView();
        return view.getZoom();
    }

    function _enableAutoZoom(enabled) {
        App.TWCCMap.model.setBoolean('autoZoom', enabled);
    }

    function _getWMM() {
        return _wmm;
    }

    function _degToRad(dValue) {
        var rValue;
        switch ($.type(dValue)) {
            case 'object':
                rValue = {};
                $.each(dValue, function (target, value) {
                    if (value && $.type(value) !== 'number') {
                        throw 'Wrong data type';
                    }
                    rValue[target] = _degToRad(value);
                });
                break;
            case 'number':
                rValue = $.type(dValue) === 'number' ? dValue * Math.PI / 180 : undefined;
                break;
        }
        return rValue;
    }

    function _radToDeg(rValue) {
        return $.type(rValue) === 'number' ? rValue * 180 / Math.PI : undefined;
    }

    /**
     * Add Utils
     */
    $.extend(App, {
        utils: {
            addOptionToSelect: _addOptionToSelect,
            degToRad: _degToRad,
            enableAutoZoom: _enableAutoZoom,
            getConvergenceConvention: _getConvergenceConvention,
            getCookieContent: _getCookieContent,
            getPreferenceCookie: _getPreferenceCookie,
            getRandomCityLocation: _getRandomCityLocation,
            getTitleFromDefinitionString: _getTitleFromDefinitionString,
            getWMM: _getWMM,
            newDeferred: _newDeferred,
            //openStaticMap: _openStaticMap,
            radToDeg: _radToDeg,
            sendMsg: _sendMsg,
            setCookie: _setCookie,
            setCookieContent: _setCookieContent,
            setPreferenceCookie: _setPreferenceCookie,
            t: _t,
            trigger: _trigger
        }
    });

    /**
     * Add Constants
     */
    $.extend(App, {
        constants: {
            keyboard: {
                RETURN: 13
            }
        }
    });

    /**
     * Add Class generator
     */
    $.extend(App, {
        Class: function (methods) {
            var klass = function () {
                this.initialize.apply(this, arguments);
            };

            for (var property in methods) {
                if (methods.hasOwnProperty(property)) {
                    klass.prototype[property] = methods[property];
                }
            }

            klass.prototype.initialize = klass.prototype.initialize || function () {
            };

            return klass;
        }
    });

    /**
     * Add Initializers
     */
    $.extend(App, {
        initialisers: {
            initializeMap: function () {
                var _options = $.extend(true, {}, App, App.TWCCMapOptions);
                delete _options.TWCCMapOptions; //Already passed
                App.TWCCMap = window.TWCCMap.getInstance(_options);
                App.map = App.TWCCMap.getMap();
                _bindMapEvents();
                return App.TWCCMap.promise;
            },
            initializeUi: function () {
                var _options = $.extend(true, {}, App);
                App.TWCCUi = window.TWCCUi.getInstance(_options);
                return App.TWCCUi.promise;
            },
            initializeConverter: function () {
                var _options = $.extend(true, {}, App, App.TWCCConverterOptions);
                delete _options.TWCCConverterOptions; //Already passed
                App.TWCCConverter = window.TWCCConverter.getInstance(_options);
                _converterWidget = App.TWCCConverter.converterWidget;
                return App.TWCCConverter.promise;
            }
        }
    });

    function _init() {
        var title = '*GPS (WGS84) (deg)',
            wgs84 = {
                title: title,
                defData: '+title=' + title + ' +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees',
                isConnector: false
            };
        if ($.type(Math.sinh) !== "function") {
            Math.sinh = function (z) {
                return (Math.exp(z) - Math.exp(-z)) / 2;
            };
        }
        $.ajax({
            url: '/js/data/WMM.COF',
            cache: true,
            dataType: 'text'
        }).done(function (cof) {
            _wmm = geoMagFactory(cof2Obj(cof));
        }).fail(function () {
            _wmm = function () {
                return {};
            };
        });
        $.extend(proj4.WGS84, wgs84);
        $.extend(proj4.defs('WGS84'), wgs84);
        App.initialisers.initializeUi().done(_initMap);
    }

    function _initMap() {
        App.initialisers.initializeMap().done(_initConverter);
    }

    function _initConverter() {
        App.initialisers.initializeConverter().done(function (data) {
            if (App.context.GET.isSetGraticule) {
                App.TWCCMap.setGraticule();
            }
            App.TWCCUi.startHelp();
            _trigger($('body'), 'main.ready', data);
        });
    }

    $(document).ready(_init);
})(jQuery, App);
;(function($, App) {
    "use strict";
    /*global window, jQuery, App */

    function _getRandomInteger(start, end) {
        var x, y, rnd;
        x = end - start;
        y = start;
        rnd = Math.random()*x + y;
        return Math.round(rnd);
    }

    function _round(value, decimals) {
        var valStr;
        decimals = decimals === undefined ? 0 : decimals;
        valStr = value.toString();
        if (valStr === '' || valStr == 'NaN') {
            return '';
        } else {
            return Math.round(_parseFloat(value) * Math.pow(10, _parseFloat(decimals))) / Math.pow(10, _parseFloat(decimals));
        }
    }

    function _parseFloat(value) {
        value = value.toString().replace(/,/gi, '.');
        if (isNaN(value)) value = 0;
        return parseFloat(value);
    }

    /**
     * Add Math to App
     */
    $.extend(App, {
        math: {
            getRandomInteger: _getRandomInteger,
            round: _round,
            parseFloat: _parseFloat
        }
    });
})(jQuery, App);;/*! Copyright (c) 2013 Brandon Aaron (http://brandon.aaron.sh)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Version 3.0.1
 *
 * Requires jQuery >= 1.2.6
 */

(function (factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['jquery'], factory);
    } else if (typeof exports === 'object') {
        // Node/CommonJS style for Browserify
        module.exports = factory;
    } else {
        // Browser globals
        factory(jQuery);
    }
}(function ($) {
    $.fn.bgiframe = function(s) {
        s = $.extend({
            top         : 'auto', // auto == borderTopWidth
            left        : 'auto', // auto == borderLeftWidth
            width       : 'auto', // auto == offsetWidth
            height      : 'auto', // auto == offsetHeight
            opacity     : true,
            src         : 'javascript:false;',
            conditional : /MSIE 6\.0/.test(navigator.userAgent) // expresion or function. return false to prevent iframe insertion
        }, s);

        // wrap conditional in a function if it isn't already
        if (!$.isFunction(s.conditional)) {
            var condition = s.conditional;
            s.conditional = function() { return condition; };
        }

        var $iframe = $('<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+s.src+'"'+
                           'style="display:block;position:absolute;z-index:-1;"/>');

        return this.each(function() {
            var $this = $(this);
            if ( s.conditional(this) === false ) { return; }
            var existing = $this.children('iframe.bgiframe');
            var $el = existing.length === 0 ? $iframe.clone() : existing;
            $el.css({
                'top': s.top == 'auto' ?
                    ((parseInt($this.css('borderTopWidth'),10)||0)*-1)+'px' : prop(s.top),
                'left': s.left == 'auto' ?
                    ((parseInt($this.css('borderLeftWidth'),10)||0)*-1)+'px' : prop(s.left),
                'width': s.width == 'auto' ? (this.offsetWidth + 'px') : prop(s.width),
                'height': s.height == 'auto' ? (this.offsetHeight + 'px') : prop(s.height),
                'opacity': s.opacity === true ? 0 : undefined
            });

            if ( existing.length === 0 ) {
                $this.prepend($el);
            }
        });
    };

    // old alias
    $.fn.bgIframe = $.fn.bgiframe;

    function prop(n) {
        return n && n.constructor === Number ? n + 'px' : n;
    }

}));
;/*
 * @name BeautyTips
 * @desc a tooltips/baloon-help plugin for jQuery
 *
 * @author Jeff Robbins - Lullabot - http://www.lullabot.com
 * @version 0.9.5 release candidate 1  (5/20/2009)
 */
jQuery.bt={version:'0.9.5-rc1'};;(function($){jQuery.fn.bt=function(content,options){if(typeof content!='string'){var contentSelect=true;options=content;content=false;}
else{var contentSelect=false;}
if(jQuery.fn.hoverIntent&&jQuery.bt.defaults.trigger=='hover'){jQuery.bt.defaults.trigger='hoverIntent';}
return this.each(function(index){var opts=jQuery.extend(false,jQuery.bt.defaults,jQuery.bt.options,options);opts.spikeLength=numb(opts.spikeLength);opts.spikeGirth=numb(opts.spikeGirth);opts.overlap=numb(opts.overlap);var ajaxTimeout=false;if(opts.killTitle){$(this).find('[title]').addBack().each(function(){if(!$(this).prop('bt-xTitle')){$(this).prop('bt-xTitle',$(this).prop('title')).prop('title','');}});}
if(typeof opts.tpropigger=='string'){opts.trigger=[opts.trigger];}
if(opts.trigger[0]=='hoverIntent'){var hoverOpts=jQuery.extend(opts.hoverIntentOpts,{over:function(){this.btOn();},out:function(){this.btOff();}});$(this).hoverIntent(hoverOpts);}
else if(opts.trigger[0]=='hover'){$(this).hover(function(){this.btOn();},function(){this.btOff();});}
else if(opts.trigger[0]=='now'){if($(this).hasClass('bt-active')){this.btOff();}
else{this.btOn();}}
else if(opts.trigger[0]=='none'){}
else if(opts.trigger.length>1&&opts.trigger[0]!=opts.trigger[1]){$(this).bind(opts.trigger[0],function(){this.btOn();}).bind(opts.trigger[1],function(){this.btOff();});}
else{$(this).bind(opts.trigger[0],function(){if($(this).hasClass('bt-active')){this.btOff();}
else{this.btOn();}});}
this.btOn=function(){if(typeof $(this).data('bt-box')=='object'){this.btOff();}
opts.preBuild.apply(this);$(jQuery.bt.vars.closeWhenOpenStack).btOff();$(this).addClass('bt-active '+opts.activeClass);if(contentSelect&&opts.ajaxPath==null){if(opts.killTitle){$(this).prop('title',$(this).prop('bt-xTitle'));}
content=$.isFunction(opts.contentSelector)?opts.contentSelector.apply(this):eval(opts.contentSelector);if(opts.killTitle){$(this).prop('title','');}}
if(opts.ajaxPath!=null&&content==false){if(typeof opts.ajaxPath=='object'){var url=eval(opts.ajaxPath[0]);url+=opts.ajaxPath[1]?' '+opts.ajaxPath[1]:'';}
else{var url=opts.ajaxPath;}
var off=url.indexOf(" ");if(off>=0){var selector=url.slice(off,url.length);url=url.slice(0,off);}
var cacheData=opts.ajaxCache?$(document.body).data('btCache-'+url.replace(/\./g,'')):null;if(typeof cacheData=='string'){content=selector?$("<div/>").append(cacheData.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):cacheData;}
else{var target=this;var ajaxOpts=jQuery.extend(false,{type:opts.ajaxType,data:opts.ajaxData,cache:opts.ajaxCache,url:url,complete:function(XMLHttpRequest,textStatus){if(textStatus=='success'||textStatus=='notmodified'){if(opts.ajaxCache){$(document.body).data('btCache-'+url.replace(/\./g,''),XMLHttpRequest.responseText);}
ajaxTimeout=false;content=selector?$("<div/>").append(XMLHttpRequest.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):XMLHttpRequest.responseText;}
else{if(textStatus=='timeout'){ajaxTimeout=true;}
content=opts.ajaxError.replace(/%error/g,XMLHttpRequest.statusText);}
if($(target).hasClass('bt-active')){target.btOn();}}},opts.ajaxOpts);jQuery.ajax(ajaxOpts);content=opts.ajaxLoading;}}
var shadowMarginX=0;var shadowMarginY=0;var shadowShiftX=0;var shadowShiftY=0;if(opts.shadow&&!shadowSupport()){opts.shadow=false;jQuery.extend(opts,opts.noShadowOpts);}
if(opts.shadow){if(opts.shadowBlur>Math.abs(opts.shadowOffsetX)){shadowMarginX=opts.shadowBlur*2;}
else{shadowMarginX=opts.shadowBlur+Math.abs(opts.shadowOffsetX);}
shadowShiftX=(opts.shadowBlur-opts.shadowOffsetX)>0?opts.shadowBlur-opts.shadowOffsetX:0;if(opts.shadowBlur>Math.abs(opts.shadowOffsetY)){shadowMarginY=opts.shadowBlur*2;}
else{shadowMarginY=opts.shadowBlur+Math.abs(opts.shadowOffsetY);}
shadowShiftY=(opts.shadowBlur-opts.shadowOffsetY)>0?opts.shadowBlur-opts.shadowOffsetY:0;}
if(opts.offsetParent){var offsetParent=$(opts.offsetParent);var offsetParentPos=offsetParent.offset();var pos=$(this).offset();var top=numb(pos.top)-numb(offsetParentPos.top)+numb($(this).css('margin-top'))-shadowShiftY;var left=numb(pos.left)-numb(offsetParentPos.left)+numb($(this).css('margin-left'))-shadowShiftX;}
else{var offsetParent=($(this).css('position')=='absolute')?$(this).parents().eq(0).offsetParent():$(this).offsetParent();var pos=$(this).btPosition();var top=numb(pos.top)+numb($(this).css('margin-top'))-shadowShiftY;var left=numb(pos.left)+numb($(this).css('margin-left'))-shadowShiftX;}
var width=$(this).btOuterWidth();var height=$(this).outerHeight();if(typeof content=='object'){if(content==null){return;}
var original=content;var clone=$(original).clone(true).show();var origClones=$(original).data('bt-clones')||[];origClones.push(clone);$(original).data('bt-clones',origClones);$(clone).data('bt-orig',original);$(this).data('bt-content-orig',{original:original,clone:clone});content=clone;}
if(typeof content=='null'||content==''){return;}
var $text=$('<div class="bt-content"></div>').append(content).css({padding:opts.padding,position:'absolute',width:(opts.shrinkToFit?'auto':opts.width),zIndex:opts.textzIndex,left:shadowShiftX,top:shadowShiftY}).css(opts.cssStyles);var $box=$('<div class="bt-wrapper"></div>').append($text).addClass(opts.cssClass).css({position:'absolute',width:opts.width,zIndex:opts.wrapperzIndex,visibility:'hidden'}).appendTo(offsetParent);if(jQuery.fn.bgiframe){$text.bgiframe();$box.bgiframe();}
$(this).data('bt-box',$box);var scrollTop=numb($(document).scrollTop());var scrollLeft=numb($(document).scrollLeft());var docWidth=numb($(window).width());var docHeight=numb($(window).height());var winRight=scrollLeft+docWidth;var winBottom=scrollTop+docHeight;var space=new Object();var thisOffset=$(this).offset();space.top=thisOffset.top-scrollTop;space.bottom=docHeight-((thisOffset+height)-scrollTop);space.left=thisOffset.left-scrollLeft;space.right=docWidth-((thisOffset.left+width)-scrollLeft);var textOutHeight=numb($text.outerHeight());var textOutWidth=numb($text.btOuterWidth());if(opts.positions.constructor==String){opts.positions=opts.positions.replace(/ /,'').split(',');}
if(opts.positions[0]=='most'){var position='top';for(var pig in space){position=space[pig]>space[position]?pig:position;}}
else{for(var x in opts.positions){var position=opts.positions[x];if((position=='left'||position=='right')&&space[position]>textOutWidth+opts.spikeLength){break;}
else if((position=='top'||position=='bottom')&&space[position]>textOutHeight+opts.spikeLength){break;}}}
var horiz=left+((width-textOutWidth)*.5);var vert=top+((height-textOutHeight)*.5);var points=new Array();var textTop,textLeft,textRight,textBottom,textTopSpace,textBottomSpace,textLeftSpace,textRightSpace,crossPoint,textCenter,spikePoint;switch(position){case'top':$text.css('margin-bottom',opts.spikeLength+'px');$box.css({top:(top-$text.outerHeight(true))+opts.overlap,left:horiz});textRightSpace=(winRight-opts.windowMargin)-($text.offset().left+$text.btOuterWidth(true));var xShift=shadowShiftX;if(textRightSpace<0){$box.css('left',(numb($box.css('left'))+textRightSpace)+'px');xShift-=textRightSpace;}
textLeftSpace=($text.offset().left+numb($text.css('margin-left')))-(scrollLeft+opts.windowMargin);if(textLeftSpace<0){$box.css('left',(numb($box.css('left'))-textLeftSpace)+'px');xShift+=textLeftSpace;}
textTop=$text.btPosition().top+numb($text.css('margin-top'));textLeft=$text.btPosition().left+numb($text.css('margin-left'));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={y:textBottom+opts.spikeLength,x:((textRight-textLeft)*.5)+xShift,type:'spike'};crossPoint=findIntersectX(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textBottom);crossPoint.x=crossPoint.x<textLeft+opts.spikeGirth/2+opts.cornerRadius?textLeft+opts.spikeGirth/2+opts.cornerRadius:crossPoint.x;crossPoint.x=crossPoint.x>(textRight-opts.spikeGirth/2)-opts.cornerRadius?(textRight-opts.spikeGirth/2)-opts.CornerRadius:crossPoint.x;points[points.length]={x:crossPoint.x-(opts.spikeGirth/2),y:textBottom,type:'join'};points[points.length]={x:textLeft,y:textBottom,type:'corner'};points[points.length]={x:textLeft,y:textTop,type:'corner'};points[points.length]={x:textRight,y:textTop,type:'corner'};points[points.length]={x:textRight,y:textBottom,type:'corner'};points[points.length]={x:crossPoint.x+(opts.spikeGirth/2),y:textBottom,type:'join'};points[points.length]=spikePoint;break;case'left':$text.css('margin-right',opts.spikeLength+'px');$box.css({top:vert+'px',left:((left-$text.btOuterWidth(true))+opts.overlap)+'px'});textBottomSpace=(winBottom-opts.windowMargin)-($text.offset().top+$text.outerHeight(true));var yShift=shadowShiftY;if(textBottomSpace<0){$box.css('top',(numb($box.css('top'))+textBottomSpace)+'px');yShift-=textBottomSpace;}
textTopSpace=($text.offset().top+numb($text.css('margin-top')))-(scrollTop+opts.windowMargin);if(textTopSpace<0){$box.css('top',(numb($box.css('top'))-textTopSpace)+'px');yShift+=textTopSpace;}
textTop=$text.btPosition().top+numb($text.css('margin-top'));textLeft=$text.btPosition().left+numb($text.css('margin-left'));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={x:textRight+opts.spikeLength,y:((textBottom-textTop)*.5)+yShift,type:'spike'};crossPoint=findIntersectY(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textRight);crossPoint.y=crossPoint.y<textTop+opts.spikeGirth/2+opts.cornerRadius?textTop+opts.spikeGirth/2+opts.cornerRadius:crossPoint.y;crossPoint.y=crossPoint.y>(textBottom-opts.spikeGirth/2)-opts.cornerRadius?(textBottom-opts.spikeGirth/2)-opts.cornerRadius:crossPoint.y;points[points.length]={x:textRight,y:crossPoint.y+opts.spikeGirth/2,type:'join'};points[points.length]={x:textRight,y:textBottom,type:'corner'};points[points.length]={x:textLeft,y:textBottom,type:'corner'};points[points.length]={x:textLeft,y:textTop,type:'corner'};points[points.length]={x:textRight,y:textTop,type:'corner'};points[points.length]={x:textRight,y:crossPoint.y-opts.spikeGirth/2,type:'join'};points[points.length]=spikePoint;break;case'bottom':$text.css('margin-top',opts.spikeLength+'px');$box.css({top:(top+height)-opts.overlap,left:horiz});textRightSpace=(winRight-opts.windowMargin)-($text.offset().left+$text.btOuterWidth(true));var xShift=shadowShiftX;if(textRightSpace<0){$box.css('left',(numb($box.css('left'))+textRightSpace)+'px');xShift-=textRightSpace;}
textLeftSpace=($text.offset().left+numb($text.css('margin-left')))-(scrollLeft+opts.windowMargin);if(textLeftSpace<0){$box.css('left',(numb($box.css('left'))-textLeftSpace)+'px');xShift+=textLeftSpace;}
textTop=$text.btPosition().top+numb($text.css('margin-top'));textLeft=$text.btPosition().left+numb($text.css('margin-left'));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={x:((textRight-textLeft)*.5)+xShift,y:shadowShiftY,type:'spike'};crossPoint=findIntersectX(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textTop);crossPoint.x=crossPoint.x<textLeft+opts.spikeGirth/2+opts.cornerRadius?textLeft+opts.spikeGirth/2+opts.cornerRadius:crossPoint.x;crossPoint.x=crossPoint.x>(textRight-opts.spikeGirth/2)-opts.cornerRadius?(textRight-opts.spikeGirth/2)-opts.cornerRadius:crossPoint.x;points[points.length]={x:crossPoint.x+opts.spikeGirth/2,y:textTop,type:'join'};points[points.length]={x:textRight,y:textTop,type:'corner'};points[points.length]={x:textRight,y:textBottom,type:'corner'};points[points.length]={x:textLeft,y:textBottom,type:'corner'};points[points.length]={x:textLeft,y:textTop,type:'corner'};points[points.length]={x:crossPoint.x-(opts.spikeGirth/2),y:textTop,type:'join'};points[points.length]=spikePoint;break;case'right':$text.css('margin-left',(opts.spikeLength+'px'));$box.css({top:vert+'px',left:((left+width)-opts.overlap)+'px'});textBottomSpace=(winBottom-opts.windowMargin)-($text.offset().top+$text.outerHeight(true));var yShift=shadowShiftY;if(textBottomSpace<0){$box.css('top',(numb($box.css('top'))+textBottomSpace)+'px');yShift-=textBottomSpace;}
textTopSpace=($text.offset().top+numb($text.css('margin-top')))-(scrollTop+opts.windowMargin);if(textTopSpace<0){$box.css('top',(numb($box.css('top'))-textTopSpace)+'px');yShift+=textTopSpace;}
textTop=$text.btPosition().top+numb($text.css('margin-top'));textLeft=$text.btPosition().left+numb($text.css('margin-left'));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={x:shadowShiftX,y:((textBottom-textTop)*.5)+yShift,type:'spike'};crossPoint=findIntersectY(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textLeft);crossPoint.y=crossPoint.y<textTop+opts.spikeGirth/2+opts.cornerRadius?textTop+opts.spikeGirth/2+opts.cornerRadius:crossPoint.y;crossPoint.y=crossPoint.y>(textBottom-opts.spikeGirth/2)-opts.cornerRadius?(textBottom-opts.spikeGirth/2)-opts.cornerRadius:crossPoint.y;points[points.length]={x:textLeft,y:crossPoint.y-opts.spikeGirth/2,type:'join'};points[points.length]={x:textLeft,y:textTop,type:'corner'};points[points.length]={x:textRight,y:textTop,type:'corner'};points[points.length]={x:textRight,y:textBottom,type:'corner'};points[points.length]={x:textLeft,y:textBottom,type:'corner'};points[points.length]={x:textLeft,y:crossPoint.y+opts.spikeGirth/2,type:'join'};points[points.length]=spikePoint;break;}
var canvas=document.createElement('canvas');$(canvas).prop('width',(numb($text.btOuterWidth(true))+opts.strokeWidth*2+shadowMarginX)).prop('height',(numb($text.outerHeight(true))+opts.strokeWidth*2+shadowMarginY)).appendTo($box).css({position:'absolute',zIndex:opts.boxzIndex});if(typeof G_vmlCanvasManager!='undefined'){canvas=G_vmlCanvasManager.initElement(canvas);}
if(opts.cornerRadius>0){var newPoints=new Array();var newPoint;for(var i=0;i<points.length;i++){if(points[i].type=='corner'){newPoint=betweenPoint(points[i],points[(i-1)%points.length],opts.cornerRadius);newPoint.type='arcStart';newPoints[newPoints.length]=newPoint;newPoints[newPoints.length]=points[i];newPoint=betweenPoint(points[i],points[(i+1)%points.length],opts.cornerRadius);newPoint.type='arcEnd';newPoints[newPoints.length]=newPoint;}
else{newPoints[newPoints.length]=points[i];}}
points=newPoints;}
var ctx=canvas.getContext("2d");if(opts.shadow&&opts.shadowOverlap!==true){var shadowOverlap=numb(opts.shadowOverlap);switch(position){case'top':if(opts.shadowOffsetX+opts.shadowBlur-shadowOverlap>0){$box.css('top',(numb($box.css('top'))-(opts.shadowOffsetX+opts.shadowBlur-shadowOverlap)));}
break;case'right':if(shadowShiftX-shadowOverlap>0){$box.css('left',(numb($box.css('left'))+shadowShiftX-shadowOverlap));}
break;case'bottom':if(shadowShiftY-shadowOverlap>0){$box.css('top',(numb($box.css('top'))+shadowShiftY-shadowOverlap));}
break;case'left':if(opts.shadowOffsetY+opts.shadowBlur-shadowOverlap>0){$box.css('left',(numb($box.css('left'))-(opts.shadowOffsetY+opts.shadowBlur-shadowOverlap)));}
break;}}
drawIt.apply(ctx,[points],opts.strokeWidth);ctx.fillStyle=opts.fill;if(opts.shadow){ctx.shadowOffsetX=opts.shadowOffsetX;ctx.shadowOffsetY=opts.shadowOffsetY;ctx.shadowBlur=opts.shadowBlur;ctx.shadowColor=opts.shadowColor;}
ctx.closePath();ctx.fill();if(opts.strokeWidth>0){ctx.shadowColor='rgba(0, 0, 0, 0)';ctx.lineWidth=opts.strokeWidth;ctx.strokeStyle=opts.strokeStyle;ctx.beginPath();drawIt.apply(ctx,[points],opts.strokeWidth);ctx.closePath();ctx.stroke();}
opts.preShow.apply(this,[$box[0]]);$box.css({display:'none',visibility:'visible'});opts.showTip.apply(this,[$box[0]]);if(opts.overlay){var overlay=$('<div class="bt-overlay"></div>').css({position:'absolute',backgroundColor:'blue',top:top,left:left,width:width,height:height,opacity:'.2'}).appendTo(offsetParent);$(this).data('overlay',overlay);}
if((opts.ajaxPath!=null&&opts.ajaxCache==false)||ajaxTimeout){content=false;}
if(opts.clickAnywhereToClose){jQuery.bt.vars.clickAnywhereStack.push(this);$(document).click(jQuery.bt.docClick);}
if(opts.closeWhenOthersOpen){jQuery.bt.vars.closeWhenOpenStack.push(this);}
opts.postShow.apply(this,[$box[0]]);};this.btOff=function(){var box=$(this).data('bt-box');if(typeof box=='undefined'){return;}
opts.preHide.apply(this,[box]);var i=this;i.btCleanup=function(){var box=$(i).data('bt-box');var contentOrig=$(i).data('bt-content-orig');var overlay=$(i).data('bt-overlay');if(typeof box=='object'){$(box).remove();$(i).removeData('bt-box');}
if(typeof contentOrig=='object'){var clones=$(contentOrig.original).data('bt-clones');$(contentOrig).data('bt-clones',arrayRemove(clones,contentOrig.clone));}
if(typeof overlay=='object'){$(overlay).remove();$(i).removeData('bt-overlay');}
jQuery.bt.vars.clickAnywhereStack=arrayRemove(jQuery.bt.vars.clickAnywhereStack,i);jQuery.bt.vars.closeWhenOpenStack=arrayRemove(jQuery.bt.vars.closeWhenOpenStack,i);$(i).removeClass('bt-active '+opts.activeClass);opts.postHide.apply(i);}
opts.hideTip.apply(this,[box,i.btCleanup]);};var refresh=this.btRefresh=function(){this.btOff();this.btOn();};});function drawIt(points,strokeWidth){this.moveTo(points[0].x,points[0].y);for(i=1;i<points.length;i++){if(points[i-1].type=='arcStart'){this.quadraticCurveTo(round5(points[i].x,strokeWidth),round5(points[i].y,strokeWidth),round5(points[(i+1)%points.length].x,strokeWidth),round5(points[(i+1)%points.length].y,strokeWidth));i++;}
else{this.lineTo(round5(points[i].x,strokeWidth),round5(points[i].y,strokeWidth));}}};function round5(num,strokeWidth){var ret;strokeWidth=numb(strokeWidth);if(strokeWidth%2){ret=num;}
else{ret=Math.round(num-.5)+.5;}
return ret;};function numb(num){return parseInt(num)||0;};function arrayRemove(arr,elem){var x,newArr=new Array();for(x in arr){if(arr[x]!=elem){newArr.push(arr[x]);}}
return newArr;};function canvasSupport(){var canvas_compatible=false;try{canvas_compatible=!!(document.createElement('canvas').getContext('2d'));}catch(e){canvas_compatible=!!(document.createElement('canvas').getContext);}
return canvas_compatible;}
function shadowSupport(){try{var userAgent=navigator.userAgent.toLowerCase();if(/webkit/.test(userAgent)){return true;}
else if(/gecko|mozilla/.test(userAgent)&&parseFloat(userAgent.match(/firefox\/(\d+(?:\.\d+)+)/)[1])>=3.1){return true;}}
catch(err){}
return false;}
function betweenPoint(point1,point2,dist){var y,x;if(point1.x==point2.x){y=point1.y<point2.y?point1.y+dist:point1.y-dist;return{x:point1.x,y:y};}
else if(point1.y==point2.y){x=point1.x<point2.x?point1.x+dist:point1.x-dist;return{x:x,y:point1.y};}};function centerPoint(arcStart,corner,arcEnd){var x=corner.x==arcStart.x?arcEnd.x:arcStart.x;var y=corner.y==arcStart.y?arcEnd.y:arcStart.y;var startAngle,endAngle;if(arcStart.x<arcEnd.x){if(arcStart.y>arcEnd.y){startAngle=(Math.PI/180)*180;endAngle=(Math.PI/180)*90;}
else{startAngle=(Math.PI/180)*90;endAngle=0;}}
else{if(arcStart.y>arcEnd.y){startAngle=(Math.PI/180)*270;endAngle=(Math.PI/180)*180;}
else{startAngle=0;endAngle=(Math.PI/180)*270;}}
return{x:x,y:y,type:'center',startAngle:startAngle,endAngle:endAngle};};function findIntersect(r1x1,r1y1,r1x2,r1y2,r2x1,r2y1,r2x2,r2y2){if(r2x1==r2x2){return findIntersectY(r1x1,r1y1,r1x2,r1y2,r2x1);}
if(r2y1==r2y2){return findIntersectX(r1x1,r1y1,r1x2,r1y2,r2y1);}
var r1m=(r1y1-r1y2)/(r1x1-r1x2);var r1b=r1y1-(r1m*r1x1);var r2m=(r2y1-r2y2)/(r2x1-r2x2);var r2b=r2y1-(r2m*r2x1);var x=(r2b-r1b)/(r1m-r2m);var y=r1m*x+r1b;return{x:x,y:y};};function findIntersectY(r1x1,r1y1,r1x2,r1y2,x){if(r1y1==r1y2){return{x:x,y:r1y1};}
var r1m=(r1y1-r1y2)/(r1x1-r1x2);var r1b=r1y1-(r1m*r1x1);var y=r1m*x+r1b;return{x:x,y:y};};function findIntersectX(r1x1,r1y1,r1x2,r1y2,y){if(r1x1==r1x2){return{x:r1x1,y:y};}
var r1m=(r1y1-r1y2)/(r1x1-r1x2);var r1b=r1y1-(r1m*r1x1);var x=(y-r1b)/r1m;return{x:x,y:y};};};jQuery.fn.btPosition=function(){function num(elem,prop){return elem[0]&&parseInt(jQuery.css(elem[0],prop,true),10)||0;};var left=0,top=0,results;if(this[0]){var offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=/^body|html$/i.test(offsetParent[0].tagName)?{top:0,left:0}:offsetParent.offset();offset.top-=num(this,'marginTop');offset.left-=num(this,'marginLeft');parentOffset.top+=num(offsetParent,'borderTopWidth');parentOffset.left+=num(offsetParent,'borderLeftWidth');results={top:offset.top-parentOffset.top,left:offset.left-parentOffset.left};}
return results;};jQuery.fn.btOuterWidth=function(margin){function num(elem,prop){return elem[0]&&parseInt(jQuery.css(elem[0],prop,true),10)||0;};return this["innerWidth"]()
+num(this,"borderLeftWidth")
+num(this,"borderRightWidth")
+(margin?num(this,"marginLeft")
+num(this,"marginRight"):0);};jQuery.fn.btOn=function(){return this.each(function(index){if(jQuery.isFunction(this.btOn)){this.btOn();}});};jQuery.fn.btOff=function(){return this.each(function(index){if(jQuery.isFunction(this.btOff)){this.btOff();}});};jQuery.bt.vars={clickAnywhereStack:[],closeWhenOpenStack:[]};jQuery.bt.docClick=function(e){if(!e){var e=window.event;};if(!$(e.target).parents().addBack().filter('.bt-wrapper, .bt-active').length&&jQuery.bt.vars.clickAnywhereStack.length){$(jQuery.bt.vars.clickAnywhereStack).btOff();$(document).unbind('click',jQuery.bt.docClick);}};jQuery.bt.defaults={trigger:'hover',clickAnywhereToClose:true,closeWhenOthersOpen:false,shrinkToFit:false,width:'200px',padding:'10px',spikeGirth:10,spikeLength:15,overlap:0,overlay:false,killTitle:true,textzIndex:9999,boxzIndex:9998,wrapperzIndex:9997,offsetParent:null,positions:['most'],fill:"rgb(255, 255, 102)",windowMargin:10,strokeWidth:1,strokeStyle:"#000",cornerRadius:5,centerPointX:.5,centerPointY:.5,shadow:false,shadowOffsetX:2,shadowOffsetY:2,shadowBlur:3,shadowColor:"#000",shadowOverlap:false,noShadowOpts:{strokeStyle:'#999'},cssClass:'',cssStyles:{},activeClass:'bt-active',contentSelector:"$(this).prop('title')",ajaxPath:null,ajaxError:'<strong>ERROR:</strong> <em>%error</em>',ajaxLoading:'<blink>Loading...</blink>',ajaxData:{},ajaxType:'GET',ajaxCache:true,ajaxOpts:{},preBuild:function(){},preShow:function(box){},showTip:function(box){$(box).show();},postShow:function(box){},preHide:function(box){},hideTip:function(box,callback){$(box).hide();callback();},postHide:function(){},hoverIntentOpts:{interval:300,timeout:500}};jQuery.bt.options={};})(jQuery);;/*! jQuery UI - v1.11.2 - 2014-12-08
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, position.js, draggable.js, droppable.js, resizable.js, selectable.js, sortable.js, accordion.js, autocomplete.js, button.js, datepicker.js, dialog.js, menu.js, progressbar.js, selectmenu.js, slider.js, spinner.js, tabs.js, tooltip.js, effect.js, effect-blind.js, effect-bounce.js, effect-clip.js, effect-drop.js, effect-explode.js, effect-fade.js, effect-fold.js, effect-highlight.js, effect-puff.js, effect-pulsate.js, effect-scale.js, effect-shake.js, effect-size.js, effect-slide.js, effect-transfer.js
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */

(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/input|select|textarea|button|object/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}function s(e){for(var t,i;e.length&&e[0]!==document;){if(t=e.css("position"),("absolute"===t||"relative"===t||"fixed"===t)&&(i=parseInt(e.css("zIndex"),10),!isNaN(i)&&0!==i))return i;e=e.parent()}return 0}function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=a(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function a(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",o)}function o(){e.datepicker._isDisabledDatepicker(v.inline?v.dpDiv.parent()[0]:v.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function r(t,i){e.extend(t,i);for(var s in i)null==i[s]&&(t[s]=i[s]);return t}function h(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var l=0,u=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,n=u.call(arguments,1),a=0,o=n.length;o>a;a++)for(i in n[a])s=n[a][i],n[a].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(n){var a="string"==typeof n,o=u.call(arguments,1),r=this;return n=!a&&o.length?e.widget.extend.apply(null,[n].concat(o)):n,a?this.each(function(){var i,a=e.data(this,s);return"instance"===n?(r=a,!1):a?e.isFunction(a[n])&&"_"!==n.charAt(0)?(i=a[n].apply(a,o),i!==a&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+n+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+n+"'")}):this.each(function(){var t=e.data(this,s);t?(t.option(n||{}),t._init&&t._init()):e.data(this,s,new i(n,this))}),r}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=l++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var d=!1;e(document).mouseup(function(){d=!1}),e.widget("ui.mouse",{version:"1.11.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!d){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),d=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),d=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function t(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}function s(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var n,a,o=Math.max,r=Math.abs,h=Math.round,l=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==n)return n;var t,i,s=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=s.children()[0];return e("body").append(s),t=a.offsetWidth,s.css("overflow","scroll"),i=a.offsetWidth,t===i&&(i=s[0].clientWidth),s.remove(),n=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),s=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,a="scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight;return{width:a?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||n?i.width():i.outerWidth(),height:s||n?i.height():i.outerHeight()}}},e.fn.position=function(n){if(!n||!n.of)return f.apply(this,arguments);n=e.extend({},n);var p,m,g,v,y,b,_=e(n.of),x=e.position.getWithinInfo(n.within),w=e.position.getScrollInfo(x),k=(n.collision||"flip").split(" "),T={};return b=s(_),_[0].preventDefault&&(n.at="left top"),m=b.width,g=b.height,v=b.offset,y=e.extend({},v),e.each(["my","at"],function(){var e,t,i=(n[this]||"").split(" ");1===i.length&&(i=l.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=l.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=d.exec(i[0]),t=d.exec(i[1]),T[this]=[e?e[0]:0,t?t[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===k.length&&(k[1]=k[0]),"right"===n.at[0]?y.left+=m:"center"===n.at[0]&&(y.left+=m/2),"bottom"===n.at[1]?y.top+=g:"center"===n.at[1]&&(y.top+=g/2),p=t(T.at,m,g),y.left+=p[0],y.top+=p[1],this.each(function(){var s,l,u=e(this),d=u.outerWidth(),c=u.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),D=d+f+i(this,"marginRight")+w.width,S=c+b+i(this,"marginBottom")+w.height,M=e.extend({},y),C=t(T.my,u.outerWidth(),u.outerHeight());"right"===n.my[0]?M.left-=d:"center"===n.my[0]&&(M.left-=d/2),"bottom"===n.my[1]?M.top-=c:"center"===n.my[1]&&(M.top-=c/2),M.left+=C[0],M.top+=C[1],a||(M.left=h(M.left),M.top=h(M.top)),s={marginLeft:f,marginTop:b},e.each(["left","top"],function(t,i){e.ui.position[k[t]]&&e.ui.position[k[t]][i](M,{targetWidth:m,targetHeight:g,elemWidth:d,elemHeight:c,collisionPosition:s,collisionWidth:D,collisionHeight:S,offset:[p[0]+C[0],p[1]+C[1]],my:n.my,at:n.at,within:x,elem:u})}),n.using&&(l=function(e){var t=v.left-M.left,i=t+m-d,s=v.top-M.top,a=s+g-c,h={target:{element:_,left:v.left,top:v.top,width:m,height:g},element:{element:u,left:M.left,top:M.top,width:d,height:c},horizontal:0>i?"left":t>0?"right":"center",vertical:0>a?"top":s>0?"bottom":"middle"};d>m&&m>r(t+i)&&(h.horizontal="center"),c>g&&g>r(s+a)&&(h.vertical="middle"),h.important=o(r(t),r(i))>o(r(s),r(a))?"horizontal":"vertical",n.using.call(this,e,h)}),u.offset(e.extend(M,{using:l}))})},e.ui.position={fit:{left:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=e.left-t.collisionPosition.marginLeft,h=n-r,l=r+t.collisionWidth-a-n;t.collisionWidth>a?h>0&&0>=l?(i=e.left+h+t.collisionWidth-a-n,e.left+=h-i):e.left=l>0&&0>=h?n:h>l?n+a-t.collisionWidth:n:h>0?e.left+=h:l>0?e.left-=l:e.left=o(e.left-r,e.left)},top:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollTop:s.offset.top,a=t.within.height,r=e.top-t.collisionPosition.marginTop,h=n-r,l=r+t.collisionHeight-a-n;t.collisionHeight>a?h>0&&0>=l?(i=e.top+h+t.collisionHeight-a-n,e.top+=h-i):e.top=l>0&&0>=h?n:h>l?n+a-t.collisionHeight:n:h>0?e.top+=h:l>0?e.top-=l:e.top=o(e.top-r,e.top)}},flip:{left:function(e,t){var i,s,n=t.within,a=n.offset.left+n.scrollLeft,o=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=e.left-t.collisionPosition.marginLeft,u=l-h,d=l+t.collisionWidth-o-h,c="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>u?(i=e.left+c+p+f+t.collisionWidth-o-a,(0>i||r(u)>i)&&(e.left+=c+p+f)):d>0&&(s=e.left-t.collisionPosition.marginLeft+c+p+f-h,(s>0||d>r(s))&&(e.left+=c+p+f))},top:function(e,t){var i,s,n=t.within,a=n.offset.top+n.scrollTop,o=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=e.top-t.collisionPosition.marginTop,u=l-h,d=l+t.collisionHeight-o-h,c="top"===t.my[1],p=c?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>u?(s=e.top+p+f+m+t.collisionHeight-o-a,e.top+p+f+m>u&&(0>s||r(u)>s)&&(e.top+=p+f+m)):d>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-h,e.top+p+f+m>d&&(i>0||d>r(i))&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,s,n,o,r=document.getElementsByTagName("body")[0],h=document.createElement("div");t=document.createElement(r?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},r&&e.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in s)t.style[o]=s[o];t.appendChild(h),i=r||document.documentElement,i.insertBefore(t,i.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",n=e(h).offset().left,a=n>10&&11>n,t.innerHTML="",i.removeChild(t)}()}(),e.ui.position,e.widget("ui.draggable",e.ui.mouse,{version:"1.11.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(s){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options,a=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,e(a).width()-this.helperProportions.width-this.margins.left,(e(a).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),s=i[0],s&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,n,a,o=this.options,r=this._isRootNode(this.scrollParent[0]),h=e.pageX,l=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a),"y"===o.axis&&(h=this.originalPageX),"x"===o.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}
},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,n))})},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,n))})},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,a=this;a.positionAbs=s.positionAbs,a.helperProportions=s.helperProportions,a.offset.click=s.offset.click,a._intersectsWith(a.containerCache)&&(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==a&&this._intersectsWith(this.containerCache)&&e.contains(a.element[0],this.element[0])&&(n=!1),n})),n?(a.isOver||(a.isOver=1,a.currentItem=i.helper.appendTo(a.element).data("ui-sortable-item",!0),a.options._helper=a.options.helper,a.options.helper=function(){return i.helper[0]},t.target=a.currentItem[0],a._mouseCapture(t,!0),a._mouseStart(t,!0,!0),a.offset.click.top=s.offset.click.top,a.offset.click.left=s.offset.click.left,a.offset.parent.left-=s.offset.parent.left-a.offset.parent.left,a.offset.parent.top-=s.offset.parent.top-a.offset.parent.top,s._trigger("toSortable",t),s.dropped=a.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,a.fromOutside=s),a.currentItem&&(a._mouseDrag(t),i.position=a.position)):a.isOver&&(a.isOver=0,a.cancelHelperRemoval=!0,a.options._revert=a.options.revert,a.options.revert=!1,a._trigger("out",t,a._uiHash(a)),a._mouseStop(t,!0),a.options.revert=a.options._revert,a.options.helper=a.options._helper,a.placeholder&&a.placeholder.remove(),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var n=e("body"),a=s.options;n.css("cursor")&&(a._cursor=n.css("cursor")),n.css("cursor",a.cursor)},stop:function(t,i,s){var n=s.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("opacity")&&(a._opacity=n.css("opacity")),n.css("opacity",a.opacity)},stop:function(t,i,s){var n=s.options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var n=s.options,a=!1,o=s.scrollParentNotHidden[0],r=s.document[0];o!==r&&"HTML"!==o.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+o.offsetHeight-t.pageY<n.scrollSensitivity?o.scrollTop=a=o.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top<n.scrollSensitivity&&(o.scrollTop=a=o.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+o.offsetWidth-t.pageX<n.scrollSensitivity?o.scrollLeft=a=o.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left<n.scrollSensitivity&&(o.scrollLeft=a=o.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(r).scrollTop()<n.scrollSensitivity?a=e(r).scrollTop(e(r).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<n.scrollSensitivity&&(a=e(r).scrollTop(e(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(r).scrollLeft()<n.scrollSensitivity?a=e(r).scrollLeft(e(r).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<n.scrollSensitivity&&(a=e(r).scrollLeft(e(r).scrollLeft()+n.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var n,a,o,r,h,l,u,d,c,p,f=s.options,m=f.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,y=i.offset.top,b=y+s.helperProportions.height;for(c=s.snapElements.length-1;c>=0;c--)h=s.snapElements[c].left-s.margins.left,l=h+s.snapElements[c].width,u=s.snapElements[c].top-s.margins.top,d=u+s.snapElements[c].height,h-m>v||g>l+m||u-m>b||y>d+m||!e.contains(s.snapElements[c].item.ownerDocument,s.snapElements[c].item)?(s.snapElements[c].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(n=m>=Math.abs(u-b),a=m>=Math.abs(d-y),o=m>=Math.abs(h-v),r=m>=Math.abs(l-g),n&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||a||o||r,"outer"!==f.snapMode&&(n=m>=Math.abs(u-y),a=m>=Math.abs(d-b),o=m>=Math.abs(h-g),r=m>=Math.abs(l-v),n&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[c].snapping&&(n||a||o||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=n||a||o||r||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var n,a=s.options,o=e.makeArray(e(a.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});o.length&&(n=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",n+t)}),this.css("zIndex",n+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("zIndex")&&(a._zIndex=n.css("zIndex")),n.css("zIndex",a.zIndex)},stop:function(t,i,s){var n=s.options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}}),e.ui.draggable,e.widget("ui.droppable",{version:"1.11.2",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){return arguments.length?(t=arguments[0],void 0):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;e.length>t;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){if("accept"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if("scope"===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(s)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function e(e,t,i){return e>=t&&t+i>e}return function(t,i,s,n){if(!i.offset)return!1;var a=(t.positionAbs||t.position.absolute).left+t.margins.left,o=(t.positionAbs||t.position.absolute).top+t.margins.top,r=a+t.helperProportions.width,h=o+t.helperProportions.height,l=i.offset.left,u=i.offset.top,d=l+i.proportions().width,c=u+i.proportions().height;switch(s){case"fit":return a>=l&&d>=r&&o>=u&&c>=h;case"intersect":return a+t.helperProportions.width/2>l&&d>r-t.helperProportions.width/2&&o+t.helperProportions.height/2>u&&c>h-t.helperProportions.height/2;case"pointer":return e(n.pageY,u,i.proportions().height)&&e(n.pageX,l,i.proportions().width);case"touch":return(o>=u&&c>=o||h>=u&&c>=h||u>o&&h>c)&&(a>=l&&d>=a||r>=l&&d>=r||l>a&&r>d);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var s,n,a=e.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,r=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(s=0;a.length>s;s++)if(!(a[s].options.disabled||t&&!a[s].accept.call(a[s].element[0],t.currentItem||t.element))){for(n=0;r.length>n;n++)if(r[n]===a[s].element[0]){a[s].proportions().height=0;continue e}a[s].visible="none"!==a[s].element.css("display"),a[s].visible&&("mousedown"===o&&a[s]._activate.call(a[s],i),a[s].offset=a[s].element.offset(),a[s].proportions({width:a[s].element[0].offsetWidth,height:a[s].element[0].offsetHeight}))}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,a,o=e.ui.intersect(t,this,this.options.tolerance,i),r=!o&&this.isover?"isout":o&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===n}),a.length&&(s=e(a[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},e.ui.droppable,e.widget("ui.resizable",e.ui.mouse,{version:"1.11.2",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[s]>0?!0:(t[s]=1,n=t[s]>0,t[s]=0,n)},_create:function(){var t,i,s,n,a,o=this,r=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;t.length>i;i++)s=e.trim(t[i]),a="ui-resizable-"+s,n=e("<div class='ui-resizable-handle "+a+"'></div>"),n.css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(t){var i,s,n,a;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=this.element.children(this.handles[i]).first().show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(s=e(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(n,a),this._proportionallyResize()),e(this.handles[i]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){r.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,s,n=!1;for(i in this.handles)s=e(this.handles[i])[0],(s===t.target||e.contains(s,t.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var i,s,n,a=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),a.containment&&(i+=e(a.containment).scrollLeft()||0,s+=e(a.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),o.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,s,n=this.originalMousePosition,a=this.axis,o=t.pageX-n.left||0,r=t.pageY-n.top||0,h=this._change[a];return this._updatePrevProperties(),h?(i=h.apply(this,[t,o,r]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(t){this.resizing=!1;var i,s,n,a,o,r,h,l=this.options,u=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:u.sizeDiff.height,a=s?0:u.sizeDiff.width,o={width:u.helper.width()-a,height:u.helper.height()-n},r=parseInt(u.element.css("left"),10)+(u.position.left-u.originalPosition.left)||null,h=parseInt(u.element.css("top"),10)+(u.position.top-u.originalPosition.top)||null,l.animate||this.element.css(e.extend(o,{top:h,left:r})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!l.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,s,n,a,o=this.options;a={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=a.minHeight*this.aspectRatio,s=a.minWidth/this.aspectRatio,i=a.maxHeight*this.aspectRatio,n=a.maxWidth/this.aspectRatio,t>a.minWidth&&(a.minWidth=t),s>a.minHeight&&(a.minHeight=s),a.maxWidth>i&&(a.maxWidth=i),a.maxHeight>n&&(a.maxHeight=n)),this._vBoundaries=a},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,a=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,o=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,r=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,l=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return a&&(e.width=t.minWidth),o&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),a&&l&&(e.left=r-t.minWidth),s&&l&&(e.left=r-t.maxWidth),o&&u&&(e.top=h-t.minHeight),n&&u&&(e.top=h-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseInt(s[t],10)||0,i[t]+=parseInt(n[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),o=a&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(h,u&&l?{top:u,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&e(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,s,n,a,o,r,h=e(this).resizable("instance"),l=h.options,u=h.element,d=l.containment,c=d instanceof e?d.get(0):/parent/.test(d)?u.parent().get(0):d;c&&(h.containerElement=e(c),/document/.test(d)||d===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(c),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,s){i[e]=h._num(t.css("padding"+s))}),h.containerOffset=t.offset(),h.containerPosition=t.position(),h.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,a=h.containerSize.width,o=h._hasScroll(c,"left")?c.scrollWidth:a,r=h._hasScroll(c)?c.scrollHeight:n,h.parentData={element:c,left:s.left,top:s.top,width:o,height:r}))},resize:function(t){var i,s,n,a,o=e(this).resizable("instance"),r=o.options,h=o.containerOffset,l=o.position,u=o._aspectRatio||t.shiftKey,d={top:0,left:0},c=o.containerElement,p=!0;c[0]!==document&&/static/.test(c.css("position"))&&(d=h),l.left<(o._helper?h.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-h.left:o.position.left-d.left),u&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=r.helper?h.left:0),l.top<(o._helper?h.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-h.top:o.position.top),u&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?h.top:0),n=o.containerElement.get(0)===o.element.parent().get(0),a=/relative|absolute/.test(o.containerElement.css("position")),n&&a?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),i=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-d.left:o.offset.left-h.left)),s=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-d.top:o.offset.top-h.top)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,u&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),s+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-s,u&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,s=t.containerOffset,n=t.containerPosition,a=t.containerElement,o=e(t.helper),r=o.offset(),h=o.outerWidth()-t.sizeDiff.width,l=o.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l}),t._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?s(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],s(i.alsoResize)):e.each(i.alsoResize,function(e){s(e)})},resize:function(t,i){var s=e(this).resizable("instance"),n=s.options,a=s.originalSize,o=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0},h=function(t,s){e(t).each(function(){var t=e(this),n=e(this).data("ui-resizable-alsoresize"),a={},o=s&&s.length?s:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var i=(n[t]||0)+(r[t]||0);i&&i>=0&&(a[t]=i||null)}),t.css(a)})};"object"!=typeof n.alsoResize||n.alsoResize.nodeType?h(n.alsoResize):e.each(n.alsoResize,function(e,t){h(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),s=i.options,n=i.size,a=i.originalSize,o=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,u=h[1]||1,d=Math.round((n.width-a.width)/l)*l,c=Math.round((n.height-a.height)/u)*u,p=a.width+d,f=a.height+c,m=s.maxWidth&&p>s.maxWidth,g=s.maxHeight&&f>s.maxHeight,v=s.minWidth&&s.minWidth>p,y=s.minHeight&&s.minHeight>f;s.grid=h,v&&(p+=l),y&&(f+=u),m&&(p-=l),g&&(f-=u),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=o.top-c):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=o.left-d):((0>=f-u||0>=p-l)&&(t=i._getPaddingPlusBorderDimensions(this)),f-u>0?(i.size.height=f,i.position.top=o.top-c):(f=u-t.height,i.size.height=f,i.position.top=o.top+a.height-f),p-l>0?(i.size.width=p,i.position.left=o.left-d):(p=u-t.height,i.size.width=p,i.position.left=o.left+a.width-p))}}),e.ui.resizable,e.widget("ui.selectable",e.ui.mouse,{version:"1.11.2",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;
this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(i.options.filter,i.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,s=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(s.filter,this.element[0]),this._trigger("start",t),e(s.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=e.data(this,"selectable-item");s.startselected=!0,t.metaKey||t.ctrlKey||(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",t,{unselecting:s.element}))}),e(t.target).parents().addBack().each(function(){var s,n=e.data(this,"selectable-item");return n?(s=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(s?"ui-unselecting":"ui-selected").addClass(s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,a=this.opos[0],o=this.opos[1],r=t.pageX,h=t.pageY;return a>r&&(i=r,r=a,a=i),o>h&&(i=h,h=o,o=i),this.helper.css({left:a,top:o,width:r-a,height:h-o}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),l=!1;i&&i.element!==s.element[0]&&("touch"===n.tolerance?l=!(i.left>r||a>i.right||i.top>h||o>i.bottom):"fit"===n.tolerance&&(l=i.left>a&&r>i.right&&i.top>o&&h>i.bottom),l?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,s._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",t,{unselected:s.element})}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",t,{selected:s.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||this._isFloating(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,n=!1,a=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,a.widgetName+"-item")===a?(s=e(this),!1):void 0}),e.data(t.target,a.widgetName+"-item")===a&&(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,s){var n,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(a)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,n,a,o=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],a=this._intersectsWithPointer(s),a&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==n&&!e.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],n):!0)){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),a=this.options.axis,o={};a&&"x"!==a||(o.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(o.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,a=e.left,o=a+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||s+l>r&&h>s+l,c="y"===this.options.axis||t+u>a&&o>t+u,p=d&&c;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&&"right"===a||"down"===n?2:1:n&&("down"===n?2:1):!1},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){r.push(this)}var s,n,a,o,r=[],h=[],l=this._connectWith();if(l&&t)for(s=l.length-1;s>=0;s--)for(a=e(l[s]),n=a.length-1;n>=0;n--)o=e.data(a[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&h.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(h.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,a,o,r,h,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(i=c.length-1;i>=0;i--)for(n=e(c[i]),s=n.length-1;s>=0;s--)a=e.data(n[s],this.widgetFullName),a&&a!==this&&!a.options.disabled&&(d.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(i=d.length-1;i>=0;i--)for(o=d[i][1],r=d[i][0],s=0,l=r.length;l>s;s++)h=e(r[s]),h.data(this.widgetName+"-item",o),u.push({item:h,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,a;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),a=n.offset(),s.left=a.left,s.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===s?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(n)}):"img"===s&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var i,s,n,a,o,r,h,l,u,d,c=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(c&&e.contains(this.containers[i].element[0],c.element[0]))continue;c=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,a=null,u=c.floating||this._isFloating(this.currentItem),o=u?"left":"top",r=u?"width":"height",d=u?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[o],l=!1,t[d]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(t[d]-h)&&(n=Math.abs(t[d]-h),a=this.items[s],this.direction=l?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===n.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===n.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,a=t.pageX,o=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)t||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(s=0;n.length>s;s++)n[s].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.widget("ui.accordion",{version:"1.11.2",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||t.active!==!1&&null!=t.active||(t.active=0),this._processPanels(),0>t.active&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),e=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){return"active"===e?(this._activate(t),void 0):("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||this.options.active!==!1||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),"disabled"===e&&(this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)),void 0)},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,s=this.headers.length,n=this.headers.index(t.target),a=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:a=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:a=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:a=this.headers[0];break;case i.END:a=this.headers[s-1]}a&&(e(t.target).attr("tabIndex",-1),e(a).attr("tabIndex",0),a.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),t.active===!1&&t.collapsible===!0||!this.headers.length?(t.active=!1,this.active=e()):t.active===!1?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var e=this.headers,t=this.panels;this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.panels=this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(),t&&(this._off(e.not(this.headers)),this._off(t.not(this.panels)))},_refresh:function(){var t,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var t=e(this),i=t.uniqueId().attr("id"),s=t.next(),n=s.uniqueId().attr("id");
t.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(t=n.height(),this.element.siblings(":visible").each(function(){var i=e(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(t-=i.outerHeight(!0))}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===s&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css("height","").height())}).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n[0]===s[0],o=a&&i.collapsible,r=o?e():n.next(),h=s.next(),l={oldHeader:s,oldPanel:h,newHeader:o?e():n,newPanel:r};t.preventDefault(),a&&!i.collapsible||this._trigger("beforeActivate",t,l)===!1||(i.active=o?!1:this.headers.index(n),this.active=a?e():n,this._toggle(l),s.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&s.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),a||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass("ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,s=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,t):(s.hide(),i.show(),this._toggleComplete(t)),s.attr({"aria-hidden":"true"}),s.prev().attr("aria-selected","false"),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(e,t,i){var s,n,a,o=this,r=0,h=e.length&&(!t.length||e.index()<t.index()),l=this.options.animate||{},u=h&&l.down||l,d=function(){o._toggleComplete(i)};return"number"==typeof u&&(a=u),"string"==typeof u&&(n=u),n=n||u.easing||l.easing,a=a||u.duration||l.duration,t.length?e.length?(s=e.show().outerHeight(),t.animate(this.hideProps,{duration:a,easing:n,step:function(e,t){t.now=Math.round(e)}}),e.hide().animate(this.showProps,{duration:a,easing:n,complete:d,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?r+=i.now:"content"!==o.options.heightStyle&&(i.now=Math.round(s-t.outerHeight()-r),r=0)}}),void 0):t.animate(this.hideProps,a,n,d):e.animate(this.showProps,a,n,d)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}}),e.widget("ui.menu",{version:"1.11.2",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(t){var i=e(t.target);!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var i=e(t.currentTarget);i.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){var i,s,n,a,o=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:o=!1,s=this.previousFilter||"",n=String.fromCharCode(t.keyCode),a=!1,clearTimeout(this.filterTimer),n===s?a=!0:n=s+n,i=this._filterMenuItems(n),i=a&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(t.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(t,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}o&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(e):this.select(e))},refresh:function(){var t,i,s=this,n=this.options.icons.submenu,a=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),a.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.parent(),s=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(s),t.attr("aria-labelledby",i.attr("id"))}),t=a.add(this.element),i=t.find(this.options.items),i.not(".ui-menu-item").each(function(){var t=e(this);s._isDivider(t)&&t.addClass("ui-widget-content ui-menu-divider")}),i.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},focus:function(e,t){var i,s;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),s=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=t.children(".ui-menu"),i.length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,s,n,a,o,r;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,n=t.offset().top-this.activeMenu.offset().top-i-s,a=this.activeMenu.scrollTop(),o=this.activeMenu.height(),r=t.outerHeight(),0>n?this.activeMenu.scrollTop(a+n):n+r>o&&this.activeMenu.scrollTop(a+n-o+r))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(t),this.activeMenu=s},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var s;this.active&&(s="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[t]()),this.focus(i,s)},nextPage:function(t){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=e(this),0>i.offset().top-s-n}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(t),void 0)},previousPage:function(t){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-s+n>0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first())),void 0):(this.next(t),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(e.trim(e(this).text()))})}}),e.widget("ui.autocomplete",{version:"1.11.2",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,s,n=this.element[0].nodeName.toLowerCase(),a="textarea"===n,o="input"===n;this.isMultiLine=a?!0:o?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[a||o?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,s=!0,i=!0,void 0;t=!1,s=!1,i=!1;var a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:t=!0,this._move("previousPage",n);break;case a.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case a.UP:t=!0,this._keyEvent("previous",n);break;case a.DOWN:t=!0,this._keyEvent("next",n);break;case a.ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case a.TAB:this.menu.active&&this.menu.select(n);break;case a.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(t)return t=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if(!i){var n=e.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(e){return s?(s=!1,e.preventDefault(),void 0):(this._searchTimeout(e),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(e),this._change(e),void 0)}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(s){s.target===t.element[0]||s.target===i||e.contains(i,s.target)||t.close()})})},menufocus:function(t,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:n})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&e.trim(s).length&&(this.liveRegion.children().hide(),e("<div>").text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),s=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,s=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,s){s(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,n){s.xhr&&s.xhr.abort(),s.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),i=this.menu.element.is(":visible"),s=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;(!t||t&&!i&&!s)&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var s=this;e.each(i,function(e,i){s._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").text(i.label).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[e](t),void 0):(this.search(null,t),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var s=RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return s.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(i).appendTo(this.liveRegion))}}),e.ui.autocomplete;var c,p="ui-button ui-widget ui-state-default ui-corner-all",f="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",m=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},g=function(t){var i=t.name,s=t.form,n=e([]);return i&&(i=i.replace(/'/g,"\\'"),n=s?e(s).find("[name='"+i+"'][type=radio]"):e("[name='"+i+"'][type=radio]",t.ownerDocument).filter(function(){return!this.form})),n};e.widget("ui.button",{version:"1.11.2",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,m),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,i=this.options,s="checkbox"===this.type||"radio"===this.type,n=s?"":"ui-state-active";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(p).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){i.disabled||this===c&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){i.disabled||e(this).removeClass(n)}).bind("click"+this.eventNamespace,function(e){i.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),s&&this.element.bind("change"+this.eventNamespace,function(){t.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return i.disabled?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var s=t.element[0];g(s).not(s).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return i.disabled?!1:(e(this).addClass("ui-state-active"),c=this,t.document.one("mouseup",function(){c=null}),void 0)}).bind("mouseup"+this.eventNamespace,function(){return i.disabled?!1:(e(this).removeClass("ui-state-active"),void 0)}).bind("keydown"+this.eventNamespace,function(t){return i.disabled?!1:((t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active"),void 0)}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(p+" ui-state-active "+f).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){return this._super(e,t),"disabled"===e?(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),t&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")),void 0):(this._resetButton(),void 0)},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?g(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return this.options.label&&this.element.val(this.options.label),void 0;var t=this.buttonElement.removeClass(f),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),s=this.options.icons,n=s.primary&&s.secondary,a=[];s.primary||s.secondary?(this.options.text&&a.push("ui-button-text-icon"+(n?"s":s.primary?"-primary":"-secondary")),s.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+s.primary+"'></span>"),s.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+s.secondary+"'></span>"),this.options.text||(a.push(n?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):a.push("ui-button-text-only"),t.addClass(a.join(" "))}}),e.widget("ui.buttonset",{version:"1.11.2",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction"),i=this.element.find(this.options.items),s=i.filter(":ui-button");i.not(":ui-button").button(),s.button("refresh"),this.buttons=i.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}}),e.ui.button,e.extend(e.ui,{datepicker:{version:"1.11.2"}});var v;e.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return r(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var s,n,a;s=t.nodeName.toLowerCase(),n="div"===s||"span"===s,t.id||(this.uuid+=1,t.id="dp"+this.uuid),a=this._newInst(e(t),n),a.settings=e.extend({},i||{}),"input"===s?this._connectDatepicker(t,a):n&&this._inlineDatepicker(t,a)},_newInst:function(t,i){var s=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?a(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var s=e(t);i.append=e([]),i.trigger=e([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,"datepicker",i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var s,n,a,o=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),o&&(i.append=e("<span class='"+this._appendClass+"'>"+o+"</span>"),t[r?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&t.focus(this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),a=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:a,alt:n,title:n}):e("<button type='button'></button>").addClass(this._triggerClass).html(a?e("<img/>").attr({src:a,alt:n,title:n}):n)),t[r?"before":"after"](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,s,n,a=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function(e){for(i=0,s=0,n=0;e.length>n;n++)e[n].length>i&&(i=e[n].length,s=n);return s},a.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),a.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-a.getDay())),e.input.attr("size",this._formatDate(e,a).length)}},_inlineDatepicker:function(t,i){var s=e(t);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),e.data(t,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,s,n,a){var o,h,l,u,d,c=this._dialogInst;return c||(this.uuid+=1,o="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+o+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),c=this._dialogInst=this._newInst(this._dialogInput,!1),c.settings={},e.data(this._dialogInput[0],"datepicker",c)),r(c.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(c,i):i,this._dialogInput.val(i),this._pos=a?a.length?a:[a.pageX,a.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+u,l/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),c.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",c),this},_destroyDatepicker:function(t){var i,s=e(t),n=e.data(t,"datepicker");s.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty())
},_enableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!1,a.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!0,a.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;this._disabledInputs.length>t;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,i,s){var n,a,o,h,l=this._getInst(t);return 2===arguments.length&&"string"==typeof i?"defaults"===i?e.extend({},e.datepicker._defaults):l?"all"===i?e.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),a=this._getDateDatepicker(t,!0),o=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),r(l.settings,n),null!==o&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,o)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),l),this._autoSize(l),this._setDate(l,a),this._updateAlternate(l),this._updateDatepicker(l)),void 0)},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,s,n,a=e.datepicker._getInst(t.target),o=!0,r=a.dpDiv.is(".ui-datepicker-rtl");if(a._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return n=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",a.dpDiv),n[0]&&e.datepicker._selectDay(t.target,a.selectedMonth,a.selectedYear,n[0]),i=e.datepicker._get(a,"onSelect"),i?(s=e.datepicker._formatDate(a),i.apply(a.input?a.input[0]:null,[s,a])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?1:-1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?-1:1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),o=t.ctrlKey||t.metaKey;break;default:o=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,s,n=e.datepicker._getInst(t.target);return e.datepicker._get(n,"constrainInput")?(i=e.datepicker._possibleChars(e.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(t){var i,s=e.datepicker._getInst(t.target);if(s.input.val()!==s.lastVal)try{i=e.datepicker.parseDate(e.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,e.datepicker._getFormatConfig(s)),i&&(e.datepicker._setDateFromField(s),e.datepicker._updateAlternate(s),e.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(t){if(t=t.target||t,"input"!==t.nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),!e.datepicker._isDisabledDatepicker(t)&&e.datepicker._lastInput!==t){var i,n,a,o,h,l,u;i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),n=e.datepicker._get(i,"beforeShow"),a=n?n.apply(t,[t,i]):{},a!==!1&&(r(i.settings,a),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each(function(){return o|="fixed"===e(this).css("position"),!o}),h={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),h=e.datepicker._checkOffset(i,h,o),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":o?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),u=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",s(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),u):i.dpDiv[l||"show"](l?u:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i))}},_updateDatepicker:function(t){this.maxRows=4,v=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var i,s=this._getNumberOfMonths(t),n=s[1],a=17,r=t.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),t.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,s){var n=t.dpDiv.outerWidth(),a=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,r=t.input?t.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:e(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?n-o:0,i.left-=s&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=s&&i.top===t.input.offset().top+r?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+a>l&&l>a?Math.abs(a+r):0),i},_findPos:function(t){for(var i,s=this._getInst(t),n=this._get(s,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[n?"previousSibling":"nextSibling"];return i=e(t).offset(),[i.left,i.top]},_hideDatepicker:function(t){var i,s,n,a,o=this._curInst;!o||t&&o!==e.data(t,"datepicker")||this._datepickerShowing&&(i=this._get(o,"showAnim"),s=this._get(o,"duration"),n=function(){e.datepicker._tidyDialog(o)},e.effects&&(e.effects.effect[i]||e.effects[i])?o.dpDiv.hide(i,e.datepicker._get(o,"showOptions"),s,n):o.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,a=this._get(o,"onClose"),a&&a.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),s=e.datepicker._getInst(i[0]);(i[0].id!==e.datepicker._mainDivId&&0===i.parents("#"+e.datepicker._mainDivId).length&&!i.hasClass(e.datepicker.markerClassName)&&!i.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||i.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==s)&&e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,s){var n=e(t),a=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(a,i+("M"===s?this._get(a,"showCurrentAtPos"):0),s),this._updateDatepicker(a))},_gotoToday:function(t){var i,s=e(t),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(t,i,s){var n=e(t),a=this._getInst(n[0]);a["selected"+("M"===s?"Month":"Year")]=a["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(a),this._adjustDate(n)},_selectDay:function(t,i,s,n){var a,o=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||(a=this._getInst(o[0]),a.selectedDay=a.currentDay=e("a",n).html(),a.selectedMonth=a.currentMonth=i,a.selectedYear=a.currentYear=s,this._selectDate(t,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var s,n=e(t),a=this._getInst(n[0]);i=null!=i?i:this._formatDate(a),a.input&&a.input.val(i),this._updateAlternate(a),s=this._get(a,"onSelect"),s?s.apply(a.input?a.input[0]:null,[i,a]):a.input&&a.input.trigger("change"),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,s,n,a=this._get(t,"altField");a&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),s=this._getDate(t),n=this.formatDate(i,s,this._getFormatConfig(t)),e(a).each(function(){e(this).val(n)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,s){if(null==t||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,a,o,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),d=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,c=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,m=-1,g=-1,v=-1,y=-1,b=!1,_=function(e){var i=t.length>n+1&&t.charAt(n+1)===e;return i&&n++,i},x=function(e){var t=_(e),s="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,n="y"===e?s:1,a=RegExp("^\\d{"+n+","+s+"}"),o=i.substring(h).match(a);if(!o)throw"Missing number at position "+h;return h+=o[0].length,parseInt(o[0],10)},w=function(t,s,n){var a=-1,o=e.map(_(t)?n:s,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(o,function(e,t){var s=t[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(a=t[0],h+=s.length,!1):void 0}),-1!==a)return a+1;throw"Unknown name at position "+h},k=function(){if(i.charAt(h)!==t.charAt(n))throw"Unexpected literal at position "+h;h++};for(n=0;t.length>n;n++)if(b)"'"!==t.charAt(n)||_("'")?k():b=!1;else switch(t.charAt(n)){case"d":v=x("d");break;case"D":w("D",d,c);break;case"o":y=x("o");break;case"m":g=x("m");break;case"M":g=w("M",p,f);break;case"y":m=x("y");break;case"@":r=new Date(x("@")),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"!":r=new Date((x("!")-this._ticksTo1970)/1e4),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"'":_("'")?k():b=!0;break;default:k()}if(i.length>h&&(o=i.substr(h),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===m?m=(new Date).getFullYear():100>m&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=m?0:-100)),y>-1)for(g=1,v=y;;){if(a=this._getDaysInMonth(m,g-1),a>=v)break;g++,v-=a}if(r=this._daylightSavingAdjust(new Date(m,g-1,v)),r.getFullYear()!==m||r.getMonth()+1!==g||r.getDate()!==v)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,i){if(!t)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,a=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(t){var i=e.length>s+1&&e.charAt(s+1)===t;return i&&s++,i},l=function(e,t,i){var s=""+t;if(h(e))for(;i>s.length;)s="0"+s;return s},u=function(e,t,i,s){return h(e)?s[t]:i[t]},d="",c=!1;if(t)for(s=0;e.length>s;s++)if(c)"'"!==e.charAt(s)||h("'")?d+=e.charAt(s):c=!1;else switch(e.charAt(s)){case"d":d+=l("d",t.getDate(),2);break;case"D":d+=u("D",t.getDay(),n,a);break;case"o":d+=l("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":d+=l("m",t.getMonth()+1,2);break;case"M":d+=u("M",t.getMonth(),o,r);break;case"y":d+=h("y")?t.getFullYear():(10>t.getYear()%100?"0":"")+t.getYear()%100;break;case"@":d+=t.getTime();break;case"!":d+=1e4*t.getTime()+this._ticksTo1970;break;case"'":h("'")?d+="'":c=!0;break;default:d+=e.charAt(s)}return d},_possibleChars:function(e){var t,i="",s=!1,n=function(i){var s=e.length>t+1&&e.charAt(t+1)===i;return s&&t++,s};for(t=0;e.length>t;t++)if(s)"'"!==e.charAt(t)||n("'")?i+=e.charAt(t):s=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),s=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),a=n,o=this._getFormatConfig(e);try{a=this.parseDate(i,s,o)||n}catch(r){s=t?"":s}e.selectedDay=a.getDate(),e.drawMonth=e.selectedMonth=a.getMonth(),e.drawYear=e.selectedYear=a.getFullYear(),e.currentDay=s?a.getDate():0,e.currentMonth=s?a.getMonth():0,e.currentYear=s?a.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,s){var n=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},a=function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,a=n.getFullYear(),o=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o));break;case"y":case"Y":a+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o))}l=h.exec(i)}return new Date(a,o,r)},o=null==i||""===i?s:"string"==typeof i?a(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return o=o&&"Invalid Date"==""+o?s:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var s=!t,n=e.selectedMonth,a=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),n===e.selectedMonth&&a===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(s?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),s="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(s,-i,"M")},next:function(){e.datepicker._adjustDate(s,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(s)},selectDay:function(){return e.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(s,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,s,n,a,o,r,h,l,u,d,c,p,f,m,g,v,y,b,_,x,w,k,T,D,S,M,C,N,A,P,I,z,H,F,E,O,j,W,L=new Date,R=this._daylightSavingAdjust(new Date(L.getFullYear(),L.getMonth(),L.getDate())),Y=this._get(e,"isRTL"),B=this._get(e,"showButtonPanel"),J=this._get(e,"hideIfNoPrevNext"),q=this._get(e,"navigationAsDateFormat"),K=this._getNumberOfMonths(e),V=this._get(e,"showCurrentAtPos"),U=this._get(e,"stepMonths"),Q=1!==K[0]||1!==K[1],G=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),X=this._getMinMaxDate(e,"min"),$=this._getMinMaxDate(e,"max"),Z=e.drawMonth-V,et=e.drawYear;if(0>Z&&(Z+=12,et--),$)for(t=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth()-K[0]*K[1]+1,$.getDate())),t=X&&X>t?X:t;this._daylightSavingAdjust(new Date(et,Z,1))>t;)Z--,0>Z&&(Z=11,et--);for(e.drawMonth=Z,e.drawYear=et,i=this._get(e,"prevText"),i=q?this.formatDate(i,this._daylightSavingAdjust(new Date(et,Z-U,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,-1,et,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":J?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(e,"nextText"),n=q?this.formatDate(n,this._daylightSavingAdjust(new Date(et,Z+U,1)),this._getFormatConfig(e)):n,a=this._canAdjustMonth(e,1,et,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":J?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",o=this._get(e,"currentText"),r=this._get(e,"gotoCurrent")&&e.currentDay?G:R,o=q?this.formatDate(o,r,this._getFormatConfig(e)):o,h=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",l=B?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(e,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(Y?"":h)+"</div>":"",u=parseInt(this._get(e,"firstDay"),10),u=isNaN(u)?0:u,d=this._get(e,"showWeek"),c=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),m=this._get(e,"monthNamesShort"),g=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),b=this._getDefaultDate(e),_="",w=0;K[0]>w;w++){for(k="",this.maxRows=4,T=0;K[1]>T;T++){if(D=this._daylightSavingAdjust(new Date(et,Z,e.selectedDay)),S=" ui-corner-all",M="",Q){if(M+="<div class='ui-datepicker-group",K[1]>1)switch(T){case 0:M+=" ui-datepicker-group-first",S=" ui-corner-"+(Y?"right":"left");break;case K[1]-1:M+=" ui-datepicker-group-last",S=" ui-corner-"+(Y?"left":"right");break;default:M+=" ui-datepicker-group-middle",S=""}M+="'>"}for(M+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+S+"'>"+(/all|left/.test(S)&&0===w?Y?a:s:"")+(/all|right/.test(S)&&0===w?Y?s:a:"")+this._generateMonthYearHeader(e,Z,et,X,$,w>0||T>0,f,m)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",C=d?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",x=0;7>x;x++)N=(x+u)%7,C+="<th scope='col'"+((x+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+c[N]+"'>"+p[N]+"</span></th>";for(M+=C+"</tr></thead><tbody>",A=this._getDaysInMonth(et,Z),et===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,A)),P=(this._getFirstDayOfMonth(et,Z)-u+7)%7,I=Math.ceil((P+A)/7),z=Q?this.maxRows>I?this.maxRows:I:I,this.maxRows=z,H=this._daylightSavingAdjust(new Date(et,Z,1-P)),F=0;z>F;F++){for(M+="<tr>",E=d?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(H)+"</td>":"",x=0;7>x;x++)O=g?g.apply(e.input?e.input[0]:null,[H]):[!0,""],j=H.getMonth()!==Z,W=j&&!y||!O[0]||X&&X>H||$&&H>$,E+="<td class='"+((x+u+6)%7>=5?" ui-datepicker-week-end":"")+(j?" ui-datepicker-other-month":"")+(H.getTime()===D.getTime()&&Z===e.selectedMonth&&e._keyEvent||b.getTime()===H.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(W?" "+this._unselectableClass+" ui-state-disabled":"")+(j&&!v?"":" "+O[1]+(H.getTime()===G.getTime()?" "+this._currentClass:"")+(H.getTime()===R.getTime()?" ui-datepicker-today":""))+"'"+(j&&!v||!O[2]?"":" title='"+O[2].replace(/'/g,"&#39;")+"'")+(W?"":" data-handler='selectDay' data-event='click' data-month='"+H.getMonth()+"' data-year='"+H.getFullYear()+"'")+">"+(j&&!v?"&#xa0;":W?"<span class='ui-state-default'>"+H.getDate()+"</span>":"<a class='ui-state-default"+(H.getTime()===R.getTime()?" ui-state-highlight":"")+(H.getTime()===G.getTime()?" ui-state-active":"")+(j?" ui-priority-secondary":"")+"' href='#'>"+H.getDate()+"</a>")+"</td>",H.setDate(H.getDate()+1),H=this._daylightSavingAdjust(H);M+=E+"</tr>"}Z++,Z>11&&(Z=0,et++),M+="</tbody></table>"+(Q?"</div>"+(K[0]>0&&T===K[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),k+=M}_+=k}return _+=l,e._keyEvent=!1,_},_generateMonthYearHeader:function(e,t,i,s,n,a,o,r){var h,l,u,d,c,p,f,m,g=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",_="";if(a||!g)_+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,_+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;12>u;u++)(!h||u>=s.getMonth())&&(!l||n.getMonth()>=u)&&(_+="<option value='"+u+"'"+(u===t?" selected='selected'":"")+">"+r[u]+"</option>");_+="</select>"}if(y||(b+=_+(!a&&g&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",a||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(d=this._get(e,"yearRange").split(":"),c=(new Date).getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?c+parseInt(e,10):parseInt(e,10);return isNaN(t)?c:t},f=p(d[0]),m=Math.max(f,p(d[1]||"")),f=s?Math.max(f,s.getFullYear()):f,m=n?Math.min(m,n.getFullYear()):m,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";m>=f;f++)e.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",b+=e.yearshtml,e.yearshtml=null}return b+=this._get(e,"yearSuffix"),y&&(b+=(!a&&g&&v?"":"&#xa0;")+_),b+="</div>"},_adjustInstDate:function(e,t,i){var s=e.drawYear+("Y"===i?t:0),n=e.drawMonth+("M"===i?t:0),a=Math.min(e.selectedDay,this._getDaysInMonth(s,n))+("D"===i?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(s,n,a)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),n=i&&i>t?i:t;return s&&n>s?s:n},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,s){var n=this._getNumberOfMonths(e),a=this._daylightSavingAdjust(new Date(i,s+(0>t?t:n[0]*n[1]),1));return 0>t&&a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(e,a)},_isInRange:function(e,t){var i,s,n=this._getMinMaxDate(e,"min"),a=this._getMinMaxDate(e,"max"),o=null,r=null,h=this._get(e,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),o=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||t.getTime()>=n.getTime())&&(!a||t.getTime()<=a.getTime())&&(!o||t.getFullYear()>=o)&&(!r||r>=t.getFullYear())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,s){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(s,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new n,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.11.2",e.datepicker,e.widget("ui.dialog",{version:"1.11.2",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i,s=this;if(this._isOpen&&this._trigger("beforeClose",t)!==!1){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{i=this.document[0].activeElement,i&&"body"!==i.nodeName.toLowerCase()&&e(i).blur()}catch(n){}this._hide(this.uiDialog,this.options.hide,function(){s._trigger("close",t)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index")}).get(),a=Math.max.apply(null,n);return a>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",a+1),s=!0),s&&!i&&this._trigger("focus",t),s},open:function(){var t=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"),void 0)},_focusTabbable:function(){var e=this._focusedElement;
e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function i(){var t=this.document[0].activeElement,i=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);i||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),this.close(t),void 0;if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");t.target!==n[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==s[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){n.focus()}),t.preventDefault()):(this._delay(function(){s.focus()}),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?(this.uiDialog.removeClass("ui-dialog-buttons"),void 0):(e.each(i,function(i,s){var n,a;s=e.isFunction(s)?{click:s,text:i}:s,s=e.extend({type:"button"},s),n=s.click,s.click=function(){n.apply(t.element[0],arguments)},a={icons:s.icons,text:s.showText},delete s.icons,delete s.showText,e("<button></button>",s).button(a).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){e(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,t(n))},drag:function(e,s){i._trigger("drag",e,t(s))},stop:function(n,a){var o=a.offset.left-i.document.scrollLeft(),r=a.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" "+"top"+(r>=0?"+":"")+r,of:i.window},e(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,t(a))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var i=this,s=this.options,n=s.resizable,a=this.uiDialog.css("position"),o="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:o,start:function(s,n){e(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,t(n))},resize:function(e,s){i._trigger("resize",e,t(s))},stop:function(n,a){var o=i.uiDialog.offset(),r=o.left-i.document.scrollLeft(),h=o.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" "+"top"+(h>=0?"+":"")+h,of:i.window},e(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,t(a))}}).css("position",a)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),i=e.inArray(this,t);-1!==i&&t.splice(i,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||(e=[],this.document.data("ui-dialog-instances",e)),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,s=!1,n={};e.each(t,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&&(s=!0),e in i.resizableRelatedOptions&&(n[e]=t)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,t){var i,s,n=this.uiDialog;"dialogClass"===e&&n.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&(i=n.is(":data(ui-draggable)"),i&&!t&&n.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(s=n.is(":data(ui-resizable)"),s&&!t&&n.resizable("destroy"),s&&"string"==typeof t&&n.resizable("option","handles",t),s||t===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),e=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),t=Math.max(0,s.minHeight-e),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-e):"none","auto"===s.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return e(t.target).closest(".ui-dialog").length?!0:!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}}),e.widget("ui.progressbar",{version:"1.11.2",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){return void 0===e?this.options.value:(this.options.value=this._constrainedValue(e),this._refreshValue(),void 0)},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=e===!1,"number"!=typeof e&&(e=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}}),e.widget("ui.selectmenu",{version:"1.11.2",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable()},_drawButton:function(){var t=this,i=this.element.attr("tabindex");this.label=e("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(e){this.button.focus(),e.preventDefault()}}),this.element.hide(),this.button=e("<span>",{"class":"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:i||this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),e("<span>",{"class":"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=e("<span>",{"class":"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){t.menuItems||t._refreshMenu()}),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var t=this;this.menu=e("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=e("<div>",{"class":"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(e,i){e.preventDefault(),t._setSelection(),t._select(i.item.data("ui-selectmenu-item"),e)},focus:function(e,i){var s=i.item.data("ui-selectmenu-item");null!=t.focusIndex&&s.index!==t.focusIndex&&(t._trigger("focus",e,{item:s}),t.isOpen||t._select(s,e)),t.focusIndex=s.index,t.button.attr("aria-activedescendant",t.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var e,t=this.element.find("option");t.length&&(this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),e=this._getSelectedItem(),this.menuInstance.focus(null,e),this._setAria(e.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(e){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",e))},_position:function(){this.menuWrap.position(e.extend({of:this.button},this.options.position))},close:function(e){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",e))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(t,i){var s=this,n="";e.each(i,function(i,a){a.optgroup!==n&&(e("<li>",{"class":"ui-selectmenu-optgroup ui-menu-divider"+(a.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:a.optgroup}).appendTo(t),n=a.optgroup),s._renderItemData(t,a)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-selectmenu-item",t)},_renderItem:function(t,i){var s=e("<li>");return i.disabled&&s.addClass("ui-state-disabled"),this._setText(s,i.label),s.appendTo(t)},_setText:function(e,t){t?e.text(t):e.html("&#160;")},_move:function(e,t){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex):(i=this.menuItems.eq(this.element[0].selectedIndex),n+=":not(.ui-state-disabled)"),s="first"===e||"last"===e?i["first"===e?"prevAll":"nextAll"](n).eq(-1):i[e+"All"](n).eq(0),s.length&&this.menuInstance.focus(t,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(e){this[this.isOpen?"close":"open"](e)},_setSelection:function(){var e;this.range&&(window.getSelection?(e=window.getSelection(),e.removeAllRanges(),e.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(t){this.isOpen&&(e(t.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(t))}},_buttonEvents:{mousedown:function(){var e;window.getSelection?(e=window.getSelection(),e.rangeCount&&(this.range=e.getRangeAt(0))):this.range=document.selection.createRange()},click:function(e){this._setSelection(),this._toggle(e)},keydown:function(t){var i=!0;switch(t.keyCode){case e.ui.keyCode.TAB:case e.ui.keyCode.ESCAPE:this.close(t),i=!1;break;case e.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(t);break;case e.ui.keyCode.UP:t.altKey?this._toggle(t):this._move("prev",t);break;case e.ui.keyCode.DOWN:t.altKey?this._toggle(t):this._move("next",t);break;case e.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(t):this._toggle(t);break;case e.ui.keyCode.LEFT:this._move("prev",t);break;case e.ui.keyCode.RIGHT:this._move("next",t);break;case e.ui.keyCode.HOME:case e.ui.keyCode.PAGE_UP:this._move("first",t);break;case e.ui.keyCode.END:case e.ui.keyCode.PAGE_DOWN:this._move("last",t);break;default:this.menu.trigger(t),i=!1}i&&t.preventDefault()}},_selectFocusedItem:function(e){var t=this.menuItems.eq(this.focusIndex);t.hasClass("ui-state-disabled")||this._select(t.data("ui-selectmenu-item"),e)},_select:function(e,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=e.index,this._setText(this.buttonText,e.label),this._setAria(e),this._trigger("select",t,{item:e}),e.index!==i&&this._trigger("change",t,{item:e}),this.close(t)},_setAria:function(e){var t=this.menuItems.eq(e.index).attr("id");this.button.attr({"aria-labelledby":t,"aria-activedescendant":t}),this.menu.attr("aria-activedescendant",t)},_setOption:function(e,t){"icons"===e&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(t.button),this._super(e,t),"appendTo"===e&&this.menuWrap.appendTo(this._appendTo()),"disabled"===e&&(this.menuInstance.option("disabled",t),this.button.toggleClass("ui-state-disabled",t).attr("aria-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===e&&this._resizeButton()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var e=this.options.width;e||(e=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(e)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")}},_parseOptions:function(t){var i=[];t.each(function(t,s){var n=e(s),a=n.parent("optgroup");i.push({element:n,index:t,value:n.attr("value"),label:n.text(),optgroup:a.attr("label")||"",disabled:a.prop("disabled")||n.prop("disabled")})}),this.items=i},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element)}}),e.widget("ui.slider",e.ui.mouse,{version:"1.11.2",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,s=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>",o=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),t=n.length;i>t;t++)o.push(a);this.handles=n.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,i="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,s,n,a,o,r,h,l,u=this,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(s-u.values(t));(n>i||n===i&&(t===u._lastChangedValue||u.values(t)===d.min))&&(n=i,a=e(this),o=t)}),r=this._start(t,o),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,a.addClass("ui-state-active").focus(),h=a.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-h.left-a.width()/2,top:t.pageY-h.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,s,n,a;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/t,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),a=this._valueMin()+s*n,this._trimAlignValue(a)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var s,n,a;this.options.values&&this.options.values.length?(s=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>s||1===t&&s>i)&&(i=s),i!==this.values(t)&&(n=this.values(),n[t]=i,a=this._trigger("slide",e,{handle:this.handles[t],value:i,values:n}),s=this.values(t?0:1),a!==!1&&this.values(t,i))):i!==this.value()&&(a=this._trigger("slide",e,{handle:this.handles[t],value:i}),a!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,i){var s,n,a;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(s=this.options.values,n=arguments[0],a=0;s.length>a;a+=1)s[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue()},_setOption:function(t,i){var s,n=0;switch("range"===t&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(n=this.options.values.length),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!i),this._super(t,i),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;n>s;s+=1)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,s;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)>=t&&(s+=i>0?t:-t),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var e=(this.options.max-this._valueMin())%this.options.step;this.max=this.options.max-e},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var t,i,s,n,a,o=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),u["horizontal"===h.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[l?"animate":"css"](u,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:r.animate}))),t=i}):(s=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?100*((s-n)/(a-n)):0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](u,r.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===o&&"horizontal"===this.orientation&&this.range[l?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===o&&"vertical"===this.orientation&&this.range[l?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(t){var i,s,n,a,o=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),i=this._start(t,o),i===!1))return}switch(a=this.options.step,s=n=this.options.values&&this.options.values.length?this.values(o):this.value(),t.keyCode){case e.ui.keyCode.HOME:n=this._valueMin();break;case e.ui.keyCode.END:n=this._valueMax();break;case e.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-a)}this._slide(t,o,n)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}}),e.widget("ui.spinner",{version:"1.11.2",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},i=this.element;return e.each(["min","max","step"],function(e,s){var n=i.attr(s);void 0!==n&&n.length&&(t[s]=n)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e),void 0)},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){function i(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(t)!==!1&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){return e(t.currentTarget).hasClass("ui-state-active")?this._start(t)===!1?!1:(this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t),void 0):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var i=this.options,s=e.ui.keyCode;switch(t.keyCode){case s.UP:return this._repeat(null,1,t),!0;case s.DOWN:return this._repeat(null,-1,t),!0;case s.PAGE_UP:return this._repeat(null,i.page,t),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon "+this.options.icons.down+"'>&#9660;</span>"+"</a>"
},_start:function(e){return this.spinning||this._trigger("start",e)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&this._trigger("spin",t,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,s=this.options;return t=null!==s.min?s.min:0,i=e-t,i=Math.round(i/s.step)*s.step,e=t+i,e=parseFloat(e.toFixed(this._precision())),null!==s.max&&e>s.max?s.max:null!==s.min&&s.min>e?s.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,this.element.val(this._format(i)),void 0}("max"===e||"min"===e||"step"===e)&&"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable"))},_setOptions:h(function(e){this._super(e)}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var e=this.value();return null===e?!1:e===this._adjustValue(e)},_value:function(e,t){var i;""!==e&&(i=this._parse(e),null!==i&&(t||(i=this._adjustValue(i)),e=this._format(i))),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:h(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:h(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:h(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:h(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){return arguments.length?(h(this._value).call(this,e),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),e.widget("ui.tabs",{version:"1.11.2",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var e=/#.*$/;return function(t){var i,s;t=t.cloneNode(!1),i=t.href.replace(e,""),s=location.href.replace(e,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return t.hash.length>1&&i===s}}(),_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===t&&(s&&this.tabs.each(function(i,n){return e(n).attr("aria-controls")===s?(t=i,!1):void 0}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=this.tabs.length?0:!1)),t!==!1&&(t=this.tabs.index(this.tabs.eq(t)),-1===t&&(t=i?!1:0)),!i&&t===!1&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:s++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:n=!1,s--;break;case e.ui.keyCode.END:s=this.anchors.length-1;break;case e.ui.keyCode.HOME:s=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),this._activate(s),void 0;case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),void 0;default:return}t.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),t.ctrlKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){function s(){return t>n&&(t=0),0>t&&(t=n),t}for(var n=this.tabs.length-1;-1!==e.inArray(s(),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){return"active"===e?(this._activate(t),void 0):"disabled"===e?(this._setupDisabled(t),void 0):(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||this.options.active!==!1||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t),void 0)},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),function(e){return i.index(e)}),this._processTabs(),t.active!==!1&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(i,s){var n,a,o,r=e(s).uniqueId().attr("id"),h=e(s).closest("li"),l=h.attr("aria-controls");t._isLocal(s)?(n=s.hash,o=n.substring(1),a=t.element.find(t._sanitizeSelector(n))):(o=h.attr("aria-controls")||e({}).uniqueId()[0].id,n="#"+o,a=t.element.find(n),a.length||(a=t._createPanel(o),a.insertAfter(t.panels[i-1]||t.tablist)),a.attr("aria-live","polite")),a.length&&(t.panels=t.panels.add(a)),l&&h.data("ui-tabs-aria-controls",l),h.attr({"aria-controls":o,"aria-labelledby":r}),a.attr("aria-labelledby",r)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,s=0;i=this.tabs[s];s++)t===!0||-1!==e.inArray(s,t)?e(i).addClass("ui-state-disabled").attr("aria-disabled","true"):e(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var i={};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,s=this.element.parent();"fill"===t?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),s=t.css("position");"absolute"!==s&&"fixed"!==s&&(i-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height("").height())}).height(i))},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n.closest("li"),o=a[0]===s[0],r=o&&i.collapsible,h=r?e():this._getPanelForTab(a),l=s.length?this._getPanelForTab(s):e(),u={oldTab:s,oldPanel:l,newTab:r?e():a,newPanel:h};t.preventDefault(),a.hasClass("ui-state-disabled")||a.hasClass("ui-tabs-loading")||this.running||o&&!i.collapsible||this._trigger("beforeActivate",t,u)===!1||(i.active=r?!1:this.tabs.index(a),this.active=o?e():a,this.xhr&&this.xhr.abort(),l.length||h.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(a),t),this._toggle(t,u))},_toggle:function(t,i){function s(){a.running=!1,a._trigger("activate",t,i)}function n(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),o.length&&a.options.show?a._show(o,a.options.show,s):(o.show(),s())}var a=this,o=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),o.length&&r.length?i.oldTab.attr("tabIndex",-1):o.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),o.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(t){var i,s=this._findActive(t);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(t){var i=this.options.disabled;i!==!1&&(void 0===t?i=!1:(t=this._getIndex(t),i=e.isArray(i)?e.map(i,function(e){return e!==t?e:null}):e.map(this.tabs,function(e,i){return i!==t?i:null})),this._setupDisabled(i))},disable:function(t){var i=this.options.disabled;if(i!==!0){if(void 0===t)i=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,i))return;i=e.isArray(i)?e.merge([t],i).sort():[t]}this._setupDisabled(i)}},load:function(t,i){t=this._getIndex(t);var s=this,n=this.tabs.eq(t),a=n.find(".ui-tabs-anchor"),o=this._getPanelForTab(n),r={tab:n,panel:o};this._isLocal(a[0])||(this.xhr=e.ajax(this._ajaxSettings(a,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(n.addClass("ui-tabs-loading"),o.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){o.html(e),s._trigger("load",i,r)},1)}).complete(function(e,t){setTimeout(function(){"abort"===t&&s.panels.stop(!1,!0),n.removeClass("ui-tabs-loading"),o.removeAttr("aria-busy"),e===s.xhr&&delete s.xhr},1)})))},_ajaxSettings:function(t,i,s){var n=this;return{url:t.attr("href"),beforeSend:function(t,a){return n._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:a},s))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),e.widget("ui.tooltip",{version:"1.11.2",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(t,i){var s=(t.attr("aria-describedby")||"").split(/\s+/);s.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(s.join(" ")))},_removeDescribedBy:function(t){var i=t.data("ui-tooltip-id"),s=(t.attr("aria-describedby")||"").split(/\s+/),n=e.inArray(i,s);-1!==n&&s.splice(n,1),t.removeData("ui-tooltip-id"),s=e.trim(s.join(" ")),s?t.attr("aria-describedby",s):t.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(t,i){var s=this;return"disabled"===t?(this[i?"_disable":"_enable"](),this.options[t]=i,void 0):(this._super(t,i),"content"===t&&e.each(this.tooltips,function(e,t){s._updateContent(t.element)}),void 0)},_disable:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur");n.target=n.currentTarget=s.element[0],t.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).removeAttr("title")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,s=e(t?t.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&s.parents().each(function(){var t,s=e(this);s.data("ui-tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._updateContent(s,t))},_updateContent:function(e,t){var i,s=this.options.content,n=this,a=t?t.type:null;return"string"==typeof s?this._open(t,e,s):(i=s.call(e[0],function(i){e.data("ui-tooltip-open")&&n._delay(function(){t&&(t.type=a),this._open(t,e,i)})}),i&&this._open(t,e,i),void 0)},_open:function(t,i,s){function n(e){u.of=e,o.is(":hidden")||o.position(u)}var a,o,r,h,l,u=e.extend({},this.options.position);if(s){if(a=this._find(i))return a.tooltip.find(".ui-tooltip-content").html(s),void 0;i.is("[title]")&&(t&&"mouseover"===t.type?i.attr("title",""):i.removeAttr("title")),a=this._tooltip(i),o=a.tooltip,this._addDescribedBy(i,o.attr("id")),o.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),s.clone?(l=s.clone(),l.removeAttr("id").find("[id]").removeAttr("id")):l=s,e("<div>").html(l).appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:n}),n(t)):o.position(e.extend({of:i},this.options.position)),o.hide(),this._show(o,this.options.show),this.options.show&&this.options.show.delay&&(h=this.delayedShow=setInterval(function(){o.is(":visible")&&(n(u.of),clearInterval(h))},e.fx.interval)),this._trigger("open",t,{tooltip:o}),r={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var s=e.Event(t);s.currentTarget=i[0],this.close(s,!0)}}},i[0]!==this.element[0]&&(r.remove=function(){this._removeTooltip(o)}),t&&"mouseover"!==t.type||(r.mouseleave="close"),t&&"focusin"!==t.type||(r.focusout="close"),this._on(!0,i,r)}},close:function(t){var i,s=this,n=e(t?t.currentTarget:this.element),a=this._find(n);a&&(i=a.tooltip,a.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),a.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(e(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete s.parents[t]}),a.closing=!0,this._trigger("close",t,{tooltip:i}),a.hiding||(a.closing=!1)))},_tooltip:function(t){var i=e("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),s=i.uniqueId().attr("id");return e("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[s]={element:t,tooltip:i}},_find:function(e){var t=e.data("ui-tooltip-id");return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event("blur"),a=s.element;n.target=n.currentTarget=a[0],t.close(n,!0),e("#"+i).remove(),a.data("ui-tooltip-title")&&(a.attr("title")||a.attr("title",a.data("ui-tooltip-title")),a.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}});var y="ui-effects-",b=e;e.effects={effect:{}},function(e,t){function i(e,t,i){var s=d[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:e>s.max?s.max:e)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(e,a){var o,r=a.re.exec(i),h=r&&a.parse(r),l=a.space||"rgba";return h?(o=s[l](h),s[u[l].cache]=o[u[l].cache],n=s._rgba=o._rgba,!1):t}),n.length?("0,0,0,0"===n.join()&&e.extend(n,a.transparent),s):a[i]}function n(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var a,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=e.Color=function(t,i,s,n){return new e.Color.fn.parse(t,i,s,n)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},c=l.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",c.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),l.fn=e.extend(l.prototype,{parse:function(n,o,r,h){if(n===t)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=e(n).css(o),o=t);var d=this,c=e.type(n),p=this._rgba=[];return o!==t&&(n=[n,o,r,h],c="array"),"string"===c?this.parse(s(n)||a._default):"array"===c?(f(u.rgba.props,function(e,t){p[t.idx]=i(n[t.idx],t)}),this):"object"===c?(n instanceof l?f(u,function(e,t){n[t.cache]&&(d[t.cache]=n[t.cache].slice())}):f(u,function(t,s){var a=s.cache;f(s.props,function(e,t){if(!d[a]&&s.to){if("alpha"===e||null==n[e])return;d[a]=s.to(d._rgba)}d[a][t.idx]=i(n[e],t,!0)}),d[a]&&0>e.inArray(null,d[a].slice(0,3))&&(d[a][3]=1,s.from&&(d._rgba=s.from(d[a])))}),this):t},is:function(e){var i=l(e),s=!0,n=this;return f(u,function(e,a){var o,r=i[a.cache];return r&&(o=n[a.cache]||a.to&&a.to(n._rgba)||[],f(a.props,function(e,i){return null!=r[i.idx]?s=r[i.idx]===o[i.idx]:t})),s}),s},_space:function(){var e=[],t=this;return f(u,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var s=l(e),n=s._space(),a=u[n],o=0===this.alpha()?l("transparent"):this,r=o[a.cache]||a.to(o._rgba),h=r.slice();return s=s[a.cache],f(a.props,function(e,n){var a=n.idx,o=r[a],l=s[a],u=d[n.type]||{};null!==l&&(null===o?h[a]=l:(u.mod&&(l-o>u.mod/2?o+=u.mod:o-l>u.mod/2&&(o-=u.mod)),h[a]=i((l-o)*t+o,n)))}),this[n](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(t)._rgba;return l(e.map(i,function(e,t){return(1-s)*n[t]+s*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,n=e[1]/255,a=e[2]/255,o=e[3],r=Math.max(s,n,a),h=Math.min(s,n,a),l=r-h,u=r+h,d=.5*u;return t=h===r?0:s===r?60*(n-a)/l+360:n===r?60*(a-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=d?l/u:l/(2-u),[Math.round(t)%360,i,d,null==o?1:o]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],a=e[3],o=.5>=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*n(r,o,t+1/3)),Math.round(255*n(r,o,t)),Math.round(255*n(r,o,t-1/3)),a]},f(u,function(s,n){var a=n.props,o=n.cache,h=n.to,u=n.from;l.fn[s]=function(s){if(h&&!this[o]&&(this[o]=h(this._rgba)),s===t)return this[o].slice();var n,r=e.type(s),d="array"===r||"object"===r?s:arguments,c=this[o].slice();return f(a,function(e,t){var s=d["object"===r?e:t.idx];null==s&&(s=c[t.idx]),c[t.idx]=i(s,t)}),u?(n=l(u(c)),n[o]=c,n):l(c)},f(a,function(t,i){l.fn[t]||(l.fn[t]=function(n){var a,o=e.type(n),h="alpha"===t?this._hsla?"hsla":"rgba":s,l=this[h](),u=l[i.idx];return"undefined"===o?u:("function"===o&&(n=n.call(this,u),o=e.type(n)),null==n&&i.empty?this:("string"===o&&(a=r.exec(n),a&&(n=u+parseFloat(a[2])*("+"===a[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,n){var a,o,r="";if("transparent"!==n&&("string"!==e.type(n)||(a=s(n)))){if(n=l(a||n),!c.rgba&&1!==n._rgba[3]){for(o="backgroundColor"===i?t.parentNode:t;(""===r||"transparent"===r)&&o&&o.style;)try{r=e.css(o,"backgroundColor"),o=o.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{t.style[i]=n}catch(h){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},l.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e}),t}},a=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(b),function(){function t(t){var i,s,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,a={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(a[e.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(a[i]=n[i]);return a}function i(t,i){var s,a,o={};for(s in i)a=i[s],t[s]!==a&&(n[s]||(e.fx.step[s]||!isNaN(parseFloat(a)))&&(o[s]=a));return o}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(b.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(n,a,o,r){var h=e.speed(a,o,r);return this.queue(function(){var a,o=e(this),r=o.attr("class")||"",l=h.children?o.find("*").addBack():o;l=l.map(function(){var i=e(this);return{el:i,start:t(this)}}),a=function(){e.each(s,function(e,t){n[t]&&o[t+"Class"](n[t])})},a(),l=l.map(function(){return this.end=t(this.el[0]),this.diff=i(this.start,this.end),this}),o.attr("class",r),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},h,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){a(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),h.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(i,s,n,a){return s?e.effects.animateClass.call(this,{add:i},s,n,a):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,s,n,a){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,n,a):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,s,n,a,o){return"boolean"==typeof s||void 0===s?n?e.effects.animateClass.call(this,s?{add:i}:{remove:i},n,a,o):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},s,n,a)}}(e.fn.toggleClass),switchClass:function(t,i,s,n,a){return e.effects.animateClass.call(this,{add:i,remove:t},s,n,a)}})}(),function(){function t(t,i,s,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(n=s,s=i,i={}),e.isFunction(s)&&(n=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=n||i.complete,t}function i(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.11.2",save:function(e,t){for(var i=0;t.length>i;i++)null!==t[i]&&e.data(y+t[i],e[0].style[t[i]])},restore:function(e,t){var i,s;for(s=0;t.length>s;s++)null!==t[s]&&(i=e.data(y+t[s]),void 0===i&&(i=""),e.css(t[s],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},a=document.activeElement;try{a.id}catch(o){a=document.body}return t.wrap(s),(t[0]===a||e.contains(t[0],a))&&e(a).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,n){return n=n||{},e.each(i,function(e,i){var a=t.cssUnit(i);a[0]>0&&(n[i]=a[0]*s+a[1])}),n}}),e.fn.extend({effect:function(){function i(t){function i(){e.isFunction(a)&&a.call(n[0]),e.isFunction(t)&&t()}var n=e(this),a=s.complete,r=s.mode;(n.is(":hidden")?"hide"===r:"show"===r)?(n[r](),i()):o.call(n[0],s,i)}var s=t.apply(this,arguments),n=s.mode,a=s.queue,o=e.effects.effect[s.effect];return e.fx.off||!o?n?this[n](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)}):a===!1?this.each(i):this.queue(a||"fx",i)},show:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(s){if(i(s))return e.apply(this,arguments);
var n=t.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(s){if(i(s)||"boolean"==typeof s)return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}(),e.effects,e.effects.effect.blind=function(t,i){var s,n,a,o=e(this),r=/up|down|vertical/,h=/up|left|vertical|horizontal/,l=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(o,t.mode||"hide"),d=t.direction||"up",c=r.test(d),p=c?"height":"width",f=c?"top":"left",m=h.test(d),g={},v="show"===u;o.parent().is(".ui-effects-wrapper")?e.effects.save(o.parent(),l):e.effects.save(o,l),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n=s[p](),a=parseFloat(s.css(f))||0,g[p]=v?n:0,m||(o.css(c?"bottom":"right",0).css(c?"top":"left","auto").css({position:"absolute"}),g[f]=v?a:n+a),v&&(s.css(p,0),m||s.css(f,a+n)),s.animate(g,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===u&&o.hide(),e.effects.restore(o,l),e.effects.removeWrapper(o),i()}})},e.effects.effect.bounce=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"effect"),l="hide"===h,u="show"===h,d=t.direction||"up",c=t.distance,p=t.times||5,f=2*p+(u||l?1:0),m=t.duration/f,g=t.easing,v="up"===d||"down"===d?"top":"left",y="up"===d||"left"===d,b=o.queue(),_=b.length;for((u||l)&&r.push("opacity"),e.effects.save(o,r),o.show(),e.effects.createWrapper(o),c||(c=o["top"===v?"outerHeight":"outerWidth"]()/3),u&&(a={opacity:1},a[v]=0,o.css("opacity",0).css(v,y?2*-c:2*c).animate(a,m,g)),l&&(c/=Math.pow(2,p-1)),a={},a[v]=0,s=0;p>s;s++)n={},n[v]=(y?"-=":"+=")+c,o.animate(n,m,g).animate(a,m,g),c=l?2*c:c/2;l&&(n={opacity:0},n[v]=(y?"-=":"+=")+c,o.animate(n,m,g)),o.queue(function(){l&&o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}),_>1&&b.splice.apply(b,[1,0].concat(b.splice(_,f+1))),o.dequeue()},e.effects.effect.clip=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"hide"),l="show"===h,u=t.direction||"vertical",d="vertical"===u,c=d?"height":"width",p=d?"top":"left",f={};e.effects.save(o,r),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n="IMG"===o[0].tagName?s:o,a=n[c](),l&&(n.css(c,0),n.css(p,a/2)),f[c]=l?a:0,f[p]=l?0:a/2,n.animate(f,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){l||o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}})},e.effects.effect.drop=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","opacity","height","width"],o=e.effects.setMode(n,t.mode||"hide"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h?"pos":"neg",d={opacity:r?1:0};e.effects.save(n,a),n.show(),e.effects.createWrapper(n),s=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0)/2,r&&n.css("opacity",0).css(l,"pos"===u?-s:s),d[l]=(r?"pos"===u?"+=":"-=":"pos"===u?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})},e.effects.effect.explode=function(t,i){function s(){b.push(this),b.length===d*c&&n()}function n(){p.css({visibility:"visible"}),e(b).remove(),m||p.hide(),i()}var a,o,r,h,l,u,d=t.pieces?Math.round(Math.sqrt(t.pieces)):3,c=d,p=e(this),f=e.effects.setMode(p,t.mode||"hide"),m="show"===f,g=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/c),y=Math.ceil(p.outerHeight()/d),b=[];for(a=0;d>a;a++)for(h=g.top+a*y,u=a-(d-1)/2,o=0;c>o;o++)r=g.left+o*v,l=o-(c-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*v,top:-a*y}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:y,left:r+(m?l*v:0),top:h+(m?u*y:0),opacity:m?0:1}).animate({left:r+(m?0:l*v),top:h+(m?0:u*y),opacity:m?1:0},t.duration||500,t.easing,s)},e.effects.effect.fade=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"toggle");s.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.easing,complete:i})},e.effects.effect.fold=function(t,i){var s,n,a=e(this),o=["position","top","bottom","left","right","height","width"],r=e.effects.setMode(a,t.mode||"hide"),h="show"===r,l="hide"===r,u=t.size||15,d=/([0-9]+)%/.exec(u),c=!!t.horizFirst,p=h!==c,f=p?["width","height"]:["height","width"],m=t.duration/2,g={},v={};e.effects.save(a,o),a.show(),s=e.effects.createWrapper(a).css({overflow:"hidden"}),n=p?[s.width(),s.height()]:[s.height(),s.width()],d&&(u=parseInt(d[1],10)/100*n[l?0:1]),h&&s.css(c?{height:0,width:u}:{height:u,width:0}),g[f[0]]=h?n[0]:u,v[f[1]]=h?n[1]:0,s.animate(g,m,t.easing).animate(v,m,t.easing,function(){l&&a.hide(),e.effects.restore(a,o),e.effects.removeWrapper(a),i()})},e.effects.effect.highlight=function(t,i){var s=e(this),n=["backgroundImage","backgroundColor","opacity"],a=e.effects.setMode(s,t.mode||"show"),o={backgroundColor:s.css("backgroundColor")};"hide"===a&&(o.opacity=0),e.effects.save(s,n),s.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===a&&s.hide(),e.effects.restore(s,n),i()}})},e.effects.effect.size=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],h=["position","top","bottom","left","right","overflow","opacity"],l=["width","height","overflow"],u=["fontSize"],d=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],c=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(o,t.mode||"effect"),f=t.restore||"effect"!==p,m=t.scale||"both",g=t.origin||["middle","center"],v=o.css("position"),y=f?r:h,b={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&o.show(),s={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},"toggle"===t.mode&&"show"===p?(o.from=t.to||b,o.to=t.from||s):(o.from=t.from||("show"===p?b:s),o.to=t.to||("hide"===p?b:s)),a={from:{y:o.from.height/s.height,x:o.from.width/s.width},to:{y:o.to.height/s.height,x:o.to.width/s.width}},("box"===m||"both"===m)&&(a.from.y!==a.to.y&&(y=y.concat(d),o.from=e.effects.setTransition(o,d,a.from.y,o.from),o.to=e.effects.setTransition(o,d,a.to.y,o.to)),a.from.x!==a.to.x&&(y=y.concat(c),o.from=e.effects.setTransition(o,c,a.from.x,o.from),o.to=e.effects.setTransition(o,c,a.to.x,o.to))),("content"===m||"both"===m)&&a.from.y!==a.to.y&&(y=y.concat(u).concat(l),o.from=e.effects.setTransition(o,u,a.from.y,o.from),o.to=e.effects.setTransition(o,u,a.to.y,o.to)),e.effects.save(o,y),o.show(),e.effects.createWrapper(o),o.css("overflow","hidden").css(o.from),g&&(n=e.effects.getBaseline(g,s),o.from.top=(s.outerHeight-o.outerHeight())*n.y,o.from.left=(s.outerWidth-o.outerWidth())*n.x,o.to.top=(s.outerHeight-o.to.outerHeight)*n.y,o.to.left=(s.outerWidth-o.to.outerWidth)*n.x),o.css(o.from),("content"===m||"both"===m)&&(d=d.concat(["marginTop","marginBottom"]).concat(u),c=c.concat(["marginLeft","marginRight"]),l=r.concat(d).concat(c),o.find("*[width]").each(function(){var i=e(this),s={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};f&&e.effects.save(i,l),i.from={height:s.height*a.from.y,width:s.width*a.from.x,outerHeight:s.outerHeight*a.from.y,outerWidth:s.outerWidth*a.from.x},i.to={height:s.height*a.to.y,width:s.width*a.to.x,outerHeight:s.height*a.to.y,outerWidth:s.width*a.to.x},a.from.y!==a.to.y&&(i.from=e.effects.setTransition(i,d,a.from.y,i.from),i.to=e.effects.setTransition(i,d,a.to.y,i.to)),a.from.x!==a.to.x&&(i.from=e.effects.setTransition(i,c,a.from.x,i.from),i.to=e.effects.setTransition(i,c,a.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){f&&e.effects.restore(i,l)})})),o.animate(o.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===o.to.opacity&&o.css("opacity",o.from.opacity),"hide"===p&&o.hide(),e.effects.restore(o,y),f||("static"===v?o.css({position:"relative",top:o.to.top,left:o.to.left}):e.each(["top","left"],function(e,t){o.css(t,function(t,i){var s=parseInt(i,10),n=e?o.to.left:o.to.top;return"auto"===i?n+"px":s+n+"px"})})),e.effects.removeWrapper(o),i()}})},e.effects.effect.scale=function(t,i){var s=e(this),n=e.extend(!0,{},t),a=e.effects.setMode(s,t.mode||"effect"),o=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===a?0:100),r=t.direction||"both",h=t.origin,l={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},u={y:"horizontal"!==r?o/100:1,x:"vertical"!==r?o/100:1};n.effect="size",n.queue=!1,n.complete=i,"effect"!==a&&(n.origin=h||["middle","center"],n.restore=!0),n.from=t.from||("show"===a?{height:0,width:0,outerHeight:0,outerWidth:0}:l),n.to={height:l.height*u.y,width:l.width*u.x,outerHeight:l.outerHeight*u.y,outerWidth:l.outerWidth*u.x},n.fade&&("show"===a&&(n.from.opacity=0,n.to.opacity=1),"hide"===a&&(n.from.opacity=1,n.to.opacity=0)),s.effect(n)},e.effects.effect.puff=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"hide"),a="hide"===n,o=parseInt(t.percent,10)||150,r=o/100,h={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:a?o:100,from:a?h:{height:h.height*r,width:h.width*r,outerHeight:h.outerHeight*r,outerWidth:h.outerWidth*r}}),s.effect(t)},e.effects.effect.pulsate=function(t,i){var s,n=e(this),a=e.effects.setMode(n,t.mode||"show"),o="show"===a,r="hide"===a,h=o||"hide"===a,l=2*(t.times||5)+(h?1:0),u=t.duration/l,d=0,c=n.queue(),p=c.length;for((o||!n.is(":visible"))&&(n.css("opacity",0).show(),d=1),s=1;l>s;s++)n.animate({opacity:d},u,t.easing),d=1-d;n.animate({opacity:d},u,t.easing),n.queue(function(){r&&n.hide(),i()}),p>1&&c.splice.apply(c,[1,0].concat(c.splice(p,l+1))),n.dequeue()},e.effects.effect.shake=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","height","width"],o=e.effects.setMode(n,t.mode||"effect"),r=t.direction||"left",h=t.distance||20,l=t.times||3,u=2*l+1,d=Math.round(t.duration/u),c="up"===r||"down"===r?"top":"left",p="up"===r||"left"===r,f={},m={},g={},v=n.queue(),y=v.length;for(e.effects.save(n,a),n.show(),e.effects.createWrapper(n),f[c]=(p?"-=":"+=")+h,m[c]=(p?"+=":"-=")+2*h,g[c]=(p?"-=":"+=")+2*h,n.animate(f,d,t.easing),s=1;l>s;s++)n.animate(m,d,t.easing).animate(g,d,t.easing);n.animate(m,d,t.easing).animate(f,d/2,t.easing).queue(function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,u+1))),n.dequeue()},e.effects.effect.slide=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","width","height"],o=e.effects.setMode(n,t.mode||"show"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h,d={};e.effects.save(n,a),n.show(),s=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(n).css({overflow:"hidden"}),r&&n.css(l,u?isNaN(s)?"-"+s:-s:s),d[l]=(r?u?"+=":"-=":u?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})},e.effects.effect.transfer=function(t,i){var s=e(this),n=e(t.to),a="fixed"===n.css("position"),o=e("body"),r=a?o.scrollTop():0,h=a?o.scrollLeft():0,l=n.offset(),u={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},d=s.offset(),c=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:d.top-r,left:d.left-h,height:s.innerHeight(),width:s.innerWidth(),position:a?"fixed":"absolute"}).animate(u,t.duration,t.easing,function(){c.remove(),i()})}});;/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD
		define(['jquery'], factory);
	} else if (typeof exports === 'object') {
		// CommonJS
		factory(require('jquery'));
	} else {
		// Browser globals
		factory(jQuery);
	}
}(function ($) {

	var pluses = /\+/g;

	function encode(s) {
		return config.raw ? s : encodeURIComponent(s);
	}

	function decode(s) {
		return config.raw ? s : decodeURIComponent(s);
	}

	function stringifyCookieValue(value) {
		return encode(config.json ? JSON.stringify(value) : String(value));
	}

	function parseCookieValue(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape...
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}

		try {
			// Replace server-side written pluses with spaces.
			// If we can't decode the cookie, ignore it, it's unusable.
			// If we can't parse the cookie, ignore it, it's unusable.
			s = decodeURIComponent(s.replace(pluses, ' '));
			return config.json ? JSON.parse(s) : s;
		} catch(e) {}
	}

	function read(s, converter) {
		var value = config.raw ? s : parseCookieValue(s);
		return $.isFunction(converter) ? converter(value) : value;
	}

	var config = $.cookie = function (key, value, options) {

		// Write

		if (value !== undefined && !$.isFunction(value)) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setTime(+t + days * 864e+5);
			}

			return (document.cookie = [
				encode(key), '=', stringifyCookieValue(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// Read

		var result = key ? undefined : {};

		// To prevent the for loop in the first place assign an empty array
		// in case there are no cookies at all. Also prevents odd result when
		// calling $.cookie().
		var cookies = document.cookie ? document.cookie.split('; ') : [];

		for (var i = 0, l = cookies.length; i < l; i++) {
			var parts = cookies[i].split('=');
			var name = decode(parts.shift());
			var cookie = parts.join('=');

			if (key && key === name) {
				// If second argument (value) is a function it's a converter...
				result = read(cookie, value);
				break;
			}

			// Prevent storing a cookie that we couldn't decode.
			if (!key && (cookie = read(cookie)) !== undefined) {
				result[name] = cookie;
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		if ($.cookie(key) === undefined) {
			return false;
		}

		// Must not alter options, thus extending a fresh object...
		$.cookie(key, '', $.extend({}, options, { expires: -1 }));
		return !$.cookie(key);
	};

}));
;/*
 jquery.fullscreen 1.1.4
 https://github.com/kayahr/jquery-fullscreen-plugin
 Copyright (C) 2012 Klaus Reimer <k@ailis.de>
 Licensed under the MIT license
 (See http://www.opensource.org/licenses/mit-license)
*/
function d(b){var c,a;if(!this.length)return this;c=this[0];c.ownerDocument?a=c.ownerDocument:(a=c,c=a.documentElement);if(null==b){if(!a.cancelFullScreen&&!a.webkitCancelFullScreen&&!a.mozCancelFullScreen)return null;b=!!a.fullScreen||!!a.webkitIsFullScreen||!!a.mozFullScreen;return!b?b:a.fullScreenElement||a.webkitCurrentFullScreenElement||a.mozFullScreenElement||b}b?(b=c.requestFullScreen||c.webkitRequestFullScreen||c.mozRequestFullScreen)&&b.call(c,Element.ALLOW_KEYBOARD_INPUT):(b=a.cancelFullScreen||
a.webkitCancelFullScreen||a.mozCancelFullScreen)&&b.call(a);return this}jQuery.fn.fullScreen=d;jQuery.fn.toggleFullScreen=function(){return d.call(this,!d.call(this))};var e,f,g;e=document;e.webkitCancelFullScreen?(f="webkitfullscreenchange",g="webkitfullscreenerror"):e.mozCancelFullScreen?(f="mozfullscreenchange",g="mozfullscreenerror"):(f="fullscreenchange",g="fullscreenerror");jQuery(document).bind(f,function(){jQuery(document).trigger(new jQuery.Event("fullscreenchange"))});
jQuery(document).bind(g,function(){jQuery(document).trigger(new jQuery.Event("fullscreenerror"))});;var cookieScripts=document.getElementsByTagName("script"),cookieScriptSrc=cookieScripts[cookieScripts.length-1].src,cookieQuery=null,cookieScriptPosition="bottom",cookieScriptSide="right",cookieScriptSource="cookie-script.com",cookieScriptDomain="",cookieScriptReadMore="/policies/cookie_"+App.context.languageCode+".html",cookieId="6a00eb3cf69b00d1af83ec32b891828a",cookieScriptDebug=0,cookieScriptCurrentUrl=window.location.href,cookieScriptTitle='<h4 id="cookiescript_header">'+App.translations.weUseCookies+'</h4>',cookieScriptDesc=App.translations.weUseCookiesDescription,
cookieScriptAccept="\u00d7",cookieScriptMore=App.translations.readMore,cookieScriptCopyrights="",cookieScriptLoadJavaScript=function(f,d){var b=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript";a.src=f;void 0!=d&&(a.onload=a.onreadystatechange=function(){a.readyState&&!/loaded|complete/.test(a.readyState)||(a.onload=a.onreadystatechange=null,b&&a.parentNode&&b.removeChild(a),a=void 0,d())});b.insertBefore(a,b.firstChild)},InjectCookieScript=function(){function f(){cookieQuery('iframe[data-cookiescript="accepted"]').not(":has([src])").each(function(){var a=
this,a=a.contentWindow?a.contentWindow:a.contentDocument.document?a.contentDocument.document:a.contentDocument;a.document.open();a.document.write(cookieQuery(this).attr("alt"));a.document.close()})}function d(a){"show"==a?(cookieQuery("#cookiescript_overlay",cookieScriptWindow).show(),cookieQuery("#cookiescript_info_box",cookieScriptWindow).show()):"hide"==a&&(cookieQuery("#cookiescript_overlay",cookieScriptWindow).hide(),cookieQuery("#cookiescript_info_box",cookieScriptWindow).hide())}function b(){cookieQuery('img[data-cookiescript="accepted"]').each(function(){cookieQuery(this).attr("src",
cookieQuery(this).attr("data-src"))});cookieQuery('script[type="text/plain"][data-cookiescript="accepted"]').each(function(){cookieQuery(this).attr("src")?cookieQuery(this).after('<script type="text/javascript" src="'+cookieQuery(this).attr("src")+'">\x3c/script>'):cookieQuery(this).after('<script type="text/javascript">'+cookieQuery(this).html()+"\x3c/script>");cookieQuery(this).empty()});cookieQuery('iframe[data-cookiescript="accepted"]').each(function(){cookieQuery(this).attr("src",cookieQuery(this).attr("data-src"))});
cookieQuery('embed[data-cookiescript="accepted"]').each(function(){cookieQuery(this).replaceWith(cookieQuery(this).attr("src",cookieQuery(this).attr("data-src"))[0].outerHTML)});cookieQuery('object[data-cookiescript="accepted"]').each(function(){cookieQuery(this).replaceWith(cookieQuery(this).attr("data",cookieQuery(this).attr("data-data"))[0].outerHTML)});cookieQuery('link[data-cookiescript="accepted"]').each(function(){cookieQuery(this).attr("href",cookieQuery(this).attr("data-href"))})}cookieScriptDropfromFlag=
0;cookieScriptDroptoFlag=0;cookieScriptCreateCookie=function(a,b,c){var d="",e;c&&(e=new Date,e.setTime(e.getTime()+864E5*c),d="; expires="+e.toGMTString());c="";""!=cookieScriptDomain&&
(c="; domain="+cookieScriptDomain);document.cookie=a+"="+b+d+c+"; path=/"};cookieScriptReadCookie=function(a){a+="=";for(var d=document.cookie.split(";"),c,b=0;b<d.length;b++){for(c=d[b];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(a))return c.substring(a.length,c.length)}return null};cookieQuery(function(){cookieScriptWindow=window.document;cookieQuery("#cookiescript_injected",cookieScriptWindow).remove();cookieQuery("#cookiescript_overlay",cookieScriptWindow).remove();cookieQuery("#cookiescript_info_box",
cookieScriptWindow).remove();cookieScriptCurrentValue=cookieScriptReadCookie("cookiescriptaccept");if("visit"==cookieScriptCurrentValue)return!1;if(cookieScriptCurrentValue){if("firstvisit"==cookieScriptCurrentValue.substring(0,10)&&cookieScriptCurrentValue!="firstvisit-"+cookieScriptCurrentUrl)return cookieScriptCreateCookie("cookiescriptaccept","visit",30),b(),!1}else cookieScriptCreateCookie("cookiescriptaccept","firstvisit-"+cookieScriptCurrentUrl,30);cookieQuery("body",cookieScriptWindow).append('<div id="cookiescript_injected">'+
cookieScriptTitle+cookieScriptDesc+' <span id="cookiescript_readmore">'+cookieScriptMore+'</span><div id="cookiescript_accept">'+cookieScriptAccept+'</div><div style="clear:both"></div>');cookieQuery("#cookiescript_injected",cookieScriptWindow).css({"background-color":"#111111","z-index":999999,opacity:1,position:"fixed",
padding:"15px",width:"300px","font-size":"13px","font-weight":"normal","text-align":"left",color:"#FFFFFF","font-family":"Arial, sans-serif",display:"none","line-height":"15px","letter-spacing":"normal","-moz-box-shadow":"0px 0px 8px #000000","-webkit-box-shadow":"0px 0px 8px #000000","box-shadow":"0px 0px 8px #000000"});"top"==cookieScriptPosition?cookieQuery("#cookiescript_injected",cookieScriptWindow).css("top",0):cookieQuery("#cookiescript_injected",cookieScriptWindow).css("bottom",0);"left"==
cookieScriptSide?cookieQuery("#cookiescript_injected",cookieScriptWindow).css("left",0):cookieQuery("#cookiescript_injected",cookieScriptWindow).css("right",0);cookieQuery("#cookiescript_injected h4#cookiescript_header",cookieScriptWindow).css({"background-color":"#111111","z-index":999999,padding:"0 0 7px 0","text-align":"left",color:"#FFFFFF","font-family":"Arial, sans-serif",display:"block","font-size":"15px","font-weight":"bold","line-height":"normal","letter-spacing":"normal","font-style":"normal",
margin:"0"});cookieQuery("#cookiescript_injected a",cookieScriptWindow).css({"text-decoration":"underline",color:"#FFFFFF"});cookieQuery("#cookiescript_injected a#cookiescript_link",cookieScriptWindow).css({"text-decoration":"none",color:"#FFFFFF","float":"right","font-size":"90%","text-decoration":"none","margin-top":"8px"});cookieQuery("#cookiescript_injected span#cookiescript_readmore",cookieScriptWindow).css({border:0,padding:"0","text-decoration":"underline",cursor:"pointer",margin:"0","white-space":"nowrap"});
cookieQuery("#cookiescript_injected div#cookiescript_accept",cookieScriptWindow).css({"-webkit-border-radius":"10px","-khtml-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px",border:0,padding:"0",cursor:"pointer",margin:"0","-webkit-transition":"0.25s","-moz-transition":"0.25s",transition:"0.25s",width:"20px",height:"20px",position:"absolute",top:"12px",right:"17px","border-radius":"10px","text-align":"center","font-weight":"bold","line-height":"21px","font-size":"20px"});cookieQuery("#cookiescript_injected div#cookiescript_accept",
cookieScriptWindow).css({"background-color":"#5BB75B",color:"#FFFFFF","float":"left"});cookieQuery("#cookiescript_injected span#cookiescript_readmore",cookieScriptWindow).css({});cookieQuery("#cookiescript_injected div#cookiescript_pixel",cookieScriptWindow).css({width:"1px",height:"1px","float":"left"});cookieQuery("#cookiescript_injected",cookieScriptWindow).fadeIn(1E3);cookieQuery("#cookiescript_injected div#cookiescript_accept",cookieScriptWindow).click(function(){"undefined"===typeof cookieScriptScrollfired&&
(cookieQuery("#cookiescript_injected",cookieScriptWindow).fadeOut(200),cookieScriptCreateCookie("cookiescriptaccept","visit",30),d("hide"),b())});cookieQuery("#cookiescript_injected span#cookiescript_readmore",cookieScriptWindow).click(function(){window.open(cookieScriptReadMore,"_blank");return!1});cookieQuery("#cookiescript_overlay",cookieScriptWindow).click(function(){d("hide")});cookieQuery("#cookiescript_info_close",cookieScriptWindow).click(function(){d("hide")});document.onkeydown=function(a){a=
a||window.event;27==a.keyCode&&d("hide")};f()});"visit"!=cookieScriptReadCookie("cookiescriptaccept")&&"shown"!=cookieScriptReadCookie("cookiescriptaccept")||b()};
window.jQuery&&jQuery.fn&&/^(1\.[8-9]|2\.[0-9])/.test(jQuery.fn.jquery)?(cookieScriptDebug&&window.console&&console.log("Using existing jQuery version "+jQuery.fn.jquery),cookieQuery=window.jQuery,InjectCookieScript()):(cookieScriptDebug&&window.console&&console.log("Loading jQuery 1.8.1 from ajax.googleapis.com"),cookieScriptLoadJavaScript(("https:"==document.location.protocol?"https://":"http://")+"ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js",function(){cookieQuery=jQuery.noConflict(!0);
InjectCookieScript()}));
;!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s(require("wkt-parser")):"function"==typeof define&&define.amd?define(["wkt-parser"],s):t.proj4=s(t.wkt)}(this,function(t){"use strict";function s(t,s){if(t[s])return t[s];for(var i,a=Object.keys(t),h=s.toLowerCase().replace(Mt,""),e=-1;++e<a.length;)if(i=a[e],i.toLowerCase().replace(Mt,"")===h)return t[i]}function i(s){var a=this;if(2===arguments.length){var h=arguments[1];"string"==typeof h?"+"===h.charAt(0)?i[s]=ct(arguments[1]):i[s]=t(arguments[1]):i[s]=h}else if(1===arguments.length){if(Array.isArray(s))return s.map(function(t){Array.isArray(t)?i.apply(a,t):i(t)});if("string"==typeof s){if(s in i)return i[s]}else"EPSG"in s?i["EPSG:"+s.EPSG]=s:"ESRI"in s?i["ESRI:"+s.ESRI]=s:"IAU2000"in s?i["IAU2000:"+s.IAU2000]=s:console.log(s);return}}function a(t){return"string"==typeof t}function h(t){return t in i}function e(t){return ut.some(function(s){return t.indexOf(s)>-1})}function n(t){var i=s(t,"authority");if(i){var a=s(i,"epsg");return a&&ft.indexOf(a)>-1}}function r(t){var i=s(t,"extension");if(i)return s(i,"proj4")}function o(t){return"+"===t[0]}function l(s){if(!a(s))return s;if(h(s))return i[s];if(e(s)){var l=t(s);if(n(l))return i["EPSG:3857"];var M=r(l);return M?ct(M):l}return o(s)?ct(s):void 0}function M(t){return t}function c(t,s){var i=bt.length;return t.names?(bt[i]=t,t.names.forEach(function(t){gt[t.toLowerCase()]=i}),this):(console.log(s),!0)}function u(t,s,i,a){var h=t*t,e=s*s,n=(h-e)/h,r=0;return a?(h=(t*=1-n*($+n*(tt+n*st)))*t,n=0):r=Math.sqrt(n),{es:n,e:r,ep2:(h-e)/e}}function f(t,i,a,h,e){if(!t){var n=s(At,h);n||(n=Pt),t=n.a,i=n.b,a=n.rf}return a&&!i&&(i=(1-1/a)*t),(0===a||Math.abs(t-i)<it)&&(e=!0,i=t),{a:t,b:i,rf:a,sphere:e}}function m(t,s,i,a,h,e){var n={};return n.datum_type=void 0===t||"none"===t?Z:J,s&&(n.datum_params=s.map(parseFloat),0===n.datum_params[0]&&0===n.datum_params[1]&&0===n.datum_params[2]||(n.datum_type=X),n.datum_params.length>3&&(0===n.datum_params[3]&&0===n.datum_params[4]&&0===n.datum_params[5]&&0===n.datum_params[6]||(n.datum_type=H,n.datum_params[3]*=V,n.datum_params[4]*=V,n.datum_params[5]*=V,n.datum_params[6]=n.datum_params[6]/1e6+1))),n.a=i,n.b=a,n.es=h,n.ep2=e,n}function Projection(t,i){if(!(this instanceof Projection))return new Projection(t);i=i||function(t){if(t)throw t};var a=l(t);if("object"==typeof a){var h=Projection.projections.get(a.projName);if(h){if(a.datumCode&&"none"!==a.datumCode){var e=s(kt,a.datumCode);e&&(a.datum_params=e.towgs84?e.towgs84.split(","):null,a.ellps=e.ellipse,a.datumName=e.datumName?e.datumName:a.datumCode)}a.k0=a.k0||1,a.axis=a.axis||"enu",a.ellps=a.ellps||"wgs84";var n=f(a.a,a.b,a.rf,a.ellps,a.sphere),r=u(n.a,n.b,n.rf,a.R_A),o=a.datum||m(a.datumCode,a.datum_params,n.a,n.b,r.es,r.ep2);mt(this,a),mt(this,h),this.a=n.a,this.b=n.b,this.rf=n.rf,this.sphere=n.sphere,this.es=r.es,this.e=r.e,this.ep2=r.ep2,this.datum=o,this.init(),i(null,this)}else i(t)}else i(t)}function p(t,s){return t.datum_type===s.datum_type&&(!(t.a!==s.a||Math.abs(t.es-s.es)>5e-11)&&(t.datum_type===X?t.datum_params[0]===s.datum_params[0]&&t.datum_params[1]===s.datum_params[1]&&t.datum_params[2]===s.datum_params[2]:t.datum_type!==H||t.datum_params[0]===s.datum_params[0]&&t.datum_params[1]===s.datum_params[1]&&t.datum_params[2]===s.datum_params[2]&&t.datum_params[3]===s.datum_params[3]&&t.datum_params[4]===s.datum_params[4]&&t.datum_params[5]===s.datum_params[5]&&t.datum_params[6]===s.datum_params[6]))}function y(t,s,i){var a,h,e,n,r=t.x,o=t.y,l=t.z?t.z:0;if(o<-Y&&o>-1.001*Y)o=-Y;else if(o>Y&&o<1.001*Y)o=Y;else{if(o<-Y)return{x:-1/0,y:-1/0,z:t.z};if(o>Y)return{x:1/0,y:1/0,z:t.z}}return r>Math.PI&&(r-=2*Math.PI),h=Math.sin(o),n=Math.cos(o),e=h*h,a=i/Math.sqrt(1-s*e),{x:(a+l)*n*Math.cos(r),y:(a+l)*n*Math.sin(r),z:(a*(1-s)+l)*h}}function d(t,s,i,a){var h,e,n,r,o,l,M,c,u,f,m,p,y,d,_,x,v=t.x,g=t.y,b=t.z?t.z:0;if(h=Math.sqrt(v*v+g*g),e=Math.sqrt(v*v+g*g+b*b),h/i<1e-12){if(d=0,e/i<1e-12)return _=Y,x=-a,{x:t.x,y:t.y,z:t.z}}else d=Math.atan2(g,v);n=b/e,c=(r=h/e)*(1-s)*(o=1/Math.sqrt(1-s*(2-s)*r*r)),u=n*o,y=0;do{y++,l=s*(M=i/Math.sqrt(1-s*u*u))/(M+(x=h*c+b*u-M*(1-s*u*u))),p=(m=n*(o=1/Math.sqrt(1-l*(2-l)*r*r)))*c-(f=r*(1-l)*o)*u,c=f,u=m}while(p*p>1e-24&&y<30);return _=Math.atan(m/Math.abs(f)),{x:d,y:_,z:x}}function _(t,s,i){if(s===X)return{x:t.x+i[0],y:t.y+i[1],z:t.z+i[2]};if(s===H){var a=i[0],h=i[1],e=i[2],n=i[3],r=i[4],o=i[5],l=i[6];return{x:l*(t.x-o*t.y+r*t.z)+a,y:l*(o*t.x+t.y-n*t.z)+h,z:l*(-r*t.x+n*t.y+t.z)+e}}}function x(t,s,i){if(s===X)return{x:t.x-i[0],y:t.y-i[1],z:t.z-i[2]};if(s===H){var a=i[0],h=i[1],e=i[2],n=i[3],r=i[4],o=i[5],l=i[6],M=(t.x-a)/l,c=(t.y-h)/l,u=(t.z-e)/l;return{x:M+o*c-r*u,y:-o*M+c+n*u,z:r*M-n*c+u}}}function v(t){return t===X||t===H}function g(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!==t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function b(t,s){return(t.datum.datum_type===X||t.datum.datum_type===H)&&"WGS84"!==s.datumCode||(s.datum.datum_type===X||s.datum.datum_type===H)&&"WGS84"!==t.datumCode}function w(t,s,i){var a;if(Array.isArray(i)&&(i=Et(i)),St(i),t.datum&&s.datum&&b(t,s)&&(i=w(t,a=new Projection("WGS84"),i),t=a),"enu"!==t.axis&&(i=Nt(t,!1,i)),"longlat"===t.projName)i={x:i.x*at,y:i.y*at,z:i.z||0};else if(t.to_meter&&(i={x:i.x*t.to_meter,y:i.y*t.to_meter,z:i.z||0}),!(i=t.inverse(i)))return;return t.from_greenwich&&(i.x+=t.from_greenwich),i=qt(t.datum,s.datum,i),s.from_greenwich&&(i={x:i.x-s.from_greenwich,y:i.y,z:i.z||0}),"longlat"===s.projName?i={x:i.x*ht,y:i.y*ht,z:i.z||0}:(i=s.forward(i),s.to_meter&&(i={x:i.x/s.to_meter,y:i.y/s.to_meter,z:i.z||0})),"enu"!==s.axis?Nt(s,!0,i):i}function A(t,s,i){var a,h,e;return Array.isArray(i)?(a=w(t,s,i)||{x:NaN,y:NaN},i.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==s.name&&"geocent"===s.name?"number"==typeof a.z?[a.x,a.y,a.z].concat(i.splice(3)):[a.x,a.y,i[2]].concat(i.splice(3)):[a.x,a.y].concat(i.splice(2)):[a.x,a.y]):(h=w(t,s,i),2===(e=Object.keys(i)).length?h:(e.forEach(function(a){if(void 0!==t.name&&"geocent"===t.name||void 0!==s.name&&"geocent"===s.name){if("x"===a||"y"===a||"z"===a)return}else if("x"===a||"y"===a)return;h[a]=i[a]}),h))}function P(t){return t instanceof Projection?t:t.oProj?t.oProj:Projection(t)}function k(t,s,i){t=P(t);var a,h=!1;return void 0===s?(s=t,t=Ct,h=!0):(void 0!==s.x||Array.isArray(s))&&(i=s,s=t,t=Ct,h=!0),s=P(s),i?A(t,s,i):(a={forward:function(i){return A(t,s,i)},inverse:function(i){return A(s,t,i)}},h&&(a.oProj=s),a)}function q(t,s){return s=s||5,G(C({lat:t[1],lon:t[0]}),s)}function N(t){var s=I(L(t.toUpperCase()));return s.lat&&s.lon?[s.lon,s.lat]:[(s.left+s.right)/2,(s.top+s.bottom)/2]}function E(t){return t*(Math.PI/180)}function S(t){return t/Math.PI*180}function C(t){var s,i,a,h,e,n,r,o=t.lat,l=t.lon,M=6378137,c=E(o),u=E(l);r=Math.floor((l+180)/6)+1,180===l&&(r=60),o>=56&&o<64&&l>=3&&l<12&&(r=32),o>=72&&o<84&&(l>=0&&l<9?r=31:l>=9&&l<21?r=33:l>=21&&l<33?r=35:l>=33&&l<42&&(r=37)),n=E(6*(r-1)-180+3),s=M/Math.sqrt(1-.00669438*Math.sin(c)*Math.sin(c)),i=Math.tan(c)*Math.tan(c),a=.006739496752268451*Math.cos(c)*Math.cos(c);var f=.9996*s*((h=Math.cos(c)*(u-n))+(1-i+a)*h*h*h/6+(5-18*i+i*i+72*a-.39089081163157013)*h*h*h*h*h/120)+5e5,m=.9996*((e=M*(.9983242984503243*c-.002514607064228144*Math.sin(2*c)+2639046602129982e-21*Math.sin(4*c)-3.418046101696858e-9*Math.sin(6*c)))+s*Math.tan(c)*(h*h/2+(5-i+9*a+4*a*a)*h*h*h*h/24+(61-58*i+i*i+600*a-2.2240339282485886)*h*h*h*h*h*h/720));return o<0&&(m+=1e7),{northing:Math.round(m),easting:Math.round(f),zoneNumber:r,zoneLetter:R(o)}}function I(t){var s=t.northing,i=t.easting,a=t.zoneLetter,h=t.zoneNumber;if(h<0||h>60)return null;var e,n,r,o,l,M,c,u,f=6378137,m=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),p=i-5e5,y=s;a<"N"&&(y-=1e7),M=6*(h-1)-180+3,u=(c=y/.9996/6367449.145945056)+(3*m/2-27*m*m*m/32)*Math.sin(2*c)+(21*m*m/16-55*m*m*m*m/32)*Math.sin(4*c)+151*m*m*m/96*Math.sin(6*c),e=f/Math.sqrt(1-.00669438*Math.sin(u)*Math.sin(u)),n=Math.tan(u)*Math.tan(u),r=.006739496752268451*Math.cos(u)*Math.cos(u),o=.99330562*f/Math.pow(1-.00669438*Math.sin(u)*Math.sin(u),1.5),l=p/(.9996*e);var d=u-e*Math.tan(u)/o*(l*l/2-(5+3*n+10*r-4*r*r-.06065547077041606)*l*l*l*l/24+(61+90*n+298*r+45*n*n-1.6983531815716497-3*r*r)*l*l*l*l*l*l/720);d=S(d);var _=(l-(1+2*n+r)*l*l*l/6+(5-2*r+28*n-3*r*r+.05391597401814761+24*n*n)*l*l*l*l*l/120)/Math.cos(u);_=M+S(_);var x;if(t.accuracy){var v=I({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});x={top:v.lat,right:v.lon,bottom:d,left:_}}else x={lat:d,lon:_};return x}function R(t){var s="Z";return 84>=t&&t>=72?s="X":72>t&&t>=64?s="W":64>t&&t>=56?s="V":56>t&&t>=48?s="U":48>t&&t>=40?s="T":40>t&&t>=32?s="S":32>t&&t>=24?s="R":24>t&&t>=16?s="Q":16>t&&t>=8?s="P":8>t&&t>=0?s="N":0>t&&t>=-8?s="M":-8>t&&t>=-16?s="L":-16>t&&t>=-24?s="K":-24>t&&t>=-32?s="J":-32>t&&t>=-40?s="H":-40>t&&t>=-48?s="G":-48>t&&t>=-56?s="F":-56>t&&t>=-64?s="E":-64>t&&t>=-72?s="D":-72>t&&t>=-80&&(s="C"),s}function G(t,s){var i="00000"+t.easting,a="00000"+t.northing;return t.zoneNumber+t.zoneLetter+j(t.easting,t.northing,t.zoneNumber)+i.substr(i.length-5,s)+a.substr(a.length-5,s)}function j(t,s,i){var a=O(i);return z(Math.floor(t/1e5),Math.floor(s/1e5)%20,a)}function O(t){var s=t%It;return 0===s&&(s=It),s}function z(t,s,i){var a=i-1,h=Rt.charCodeAt(a),e=Gt.charCodeAt(a),n=h+t-1,r=e+s,o=!1;return n>Bt&&(n=n-Bt+jt-1,o=!0),(n===Ot||h<Ot&&n>Ot||(n>Ot||h<Ot)&&o)&&n++,(n===zt||h<zt&&n>zt||(n>zt||h<zt)&&o)&&++n===Ot&&n++,n>Bt&&(n=n-Bt+jt-1),r>Lt?(r=r-Lt+jt-1,o=!0):o=!1,(r===Ot||e<Ot&&r>Ot||(r>Ot||e<Ot)&&o)&&r++,(r===zt||e<zt&&r>zt||(r>zt||e<zt)&&o)&&++r===Ot&&r++,r>Lt&&(r=r-Lt+jt-1),String.fromCharCode(n)+String.fromCharCode(r)}function L(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var s,i=t.length,a=null,h="",e=0;!/[A-Z]/.test(s=t.charAt(e));){if(e>=2)throw"MGRSPoint bad conversion from: "+t;h+=s,e++}var n=parseInt(h,10);if(0===e||e+3>i)throw"MGRSPoint bad conversion from: "+t;var r=t.charAt(e++);if(r<="A"||"B"===r||"Y"===r||r>="Z"||"I"===r||"O"===r)throw"MGRSPoint zone letter "+r+" not handled: "+t;a=t.substring(e,e+=2);for(var o=O(n),l=B(a.charAt(0),o),M=T(a.charAt(1),o);M<F(r);)M+=2e6;var c=i-e;if(c%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var u,f,m,p,y,d=c/2,_=0,x=0;return d>0&&(u=1e5/Math.pow(10,d),f=t.substring(e,e+d),_=parseFloat(f)*u,m=t.substring(e+d),x=parseFloat(m)*u),p=_+l,y=x+M,{easting:p,northing:y,zoneLetter:r,zoneNumber:n,accuracy:u}}function B(t,s){for(var i=Rt.charCodeAt(s-1),a=1e5,h=!1;i!==t.charCodeAt(0);){if(++i===Ot&&i++,i===zt&&i++,i>Bt){if(h)throw"Bad character: "+t;i=jt,h=!0}a+=1e5}return a}function T(t,s){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var i=Gt.charCodeAt(s-1),a=0,h=!1;i!==t.charCodeAt(0);){if(++i===Ot&&i++,i===zt&&i++,i>Lt){if(h)throw"Bad character: "+t;i=jt,h=!0}a+=1e5}return a}function F(t){var s;switch(t){case"C":s=11e5;break;case"D":s=2e6;break;case"E":s=28e5;break;case"F":s=37e5;break;case"G":s=46e5;break;case"H":s=55e5;break;case"J":s=64e5;break;case"K":s=73e5;break;case"L":s=82e5;break;case"M":s=91e5;break;case"N":s=0;break;case"P":s=8e5;break;case"Q":s=17e5;break;case"R":s=26e5;break;case"S":s=35e5;break;case"T":s=44e5;break;case"U":s=53e5;break;case"V":s=62e5;break;case"W":s=7e6;break;case"X":s=79e5;break;default:s=-1}if(s>=0)return s;throw"Invalid zone letter: "+t}function Point(t,s,i){if(!(this instanceof Point))return new Point(t,s,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===s){var a=t.split(",");this.x=parseFloat(a[0],10),this.y=parseFloat(a[1],10),this.z=parseFloat(a[2],10)||0}else this.x=t,this.y=s,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}function Q(t){var s,i=[];return i[0]=t*bs,s=t*t,i[0]+=s*ws,i[1]=s*Ps,s*=t,i[0]+=s*As,i[1]+=s*ks,i[2]=s*qs,i}function D(t,s){var i=t+t;return t+s[0]*Math.sin(i)+s[1]*Math.sin(i+i)+s[2]*Math.sin(i+i+i)}function W(t,s,i,a){var h;return t<it?(a.value=Xs.AREA_0,h=0):(h=Math.atan2(s,i),Math.abs(h)<=et?a.value=Xs.AREA_0:h>et&&h<=Y+et?(a.value=Xs.AREA_1,h-=Y):h>Y+et||h<=-(Y+et)?(a.value=Xs.AREA_2,h=h>=0?h-rt:h+rt):(a.value=Xs.AREA_3,h+=Y)),h}function U(t,s){var i=t+s;return i<-rt?i+=nt:i>+rt&&(i-=nt),i}function K(t,s,i,a){for(var h=s;a;--a){var e=t(h);if(h-=e,Math.abs(e)<i)break}return h}t=t&&t.hasOwnProperty("default")?t.default:t;var X=1,H=2,J=4,Z=5,V=484813681109536e-20,Y=Math.PI/2,$=.16666666666666666,tt=.04722222222222222,st=.022156084656084655,it=1e-10,at=.017453292519943295,ht=57.29577951308232,et=Math.PI/4,nt=2*Math.PI,rt=3.14159265359,ot={};ot.greenwich=0,ot.lisbon=-9.131906111111,ot.paris=2.337229166667,ot.bogota=-74.080916666667,ot.madrid=-3.687938888889,ot.rome=12.452333333333,ot.bern=7.439583333333,ot.jakarta=106.807719444444,ot.ferro=-17.666666666667,ot.brussels=4.367975,ot.stockholm=18.058277777778,ot.athens=23.7163375,ot.oslo=10.722916666667;var lt={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Mt=/[\s_\-\/\(\)]/g,ct=function(t){var i,a,h,e={},n=t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,s){var i=s.split("=");return i.push(!0),t[i[0].toLowerCase()]=i[1],t},{}),r={proj:"projName",datum:"datumCode",rf:function(t){e.rf=parseFloat(t)},lat_0:function(t){e.lat0=t*at},lat_1:function(t){e.lat1=t*at},lat_2:function(t){e.lat2=t*at},lat_ts:function(t){e.lat_ts=t*at},lon_0:function(t){e.long0=t*at},lon_1:function(t){e.long1=t*at},lon_2:function(t){e.long2=t*at},alpha:function(t){e.alpha=parseFloat(t)*at},lonc:function(t){e.longc=t*at},x_0:function(t){e.x0=parseFloat(t)},y_0:function(t){e.y0=parseFloat(t)},k_0:function(t){e.k0=parseFloat(t)},k:function(t){e.k0=parseFloat(t)},a:function(t){e.a=parseFloat(t)},b:function(t){e.b=parseFloat(t)},r_a:function(){e.R_A=!0},zone:function(t){e.zone=parseInt(t,10)},south:function(){e.utmSouth=!0},towgs84:function(t){e.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){e.to_meter=parseFloat(t)},units:function(t){e.units=t;var i=s(lt,t);i&&(e.to_meter=i.to_meter)},from_greenwich:function(t){e.from_greenwich=t*at},pm:function(t){var i=s(ot,t);e.from_greenwich=(i||parseFloat(t))*at},nadgrids:function(t){"@null"===t?e.datumCode="none":e.nadgrids=t},axis:function(t){3===t.length&&-1!=="ewnsud".indexOf(t.substr(0,1))&&-1!=="ewnsud".indexOf(t.substr(1,1))&&-1!=="ewnsud".indexOf(t.substr(2,1))&&(e.axis=t)}};for(i in n)a=n[i],i in r?"function"==typeof(h=r[i])?h(a):e[h]=a:e[i]=a;return"string"==typeof e.datumCode&&"WGS84"!==e.datumCode&&(e.datumCode=e.datumCode.toLowerCase()),e};!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(i);var ut=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],ft=["3857","900913","3785","102113"],mt=function(t,s){t=t||{};var i,a;if(!s)return t;for(a in s)void 0!==(i=s[a])&&(t[a]=i);return t},pt=function(t,s,i){var a=t*s;return i/Math.sqrt(1-a*a)},yt=function(t){return t<0?-1:1},dt=function(t){return Math.abs(t)<=rt?t:t-yt(t)*nt},_t=function(t,s,i){var a=t*i,h=.5*t;return a=Math.pow((1-a)/(1+a),h),Math.tan(.5*(Y-s))/a},xt=function(t,s){for(var i,a,h=.5*t,e=Y-2*Math.atan(s),n=0;n<=15;n++)if(i=t*Math.sin(e),a=Y-2*Math.atan(s*Math.pow((1-i)/(1+i),h))-e,e+=a,Math.abs(a)<=1e-10)return e;return-9999},vt=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=pt(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var s=t.x,i=t.y;if(i*ht>90&&i*ht<-90&&s*ht>180&&s*ht<-180)return null;var a,h;if(Math.abs(Math.abs(i)-Y)<=it)return null;if(this.sphere)a=this.x0+this.a*this.k0*dt(s-this.long0),h=this.y0+this.a*this.k0*Math.log(Math.tan(et+.5*i));else{var e=Math.sin(i),n=_t(this.e,i,e);a=this.x0+this.a*this.k0*dt(s-this.long0),h=this.y0-this.a*this.k0*Math.log(n)}return t.x=a,t.y=h,t},inverse:function(t){var s,i,a=t.x-this.x0,h=t.y-this.y0;if(this.sphere)i=Y-2*Math.atan(Math.exp(-h/(this.a*this.k0)));else{var e=Math.exp(-h/(this.a*this.k0));if(-9999===(i=xt(this.e,e)))return null}return s=dt(this.long0+a/(this.a*this.k0)),t.x=s,t.y=i,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:M,inverse:M,names:["longlat","identity"]}],gt={},bt=[],wt={start:function(){vt.forEach(c)},add:c,get:function(t){if(!t)return!1;var s=t.toLowerCase();return void 0!==gt[s]&&bt[gt[s]]?bt[gt[s]]:void 0}},At={};At.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},At.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},At.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},At.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},At.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},At.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},At.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},At.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},At.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},At.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},At.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},At.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},At.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},At.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},At.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},At.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},At.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},At.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},At.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},At.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},At.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},At.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},At.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},At.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},At.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},At.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},At.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},At.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},At.hough={a:6378270,rf:297,ellipseName:"Hough"},At.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},At.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},At.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},At.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},At.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},At.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},At.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},At.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},At.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},At.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},At.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},At.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var Pt=At.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};At.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var kt={};kt.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},kt.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},kt.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},kt.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},kt.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},kt.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},kt.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},kt.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},kt.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},kt.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},kt.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},kt.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},kt.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},kt.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},kt.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},kt.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},kt.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},Projection.projections=wt,Projection.projections.start();var qt=function(t,s,i){return p(t,s)?i:t.datum_type===Z||s.datum_type===Z?i:t.es!==s.es||t.a!==s.a||v(t.datum_type)||v(s.datum_type)?(i=y(i,t.es,t.a),v(t.datum_type)&&(i=_(i,t.datum_type,t.datum_params)),v(s.datum_type)&&(i=x(i,s.datum_type,s.datum_params)),d(i,s.es,s.a,s.b)):i},Nt=function(t,s,i){var a,h,e,n=i.x,r=i.y,o=i.z||0,l={};for(e=0;e<3;e++)if(!s||2!==e||void 0!==i.z)switch(0===e?(a=n,h=-1!=="ew".indexOf(t.axis[e])?"x":"y"):1===e?(a=r,h=-1!=="ns".indexOf(t.axis[e])?"y":"x"):(a=o,h="z"),t.axis[e]){case"e":case"w":case"n":case"s":l[h]=a;break;case"u":void 0!==i[h]&&(l.z=a);break;case"d":void 0!==i[h]&&(l.z=-a);break;default:return null}return l},Et=function(t){var s={x:t[0],y:t[1]};return t.length>2&&(s.z=t[2]),t.length>3&&(s.m=t[3]),s},St=function(t){g(t.x),g(t.y)},Ct=Projection("WGS84"),It=6,Rt="AJSAJS",Gt="AFAFAF",jt=65,Ot=73,zt=79,Lt=86,Bt=90,Tt={forward:q,inverse:function(t){var s=I(L(t.toUpperCase()));return s.lat&&s.lon?[s.lon,s.lat,s.lon,s.lat]:[s.left,s.bottom,s.right,s.top]},toPoint:N};Point.fromMGRS=function(t){return new Point(N(t))},Point.prototype.toMGRS=function(t){return q([this.x,this.y],t)};var Ft=.01068115234375,Qt=function(t){var s=[];s[0]=1-t*(.25+t*(.046875+t*(.01953125+t*Ft))),s[1]=t*(.75-t*(.046875+t*(.01953125+t*Ft)));var i=t*t;return s[2]=i*(.46875-t*(.013020833333333334+.007120768229166667*t)),i*=t,s[3]=i*(.3645833333333333-.005696614583333333*t),s[4]=i*t*.3076171875,s},Dt=function(t,s,i,a){return i*=s,s*=s,a[0]*t-i*(a[1]+s*(a[2]+s*(a[3]+s*a[4])))},Wt=function(t,s,i){for(var a=1/(1-s),h=t,e=20;e;--e){var n=Math.sin(h),r=1-s*n*n;if(r=(Dt(h,n,Math.cos(h),i)-t)*(r*Math.sqrt(r))*a,h-=r,Math.abs(r)<it)return h}return h},Ut={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Qt(this.es),this.ml0=Dt(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var s,i,a,h=t.x,e=t.y,n=dt(h-this.long0),r=Math.sin(e),o=Math.cos(e);if(this.es){var l=o*n,M=Math.pow(l,2),c=this.ep2*Math.pow(o,2),u=Math.pow(c,2),f=Math.abs(o)>it?Math.tan(e):0,m=Math.pow(f,2),p=Math.pow(m,2);s=1-this.es*Math.pow(r,2),l/=Math.sqrt(s);var y=Dt(e,r,o,this.en);i=this.a*(this.k0*l*(1+M/6*(1-m+c+M/20*(5-18*m+p+14*c-58*m*c+M/42*(61+179*p-p*m-479*m)))))+this.x0,a=this.a*(this.k0*(y-this.ml0+r*n*l/2*(1+M/12*(5-m+9*c+4*u+M/30*(61+p-58*m+270*c-330*m*c+M/56*(1385+543*p-p*m-3111*m))))))+this.y0}else{var d=o*Math.sin(n);if(Math.abs(Math.abs(d)-1)<it)return 93;if(i=.5*this.a*this.k0*Math.log((1+d)/(1-d))+this.x0,a=o*Math.cos(n)/Math.sqrt(1-Math.pow(d,2)),(d=Math.abs(a))>=1){if(d-1>it)return 93;a=0}else a=Math.acos(a);e<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return t.x=i,t.y=a,t},inverse:function(t){var s,i,a,h,e=(t.x-this.x0)*(1/this.a),n=(t.y-this.y0)*(1/this.a);if(this.es)if(s=this.ml0+n/this.k0,i=Wt(s,this.es,this.en),Math.abs(i)<Y){var r=Math.sin(i),o=Math.cos(i),l=Math.abs(o)>it?Math.tan(i):0,M=this.ep2*Math.pow(o,2),c=Math.pow(M,2),u=Math.pow(l,2),f=Math.pow(u,2);s=1-this.es*Math.pow(r,2);var m=e*Math.sqrt(s)/this.k0,p=Math.pow(m,2);a=i-(s*=l)*p/(1-this.es)*.5*(1-p/12*(5+3*u-9*M*u+M-4*c-p/30*(61+90*u-252*M*u+45*f+46*M-p/56*(1385+3633*u+4095*f+1574*f*u)))),h=dt(this.long0+m*(1-p/6*(1+2*u+M-p/20*(5+28*u+24*f+8*M*u+6*M-p/42*(61+662*u+1320*f+720*f*u))))/o)}else a=Y*yt(n),h=0;else{var y=Math.exp(e/this.k0),d=.5*(y-1/y),_=this.lat0+n/this.k0,x=Math.cos(_);s=Math.sqrt((1-Math.pow(x,2))/(1+Math.pow(d,2))),a=Math.asin(s),n<0&&(a=-a),h=0===d&&0===x?0:dt(Math.atan2(d,x)+this.long0)}return t.x=h,t.y=a,t},names:["Transverse_Mercator","Transverse Mercator","tmerc"]},Kt=function(t){var s=Math.exp(t);return s=(s-1/s)/2},Xt=function(t,s){t=Math.abs(t),s=Math.abs(s);var i=Math.max(t,s),a=Math.min(t,s)/(i||1);return i*Math.sqrt(1+Math.pow(a,2))},Ht=function(t){var s=1+t,i=s-1;return 0===i?t:t*Math.log(s)/i},Jt=function(t){var s=Math.abs(t);return s=Ht(s*(1+s/(Xt(1,s)+1))),t<0?-s:s},Zt=function(t,s){for(var i,a=2*Math.cos(2*s),h=t.length-1,e=t[h],n=0;--h>=0;)i=a*e-n+t[h],n=e,e=i;return s+i*Math.sin(2*s)},Vt=function(t,s){for(var i,a=2*Math.cos(s),h=t.length-1,e=t[h],n=0;--h>=0;)i=a*e-n+t[h],n=e,e=i;return Math.sin(s)*i},Yt=function(t){var s=Math.exp(t);return s=(s+1/s)/2},$t=function(t,s,i){for(var a,h,e=Math.sin(s),n=Math.cos(s),r=Kt(i),o=Yt(i),l=2*n*o,M=-2*e*r,c=t.length-1,u=t[c],f=0,m=0,p=0;--c>=0;)a=m,h=f,u=l*(m=u)-a-M*(f=p)+t[c],p=M*m-h+l*f;return l=e*o,M=n*r,[l*u-M*p,l*p+M*u]},ts={init:function(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),s=t/(2-t),i=s;this.cgb[0]=s*(2+s*(-2/3+s*(s*(116/45+s*(26/45+s*(-2854/675)))-2))),this.cbg[0]=s*(s*(2/3+s*(4/3+s*(-82/45+s*(32/45+s*(4642/4725)))))-2),i*=s,this.cgb[1]=i*(7/3+s*(s*(-227/45+s*(2704/315+s*(2323/945)))-1.6)),this.cbg[1]=i*(5/3+s*(-16/15+s*(-13/9+s*(904/315+s*(-1522/945))))),i*=s,this.cgb[2]=i*(56/15+s*(-136/35+s*(-1262/105+s*(73814/2835)))),this.cbg[2]=i*(-26/15+s*(34/21+s*(1.6+s*(-12686/2835)))),i*=s,this.cgb[3]=i*(4279/630+s*(-332/35+s*(-399572/14175))),this.cbg[3]=i*(1237/630+s*(s*(-24832/14175)-2.4)),i*=s,this.cgb[4]=i*(4174/315+s*(-144838/6237)),this.cbg[4]=i*(-734/315+s*(109598/31185)),i*=s,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(s,2),this.Qn=this.k0/(1+s)*(1+i*(.25+i*(1/64+i/256))),this.utg[0]=s*(s*(2/3+s*(-37/96+s*(1/360+s*(81/512+s*(-96199/604800)))))-.5),this.gtu[0]=s*(.5+s*(-2/3+s*(5/16+s*(41/180+s*(-127/288+s*(7891/37800)))))),this.utg[1]=i*(-1/48+s*(-1/15+s*(437/1440+s*(-46/105+s*(1118711/3870720))))),this.gtu[1]=i*(13/48+s*(s*(557/1440+s*(281/630+s*(-1983433/1935360)))-.6)),i*=s,this.utg[2]=i*(-17/480+s*(37/840+s*(209/4480+s*(-5569/90720)))),this.gtu[2]=i*(61/240+s*(-103/140+s*(15061/26880+s*(167603/181440)))),i*=s,this.utg[3]=i*(-4397/161280+s*(11/504+s*(830251/7257600))),this.gtu[3]=i*(49561/161280+s*(-179/168+s*(6601661/7257600))),i*=s,this.utg[4]=i*(-4583/161280+s*(108847/3991680)),this.gtu[4]=i*(34729/80640+s*(-3418889/1995840)),i*=s,this.utg[5]=-.03233083094085698*i,this.gtu[5]=.6650675310896665*i;var a=Zt(this.cbg,this.lat0);this.Zb=-this.Qn*(a+Vt(this.gtu,2*a))},forward:function(t){var s=dt(t.x-this.long0),i=t.y;i=Zt(this.cbg,i);var a=Math.sin(i),h=Math.cos(i),e=Math.sin(s),n=Math.cos(s);i=Math.atan2(a,n*h),s=Math.atan2(e*h,Xt(a,h*n)),s=Jt(Math.tan(s));var r=$t(this.gtu,2*i,2*s);i+=r[0],s+=r[1];var o,l;return Math.abs(s)<=2.623395162778?(o=this.a*(this.Qn*s)+this.x0,l=this.a*(this.Qn*i+this.Zb)+this.y0):(o=1/0,l=1/0),t.x=o,t.y=l,t},inverse:function(t){var s=(t.x-this.x0)*(1/this.a),i=(t.y-this.y0)*(1/this.a);i=(i-this.Zb)/this.Qn,s/=this.Qn;var a,h;if(Math.abs(s)<=2.623395162778){var e=$t(this.utg,2*i,2*s);i+=e[0],s+=e[1],s=Math.atan(Kt(s));var n=Math.sin(i),r=Math.cos(i),o=Math.sin(s),l=Math.cos(s);i=Math.atan2(n*l,Xt(o,l*r)),s=Math.atan2(o,l*r),a=dt(s+this.long0),h=Zt(this.cgb,i)}else a=1/0,h=1/0;return t.x=a,t.y=h,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]},ss=function(t,s){if(void 0===t){if((t=Math.floor(30*(dt(s)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t},is={init:function(){var t=ss(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*at,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,ts.init.apply(this),this.forward=ts.forward,this.inverse=ts.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},as=function(t,s){return Math.pow((1-t)/(1+t),s)},hs=20,es={init:function(){var t=Math.sin(this.lat0),s=Math.cos(this.lat0);s*=s,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*s*s/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+et)/(Math.pow(Math.tan(.5*this.lat0+et),this.C)*as(this.e*t,this.ratexp))},forward:function(t){var s=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+et),this.C)*as(this.e*Math.sin(i),this.ratexp))-Y,t.x=this.C*s,t},inverse:function(t){for(var s=t.x/this.C,i=t.y,a=Math.pow(Math.tan(.5*i+et)/this.K,1/this.C),h=hs;h>0&&(i=2*Math.atan(a*as(this.e*Math.sin(t.y),-.5*this.e))-Y,!(Math.abs(i-t.y)<1e-14));--h)t.y=i;return h?(t.x=s,t.y=i,t):null},names:["gauss"]},ns={init:function(){es.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var s,i,a,h;return t.x=dt(t.x-this.long0),es.forward.apply(this,[t]),s=Math.sin(t.y),i=Math.cos(t.y),a=Math.cos(t.x),h=this.k0*this.R2/(1+this.sinc0*s+this.cosc0*i*a),t.x=h*i*Math.sin(t.x),t.y=h*(this.cosc0*s-this.sinc0*i*a),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var s,i,a,h,e;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,e=Math.sqrt(t.x*t.x+t.y*t.y)){var n=2*Math.atan2(e,this.R2);s=Math.sin(n),i=Math.cos(n),h=Math.asin(i*this.sinc0+t.y*s*this.cosc0/e),a=Math.atan2(t.x*s,e*this.cosc0*i-t.y*this.sinc0*s)}else h=this.phic0,a=0;return t.x=a,t.y=h,es.inverse.apply(this,[t]),t.x=dt(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},rs={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=it&&(this.k0=.5*(1+yt(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=it&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=it&&(this.k0=.5*this.cons*pt(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/_t(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=pt(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Y,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var s,i,a,h,e,n,r=t.x,o=t.y,l=Math.sin(o),M=Math.cos(o),c=dt(r-this.long0);return Math.abs(Math.abs(r-this.long0)-Math.PI)<=it&&Math.abs(o+this.lat0)<=it?(t.x=NaN,t.y=NaN,t):this.sphere?(s=2*this.k0/(1+this.sinlat0*l+this.coslat0*M*Math.cos(c)),t.x=this.a*s*M*Math.sin(c)+this.x0,t.y=this.a*s*(this.coslat0*l-this.sinlat0*M*Math.cos(c))+this.y0,t):(i=2*Math.atan(this.ssfn_(o,l,this.e))-Y,h=Math.cos(i),a=Math.sin(i),Math.abs(this.coslat0)<=it?(e=_t(this.e,o*this.con,this.con*l),n=2*this.a*this.k0*e/this.cons,t.x=this.x0+n*Math.sin(r-this.long0),t.y=this.y0-this.con*n*Math.cos(r-this.long0),t):(Math.abs(this.sinlat0)<it?(s=2*this.a*this.k0/(1+h*Math.cos(c)),t.y=s*a):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*a+this.cosX0*h*Math.cos(c))),t.y=s*(this.cosX0*a-this.sinX0*h*Math.cos(c))+this.y0),t.x=s*h*Math.sin(c)+this.x0,t))},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var s,i,a,h,e,n=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var r=2*Math.atan(n/(2*this.a*this.k0));return s=this.long0,i=this.lat0,n<=it?(t.x=s,t.y=i,t):(i=Math.asin(Math.cos(r)*this.sinlat0+t.y*Math.sin(r)*this.coslat0/n),s=dt(Math.abs(this.coslat0)<it?this.lat0>0?this.long0+Math.atan2(t.x,-1*t.y):this.long0+Math.atan2(t.x,t.y):this.long0+Math.atan2(t.x*Math.sin(r),n*this.coslat0*Math.cos(r)-t.y*this.sinlat0*Math.sin(r))),t.x=s,t.y=i,t)}if(Math.abs(this.coslat0)<=it){if(n<=it)return i=this.lat0,s=this.long0,t.x=s,t.y=i,t;t.x*=this.con,t.y*=this.con,a=n*this.cons/(2*this.a*this.k0),i=this.con*xt(this.e,a),s=this.con*dt(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else h=2*Math.atan(n*this.cosX0/(2*this.a*this.k0*this.ms1)),s=this.long0,n<=it?e=this.X0:(e=Math.asin(Math.cos(h)*this.sinX0+t.y*Math.sin(h)*this.cosX0/n),s=dt(this.long0+Math.atan2(t.x*Math.sin(h),n*this.cosX0*Math.cos(h)-t.y*this.sinX0*Math.sin(h)))),i=-1*xt(this.e,Math.tan(.5*(Y+e)));return t.x=s,t.y=i,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,s,i){return s*=i,Math.tan(.5*(Y+t))*Math.pow((1-s)/(1+s),.5*i)}},os={init:function(){var t=this.lat0;this.lambda0=this.long0;var s=Math.sin(t),i=this.a,a=1/this.rf,h=2*a-Math.pow(a,2),e=this.e=Math.sqrt(h);this.R=this.k0*i*Math.sqrt(1-h)/(1-h*Math.pow(s,2)),this.alpha=Math.sqrt(1+h/(1-h)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(s/this.alpha);var n=Math.log(Math.tan(Math.PI/4+this.b0/2)),r=Math.log(Math.tan(Math.PI/4+t/2)),o=Math.log((1+e*s)/(1-e*s));this.K=n-this.alpha*r+this.alpha*e/2*o},forward:function(t){var s=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),a=-this.alpha*(s+i)+this.K,h=2*(Math.atan(Math.exp(a))-Math.PI/4),e=this.alpha*(t.x-this.lambda0),n=Math.atan(Math.sin(e)/(Math.sin(this.b0)*Math.tan(h)+Math.cos(this.b0)*Math.cos(e))),r=Math.asin(Math.cos(this.b0)*Math.sin(h)-Math.sin(this.b0)*Math.cos(h)*Math.cos(e));return t.y=this.R/2*Math.log((1+Math.sin(r))/(1-Math.sin(r)))+this.y0,t.x=this.R*n+this.x0,t},inverse:function(t){for(var s=t.x-this.x0,i=t.y-this.y0,a=s/this.R,h=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),e=Math.asin(Math.cos(this.b0)*Math.sin(h)+Math.sin(this.b0)*Math.cos(h)*Math.cos(a)),n=Math.atan(Math.sin(a)/(Math.cos(this.b0)*Math.cos(a)-Math.sin(this.b0)*Math.tan(h))),r=this.lambda0+n/this.alpha,o=0,l=e,M=-1e3,c=0;Math.abs(l-M)>1e-7;){if(++c>20)return;o=1/this.alpha*(Math.log(Math.tan(Math.PI/4+e/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),M=l,l=2*Math.atan(Math.exp(o))-Math.PI/2}return t.x=r,t.y=l,t},names:["somerc"]},ls={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),s=Math.cos(this.lat0),i=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(s,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-i*i);var a=_t(this.e,this.lat0,t),h=this.bl/s*Math.sqrt((1-this.es)/(1-i*i));h*h<1&&(h=1);var e,n;if(isNaN(this.longc)){var r=_t(this.e,this.lat1,Math.sin(this.lat1)),o=_t(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(h+Math.sqrt(h*h-1))*Math.pow(a,this.bl):this.el=(h-Math.sqrt(h*h-1))*Math.pow(a,this.bl);var l=Math.pow(r,this.bl),M=Math.pow(o,this.bl);n=.5*((e=this.el/l)-1/e);var c=(this.el*this.el-M*l)/(this.el*this.el+M*l),u=(M-l)/(M+l),f=dt(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(c*Math.tan(.5*this.bl*f)/u)/this.bl,this.long0=dt(this.long0);var m=dt(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*m)/n),this.alpha=Math.asin(h*Math.sin(this.gamma0))}else e=this.lat0>=0?h+Math.sqrt(h*h-1):h-Math.sqrt(h*h-1),this.el=e*Math.pow(a,this.bl),n=.5*(e-1/e),this.gamma0=Math.asin(Math.sin(this.alpha)/h),this.long0=this.longc-Math.asin(n*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(h*h-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(h*h-1),Math.cos(this.alpha))},forward:function(t){var s,i,a,h=t.x,e=t.y,n=dt(h-this.long0);if(Math.abs(Math.abs(e)-Y)<=it)a=e>0?-1:1,i=this.al/this.bl*Math.log(Math.tan(et+a*this.gamma0*.5)),s=-1*a*Y*this.al/this.bl;else{var r=_t(this.e,e,Math.sin(e)),o=this.el/Math.pow(r,this.bl),l=.5*(o-1/o),M=.5*(o+1/o),c=Math.sin(this.bl*n),u=(l*Math.sin(this.gamma0)-c*Math.cos(this.gamma0))/M;i=Math.abs(Math.abs(u)-1)<=it?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-u)/(1+u))/this.bl,s=Math.abs(Math.cos(this.bl*n))<=it?this.al*this.bl*n:this.al*Math.atan2(l*Math.cos(this.gamma0)+c*Math.sin(this.gamma0),Math.cos(this.bl*n))/this.bl}return this.no_rot?(t.x=this.x0+s,t.y=this.y0+i):(s-=this.uc,t.x=this.x0+i*Math.cos(this.alpha)+s*Math.sin(this.alpha),t.y=this.y0+s*Math.cos(this.alpha)-i*Math.sin(this.alpha)),t},inverse:function(t){var s,i;this.no_rot?(i=t.y-this.y0,s=t.x-this.x0):(i=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),s=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),s+=this.uc);var a=Math.exp(-1*this.bl*i/this.al),h=.5*(a-1/a),e=.5*(a+1/a),n=Math.sin(this.bl*s/this.al),r=(n*Math.cos(this.gamma0)+h*Math.sin(this.gamma0))/e,o=Math.pow(this.el/Math.sqrt((1+r)/(1-r)),1/this.bl);return Math.abs(r-1)<it?(t.x=this.long0,t.y=Y):Math.abs(r+1)<it?(t.x=this.long0,t.y=-1*Y):(t.y=xt(this.e,o),t.x=dt(this.long0-Math.atan2(h*Math.cos(this.gamma0)-n*Math.sin(this.gamma0),Math.cos(this.bl*s/this.al))/this.bl)),t},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},Ms={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<it)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var s=Math.sin(this.lat1),i=Math.cos(this.lat1),a=pt(this.e,s,i),h=_t(this.e,this.lat1,s),e=Math.sin(this.lat2),n=Math.cos(this.lat2),r=pt(this.e,e,n),o=_t(this.e,this.lat2,e),l=_t(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>it?this.ns=Math.log(a/r)/Math.log(h/o):this.ns=s,isNaN(this.ns)&&(this.ns=s),this.f0=a/(this.ns*Math.pow(h,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var s=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=it&&(i=yt(i)*(Y-2*it));var a,h,e=Math.abs(Math.abs(i)-Y);if(e>it)a=_t(this.e,i,Math.sin(i)),h=this.a*this.f0*Math.pow(a,this.ns);else{if((e=i*this.ns)<=0)return null;h=0}var n=this.ns*dt(s-this.long0);return t.x=this.k0*(h*Math.sin(n))+this.x0,t.y=this.k0*(this.rh-h*Math.cos(n))+this.y0,t},inverse:function(t){var s,i,a,h,e,n=(t.x-this.x0)/this.k0,r=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(s=Math.sqrt(n*n+r*r),i=1):(s=-Math.sqrt(n*n+r*r),i=-1);var o=0;if(0!==s&&(o=Math.atan2(i*n,i*r)),0!==s||this.ns>0){if(i=1/this.ns,a=Math.pow(s/(this.a*this.f0),i),-9999===(h=xt(this.e,a)))return null}else h=-Y;return e=dt(o/this.ns+this.long0),t.x=e,t.y=h,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},cs={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var s,i,a,h,e,n,r,o=t.x,l=t.y,M=dt(o-this.long0);return s=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/s)-this.s45),a=-M*this.alfa,h=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(a)),e=Math.asin(Math.cos(i)*Math.sin(a)/Math.cos(h)),n=this.n*e,r=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(h/2+this.s45),this.n),t.y=r*Math.cos(n)/1,t.x=r*Math.sin(n)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var s,i,a,h,e,n,r,o=t.x;t.x=t.y,t.y=o,this.czech||(t.y*=-1,t.x*=-1),e=Math.sqrt(t.x*t.x+t.y*t.y),h=Math.atan2(t.y,t.x)/Math.sin(this.s0),a=2*(Math.atan(Math.pow(this.ro0/e,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),s=Math.asin(Math.cos(this.ad)*Math.sin(a)-Math.sin(this.ad)*Math.cos(a)*Math.cos(h)),i=Math.asin(Math.cos(a)*Math.sin(h)/Math.cos(s)),t.x=this.long0-i/this.alfa,n=s,r=0;var l=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(s/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(n))/(1-this.e*Math.sin(n)),this.e/2))-this.s45),Math.abs(n-t.y)<1e-10&&(r=1),n=t.y,l+=1}while(0===r&&l<15);return l>=15?null:t},names:["Krovak","krovak"]},us=function(t,s,i,a,h){return t*h-s*Math.sin(2*h)+i*Math.sin(4*h)-a*Math.sin(6*h)},fs=function(t){return 1-.25*t*(1+t/16*(3+1.25*t))},ms=function(t){return.375*t*(1+.25*t*(1+.46875*t))},ps=function(t){return.05859375*t*t*(1+.75*t)},ys=function(t){return t*t*t*(35/3072)},ds=function(t,s,i){var a=s*i;return t/Math.sqrt(1-a*a)},_s=function(t){return Math.abs(t)<Y?t:t-yt(t)*Math.PI},xs=function(t,s,i,a,h){var e,n;e=t/s;for(var r=0;r<15;r++)if(n=(t-(s*e-i*Math.sin(2*e)+a*Math.sin(4*e)-h*Math.sin(6*e)))/(s-2*i*Math.cos(2*e)+4*a*Math.cos(4*e)-6*h*Math.cos(6*e)),e+=n,Math.abs(n)<=1e-10)return e;return NaN},vs={init:function(){this.sphere||(this.e0=fs(this.es),this.e1=ms(this.es),this.e2=ps(this.es),this.e3=ys(this.es),this.ml0=this.a*us(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var s,i,a=t.x,h=t.y;if(a=dt(a-this.long0),this.sphere)s=this.a*Math.asin(Math.cos(h)*Math.sin(a)),i=this.a*(Math.atan2(Math.tan(h),Math.cos(a))-this.lat0);else{var e=Math.sin(h),n=Math.cos(h),r=ds(this.a,this.e,e),o=Math.tan(h)*Math.tan(h),l=a*Math.cos(h),M=l*l,c=this.es*n*n/(1-this.es);s=r*l*(1-M*o*(1/6-(8-o+8*c)*M/120)),i=this.a*us(this.e0,this.e1,this.e2,this.e3,h)-this.ml0+r*e/n*M*(.5+(5-o+6*c)*M/24)}return t.x=s+this.x0,t.y=i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var s,i,a=t.x/this.a,h=t.y/this.a;if(this.sphere){var e=h+this.lat0;s=Math.asin(Math.sin(e)*Math.cos(a)),i=Math.atan2(Math.tan(a),Math.cos(e))}else{var n=this.ml0/this.a+h,r=xs(n,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(r)-Y)<=it)return t.x=this.long0,t.y=Y,h<0&&(t.y*=-1),t;var o=ds(this.a,this.e,Math.sin(r)),l=o*o*o/this.a/this.a*(1-this.es),M=Math.pow(Math.tan(r),2),c=a*this.a/o,u=c*c;s=r-o*Math.tan(r)/l*c*c*(.5-(1+3*M)*c*c/24),i=c*(1-u*(M/3+(1+3*M)*M*u/15))/Math.cos(r)}return t.x=dt(i+this.long0),t.y=_s(s),t},names:["Cassini","Cassini_Soldner","cass"]},gs=function(t,s){var i;return t>1e-7?(i=t*s,(1-t*t)*(s/(1-i*i)-.5/t*Math.log((1-i)/(1+i)))):2*s},bs=.3333333333333333,ws=.17222222222222222,As=.10257936507936508,Ps=.06388888888888888,ks=.0664021164021164,qs=.016415012942191543,Ns={init:function(){var t=Math.abs(this.lat0);if(Math.abs(t-Y)<it?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<it?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var s;switch(this.qp=gs(this.e,1),this.mmf=.5/(1-this.es),this.apa=Q(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),s=Math.sin(this.lat0),this.sinb1=gs(this.e,s)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*s*s)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var s,i,a,h,e,n,r,o,l,M,c=t.x,u=t.y;if(c=dt(c-this.long0),this.sphere){if(e=Math.sin(u),M=Math.cos(u),a=Math.cos(c),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+M*a:1+this.sinph0*e+this.cosph0*M*a)<=it)return null;s=(i=Math.sqrt(2/i))*M*Math.sin(c),i*=this.mode===this.EQUIT?e:this.cosph0*e-this.sinph0*M*a}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(a=-a),Math.abs(u+this.lat0)<it)return null;i=et-.5*u,s=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(c),i*=a}}else{switch(r=0,o=0,l=0,a=Math.cos(c),h=Math.sin(c),e=Math.sin(u),n=gs(this.e,e),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(r=n/this.qp,o=Math.sqrt(1-r*r)),this.mode){case this.OBLIQ:l=1+this.sinb1*r+this.cosb1*o*a;break;case this.EQUIT:l=1+o*a;break;case this.N_POLE:l=Y+u,n=this.qp-n;break;case this.S_POLE:l=u-Y,n=this.qp+n}if(Math.abs(l)<it)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),i=this.mode===this.OBLIQ?this.ymf*l*(this.cosb1*r-this.sinb1*o*a):(l=Math.sqrt(2/(1+o*a)))*r*this.ymf,s=this.xmf*l*o*h;break;case this.N_POLE:case this.S_POLE:n>=0?(s=(l=Math.sqrt(n))*h,i=a*(this.mode===this.S_POLE?l:-l)):s=i=0}}return t.x=this.a*s+this.x0,t.y=this.a*i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var s,i,a,h,e,n,r,o=t.x/this.a,l=t.y/this.a;if(this.sphere){var M,c=0,u=0;if(M=Math.sqrt(o*o+l*l),(i=.5*M)>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(u=Math.sin(i),c=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(M)<=it?0:Math.asin(l*u/M),o*=u,l=c*M;break;case this.OBLIQ:i=Math.abs(M)<=it?this.lat0:Math.asin(c*this.sinph0+l*u*this.cosph0/M),o*=u*this.cosph0,l=(c-Math.sin(i)*this.sinph0)*M;break;case this.N_POLE:l=-l,i=Y-i;break;case this.S_POLE:i-=Y}s=0!==l||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(o,l):0}else{if(r=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(o/=this.dd,l*=this.dd,(n=Math.sqrt(o*o+l*l))<it)return t.x=this.long0,t.y=this.lat0,t;h=2*Math.asin(.5*n/this.rq),a=Math.cos(h),o*=h=Math.sin(h),this.mode===this.OBLIQ?(r=a*this.sinb1+l*h*this.cosb1/n,e=this.qp*r,l=n*this.cosb1*a-l*this.sinb1*h):(r=l*h/n,e=this.qp*r,l=n*a)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(l=-l),!(e=o*o+l*l))return t.x=this.long0,t.y=this.lat0,t;r=1-e/this.qp,this.mode===this.S_POLE&&(r=-r)}s=Math.atan2(o,l),i=D(Math.asin(r),this.apa)}return t.x=dt(this.long0+s),t.y=i,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},Es=function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)},Ss={init:function(){Math.abs(this.lat1+this.lat2)<it||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=pt(this.e3,this.sin_po,this.cos_po),this.qs1=gs(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=pt(this.e3,this.sin_po,this.cos_po),this.qs2=gs(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=gs(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>it?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var s=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var a=gs(this.e3,this.sin_phi,this.cos_phi),h=this.a*Math.sqrt(this.c-this.ns0*a)/this.ns0,e=this.ns0*dt(s-this.long0),n=h*Math.sin(e)+this.x0,r=this.rh-h*Math.cos(e)+this.y0;return t.x=n,t.y=r,t},inverse:function(t){var s,i,a,h,e,n;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(s=Math.sqrt(t.x*t.x+t.y*t.y),a=1):(s=-Math.sqrt(t.x*t.x+t.y*t.y),a=-1),h=0,0!==s&&(h=Math.atan2(a*t.x,a*t.y)),a=s*this.ns0/this.a,this.sphere?n=Math.asin((this.c-a*a)/(2*this.ns0)):(i=(this.c-a*a)/this.ns0,n=this.phi1z(this.e3,i)),e=dt(h/this.ns0+this.long0),t.x=e,t.y=n,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,s){var i,a,h,e,n,r=Es(.5*s);if(t<it)return r;for(var o=t*t,l=1;l<=25;l++)if(i=Math.sin(r),a=Math.cos(r),h=t*i,e=1-h*h,n=.5*e*e/a*(s/(1-o)-i/e+.5/t*Math.log((1-h)/(1+h))),r+=n,Math.abs(n)<=1e-7)return r;return null}},Cs={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var s,i,a,h,e,n,r,o=t.x,l=t.y;return a=dt(o-this.long0),s=Math.sin(l),i=Math.cos(l),h=Math.cos(a),(e=this.sin_p14*s+this.cos_p14*i*h)>0||Math.abs(e)<=it?(n=this.x0+1*this.a*i*Math.sin(a)/e,r=this.y0+1*this.a*(this.cos_p14*s-this.sin_p14*i*h)/e):(n=this.x0+this.infinity_dist*i*Math.sin(a),r=this.y0+this.infinity_dist*(this.cos_p14*s-this.sin_p14*i*h)),t.x=n,t.y=r,t},inverse:function(t){var s,i,a,h,e,n;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(s=Math.sqrt(t.x*t.x+t.y*t.y))?(h=Math.atan2(s,this.rc),i=Math.sin(h),a=Math.cos(h),n=Es(a*this.sin_p14+t.y*i*this.cos_p14/s),e=Math.atan2(t.x*i,s*this.cos_p14*a-t.y*this.sin_p14*i),e=dt(this.long0+e)):(n=this.phic0,e=0),t.x=e,t.y=n,t},names:["gnom"]},Is=function(t,s){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(s)-i)<1e-6)return s<0?-1*Y:Y;for(var a,h,e,n,r=Math.asin(.5*s),o=0;o<30;o++)if(h=Math.sin(r),e=Math.cos(r),n=t*h,a=Math.pow(1-n*n,2)/(2*e)*(s/(1-t*t)-h/(1-n*n)+.5/t*Math.log((1-n)/(1+n))),r+=a,Math.abs(a)<=1e-10)return r;return NaN},Rs={init:function(){this.sphere||(this.k0=pt(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var s,i,a=t.x,h=t.y,e=dt(a-this.long0);if(this.sphere)s=this.x0+this.a*e*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(h)/Math.cos(this.lat_ts);else{var n=gs(this.e,Math.sin(h));s=this.x0+this.a*this.k0*e,i=this.y0+this.a*n*.5/this.k0}return t.x=s,t.y=i,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var s,i;return this.sphere?(s=dt(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=Is(this.e,2*t.y*this.k0/this.a),s=dt(this.long0+t.x/(this.a*this.k0))),t.x=s,t.y=i,t},names:["cea"]},Gs={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var s=t.x,i=t.y,a=dt(s-this.long0),h=_s(i-this.lat0);return t.x=this.x0+this.a*a*this.rc,t.y=this.y0+this.a*h,t},inverse:function(t){var s=t.x,i=t.y;return t.x=dt(this.long0+(s-this.x0)/(this.a*this.rc)),t.y=_s(this.lat0+(i-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},js=20,Os={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=fs(this.es),this.e1=ms(this.es),this.e2=ps(this.es),this.e3=ys(this.es),this.ml0=this.a*us(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var s,i,a,h=t.x,e=t.y,n=dt(h-this.long0);if(a=n*Math.sin(e),this.sphere)Math.abs(e)<=it?(s=this.a*n,i=-1*this.a*this.lat0):(s=this.a*Math.sin(a)/Math.tan(e),i=this.a*(_s(e-this.lat0)+(1-Math.cos(a))/Math.tan(e)));else if(Math.abs(e)<=it)s=this.a*n,i=-1*this.ml0;else{var r=ds(this.a,this.e,Math.sin(e))/Math.tan(e);s=r*Math.sin(a),i=this.a*us(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+r*(1-Math.cos(a))}return t.x=s+this.x0,t.y=i+this.y0,t},inverse:function(t){var s,i,a,h,e,n,r,o,l;if(a=t.x-this.x0,h=t.y-this.y0,this.sphere)if(Math.abs(h+this.a*this.lat0)<=it)s=dt(a/this.a+this.long0),i=0;else{n=this.lat0+h/this.a,r=a*a/this.a/this.a+n*n,o=n;var M;for(e=js;e;--e)if(M=Math.tan(o),l=-1*(n*(o*M+1)-o-.5*(o*o+r)*M)/((o-n)/M-1),o+=l,Math.abs(l)<=it){i=o;break}s=dt(this.long0+Math.asin(a*Math.tan(o)/this.a)/Math.sin(i))}else if(Math.abs(h+this.ml0)<=it)i=0,s=dt(this.long0+a/this.a);else{n=(this.ml0+h)/this.a,r=a*a/this.a/this.a+n*n,o=n;var c,u,f,m,p;for(e=js;e;--e)if(p=this.e*Math.sin(o),c=Math.sqrt(1-p*p)*Math.tan(o),u=this.a*us(this.e0,this.e1,this.e2,this.e3,o),f=this.e0-2*this.e1*Math.cos(2*o)+4*this.e2*Math.cos(4*o)-6*this.e3*Math.cos(6*o),m=u/this.a,l=(n*(c*m+1)-m-.5*c*(m*m+r))/(this.es*Math.sin(2*o)*(m*m+r-2*n*m)/(4*c)+(n-m)*(c*f-2/Math.sin(2*o))-f),o-=l,Math.abs(l)<=it){i=o;break}c=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),s=dt(this.long0+Math.asin(a*c/this.a)/Math.sin(i))}return t.x=s,t.y=i,t},names:["Polyconic","poly"]},zs={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var s,i=t.x,a=t.y-this.lat0,h=i-this.long0,e=a/V*1e-5,n=h,r=1,o=0;for(s=1;s<=10;s++)r*=e,o+=this.A[s]*r;var l,M=o,c=n,u=1,f=0,m=0,p=0;for(s=1;s<=6;s++)l=f*M+u*c,u=u*M-f*c,f=l,m=m+this.B_re[s]*u-this.B_im[s]*f,p=p+this.B_im[s]*u+this.B_re[s]*f;return t.x=p*this.a+this.x0,t.y=m*this.a+this.y0,t},inverse:function(t){var s,i,a=t.x,h=t.y,e=a-this.x0,n=(h-this.y0)/this.a,r=e/this.a,o=1,l=0,M=0,c=0;for(s=1;s<=6;s++)i=l*n+o*r,o=o*n-l*r,l=i,M=M+this.C_re[s]*o-this.C_im[s]*l,c=c+this.C_im[s]*o+this.C_re[s]*l;for(var u=0;u<this.iterations;u++){var f,m=M,p=c,y=n,d=r;for(s=2;s<=6;s++)f=p*M+m*c,m=m*M-p*c,p=f,y+=(s-1)*(this.B_re[s]*m-this.B_im[s]*p),d+=(s-1)*(this.B_im[s]*m+this.B_re[s]*p);m=1,p=0;var _=this.B_re[1],x=this.B_im[1];for(s=2;s<=6;s++)f=p*M+m*c,m=m*M-p*c,p=f,_+=s*(this.B_re[s]*m-this.B_im[s]*p),x+=s*(this.B_im[s]*m+this.B_re[s]*p);var v=_*_+x*x;M=(y*_+d*x)/v,c=(d*_-y*x)/v}var g=M,b=c,w=1,A=0;for(s=1;s<=9;s++)w*=g,A+=this.D[s]*w;var P=this.lat0+A*V*1e5,k=this.long0+b;return t.x=k,t.y=P,t},names:["New_Zealand_Map_Grid","nzmg"]},Ls={init:function(){},forward:function(t){var s=t.x,i=t.y,a=dt(s-this.long0),h=this.x0+this.a*a,e=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=h,t.y=e,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var s=dt(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=s,t.y=i,t},names:["Miller_Cylindrical","mill"]},Bs=20,Ts={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Qt(this.es)},forward:function(t){var s,i,a=t.x,h=t.y;if(a=dt(a-this.long0),this.sphere){if(this.m)for(var e=this.n*Math.sin(h),n=Bs;n;--n){var r=(this.m*h+Math.sin(h)-e)/(this.m+Math.cos(h));if(h-=r,Math.abs(r)<it)break}else h=1!==this.n?Math.asin(this.n*Math.sin(h)):h;s=this.a*this.C_x*a*(this.m+Math.cos(h)),i=this.a*this.C_y*h}else{var o=Math.sin(h),l=Math.cos(h);i=this.a*Dt(h,o,l,this.en),s=this.a*a*l/Math.sqrt(1-this.es*o*o)}return t.x=s,t.y=i,t},inverse:function(t){var s,i,a,h;return t.x-=this.x0,a=t.x/this.a,t.y-=this.y0,s=t.y/this.a,this.sphere?(s/=this.C_y,a/=this.C_x*(this.m+Math.cos(s)),this.m?s=Es((this.m*s+Math.sin(s))/this.n):1!==this.n&&(s=Es(Math.sin(s)/this.n)),a=dt(a+this.long0),s=_s(s)):(s=Wt(t.y/this.a,this.es,this.en),(h=Math.abs(s))<Y?(h=Math.sin(s),i=this.long0+t.x*Math.sqrt(1-this.es*h*h)/(this.a*Math.cos(s)),a=dt(i)):h-it<Y&&(a=this.long0)),t.x=a,t.y=s,t},names:["Sinusoidal","sinu"]},Fs={init:function(){},forward:function(t){for(var s=t.x,i=t.y,a=dt(s-this.long0),h=i,e=Math.PI*Math.sin(i);;){var n=-(h+Math.sin(h)-e)/(1+Math.cos(h));if(h+=n,Math.abs(n)<it)break}h/=2,Math.PI/2-Math.abs(i)<it&&(a=0);var r=.900316316158*this.a*a*Math.cos(h)+this.x0,o=1.4142135623731*this.a*Math.sin(h)+this.y0;return t.x=r,t.y=o,t},inverse:function(t){var s,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),s=Math.asin(i);var a=dt(this.long0+t.x/(.900316316158*this.a*Math.cos(s)));a<-Math.PI&&(a=-Math.PI),a>Math.PI&&(a=Math.PI),i=(2*s+Math.sin(2*s))/Math.PI,Math.abs(i)>1&&(i=1);var h=Math.asin(i);return t.x=a,t.y=h,t},names:["Mollweide","moll"]},Qs={init:function(){Math.abs(this.lat1+this.lat2)<it||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=fs(this.es),this.e1=ms(this.es),this.e2=ps(this.es),this.e3=ys(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=pt(this.e,this.sinphi,this.cosphi),this.ml1=us(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<it?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=pt(this.e,this.sinphi,this.cosphi),this.ml2=us(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=us(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var s,i=t.x,a=t.y;if(this.sphere)s=this.a*(this.g-a);else{var h=us(this.e0,this.e1,this.e2,this.e3,a);s=this.a*(this.g-h)}var e=this.ns*dt(i-this.long0),n=this.x0+s*Math.sin(e),r=this.y0+this.rh-s*Math.cos(e);return t.x=n,t.y=r,t},inverse:function(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var s,i,a,h;this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),s=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),s=-1);var e=0;if(0!==i&&(e=Math.atan2(s*t.x,s*t.y)),this.sphere)return h=dt(this.long0+e/this.ns),a=_s(this.g-i/this.a),t.x=h,t.y=a,t;var n=this.g-i/this.a;return a=xs(n,this.e0,this.e1,this.e2,this.e3),h=dt(this.long0+e/this.ns),t.x=h,t.y=a,t},names:["Equidistant_Conic","eqdc"]},Ds={init:function(){this.R=this.a},forward:function(t){var s,i,a=t.x,h=t.y,e=dt(a-this.long0);Math.abs(h)<=it&&(s=this.x0+this.R*e,i=this.y0);var n=Es(2*Math.abs(h/Math.PI));(Math.abs(e)<=it||Math.abs(Math.abs(h)-Y)<=it)&&(s=this.x0,i=h>=0?this.y0+Math.PI*this.R*Math.tan(.5*n):this.y0+Math.PI*this.R*-Math.tan(.5*n));var r=.5*Math.abs(Math.PI/e-e/Math.PI),o=r*r,l=Math.sin(n),M=Math.cos(n),c=M/(l+M-1),u=c*c,f=c*(2/l-1),m=f*f,p=Math.PI*this.R*(r*(c-m)+Math.sqrt(o*(c-m)*(c-m)-(m+o)*(u-m)))/(m+o);e<0&&(p=-p),s=this.x0+p;var y=o+c;return p=Math.PI*this.R*(f*y-r*Math.sqrt((m+o)*(o+1)-y*y))/(m+o),i=h>=0?this.y0+p:this.y0-p,t.x=s,t.y=i,t},inverse:function(t){var s,i,a,h,e,n,r,o,l,M,c,u,f;return t.x-=this.x0,t.y-=this.y0,c=Math.PI*this.R,a=t.x/c,h=t.y/c,e=a*a+h*h,n=-Math.abs(h)*(1+e),r=n-2*h*h+a*a,o=-2*n+1+2*h*h+e*e,f=h*h/o+(2*r*r*r/o/o/o-9*n*r/o/o)/27,l=(n-r*r/3/o)/o,M=2*Math.sqrt(-l/3),c=3*f/l/M,Math.abs(c)>1&&(c=c>=0?1:-1),u=Math.acos(c)/3,i=t.y>=0?(-M*Math.cos(u+Math.PI/3)-r/3/o)*Math.PI:-(-M*Math.cos(u+Math.PI/3)-r/3/o)*Math.PI,s=Math.abs(a)<it?this.long0:dt(this.long0+Math.PI*(e-1+Math.sqrt(1+2*(a*a-h*h)+e*e))/2/a),t.x=s,t.y=i,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},Ws={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var s,i,a,h,e,n,r,o,l,M,c,u,f,m,p,y,d,_,x,v,g,b,w,A=t.x,P=t.y,k=Math.sin(t.y),q=Math.cos(t.y),N=dt(A-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=it?(t.x=this.x0+this.a*(Y-P)*Math.sin(N),t.y=this.y0-this.a*(Y-P)*Math.cos(N),t):Math.abs(this.sin_p12+1)<=it?(t.x=this.x0+this.a*(Y+P)*Math.sin(N),t.y=this.y0+this.a*(Y+P)*Math.cos(N),t):(_=this.sin_p12*k+this.cos_p12*q*Math.cos(N),y=Math.acos(_),d=y?y/Math.sin(y):1,t.x=this.x0+this.a*d*q*Math.sin(N),t.y=this.y0+this.a*d*(this.cos_p12*k-this.sin_p12*q*Math.cos(N)),t):(s=fs(this.es),i=ms(this.es),a=ps(this.es),h=ys(this.es),Math.abs(this.sin_p12-1)<=it?(e=this.a*us(s,i,a,h,Y),n=this.a*us(s,i,a,h,P),t.x=this.x0+(e-n)*Math.sin(N),t.y=this.y0-(e-n)*Math.cos(N),t):Math.abs(this.sin_p12+1)<=it?(e=this.a*us(s,i,a,h,Y),n=this.a*us(s,i,a,h,P),t.x=this.x0+(e+n)*Math.sin(N),t.y=this.y0+(e+n)*Math.cos(N),t):(r=k/q,o=ds(this.a,this.e,this.sin_p12),l=ds(this.a,this.e,k),M=Math.atan((1-this.es)*r+this.es*o*this.sin_p12/(l*q)),c=Math.atan2(Math.sin(N),this.cos_p12*Math.tan(M)-this.sin_p12*Math.cos(N)),x=0===c?Math.asin(this.cos_p12*Math.sin(M)-this.sin_p12*Math.cos(M)):Math.abs(Math.abs(c)-Math.PI)<=it?-Math.asin(this.cos_p12*Math.sin(M)-this.sin_p12*Math.cos(M)):Math.asin(Math.sin(N)*Math.cos(M)/Math.sin(c)),u=this.e*this.sin_p12/Math.sqrt(1-this.es),f=this.e*this.cos_p12*Math.cos(c)/Math.sqrt(1-this.es),m=u*f,p=f*f,v=x*x,g=v*x,b=g*x,w=b*x,y=o*x*(1-v*p*(1-p)/6+g/8*m*(1-2*p)+b/120*(p*(4-7*p)-3*u*u*(1-7*p))-w/48*m),t.x=this.x0+y*Math.sin(c),t.y=this.y0+y*Math.cos(c),t))},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var s,i,a,h,e,n,r,o,l,M,c,u,f,m,p,y,d,_,x,v,g,b,w,A;if(this.sphere){if((s=Math.sqrt(t.x*t.x+t.y*t.y))>2*Y*this.a)return;return i=s/this.a,a=Math.sin(i),h=Math.cos(i),e=this.long0,Math.abs(s)<=it?n=this.lat0:(n=Es(h*this.sin_p12+t.y*a*this.cos_p12/s),r=Math.abs(this.lat0)-Y,e=dt(Math.abs(r)<=it?this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y):this.long0+Math.atan2(t.x*a,s*this.cos_p12*h-t.y*this.sin_p12*a))),t.x=e,t.y=n,t}return o=fs(this.es),l=ms(this.es),M=ps(this.es),c=ys(this.es),Math.abs(this.sin_p12-1)<=it?(u=this.a*us(o,l,M,c,Y),s=Math.sqrt(t.x*t.x+t.y*t.y),f=u-s,n=xs(f/this.a,o,l,M,c),e=dt(this.long0+Math.atan2(t.x,-1*t.y)),t.x=e,t.y=n,t):Math.abs(this.sin_p12+1)<=it?(u=this.a*us(o,l,M,c,Y),s=Math.sqrt(t.x*t.x+t.y*t.y),f=s-u,n=xs(f/this.a,o,l,M,c),e=dt(this.long0+Math.atan2(t.x,t.y)),t.x=e,t.y=n,t):(s=Math.sqrt(t.x*t.x+t.y*t.y),y=Math.atan2(t.x,t.y),m=ds(this.a,this.e,this.sin_p12),d=Math.cos(y),_=this.e*this.cos_p12*d,x=-_*_/(1-this.es),v=3*this.es*(1-x)*this.sin_p12*this.cos_p12*d/(1-this.es),g=s/m,b=g-x*(1+x)*Math.pow(g,3)/6-v*(1+3*x)*Math.pow(g,4)/24,w=1-x*b*b/2-g*b*b*b/6,p=Math.asin(this.sin_p12*Math.cos(b)+this.cos_p12*Math.sin(b)*d),e=dt(this.long0+Math.asin(Math.sin(y)*Math.sin(b)/Math.cos(p))),A=Math.sin(p),n=Math.atan2((A-this.es*w*this.sin_p12)*Math.tan(p),A*(1-this.es)),t.x=e,t.y=n,t)},names:["Azimuthal_Equidistant","aeqd"]},Us={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var s,i,a,h,e,n,r,o=t.x,l=t.y;return a=dt(o-this.long0),s=Math.sin(l),i=Math.cos(l),h=Math.cos(a),((e=this.sin_p14*s+this.cos_p14*i*h)>0||Math.abs(e)<=it)&&(n=1*this.a*i*Math.sin(a),r=this.y0+1*this.a*(this.cos_p14*s-this.sin_p14*i*h)),t.x=n,t.y=r,t},inverse:function(t){var s,i,a,h,e,n,r;return t.x-=this.x0,t.y-=this.y0,s=Math.sqrt(t.x*t.x+t.y*t.y),i=Es(s/this.a),a=Math.sin(i),h=Math.cos(i),n=this.long0,Math.abs(s)<=it?(r=this.lat0,t.x=n,t.y=r,t):(r=Es(h*this.sin_p14+t.y*a*this.cos_p14/s),e=Math.abs(this.lat0)-Y,Math.abs(e)<=it?(n=dt(this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y)),t.x=n,t.y=r,t):(n=dt(this.long0+Math.atan2(t.x*a,s*this.cos_p14*h-t.y*this.sin_p14*a)),t.x=n,t.y=r,t))},names:["ortho"]},Ks={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Xs={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4},Hs={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Y-et/2?this.face=Ks.TOP:this.lat0<=-(Y-et/2)?this.face=Ks.BOTTOM:Math.abs(this.long0)<=et?this.face=Ks.FRONT:Math.abs(this.long0)<=Y+et?this.face=this.long0>0?Ks.RIGHT:Ks.LEFT:this.face=Ks.BACK,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var s,i,a,h,e,n,r={x:0,y:0},o={value:0};if(t.x-=this.long0,s=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,i=t.x,this.face===Ks.TOP)h=Y-s,i>=et&&i<=Y+et?(o.value=Xs.AREA_0,a=i-Y):i>Y+et||i<=-(Y+et)?(o.value=Xs.AREA_1,a=i>0?i-rt:i+rt):i>-(Y+et)&&i<=-et?(o.value=Xs.AREA_2,a=i+Y):(o.value=Xs.AREA_3,a=i);else if(this.face===Ks.BOTTOM)h=Y+s,i>=et&&i<=Y+et?(o.value=Xs.AREA_0,a=-i+Y):i<et&&i>=-et?(o.value=Xs.AREA_1,a=-i):i<-et&&i>=-(Y+et)?(o.value=Xs.AREA_2,a=-i-Y):(o.value=Xs.AREA_3,a=i>0?-i+rt:-i-rt);else{var l,M,c,u,f,m;this.face===Ks.RIGHT?i=U(i,+Y):this.face===Ks.BACK?i=U(i,+rt):this.face===Ks.LEFT&&(i=U(i,-Y)),u=Math.sin(s),f=Math.cos(s),m=Math.sin(i),l=f*Math.cos(i),M=f*m,c=u,this.face===Ks.FRONT?a=W(h=Math.acos(l),c,M,o):this.face===Ks.RIGHT?a=W(h=Math.acos(M),c,-l,o):this.face===Ks.BACK?a=W(h=Math.acos(-l),c,-M,o):this.face===Ks.LEFT?a=W(h=Math.acos(-M),c,l,o):(h=a=0,o.value=Xs.AREA_0)}return n=Math.atan(12/rt*(a+Math.acos(Math.sin(a)*Math.cos(et))-Y)),e=Math.sqrt((1-Math.cos(h))/(Math.cos(n)*Math.cos(n))/(1-Math.cos(Math.atan(1/Math.cos(a))))),o.value===Xs.AREA_1?n+=Y:o.value===Xs.AREA_2?n+=rt:o.value===Xs.AREA_3&&(n+=1.5*rt),r.x=e*Math.cos(n),r.y=e*Math.sin(n),r.x=r.x*this.a+this.x0,r.y=r.y*this.a+this.y0,t.x=r.x,t.y=r.y,t},inverse:function(t){var s,i,a,h,e,n,r,o,l,M={lam:0,phi:0},c={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,i=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),s=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?c.value=Xs.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(c.value=Xs.AREA_1,s-=Y):t.x<0&&-t.x>=Math.abs(t.y)?(c.value=Xs.AREA_2,s=s<0?s+rt:s-rt):(c.value=Xs.AREA_3,s+=Y),l=rt/12*Math.tan(s),e=Math.sin(l)/(Math.cos(l)-1/Math.sqrt(2)),n=Math.atan(e),a=Math.cos(s),h=Math.tan(i),(r=1-a*a*h*h*(1-Math.cos(Math.atan(1/Math.cos(n)))))<-1?r=-1:r>1&&(r=1),this.face===Ks.TOP)o=Math.acos(r),M.phi=Y-o,c.value===Xs.AREA_0?M.lam=n+Y:c.value===Xs.AREA_1?M.lam=n<0?n+rt:n-rt:c.value===Xs.AREA_2?M.lam=n-Y:M.lam=n;else if(this.face===Ks.BOTTOM)o=Math.acos(r),M.phi=o-Y,c.value===Xs.AREA_0?M.lam=-n+Y:c.value===Xs.AREA_1?M.lam=-n:c.value===Xs.AREA_2?M.lam=-n-Y:M.lam=n<0?-n-rt:-n+rt;else{var u,f,m;l=(u=r)*u,f=(l+=(m=l>=1?0:Math.sqrt(1-l)*Math.sin(n))*m)>=1?0:Math.sqrt(1-l),c.value===Xs.AREA_1?(l=f,f=-m,m=l):c.value===Xs.AREA_2?(f=-f,m=-m):c.value===Xs.AREA_3&&(l=f,f=m,m=-l),this.face===Ks.RIGHT?(l=u,u=-f,f=l):this.face===Ks.BACK?(u=-u,f=-f):this.face===Ks.LEFT&&(l=u,u=f,f=-l),M.phi=Math.acos(-m)-Y,M.lam=Math.atan2(f,u),this.face===Ks.RIGHT?M.lam=U(M.lam,-Y):this.face===Ks.BACK?M.lam=U(M.lam,-rt):this.face===Ks.LEFT&&(M.lam=U(M.lam,+Y))}if(0!==this.es){var p,y,d;p=M.phi<0?1:0,y=Math.tan(M.phi),d=this.b/Math.sqrt(y*y+this.one_minus_f_squared),M.phi=Math.atan(Math.sqrt(this.a*this.a-d*d)/(this.one_minus_f*d)),p&&(M.phi=-M.phi)}return M.lam+=this.long0,t.x=M.lam,t.y=M.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},Js=[[1,2.2199e-17,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Zs=[[-5.20417e-18,.0124,1.21431e-18,-8.45284e-11],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Vs=.8487,Ys=1.3523,$s=ht/5,ti=1/$s,si=18,ii=function(t,s){return t[0]+s*(t[1]+s*(t[2]+s*t[3]))},ai=function(t,s){return t[1]+s*(2*t[2]+3*s*t[3])},hi={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var s=dt(t.x-this.long0),i=Math.abs(t.y),a=Math.floor(i*$s);a<0?a=0:a>=si&&(a=si-1),i=ht*(i-ti*a);var h={x:ii(Js[a],i)*s,y:ii(Zs[a],i)};return t.y<0&&(h.y=-h.y),h.x=h.x*this.a*Vs+this.x0,h.y=h.y*this.a*Ys+this.y0,h},inverse:function(t){var s={x:(t.x-this.x0)/(this.a*Vs),y:Math.abs(t.y-this.y0)/(this.a*Ys)};if(s.y>=1)s.x/=Js[si][0],s.y=t.y<0?-Y:Y;else{var i=Math.floor(s.y*si);for(i<0?i=0:i>=si&&(i=si-1);;)if(Zs[i][0]>s.y)--i;else{if(!(Zs[i+1][0]<=s.y))break;++i}var a=Zs[i],h=5*(s.y-a[0])/(Zs[i+1][0]-a[0]);h=K(function(t){return(ii(a,t)-s.y)/ai(a,t)},h,it,100),s.x/=ii(Js[i],h),s.y=(5*i+h)*at,t.y<0&&(s.y=-s.y)}return s.x=dt(s.x+this.long0),s},names:["Robinson","robin"]},ei={init:function(){this.name="geocent"},forward:function(t){return y(t,this.es,this.a)},inverse:function(t){return d(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};return k.defaultDatum="WGS84",k.Proj=Projection,k.WGS84=new k.Proj("WGS84"),k.Point=Point,k.toPoint=Et,k.defs=i,k.transform=w,k.mgrs=Tt,k.version="2.6.2",function(proj4){proj4.Proj.projections.add(Ut),proj4.Proj.projections.add(ts),proj4.Proj.projections.add(is),proj4.Proj.projections.add(ns),proj4.Proj.projections.add(rs),proj4.Proj.projections.add(os),proj4.Proj.projections.add(ls),proj4.Proj.projections.add(Ms),proj4.Proj.projections.add(cs),proj4.Proj.projections.add(vs),proj4.Proj.projections.add(Ns),proj4.Proj.projections.add(Ss),proj4.Proj.projections.add(Cs),proj4.Proj.projections.add(Rs),proj4.Proj.projections.add(Gs),proj4.Proj.projections.add(Os),proj4.Proj.projections.add(zs),proj4.Proj.projections.add(Ls),proj4.Proj.projections.add(Ts),proj4.Proj.projections.add(Fs),proj4.Proj.projections.add(Qs),proj4.Proj.projections.add(Ds),proj4.Proj.projections.add(Ws),proj4.Proj.projections.add(Us),proj4.Proj.projections.add(Hs),proj4.Proj.projections.add(hi),proj4.Proj.projections.add(ei)}(k),k});;/**
 * This file is part of TWCC.
 *
 * TWCC is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * TWCC is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with TWCC.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @copyright Copyright (c) 2010-2014 Clément Ronzon
 * @license http://www.gnu.org/licenses/agpl.txt
 */
/* ======================================================================
    converter.class.js
   ====================================================================== */
/*

  File: converter.class.js
  Description: User Interface for Proj4.js library
    ---------------------------------------------------------------------
    |  /!\ Warning: needs JQuery 1.4.2 or later and Proj4.js libraries!  |
    ---------------------------------------------------------------------

  Version |    Date     |         Author          |  Modifications
  ----------------------------------------------------------------------
  1.0     |  2010-01-01 | clem.rz -at- gmail.com  | Creation of converter.class.js
  1.1     |  2010-08-01 | clem.rz -at- gmail.com  | Adding of m <-> km option for XY and ZXY projections
  1.2     |  2010-08-23 | clem.rz -at- gmail.com  | Rewriting the document for JQuery 1.4.2
  1.2.1   |  2010-08-24 | clem.rz -at- gmail.com  | Convert on enter key, sort CRS by country and by text
  1.2.2   |  2010-08-30 | clem.rz -at- gmail.com  | Correction for callback function in continueDefSource
  1.2.3   |  2010-09-01 | clem.rz -at- gmail.com  | check existing functions and remove empty optgroups
  1.2.4   |  2010-09-01 | clem.rz -at- gmail.com  | modification of showLoadingSign
  1.2.5   |  2010-09-01 | clem.rz -at- gmail.com  | callback function if defs ajax loading fails
  1.2.6   |  2010-09-02 | clem.rz -at- gmail.com  | toggleLoadingSing has been replaced with showLoadingSign
  1.2.7   |  2010-09-03 | clem.rz -at- gmail.com  | bug in the removing loop of continueDefSource, adding possibility
                                                  | of specifying new codes like: ESRI, IAU2000, SR-ORG, and urls and urns
                                                  | adding callback function for reload
  2.0     |  2010-09-07 | clem.rz -at- gmail.com  | Creation of Proj4js.Proj object on selection only, this reduce memory usage
  2.0.1   |  2010-09-15 | clem.rz -at- gmail.com  | Show Hide loading sign issue
  2.0.2   |  2010-11-19 | clem.rz -at- gmail.com  | The CRS info link is optional
                                                  | pass WGS84 array in case of CSV
  2.0.3   |  2011-04-04 | clem.rz -at- gmail.com  | Correction of dmsToDd function
  2.0.4   |  2011-04-15 | clem.rz -at- gmail.com  | Correction of App.math.parseFloat when value isNaN returns 0
  2.0.5   |  2013-02-08 | clem.rz -at- gmail.com  | Modification of loadCRS
                                                  | its content and the function getDefTitle have been moved to global.js.php
  2.0.6   |  2013-09-13 | clem.rz -at- gmail.com  | Update to new JQuery specs
  2.1.0   |  2013-10-06 | clem.rz -at- gmail.com  | Addition of the convergence information
  2.1.1   |  2013-10-13 | clem.rz -at- gmail.com  | Addition of getConvergence function
  2.1.2   |  2013-12-19 | clem.rz -at- gmail.com  | Addition of conventions for convergence angle
  2.1.3   |  2014-01-06 | clem.rz -at- gmail.com  | Compatibility changes for html5
  2.1.4   |  2014-03-17 | clem.rz -at- gmail.com  | Add connector specific changes
                                                  | Remove the nfo parameter
  2.1.5   |  2014-04-13 | clem.rz -at- gmail.com  | Fix some connectors bugs
  2.2.0   |  2014-05-12 | clem.rz -at- gmail.com  | Use an object as parameter of constructors instead of plenty o arguments!
                                                  | Utils functions moved to utils.js file
  3.0.0   |  2014-11-18 | clem.rz -at- gmail.com  | Refactor everything into jQuery UI Widgets
*/
/**
 * Usage:
 * $container.converterSet(options);
 */

(function($, proj4, TWCCHistory, App) {
    "use strict";
    /*global window, jQuery, App, Proj4js, TWCCHistory */

    //region Utils
    var _INPUT_ERROR_MESSAGE = 'INPUT ERROR ON LINE ';

    function _parseFloat(value) {
        value = +value.toString().replace(/\,/gi, '.');
        return isNaN(value) ? 0 : value;
    }

    function _newDeferred() {
        return App.utils.newDeferred.apply(this, arguments);
    }

    function _capitalize(string) {
        return string.charAt(0).toUpperCase() + string.substring(1);
    }

    function _getMagneticDeclinationForToday(wgs84) {
        var wmm = App.utils.getWMM();
        return wmm(wgs84[0].y, wgs84[0].x).dec;
    }

    function _getUTMZone(wgs84lng) {
        return (wgs84lng >= 0) ? Math.floor((wgs84lng + 180) / 6) + 1 : Math.floor(wgs84lng / 6) + 31;
    }

    function getHemisphere(wgs84Lat) {
        return (wgs84Lat >= 0) ? 'n' : 's';
    }

    function _getKeyCode(event) {
        if (event.keyCode) {
            return event.keyCode;
        } else {
            return event.which;
        }
    }

    function _dmsToDd(dmsValue) {
        var value, cardinal, ddValue;
        if (dmsValue !== undefined) {
            value = Math.abs(_parseFloat(dmsValue.D));
            value += Math.abs(_parseFloat(dmsValue.M)) / 60;
            value += Math.abs(_parseFloat(dmsValue.S)) / 3600;
            cardinal = (_parseFloat(dmsValue.D) >= 0) ? 1 : -1;
            cardinal *= ((dmsValue.C == 'N' || dmsValue.C == 'E') ? 1 : -1);
            ddValue = cardinal * value;
        }
        return ddValue;
    }

    function _dmToDd(dmsValue) {
        var value, cardinal, ddValue;
        if (dmsValue !== undefined) {
            value = Math.abs(_parseFloat(dmsValue.D));
            value += Math.abs(_parseFloat(dmsValue.M)) / 60;
            cardinal = (_parseFloat(dmsValue.D) >= 0) ? 1 : -1;
            cardinal *= ((dmsValue.C == 'N' || dmsValue.C == 'E') ? 1 : -1);
            ddValue = cardinal * value;
        }
        return ddValue;
    }

    function _ddToDms(ddValue, ddOpts) {
        var degrees, minutes_temp, minutes, seconds, cardinal;
        if ($.type(+ddValue) !== 'number' || isNaN(ddValue)) {
            degrees = 0;
            minutes = 0;
            seconds = 0;
            if (ddOpts) {
                cardinal = ddOpts.N ? 'N' : 'E';
            }
        } else {
            if (ddOpts) {
                cardinal = (ddValue >= 0) ? (ddOpts.N ? 'N' : 'E') : (ddOpts.S ? 'S' : 'W');
            }
            ddValue = Math.abs(ddValue);
            degrees = Math.floor(ddValue);
            minutes_temp = (ddValue - degrees) * 60;
            minutes = Math.floor(minutes_temp);
            seconds = (minutes_temp - minutes) * 60;
        }
        return {
            'C': cardinal,
            'D': degrees.toString(),
            'M': minutes.toString(),
            'S': seconds.toString()
        };
    }

    function _ddToDm(ddValue, ddOpts) {
        var degrees, minutes, cardinal;
        if ($.type(+ddValue) !== 'number' || isNaN(ddValue)) {
            degrees = 0;
            minutes = 0;
            if (ddOpts) {
                cardinal = ddOpts.N ? 'N' : 'E';
            }
        } else {
            if (ddOpts) {
                cardinal = (ddValue >= 0) ? (ddOpts.N ? 'N' : 'E') : (ddOpts.S ? 'S' : 'W');
            }
            ddValue = Math.abs(ddValue);
            degrees = Math.floor(ddValue);
            minutes = (ddValue - degrees) * 60;
        }
        return {
            'C': cardinal,
            'D': degrees.toString(),
            'M': minutes.toString()
        };
    }

    function _getDefinitionString(srsCode, definitions) {
        var definitionString = '';
        $.each(definitions, function(country, definition) {
            if (definition.hasOwnProperty(srsCode)) {
                definitionString = definition[srsCode].def;
                return false;
            } else {
                return true;
            }
        });
        return definitionString;
    }

    /**
     * Return the convergence angle
     * Source:
     * http://www.threelittlemaids.co.uk/magdec/transverse_mercator_projection.pdf
     * http://www.ga.gov.au/geodesy/datums/redfearn_geo_to_grid.jsp
     * http://www.threelittlemaids.co.uk/magdec/explain.html
     */
    function _computeConvergence(a, b, lng0, wgs84) {
        var lng_0 = lng0 || App.utils.degToRad(_getUTMZone(wgs84.x) * 6 - 183),
            lat = App.utils.degToRad(wgs84.y),
            lng = App.utils.degToRad(wgs84.x),
            e2 = (a - b) / a,
            eta2 = e2 * Math.pow(Math.cos(lat), 2) / (1 - e2),
            P = lng - lng_0,
            J13 = Math.sin(lat),
            J14 = (1 + 3 * eta2 + 2 * Math.pow(eta2, 2)) * Math.sin(lat) * Math.pow(Math.cos(lat), 2) / 3,
            J15 = (2 - Math.pow(Math.tan(lat), 2)) * Math.sin(lat) * Math.pow(Math.cos(lat), 4) / 15,
            C = P * J13 + Math.pow(P, 3) * J14 + Math.pow(P, 5) * J15;
            C *= -1;
        return App.utils.radToDeg(C);
    }

    function getCoef(lenghtUnit) {
        var coef;
        switch (lenghtUnit) {
            case 'm':
                coef = 1;
                break;
            case 'km':
                coef = 1000;
                break;
            case 'us-ft':
                coef = 0.304800609601219;
                break;
            default:
                coef = 1000;
        }
        return coef;
    }

    function _toMeter(value, lenghtUnit) {
        return _parseFloat(value) * getCoef(lenghtUnit);
    }

    function _fromMeter(value, lenghtUnit) {
        return _parseFloat(value) / getCoef(lenghtUnit);
    }
    //endregion

    //region Converter widgets
    $.widget('twcc.converterSet', {
        options: {
            units: {
                dms:{D:'°', M:'\'', S:'\'\''},
                dd:{x:{DD:'°E'}, y:{DD:'°N'}},
                cartesian:{XY:{m:'m', km:'km', 'us-ft':'ft'},CONVERGENCE:'°'}
            },
            labels:{
                spherical:{x:'Lng = ', y:'Lat = ', convergence:'Conv. = '},
                cartesian:{x:'X = ', y:'Y = ', z:'Zone = ', h:'Hemisphere = ', convergence:'Conv. = '},
                csv:{csv:'CSV : ', l:'Format : '}
            },
            options:{
                x:{E:'East',W:'West'},
                y:{N:'North',S:'South'},
                o:{_DMS:'Deg. min. sec.', _DM:'Deg. min.', _DD:'Decimal deg.'},
                h:{n:'North', s:'South'},
                u:{_M:'Meters', _KM:'Kilometers', _F:'Feet'}
            },
            value: {x:0,y:0},
            wgs84: [],
            defaultWgs84: [{x:0,y:0}],
            selections: {},
            definitions: {},
            url: '',
            $containers: [],
            masterLoadingToggleSwitch: false,
            csv: false
        },
        _create: function() {
            var history,
                self = this;
            this._bindEvents();
            this._historyManager = TWCCHistory.getInstance(App);
            history = this._historyManager.getCurrentValue();
            if (!this.options.wgs84) {
                if (history) {
                    var reg = /UD\d+/gi;
                    if (history.wgs84.length > 1) {
                        this.options.wgs84 = history.wgs84;
                        self.options.csv = true;
                    } else {
                        if ($.type(history.wgs84) !== 'array') {
                            throw 'Wrong data type';
                        }
                        this.options.wgs84 = history.wgs84;
                    }
                    this.options.selections.source = reg.test(history.sc) ? 'WGS84' : history.sc;
                    this.options.selections.destination = reg.test(history.dc) ? 'WGS84' : history.dc;
                } else {
                    this.options.wgs84 = this.options.defaultWgs84;
                }
            }
            this.options.$containers = this.element.find('.converter-container');
            this.options.$containers.each(function(index) {
                $(this).converter({
                    units: self.options.units,
                    labels: self.options.labels,
                    options: self.options.options,
                    csv: self.options.csv,
                    target: index ? 'dest' : 'source',
                    selection: self.options.selections[index ? 'destination' : 'source'],
                    value: self.options.value,
                    wgs84: self.options.wgs84
                });
            });
            this.options.masterLoadingToggleSwitch = true;
            this._toggleLoading();
            this._reload()
                .progress(function(message) {
                    self._trigger('.notify', null, message);
                })
                .done(function() {
                    self._reloadSucceeded.apply(self, arguments);
                    self._trigger('.done', null, {
                        wgs84: self.wgs84(),
                        csv: self.csv(),
                        selections: self.options.selections
                    });
                    self.setConvergence();
                })
                .fail(function() {
                    self._reloadFailed.apply(self, arguments);
                });
        },
        _bindEvents: function() {
            var self = this;
            this.element.on('converter.transform', function(event, obj) {
                self.transform(obj);
            });
            this.element.on('converter.source.wgs84_changed ' +
                'converterset.done ', function(event, response) {
                var data = {
                    wgs84: response.wgs84,
                    convergenceInDegrees: self._convergence(),
                    srsCode: self._selection(),
                    magneticDeclinationInDegrees: _getMagneticDeclinationForToday(response.wgs84)
                };
                self._addToHistory(data);
                self._triggerWgs84Changed(event, data);
            });
            this.element.on('converter.source.selection_changed ' +
                'converter.dest.selection_changed ', function(event, response) {
                var data = {
                    wgs84: response.wgs84,
                    srsCode: self._selection()
                };
                self._addToHistory(data);
                self._triggerConvergenceChange();
            });
            this.element.on('converter.source.convergence_changed ' +
                'converter.dest.convergence_changed ', function() {
                self._triggerConvergenceChange();
            });
            this.element.find('.history').click(function() {
                if ($(this).hasClass('next')) {
                    self._historyManager.moveToNext();
                } else {
                    self._historyManager.moveToPrevious();
                }
                self._restoreFromHistory();
            });
        },
        _triggerWgs84Changed: function(event, data) {
            this._trigger('.wgs84_changed', event, data);
        },
        _triggerConvergenceChange: function() {
            this._trigger('.convergence_changed', null, {
                convergenceInDegrees: this._convergence()
            });
        },
        _reloadSucceeded: function() {
            this._loadDefinitionsObject();
            this.options.masterLoadingToggleSwitch = false;
            this._toggleLoading();
        },
        _reloadFailed: function(XMLHttpRequest) {
            this._trigger('.fail', null, XMLHttpRequest);
        },
        _reload: function() {
            var self = this,
                dfd = _newDeferred('Reload');
            this._toggleLoading(true);
            this._loadDefinitions().always(function() {
                self._toggleLoading(false);
            }).done(function() {
                var plainDefinitions = {};
                if (self.options.definitions.WGS84) {
                    self.options.definitions = {'*World': self.options.definitions};
                }
                $.each(self.options.definitions, function(country, newDef) {
                    $.extend(plainDefinitions, newDef);
                });
                dfd.resolve();
            }).fail(function(message, args) {
                dfd.reject(args);
            });
            return dfd.promise();
        },
        _loadDefinitions: function() {
            var self = this,
                dfd = _newDeferred('Load definitions');
            if ($.type(this.options.definitions) !== 'object') {
                dfd.reject('Wrong definitions type');
            } else {
                if ($.isEmptyObject(this.options.definitions)) {
                    $.ajax({
                        url: this.options.url,
                        data: {u: 'u'},
                        type: "POST",
                        cache: false,
                        dataType: 'json'
                    }).done(function(data, textStatus, jqXHR) {
                        if (data.error !== undefined) {
                            dfd.reject('Server Error', [jqXHR, textStatus, data]);
                        } else {
                            self.options.definitions = data;
                            dfd.resolve();
                        }
                    }).fail(function(jqXHR, textStatus, errorThrown) {
                        dfd.reject('Server Error', arguments);
                    });
                } else {
                    dfd.resolve();
                }
            }
            return dfd.promise();
        },
        _loadDefinitionsObject: function() {
            this._pushPullAll('loadDefinitionsObject', this.options.definitions);
        },
        _toggleLoading: function(show) {
            show = this.options.masterLoadingToggleSwitch || !!show;
            this._pushPullAll('toggleLoading', show);
        },
        _addToHistory: function(response) {
            if (this._historyManager.isEnabled()) {
                this._historyManager.add({
                    wgs84: response.wgs84,
                    sc: response.srsCode.source,
                    dc: response.srsCode.destination
                });
            }
        },
        _restoreFromHistory: function() {
            var self = this,
                obj = this._historyManager.getCurrentValue();
            this._underTheRadar(function() {
                var isCsv = obj.wgs84.length > 1,
                    csv = self.csv();
                if (csv !== isCsv) {
                    self.csv(isCsv);
                }
                self.transform(obj);
                self.pushPullSource('selection', obj.sc);
                self.pushPullDestination('selection', obj.dc);
            });
        },
        _underTheRadar: function(func) {
            if ($.type(func) !== 'function') {
                throw 'Invalid function';
            }
            this._historyManager.toggle(false);
            func();
            this._historyManager.toggle(true);
        },
        _pushPullWithCriterion: function(key, value, criteria, criterion) {
            var returnedValue = null,
                self = this;
            this.options.$containers.each(function() {
                if ($(this).converter('option', criteria) === criterion) {
                    returnedValue = self._pushPullOne(key, value, $(this));
                }
            });
            return returnedValue;
        },
        _pushPullOne: function(key, value, $container) {
            var returnedValue = value === undefined ? $container.converter(key) : $container.converter(key, value);
            if (this.options.hasOwnProperty(key)) {
                this.options[key] = returnedValue;
            }
            return returnedValue;
        },
        pushPullSource: function(key, value) {
            return this._pushPullWithCriterion(key, value, 'target', 'source');
        },
        pushPullDestination: function(key, value) {
            return this._pushPullWithCriterion(key, value, 'target', 'dest');
        },
        _pushPullAll: function(key, value) {
            var self = this;
            this.options.$containers.each(function() {
                self._pushPullOne(key, value, $(this));
            });
            return this.options[key];
        },
        _pullAll: function(key) {
            return {
                source: this.pushPullSource(key),
                destination: this.pushPullDestination(key)
            };
        },
        wgs84: function(value) {
            return this._pushPullAll('wgs84', value);
        },
        toggle: function(enable) {
            return this._pushPullAll('toggle', enable);
        },
        _getFirstWgs84: function() {
            var wgs84 = null,
                wgs84Array = this.wgs84();
            $.each(wgs84Array, function() {
                if (!this.error) {
                    wgs84 = this;
                    return false;
                }
                return true;
            });
            return wgs84 || {x:0,y:0};
        },
        _convergence: function() {
            return this._pullAll('convergence');
        },
        _selection: function() {
            this.options.selections = this._pullAll('selection');
            return this.options.selections;
        },
        setConvergence: function() {
            this._pushPullAll('setConvergence');
        },
        readOnly: function() {
            return this.options.readOnly;
        },
        csv: function(enable) {
            if (enable != this.options.csv && enable !== undefined) {
                if (!enable) {
                    var wgs84 = [this._getFirstWgs84()];
                    if (JSON.stringify(wgs84[0]) === JSON.stringify(this.wgs84()[0])) {
                        this.wgs84(wgs84);
                    } else {
                        this.transform({wgs84:wgs84});
                    }
                }
                this._trigger('.csv_changed', null, {csv:enable});
            }
            return this._pushPullAll('csv', enable);
        },
        unloadCRS: function(srsCode) {
            this._pushPullAll('unloadCRS', srsCode);
        },
        removeEmptyOptgroups: function() {
            this._pushPullAll('removeEmptyOptgroups');
        },
        mergeDefinitions: function(definitionsObject) {
            var self = this,
                dfd = new $.Deferred();
            this.options.masterLoadingToggleSwitch = true;
            this._toggleLoading();
            this.options.definitions = $.type(this.options.definitions) !== 'object' ? {} : this.options.definitions;
            $.extend(true, this.options.definitions, definitionsObject);
            this._reload()
                .progress(function() {
                    dfd.notify('Reloading');
                })
                .done(function() {
                    self._reloadSucceeded.apply(self, arguments);
                    dfd.resolve();
                })
                .fail(function() {
                    self._reloadFailed.apply(self, arguments);
                    dfd.reject.apply(null, arguments);
                });
            return dfd.promise();
        },
        transform: function(data) {
            var fromPivot = data.hasOwnProperty('wgs84');
            if (!(fromPivot && $.type(data.wgs84) === 'array' || data.hasOwnProperty('target'))) {
                throw 'Wrong data format';
            }
            if (fromPivot) {
                this._pushPullAll('transform', data);
            } else {
                var wgs84;
                if (data.target === 'source') {
                    wgs84 = this.pushPullSource('transform', {input:null});
                    this.pushPullDestination('transform', {wgs84:wgs84});
                } else {
                    wgs84 = this.pushPullDestination('transform', {input:null});
                    this.pushPullSource('transform', {wgs84:wgs84});
                }
            }
        },
        _setOption: function(key, value) {
            return this._superApply(arguments);
        },
        _destroy: function() {
            this._toggleLoading(true);
            this._pushPullAll('destroy');
            return this._super();
        }
    });

    $.widget('twcc.converter', {
        options: {
            readOnly: false,
            wrapper: {
                fieldSet: ['<div>'],
                title: ['<h3>'],
                info: ['<a>', {name: 'info', href: '#'}]
            },
            projections: {},
            units: {},
            labels: {},
            options: {},
            angleUnit: 'dd',
            lengthUnit: 'm',
            convergence: null,
            hint: '',
            wgs84: [{x:0, y:0}],
            value: {x:0, y:0},
            selection: null,
            mapping: {
                aea: 'cartesian',
                aeqd: 'cartesian',
                cass: 'cartesian',
                cea: 'cartesian',
                csv: 'csv',
                eqc: 'cartesian',
                eqdc: 'cartesian',
                equi: 'cartesian',
                gauss: 'cartesian',
                geocent: 'cartesian',
                gnom: 'cartesian',
                gstmerc: 'cartesian',
                laea: 'cartesian',
                lcc: 'cartesian',
                longlat: 'spherical',
                merc: 'cartesian',
                mill: 'cartesian',
                moll: 'cartesian',
                nzmg: 'cartesian',
                omerc: 'cartesian',
                ortho: 'cartesian',
                poly: 'cartesian',
                sinu: 'cartesian',
                somerc: 'cartesian',
                stere: 'cartesian',
                sterea: 'cartesian',
                tmerc: 'cartesian',
                utm: 'utm',
                vandg: 'spherical',
                connector: 'connector'
            },
            $select: null,
            $container: null,
            csv: false
        },
        _widget: undefined,
        _create: function() {
            $.extend(this.options, {
                $select: this.element.find('select.crs-list'),
                $container: this.element.find('.container')
            });
            this._bindEvents();
            this._unload();
        },
        _triggerTransform: function(event) {
            event.preventDefault();
            this._trigger('.transform', event, {
                target: this.options.target
            });
        },
        _bindEvents: function() {
            var self = this;
            this.options.$select.on('change', function() {
                self.selection();
            });
            this.element.on('angleswitchgeofield.update_display', function(event, response) {
                self.options.angleUnit = response.value;
                self.value();
                self.updateContainer();
            });
            this.element.find('.convert-button').click(function(event) {
                self._triggerTransform(event);
            });
            this.element.on('keyup', 'input, select', function(event) {
                if (_getKeyCode(event) == App.constants.keyboard.RETURN) {
                    self._triggerTransform(event);
                }
            });
        },
        _getFieldSetUnit: function(projName) {
            var widgetPrefix = this._getWidgetPrefix(projName),
                unitName = this._getFieldSetUnitName(widgetPrefix);
            if (unitName) {
                return this.options.units[unitName];
            } else {
                var camelArray = widgetPrefix.match(/([A-Z]?[a-z]*)/g);
                unitName = this._getFieldSetUnitName(camelArray[1]);
                if (unitName) {
                    return this.options.units[unitName];
                }
            }
        },
        _getFieldSetUnitName: function(widgetPrefix) {
            var unitName;
            switch (widgetPrefix) {
                case 'utm':
                    unitName = 'cartesian';
                    break;
                case 'Dm':
                    unitName = 'dms';
                    break;
                case 'csv':
                case 'connector':
                    break;
                default:
                    unitName = widgetPrefix.toLowerCase();
            }
            if (unitName && this.options.units.hasOwnProperty(unitName)) {
                return unitName;
            }
        },
        _getFieldSetLabel: function(projName) {
            var widgetPrefix = this._getWidgetPrefix(projName),
                labelName = this._getFieldSetLabelName(widgetPrefix);
            if (labelName) {
                return this.options.labels[labelName];
            } else {
                var camelArray = widgetPrefix.match(/([A-Z]?[a-z]*)/g);
                labelName = this._getFieldSetLabelName(camelArray[0]);
                if (labelName) {
                    return this.options.labels[labelName];
                }
            }
        },
        _getFieldSetLabelName: function(widgetPrefix) {
            var labelName;
            switch (widgetPrefix) {
                case 'utm':
                    labelName = 'cartesian';
                    break;
                case 'connector':
                    break;
                default:
                    labelName = widgetPrefix.toLowerCase();
            }
            if (labelName && this.options.labels.hasOwnProperty(labelName)) {
                return labelName;
            }
        },
        _getWidgetMidfix: function(prefix) {
            var midfix = '';
            if (prefix === 'spherical') {
                midfix = this.options.angleUnit;
                midfix = midfix.charAt(0).toUpperCase() + midfix.substr(1).toLowerCase();
            }
            return midfix;
        },
        _getWidgetPrefix: function(projName) {
            var prefix,
                projection = this.options.projections[this.options.selection];
            projName = projection.isConnector && projName !== 'csv' ? 'connector' : projName;
            if (this.options.mapping.hasOwnProperty(projName)) {
                prefix = this.options.mapping[projName];
            } else {
                console.error('Projection not found: ' + projName);
                prefix = 'cartesian';
            }
            return prefix + this._getWidgetMidfix(prefix);
        },
        _getWidgetName: function(projName) {
            return this._getWidgetPrefix(projName) + 'FieldSet';
        },
        _unload: function() {
            this.element.find('select.crs-list, .container').empty();
            this.projections = {};
        },
        toggleLoading: function(show) {
            this.element.find('.container').toggle(!show);
            this.element.find('.loading').toggle(!!show);
        },
        removeEmptyOptgroups: function() {
            this.options.$select.find('optgroup:empty').remove();
        },
        loadDefinitionsObject: function(definitions) {
            var flag,
                self = this,
                $select = this.options.$select;
            this.options.definitions = definitions;
            this.removeEmptyOptgroups();
            flag = false;
            $.each(this.options.definitions, function(country, newDef) {
                $.each(newDef, function(srsCode, obj) {
                    if (!self.options.$select.has('optgroup[label="'+country+'"] option[value="'+srsCode+'"]').length) {
                        App.utils.addOptionToSelect(country, srsCode, self.options.$select, obj.def);
                        flag = true;
                    }
                });
            });
            if (flag) {
                $select.sortGrpsNOptionsByText();
                try {
                    this.selection(this.options.selection || $select.find('option:first').val());
                } catch(e) {
                    this.selection($select.find('option:first').val());
                }
            }
        },
        unloadCRS: function(srsCode) {
            var self = this;
            if (this.selection() === srsCode) {
                var originalSrsCode = this._widget.options.srsCode;
                this.selection(originalSrsCode);
            }
            this.options.$select.find('option[value="'+srsCode.toString()+'"]').remove();
            proj4.defs(srsCode, undefined);
            delete this.options.projections[srsCode];
            $.each(this.options.definitions, function(country, definition) {
                if (definition.hasOwnProperty(srsCode)) {
                    delete self.options.definitions[country][srsCode];
                    return false;
                }
                return true;
            });
            this.removeEmptyOptgroups();
        },
        updateContainer: function() {
            var self = this,
                srsCode = this.selection();
            this.options.value = (!this.options.csv && $.type(this.options.value) === 'array') ? this.options.value[0] : this.options.value;
            this.options.value = (this.options.csv && $.type(this.options.value) !== 'array') ? [this.options.value] : this.options.value;
            if (srsCode) {
                if (!this.options.projections.hasOwnProperty(srsCode)) {
                    this._registerProjection(srsCode);
                }
                var $title, $temp,
                    projection = this._getProjection(srsCode),
                    projectionName = projection.projName,
                    unit = this._getFieldSetUnit(projectionName) || '',
                    label = this._getFieldSetLabel(projectionName) || '',
                    options = {
                        srsCode: srsCode,
                        target: this.options.target,
                        convergence: this.options.convergence,
                        wgs84: this.options.wgs84,
                        value: this.options.value,
                        units: unit,
                        labels: label,
                        lengthUnit: this.options.lengthUnit,
                        options: this.options.options,
                        readOnly: this.options.readOnly
                    },
                    crsTitle = projection.title || srsCode,
                    widgetName = this._getWidgetName(this.options.csv ? 'csv' : projection.projName),
                    $fieldSetContainer = $.apply(null, this.options.wrapper.fieldSet);
                this.options.$container.empty();
                $title = $.apply(null, this.options.wrapper.title);
                $title.append(crsTitle);
                $temp = $.apply(null, this.options.wrapper.info);
                $temp.click(function(event) {
                    self._trigger('.info', event, {
                        srsCode: srsCode,
                        definitionString: projection.defData
                    });
                });
                $temp.text(' [?]');
                $title.append($temp);
                $fieldSetContainer.append($title);
                if (widgetName == 'csvFieldSet') {
                    unit = unit.D ? this.options.units.dd : unit;
                    var hint = (
                        (projectionName === 'utm' ? label.h + ',' + label.z + ',' : '') + (label.x ? label.x + (unit.x ? '(' + unit.x.DD + ')' : '(' + unit.XY.m + ')') : '') + (label.y ? ',' + label.y + (unit.y ? '(' + unit.y.DD + ')' : '(' + unit.XY.m + ')') : '')
                        ).replace(/[\s]*=[\s]*/ig, '');
                    $.extend(options, {
                        originalProjection: projection.isConnector ? 'connector' : projectionName,
                        hint: hint,
                        units: null,
                        labels: this.options.labels.csv
                    });
                }
                this._widget = $fieldSetContainer[widgetName](options).data('twcc'+_capitalize(widgetName));
                this.options.$container.append($fieldSetContainer);
            }
        },
        _registerProjection: function(srsCode) {
            var projection;
            if (!proj4.defs(srsCode)) {
                var isConnector = srsCode.indexOf('Connector') >= 0,
                    definitionString = _getDefinitionString(srsCode, this.options.definitions),
                    definition  = {
                        defData: definitionString,
                        isConnector: isConnector
                    };
                proj4.defs(srsCode, definitionString);
                $.extend(proj4.defs(srsCode), definition);
            }
            projection = $.extend({}, proj4.defs(srsCode));
            this._setProjection(srsCode, projection);
        },
        _getProjection: function(srsCode) {
            if (!this.options.projections.hasOwnProperty(srsCode)) {
                throw 'Unknown srsCode';
            }
            return this.options.projections[srsCode];
        },
        _setProjection: function(srsCode, projection) {
            this.options.projections[srsCode] = projection;
        },
        selection: function(value) {
            var $select = this.options.$select,
                flag = false,
                self = this,
                originalSelection = this.options.selection;
            if (value !== undefined) {
                this.options.selection = value;
                try {
                    $select.val(this.options.selection);
                } catch (e) {} //IE6 BUG
                flag = true;
            } else if ($select.val() && $select.val() != this.options.selection) {
                this.options.selection = $select.val();
                flag = true;
            }
            if (flag) {
                this.updateContainer();
                var srsCode = self.options.selection,
                    wgs84 = self.wgs84();
                self.transform({wgs84: wgs84});
                self.setConvergence();
                if (originalSelection !== srsCode) {
                    self._trigger('.'+self.options.target+'.selection_changed', null, {
                        wgs84: wgs84,
                        srsCode: srsCode
                    });
                }
            }
            return this.options.selection;
        },
        projection: function() {
            return this._getProjection(this.selection());
        },
        _pushPull: function(key, value) {
            var returnedValue;
            if (!this._widget) {
                return null;
            }
            returnedValue = this._widget[key](value);
            if (this.options.hasOwnProperty(key)) {
                this.options[key] = returnedValue;
            }
            return returnedValue;
        },
        value: function(value) {
            if (value !== undefined) {
                if (!this.options.csv && $.type(value) !== 'object' || this.options.csv && $.type(value) !== 'array') {
                    throw 'Invalid type';
                }
            }
            return this._pushPull('value', value);
        },
        wgs84: function(value) {
            if (value !== undefined && JSON.stringify(this.options.wgs84) !== JSON.stringify(value)) {
                this._pushPull('wgs84', value);
                this._trigger('.'+this.options.target+'.wgs84_changed', null, {wgs84:value});
                this.setConvergence();
            }
            return this.options.wgs84;
        },
        convergence: function(value) {
            this._pushPull('convergence', value);
            if (value !== undefined) {
                var wgs84 = this.wgs84();
                this._trigger('.'+this.options.target+'.convergence_changed', null, {wgs84:wgs84});
            }
            return this.options.convergence;
        },
        setConvergence: function() {
            if (this._widget && $.type(this._widget.convergence()) !== 'null') {
                var convergence,
                    wgs84 = this.wgs84()[0],
                    projection = new proj4.Proj(this.projection().defData),
                    long0 = this._widget.zone ? null : projection.long0 || null;
                convergence = _computeConvergence(projection.a, projection.b, long0, wgs84);
                this.convergence(convergence);
            }
        },
        csv: function(enable) {
            if (enable !== undefined) {
                this.value();
                this.options.csv = !!enable;
                this.updateContainer();
            }
            return this.options.csv;
        },
        hint: function(value) {
            return this._pushPull('hint', value);
        },
        toggle: function(enable) {
            return this._pushPull('toggle', enable);
        },
        readOnly: function() {
            return this.options.readOnly;
        },
        _formatCoordinates: function(coordinates) {
            var coordinatesArray,
                whiteList = ['array', 'object'];
            if ($.inArray($.type(coordinates), whiteList) < 0) {
                throw 'Wrong data type';
            }
            coordinatesArray = $.type(coordinates) === 'array' ? coordinates : [coordinates];
            return coordinatesArray;
        },
        _setupInputProjection: function(projection, wgs84, fromPivot, value) {
            var parameters = fromPivot ? {z:_getUTMZone(wgs84.x),h:getHemisphere(wgs84.y)} : value,
                defData = projection.defData;
            defData = defData.replace(/\+zone=[^\s]+/ig, "+zone=" + parameters.z);
            defData = defData.replace("+south", "");
            defData += parameters.h === "s" ? " +south" : "";
            return new proj4.Proj(defData);
        },
        _isValidPoint: function(point, isConnector) {
            var isValid = 1;
            isValid &= $.type(point) === 'object';
            isValid &= point.hasOwnProperty('x');
            if (isConnector) {
                isValid &= point.x.indexOf(_INPUT_ERROR_MESSAGE) < 0;
            } else {
                isValid &= point.hasOwnProperty('y');
                isValid &= $.type(point.x) === 'number' && !isNaN(point.x);
                isValid &= $.type(point.y) === 'number' && !isNaN(point.y);
            }
            return !!isValid;
        },
        _getConnector: function() {
            var connectorName = this.selection();
            if (!window.hasOwnProperty(connectorName)) {
                $.ajax({
                    url: '/js/connectors/' + connectorName + '.js',
                    async: false,
                    cache: true,
                    dataType: 'script'
                });
            }
            return window[connectorName].getInstance(App.context);
        },
        transform: function(data) {
            var coordinates, pointsA, originalProjection, projections,
                self = this,
                pointsB = [],
                wgs84Array = [],
                fromPivot = data.hasOwnProperty('wgs84'),
                value = this.value(),
                pivotProjection = proj4.WGS84,
                inputProjection = this.projection(),
                inputIsUtm = inputProjection.defData.indexOf('+proj=utm') > -1,
                getPivotProjection = function() {return $.extend({isConnector: pivotProjection.isConnector}, new proj4.Proj(pivotProjection.defData));},
                getInputProjection = function() {return inputIsUtm ? self._setupInputProjection.apply(self, arguments) : $.extend({isConnector: inputProjection.isConnector}, new proj4.Proj(inputProjection.defData));},
                pivotProjectionObject = {type: 'pivot', getProjection: getPivotProjection},
                inputProjectionObject = {type: 'input', getProjection: getInputProjection};
            if (!(fromPivot || data.hasOwnProperty('input'))) {
                throw 'Wrong data format';
            }
            this.toggleLoading(true);
            var dataValue = fromPivot ? data.wgs84 : data.input;
            if (fromPivot && dataValue) {
                this.wgs84(dataValue);
            }
            if (fromPivot) {
                coordinates = dataValue || this.wgs84();
                projections = {A: pivotProjectionObject, B: inputProjectionObject};
            } else {
                coordinates = dataValue || value;
                projections = {A: inputProjectionObject, B: pivotProjectionObject};
                originalProjection = this._widget.options.originalProjection;
            }
            pointsA = this._formatCoordinates(coordinates);
            $.each(pointsA, function(index, pointA) {
                var pointB = {},
                    wgs84 = self.wgs84()[index],
                    thisValue = $.type(value) === 'array' ? value[index] : value,
                    projectionA = projections.A.getProjection(inputProjection, wgs84, fromPivot, thisValue),
                    projectionB = projections.B.getProjection(inputProjection, wgs84, fromPivot, thisValue),
                    AIsConnector = originalProjection === 'connector' || !fromPivot && projectionA.isConnector,
                    BIsConnector = fromPivot && projectionB.isConnector,
                    areConnectors = AIsConnector || BIsConnector;
                if (!self._isValidPoint(pointA, AIsConnector) || fromPivot && wgs84.error) {
                    wgs84Array.push({x:0,y:0,error:true});
                    pointsB.push(_INPUT_ERROR_MESSAGE + (index+1));
                } else {
                    var connector;
                    if (areConnectors) {
                        connector = self._getConnector();
                    }
                    if (areConnectors && fromPivot) {
                        pointB[projections.B.type] = connector.forward(pointA);
                    } else {
                        if (areConnectors) {
                            pointA = connector.inverse(pointA);
                        }
                        pointB[projections.B.type] = proj4(projectionA, projectionB, $.extend({}, pointA));
                    }
                    pointB[projections.A.type] = $.extend({}, pointA);
                    wgs84Array.push({x:pointB.pivot.x, y:pointB.pivot.y});
                    pointsB.push({x:pointB.input.x, y:pointB.input.y});
                }
            });
            if (!this.csv()) {
                pointsB = pointsB[0];
            }
            if (fromPivot) {
                this.value(pointsB);
            } else {
                this.wgs84(wgs84Array);
            }
            this.toggleLoading(false);
            return this.wgs84();
        },
        _setOption: function(key, value) {
            return this._superApply(arguments);
        },
        _destroy: function() {
            this._unload();
            return this._super();
        }
    });
    //endregion

    //region FieldSet widgets
    $.widget('twcc.fieldSet', {
        options: {
            srsCode: null,
            value: {},
            units: {},
            target: null,
            wrapper: {
                set: ['<div>', {class:'table'}],
                geoField: ['<div>', {class: 'row'}],
                geoCaption: ['<div>', {class: 'caption'}]
            },
            readOnly: false,
            geoFields: {},
            geoFieldsIndex: 0,
            wgs84: null
        },
        _create: function() {
            var geoFieldsOptions,
                $set = $.apply(null, this.options.wrapper.set);
            geoFieldsOptions = this._getGeoFieldsOptions();
            this._setDefaultsGeoFieldsOptions(geoFieldsOptions);
            this._buildGeoFields($set, geoFieldsOptions);
            this._setFieldsHandlers();
            this.element.append($set);
        },
        _setFieldsHandlers: function() {
            //Do not remove
        },
        _setDefaultsGeoFieldsOptions: function(obj) {
            var self = this;
            $.each(obj, function(key, geoFieldOption) {
                var params = {
                    name: self.options.srsCode+'_'+self.options.target,
                    readOnly: self.options.readOnly,
                    unit: self.options.units,
                    target: self.options.target,
                    value: self.options.value[geoFieldOption.options.axis]
                };
                obj[key].options = $.extend(params, obj[key].options);
            });
        },
        _buildGeoField: function($container, key, type, options) {
            var $geoField,
                index = this.options.geoFieldsIndex++;
            if (type.indexOf('Switch') >= 0 || type.indexOf('connector') >= 0) {
                $geoField = $.apply(null, this.options.wrapper.geoCaption);
            } else {
                $geoField = $.apply(null, this.options.wrapper.geoField);
            }
            this.options.geoFields[index] = $geoField[type](options);
            $container.append($geoField);
        },
        _buildGeoFields: function($container, geoFieldsOptions) {
            var self = this;
            $.each(geoFieldsOptions, function(key, obj) {
                self._buildGeoField($container, key, obj.type, obj.options);
            });
        },
        _getGeoFieldsOptions: function() {
            return {};
        },
        _getConvergenceIcon: function() {
            return '<img src="'+App.system.dirWsImages+'GN_'+this.options.target+'.png" alt="">';
        },
        convergence: function() {
            return null;
        },
        hint: function() {
            return null;
        },
        wgs84: function(value) {
            if (value === undefined) {
                return this._getWgs84();
            } else {
                return this._setWgs84(value);
            }
        },
        _getWgs84: function() {
            return this.options.wgs84;
        },
        _setWgs84: function(value) {
            this.options.wgs84 = value;
            return this.options.wgs84;
        },
        value: function(value) {
            if (value === undefined) {
                this.options.value = this._getValue();
            } else {
                this.options.value = this._setValue(value);
            }
            this._setToStringMethod();
            return this.options.value;
        },
        _getValue: function() {
            return this.options.value;
        },
        _setValue: function(value) {
            this.options.value = value;
        },
        _setToStringMethod: function() {
            var self = this;
            this.options.value.toString = function() {
                return self._getStringValue();
            };
        },
        _getStringValue: function() {
            return "";
        },
        toggle: function(enable) {
            enable = enable === undefined ? this.options.readOnly : !!enable;
            this.options.readOnly = this._toggle(enable);
            return this.options.readOnly;
        },
        readOnly: function() {
            return this.options.readOnly;
        },
        _toggle: function(enable) {
            return !enable;
        },
        _setOption: function(key, value) {
            return this._superApply(arguments);
        },
        _destroy: function() {
            this.element.empty();
            return this._super();
        }
    });

    $.widget('twcc.connectorFieldSet', $.twcc.fieldSet, {
        options: {
            options: {},
            geoFields: {},
            value: {}
        },
        _getGeoFieldsOptions: function() {
            return [{
                type: 'connectorGeoField',
                options: {
                    axis: 'x'
                }
            }];
        },
        _getValue: function() {
            return {
                x: this.options.geoFields[0].connectorGeoField('value')
            };
        },
        _setValue: function(value) {
            return {
                x: this.options.geoFields[0].connectorGeoField('value', value.x)
            };
        },
        _toggle: function(enable) {
            return this.options.geoFields[0].connectorGeoField('toggle', enable);
        },
        _getStringValue: function() {
            return this.options.geoFields[0].connectorGeoField('value');
        }
    });

    $.widget('twcc.csvFieldSet', $.twcc.fieldSet, {
        options: {
            labels: {},
            units: {},
            options: {},
            geoFields: {},
            value: [],
            hint: '',
            wgs84: [],
            originalProjection: null
        },
        _getGeoFieldsOptions: function() {
            return [
                {
                    type: 'csvGeoField',
                    options: {
                        value: this._toString(this.options.value),
                        label: this.options.labels.csv
                    }
                },
                {
                    type: 'labelGeoField',
                    options: {
                        value: this.options.hint,
                        label: this.options.labels.l

                    }
                }
            ];
        },
        _getValue: function() {
            return this._fromString(this.options.geoFields[0].csvGeoField('value'));
        },
        _setValue: function(value) {
            return this._fromString(this.options.geoFields[0].csvGeoField('value', this._toString(value)));
        },
        _fromString: function(value) {
            var array = value.split("\n"),
                self = this;
            $.each(array, function(index, coordinatesString) {
                var subArray = coordinatesString.split(',');
                switch (self.options.originalProjection) {
                    case 'utm':
                        array[index] = {
                            h: subArray[0],
                            z: +subArray[1],
                            x: +subArray[2],
                            y: +subArray[3]
                        };
                        break;
                    case 'connector':
                        array[index] = {
                            x: subArray[0],
                            y: subArray[1]
                        };
                        break;
                    default:
                        array[index] = {
                            x: +subArray[0],
                            y: +subArray[1]
                        };
                }
            });
            return array;
        },
        _toString: function(value) {
            var array = [],
                self = this;
            if ($.type(value) !== 'array') {
                throw 'Invalid type';
            }
            $.each(value, function(index, obj) {
                var wgs84 = self.wgs84()[index];
                if (wgs84.error) {
                    array.push(obj.toString());
                } else {
                    if (self.options.originalProjection == 'utm') {
                        var hemisphere = obj.h || getHemisphere(wgs84.y),
                            zone = obj.z || _getUTMZone(wgs84.x);
                        array.push(hemisphere+','+zone+','+obj.x+','+obj.y);
                    } else {
                        array.push(obj.x+','+obj.y);
                    }
                }
            });
            return array.join("\n");
        },
        originalProjection: function(proj) {
            if (proj === undefined) {
                return this.options.originalProjection;
            } else {
                this.options.originalProjection = proj;
            }
        },
        hint: function(hint) {
            if (hint === undefined) {
                this.options.hint = this.options.geoFields[1].labelGeoField('value');
                return this.options.hint;
            } else {
                this.options.hint = hint;
                this.options.geoFields[1].labelGeoField('value', this.options.hint);
            }
        },
        _toggle: function(enable) {
            this.options.geoFields[0].csvGeoField('toggle', enable);
            return this.options.geoFields[1].labelGeoField('toggle', enable);
        },
        _getStringValue: function() {
            return this.options.hint + '\n' + this.options.geoFields[0].csvGeoField('value');
        }
    });

    $.widget('twcc.utmFieldSet', $.twcc.fieldSet, {
        options: {
            labels: {},
            options: {},
            geoFields: {},
            lengthUnit: 'm',
            value: {},
            convergence: 0,
            wgs84: []
        },
        _getGeoFieldsOptions: function() {
            return [
                {
                    type: 'hemisphereGeoField',
                    options: {
                        label: this.options.labels.h,
                        options: this.options.options.h,
                        axis: 'h'
                    }
                },
                {
                    type: 'zoneGeoField',
                    options: {
                        label: this.options.labels.z,
                        options: this.options.options.z,
                        axis: 'z'
                    }
                },
                {
                    type: 'xyGeoField',
                    options: {
                        label: this.options.labels.x,
                        lengthUnit: this.options.lengthUnit,
                        axis: 'x'
                    }
                },
                {
                    type: 'xyGeoField',
                    options: {
                        label: this.options.labels.y,
                        lengthUnit: this.options.lengthUnit,
                        axis: 'y'
                    }
                },
                {
                    type: 'convergenceGeoField',
                    options: {
                        value: this.options.convergence,
                        label: this.options.labels.convergence,
                        icon: this._getConvergenceIcon()
                    }
                },
                {
                    type: 'lengthSwitchGeoField',
                    options: {
                        value: this.options.lengthUnit,
                        unit: this.options.options.u
                    }
                }
            ];
        },
        _setFieldsHandlers: function() {
            var self = this;
            this._super();
            this.element.on('lengthswitchgeofield.update_display', function(event, response) {
                self.options.lengthUnit = self.unit(response.value);
            });
        },
        _getValue: function() {
            return {
                h: this.hemisphere(),
                z: this.zone(),
                x: this.options.geoFields[2].xyGeoField('value'),
                y: this.options.geoFields[3].xyGeoField('value')
            };
        },
        _setValue: function(value) {
            var wgs84 = this._getWgs84()[0];
            if (!value.h || !value.z) {
                $.extend(value, {
                    y: Math.abs(value.y),
                    h: getHemisphere(wgs84.y),
                    z: _getUTMZone(wgs84.x)
                });
            }
            return {
                h: this.hemisphere(value.h),
                z: this.zone(value.z),
                x: this.options.geoFields[2].xyGeoField('value', value.x),
                y: this.options.geoFields[3].xyGeoField('value', value.y)
            };
        },
        unit: function(lengthUnit) {
            if (lengthUnit === undefined) {
                this.options.lengthUnit = this.options.geoFields[2].xyGeoField('unit');
            } else {
                this.options.geoFields[2].xyGeoField('unit', lengthUnit);
                this.options.geoFields[3].xyGeoField('unit', lengthUnit);
                this.options.lengthUnit = this.options.geoFields[5].lengthSwitchGeoField('value', lengthUnit);
            }
            return this.options.lengthUnit;
        },
        convergence: function(value) {
            if (value === undefined) {
                this.options.convergence = this.options.geoFields[4].convergenceGeoField('value');
            } else {
                this.options.convergence = this.options.geoFields[4].convergenceGeoField('value', value);
            }
            return this.options.convergence;
        },
        zone: function(value) {
            if (value === undefined) {
                this.options.value.z = this.options.geoFields[1].zoneGeoField('value');
            } else {
                this.options.value.z = this.options.geoFields[1].zoneGeoField('value', value);
            }
            return this.options.value.z;
        },
        hemisphere: function(value) {
            if (value === undefined) {
                this.options.value.h = this.options.geoFields[0].hemisphereGeoField('value');
            } else {
                this.options.value.h = this.options.geoFields[0].hemisphereGeoField('value', value);
            }
            return this.options.value.h;
        },
        _toggle: function(enable) {
            this.options.geoFields[0].hemisphereGeoField('toggle', enable);
            this.options.geoFields[1].zoneGeoField('toggle', enable);
            this.options.geoFields[2].xyGeoField('toggle', enable);
            this.options.geoFields[3].xyGeoField('toggle', enable);
            return this.options.geoFields[5].lengthSwitchGeoField('toggle', enable);
        },
        _getStringValue: function() {
            var geoFields = this.options.geoFields;
            return geoFields[2].xyGeoField('getStringValue')+', '+geoFields[3].xyGeoField('getStringValue')+' '+geoFields[1].zoneGeoField('value')+geoFields[0].hemisphereGeoField('value');
        }
    });

    $.widget('twcc.cartesianFieldSet', $.twcc.fieldSet, {
        options: {
            labels: {},
            options: {},
            geoFields: {},
            lengthUnit: 'm',
            value: {},
            convergence: 0
        },
        _getGeoFieldsOptions: function() {
            return [
                {
                    type: 'xyGeoField',
                    options: {
                        label: this.options.labels.x,
                        lengthUnit: this.options.lengthUnit,
                        axis: 'x'
                    }
                },
                {
                    type: 'xyGeoField',
                    options: {
                        label: this.options.labels.y,
                        lengthUnit: this.options.lengthUnit,
                        axis: 'y'
                    }
                },
                {
                    type: 'convergenceGeoField',
                    options: {
                        value: this.options.convergence,
                        label: this.options.labels.convergence,
                        icon: this._getConvergenceIcon()
                    }
                },
                {
                    type: 'lengthSwitchGeoField',
                    options: {
                        value: this.options.lengthUnit,
                        unit: this.options.options.u
                    }
                }
            ];
        },
        _setFieldsHandlers: function() {
            var self = this;
            this._super();
            this.element.on('lengthswitchgeofield.update_display', function(event, response) {
                self.options.lengthUnit = self.unit(response.value);
            });
        },
        _getValue: function() {
            return {
                x: this.options.geoFields[0].xyGeoField('value'),
                y: this.options.geoFields[1].xyGeoField('value')
            };
        },
        _setValue: function(value) {
            return {
                x: this.options.geoFields[0].xyGeoField('value', value.x),
                y: this.options.geoFields[1].xyGeoField('value', value.y)
            };
        },
        unit: function(lengthUnit) {
            if (lengthUnit === undefined) {
                this.options.lengthUnit = this.options.geoFields[0].xyGeoField('unit');
            } else {
                this.options.geoFields[0].xyGeoField('unit', lengthUnit);
                this.options.geoFields[1].xyGeoField('unit', lengthUnit);
                this.options.lengthUnit = this.options.geoFields[3].lengthSwitchGeoField('value', lengthUnit);
            }
            return this.options.lengthUnit;
        },
        convergence: function(value) {
            if (value === undefined) {
                this.options.convergence = this.options.geoFields[2].convergenceGeoField('value');
            } else {
                this.options.convergence = this.options.geoFields[2].convergenceGeoField('value', value);
            }
            return this.options.convergence;
        },
        _toggle: function(enable) {
            this.options.geoFields[0].xyGeoField('toggle', enable);
            this.options.geoFields[1].xyGeoField('toggle', enable);
            return this.options.geoFields[3].lengthSwitchGeoField('toggle', enable);
        },
        _getStringValue: function() {
            var geoFields = this.options.geoFields;
            return geoFields[0].xyGeoField('getStringValue')+', '+geoFields[1].xyGeoField('getStringValue');
        }
    });

    $.widget('twcc.sphericalDdFieldSet', $.twcc.fieldSet, {
        options: {
            labels: {},
            options: {},
            geoFields: {},
            value: {}
        },
        _getGeoFieldsOptions: function() {
            return [
                {
                    type: 'ddGeoField',
                    options: {
                        unit: this.options.units.y,
                        label: this.options.labels.y,
                        axis: 'y'
                    }
                },
                {
                    type: 'ddGeoField',
                    options: {
                        unit: this.options.units.x,
                        label: this.options.labels.x,
                        axis: 'x'
                    }
                },
                {
                    type: 'angleSwitchGeoField',
                    options: {
                        value: 'dd',
                        unit: this.options.options.o
                    }
                }
            ];
        },
        _getValue: function() {
            return {
                x: this.options.geoFields[1].ddGeoField('value'),
                y: this.options.geoFields[0].ddGeoField('value')
            };
        },
        _setValue: function(value) {
            return {
                x: this.options.geoFields[1].ddGeoField('value', value.x),
                y: this.options.geoFields[0].ddGeoField('value', value.y)
            };
        },
        _toggle: function(enable) {
            this.options.geoFields[0].ddGeoField('toggle', enable);
            this.options.geoFields[1].ddGeoField('toggle', enable);
            return this.options.geoFields[2].angleSwitchGeoField('toggle', enable);
        },
        _getStringValue: function() {
            var geoFields = this.options.geoFields;
            return geoFields[0].ddGeoField('getStringValue')+', '+geoFields[1].ddGeoField('getStringValue');
        }
    });

    $.widget('twcc.sphericalDmFieldSet', $.twcc.fieldSet, {
        options: {
            labels: {},
            options: {},
            geoFields: {},
            value: {}
        },
        _getGeoFieldsOptions: function() {
            return [
                {
                    type: 'dmGeoField',
                    options: {
                        label: this.options.labels.y,
                        options: this.options.options.y,
                        axis: 'y'
                    }
                },
                {
                    type: 'dmGeoField',
                    options: {
                        label: this.options.labels.x,
                        options: this.options.options.x,
                        axis: 'x'
                    }
                },
                {
                    type: 'angleSwitchGeoField',
                    options: {
                        value: 'dm',
                        unit: this.options.options.o
                    }
                }
            ];
        },
        _getValue: function() {
            return {
                x: this.options.geoFields[1].dmGeoField('value'),
                y: this.options.geoFields[0].dmGeoField('value')
            };
        },
        _setValue: function(value) {
            return {
                x: this.options.geoFields[1].dmGeoField('value', value.x),
                y: this.options.geoFields[0].dmGeoField('value', value.y)
            };
        },
        _toggle: function(enable) {
            this.options.geoFields[0].dmGeoField('toggle', enable);
            this.options.geoFields[1].dmGeoField('toggle', enable);
            return this.options.geoFields[2].angleSwitchGeoField('toggle', enable);
        },
        _getStringValue: function() {
            var geoFields = this.options.geoFields;
            return geoFields[0].dmGeoField('getStringValue')+', '+geoFields[1].dmGeoField('getStringValue');
        }
    });

    $.widget('twcc.sphericalDmsFieldSet', $.twcc.fieldSet, {
        options: {
            labels: {},
            options: {},
            geoFields: {},
            value: {}
        },
        _getGeoFieldsOptions: function() {
            return [
                {
                    type: 'dmsGeoField',
                    options: {
                        label: this.options.labels.y,
                        options: this.options.options.y,
                        axis: 'y'
                    }
                },
                {
                    type: 'dmsGeoField',
                    options: {
                        label: this.options.labels.x,
                        options: this.options.options.x,
                        axis: 'x'
                    }
                },
                {
                    type: 'angleSwitchGeoField',
                    options: {
                        value: 'dms',
                        unit: this.options.options.o
                    }
                }
            ];
        },
        _getValue: function() {
            return {
                x: this.options.geoFields[1].dmsGeoField('value'),
                y: this.options.geoFields[0].dmsGeoField('value')
            };
        },
        _setValue: function(value) {
            return {
                x: this.options.geoFields[1].dmsGeoField('value', value.x),
                y: this.options.geoFields[0].dmsGeoField('value', value.y)
            };
        },
        _toggle: function(enable) {
            this.options.geoFields[0].dmsGeoField('toggle', enable);
            this.options.geoFields[1].dmsGeoField('toggle', enable);
            return this.options.geoFields[2].angleSwitchGeoField('toggle', enable);
        },
        _getStringValue: function() {
            var geoFields = this.options.geoFields;
            return geoFields[0].dmsGeoField('getStringValue')+', '+geoFields[1].dmsGeoField('getStringValue');
        }
    });
    //endregion

    //region Geo Field widgets
    $.widget('twcc.geoField', {
        options: {
            name: null,
            unit: null,
            label: null,
            readOnly: false,
            lengthUnit: 'm',
            glue: '_',
            wrapper: {
                field: ['<span>'],
                fields: ['<div>', {class: 'cell fields'}],
                label: ['<div>', {class: 'cell label'}],
                options: ['<div>', {class: 'fields'}]
            },
            attributes: {},
            fields: {},
            icon: ''
        },
        _create: function() {
            var $cell, fieldsOptions,
                self = this;
            $.each(this.options.attributes, function(key) {
                var params = {
                    disabled: self.options.readOnly,
                    readonly: self.options.readOnly
                };
                self.options.attributes[key] = $.extend(params, self.options.attributes[key]);
            });
            $cell = this._getEmptyFieldCell();
            fieldsOptions = this._getFieldsOptions();
            this._setDefaultsFieldsOptions(fieldsOptions);
            $.each(fieldsOptions, function(name, fieldOptions) {
                var $field = self._buildField(name, fieldOptions);
                self._setFieldHandlers($field);
                $field.append(self._getFieldSetUnit(name));
                $field.append('&nbsp;');
                $cell.append($field);
            });
            this._appendLabelCell();
            this.element.append($cell);
        },
        _getFieldSetUnit: function(name) {
            return this.options.unit[name];
        },
        _setFieldHandlers: function() {
            //Do not remove
        },
        _clean: function(value, precision) {
            return this._superClean(value, precision);
        },
        _superClean: function(value, precision) {
            return isNaN(value) || value === null ? '' : App.math.round(value, precision || 0);
        },
        _buildField: function(name, fieldOptions) {
            this.options.fields[name] = $.apply(null, this.options.wrapper.field).field(fieldOptions);
            return this.options.fields[name];
        },
        _appendLabelCell: function() {
            var $label, $cell,
                id = this._getForId();
            if (id) {
                $label = $('<label>', {for: id}).html(this.options.icon + this.options.label);
            } else {
                $label = this.options.icon + this.options.label;
            }
            $cell = $.apply(null, this.options.wrapper.label).append($label);
            this.element.append($cell);
        },
        _getForId: function() {
            //Do not remove
        },
        _getEmptyFieldCell: function() {
            return $.apply(null, this.options.wrapper.fields);
        },
        _getFieldsOptions: function() {
            return {};
        },
        _setDefaultsFieldsOptions: function(obj) {
            var self = this;
            $.each(obj, function(key) {
                var params = {
                    name: self.options.name + self.options.glue + key,
                    attributes: self.options.attributes[key],
                    value: self._clean(self.options.value)
                };
                obj[key] = $.extend(params, obj[key]);
            });
        },
        value: function(value) {
            if (value === undefined) {
                this.options.value = this._constraint(this._getRawValue());
            } else {
                this.options.value = this._setValue(this._clean(value));
            }
            return this.options.value;
        },
        toggle: function(enable) {
            enable = enable === undefined ? this.options.readOnly : !!enable;
            this.options.readOnly = this._toggle(enable);
            return this.options.readOnly;
        },
        readOnly: function() {
            return this.options.readOnly;
        },
        _toggle: function(enable) {
            var self = this;
            $.each(this.options.fields, function(name, $field) {
                var fieldOptions = self._getFieldsOptions()[name];
                self._toggleField($field, enable, fieldOptions);
            });
            return !enable;
        },
        _toggleField: function($field, enable) {
            $field.field('toggle', enable);
        },
        _getRawValue: function() {
            return this.options.value;
        },
        getStringValue: function() {
            return this.options.value;
        },
        _constraint: function(value) {
            return value;
        },
        _setValue: function(value) {
            this.options.value = value;
        },
        _setOption: function(key, value) {
            this.options[key] = value;
            this._update();
        },
        _update: function() {
            this._destroy();
            this._create();
        },
        _destroy: function() {
            this.element.empty();
            return this._super();
        }
    });

    $.widget('twcc.ddGeoField', $.twcc.geoField, {
        options: {
            value: 0,
            attributes: {
                DD: {size: '20', class: 'width_5'}
            }
        },
        _getFieldsOptions: function() {
            return {
                DD: {
                    type: 'text'
                }
            };
        },
        _getForId: function() {
            return this.options.fields.DD.field('id');
        },
        _getRawValue: function() {
            return App.math.parseFloat(this.options.fields.DD.field('value'));
        },
        getStringValue: function() {
            return this.options.value + this._getFieldSetUnit('DD');
        },
        _setValue: function(value) {
            return this.options.fields.DD.field('value', value);
        },
        _constraint: function(value) {
            var max = this.options.axis === 'y' ? Math.atan(Math.sinh(Math.PI))*180/Math.PI : 180,
                min = -max;
            value = Math.max(value, min);
            value = Math.min(value, max);
            return value;
        },
        _clean: function(value) {
            return this._constraint(this._super(value, 15));
        }
    });

    $.widget('twcc.dmGeoField', $.twcc.ddGeoField, {
        options: {
            value: 0,
            options: {},
            attributes: {
                C: {size: '1'},
                D: {size: '4', class: 'width_1'},
                M: {size: '6', class: 'width_3'}
            }
        },
        _buildField: function(name, fieldOptions) {
            if (fieldOptions.type === 'option') {
                this.options.fields[name] = $.apply(null, this.options.wrapper.field).optionField(fieldOptions);
                return this.options.fields[name];
            } else {
                return this._superApply(arguments);
            }
        },
        _getFieldsOptions: function() {
            var value = this._clean(this.options.value);
            return {
                C: {
                    type: 'option',
                    value: value.C || '',
                    options: this.options.options
                },
                D: {
                    type: 'text',
                    value: this._superClean(value.D)
                },
                M: {
                    type: 'text',
                    value: this._superClean(value.M, 12)
                }
            };
        },
        _getForId: function() {
            return this.options.fields.D.field('id');
        },
        _getFieldSetUnit: function(name) {
            if (name != 'C') {
                return this._superApply(arguments);
            } else {
                return '';
            }
        },
        _getObjectValue: function() {
            return {
                C: this.options.fields.C.optionField('value'),
                D: App.math.parseFloat(this.options.fields.D.field('value')),
                M: App.math.parseFloat(this.options.fields.M.field('value'))
            };
        },
        value: function(value) {
            if (value === undefined) {
                this._clean(_dmToDd(this._getObjectValue()));
            } else {
                value = this._clean(value);
                this.options.fields.C.optionField('value', value.C || '');
                this.options.fields.D.field('value', this._superClean(value.D));
                this.options.fields.M.field('value', this._superClean(value.M, 12));
            }
            return this.options.value;
        },
        getStringValue: function() {
            var objectValue = this._getObjectValue();
            return objectValue.D + this._getFieldSetUnit('D') +
                objectValue.M + this._getFieldSetUnit('M') +
                objectValue.C;
        },
        _clean: function(ddValue) {
            this.options.value = this._constraint(ddValue);
            return _ddToDm(this.options.value, this.options.options);
        },
        _toggleField: function($field, enable, fieldOptions) {
            if (fieldOptions.type === 'option') {
                return $field.optionField('toggle', enable);
            } else {
                return this._superApply(arguments);
            }
        }
    });

    $.widget('twcc.dmsGeoField', $.twcc.dmGeoField, {
        options: {
            value: 0,
            options: {},
            attributes: {
                C: {size: '1'},
                D: {size: '4', class: 'width_1'},
                M: {size: '4', class: 'width_1'},
                S: {size: '6', class: 'width_3'}
            }
        },
        _getFieldsOptions: function() {
            var value = this._clean(this.options.value);
            return {
                C: {
                    type: 'option',
                    value: value.C || '',
                    options: this.options.options
                },
                D: {
                    type: 'text',
                    value: this._superClean(value.D)
                },
                M: {
                    type: 'text',
                    value: this._superClean(value.M)
                },
                S: {
                    type: 'text',
                    value: this._superClean(value.S, 12)
                }
            };
        },
        _getObjectValue: function() {
            return {
                C: this.options.fields.C.optionField('value'),
                D: App.math.parseFloat(this.options.fields.D.field('value')),
                M: App.math.parseFloat(this.options.fields.M.field('value')),
                S: App.math.parseFloat(this.options.fields.S.field('value'))
            };
        },
        value: function(value) {
            if (value === undefined) {
                this._clean(_dmsToDd(this._getObjectValue()));
            } else {
                value = this._clean(value);
                this.options.fields.C.optionField('value', value.C || '');
                this.options.fields.D.field('value', this._superClean(value.D));
                this.options.fields.M.field('value', this._superClean(value.M));
                this.options.fields.S.field('value', this._superClean(value.S, 12));
            }
            return this.options.value;
        },
        getStringValue: function() {
            var objectValue = this._getObjectValue();
            return objectValue.D + this._getFieldSetUnit('D') +
                objectValue.M + this._getFieldSetUnit('M') +
                objectValue.S + this._getFieldSetUnit('S') +
                objectValue.C;
        },
        _clean: function(ddValue) {
            this.options.value = this._constraint(ddValue);
            return _ddToDms(this.options.value, this.options.options);
        }
    });

    $.widget('twcc.switchGeoField', $.twcc.geoField, {
        _clean: function(value) {
            return this._constraint(value);
        },
        _setFieldHandlers: function($field) {
            var self = this;
            $field.find(':first-child').click(function(event) {
                self._trigger('.update_display', event, {value:self.value()});
            });
        },
        _appendLabelCell: function() {
            //Do not remove
        },
        _getEmptyFieldCell: function() {
            return $.apply(null, this.options.wrapper.options);
        },
        _setDefaultsFieldsOptions: function() {
            //Do not remove
        },
        _getRawValue: function() {
            return $('input:radio:checked', this.element).val();
        },
        _setValue: function(value) {
            this.element.find('input:radio[value="'+value+'"]').prop('checked', true);
            return value;
        },
        _getForId: function(name) {
            return this.options.fields[name].field('id');
        },
        _getFieldSetUnit: function(name) {
            var unit = this._superApply(arguments),
                id = this._getForId(name);
            return $('<label>', {for: id}).append(unit);
        }
    });

    $.widget('twcc.angleSwitchGeoField', $.twcc.switchGeoField, {
        options: {
            value: 'dd'
        },
        _getFieldsOptions: function() {
            this.options.value = this._clean(this.options.value);
            var name = this.options.name + '_DMS_DM_DD',
                value = this.options.value,
                isDD = value === 'dd',
                isDm = value === 'dm',
                isDms = !isDD && !isDm;
            return {
                _DMS: {
                    name: name,
                    type: 'radio',
                    value: 'dms',
                    attributes: {
                        checked: isDms
                    }
                },
                _DM: {
                    name: name,
                    type: 'radio',
                    value: 'dm',
                    attributes: {
                        checked: isDm
                    }
                },
                _DD: {
                    name: name,
                    type: 'radio',
                    value: 'dd',
                    attributes: {
                        checked: isDD
                    }
                }
            };
        },
        _constraint: function(value) {
            return $.inArray(value, ['dms', 'dm', 'dd']) < 0 ? 'dms' : value;
        }
    });

    $.widget('twcc.lengthSwitchGeoField', $.twcc.switchGeoField, {
        options: {
            value: 'm'
        },
        _getFieldsOptions: function() {
            this.options.value = this._clean(this.options.value);
            var name = this.options.name + '_M_KM_F',
                value = this.options.value,
                isKm = value === 'km',
                isFt = value === 'us-ft',
                isM = !isKm && !isFt;
            return {
                _M: {
                    name: name,
                    type: 'radio',
                    value: 'm',
                    attributes: {
                        checked: isM
                    }
                },
                _KM: {
                    name: name,
                    type: 'radio',
                    value: 'km',
                    attributes: {
                        checked: isKm
                    }
                },
                _F: {
                    name: name,
                    type: 'radio',
                    value: 'us-ft',
                    attributes: {
                        checked: isFt
                    }
                }
            };
        },
        _constraint: function(value) {
            return $.inArray(value, ['m', 'km', 'us-ft']) < 0 ? 'm' : value;
        }
    });

    $.widget('twcc.xyGeoField', $.twcc.geoField, {
        options: {
            value: 0,
            attributes: {
                XY: {size: '20', class: 'width_4'}
            }
        },
        _setFieldHandlers: function() {
            //Do not remove
        },
        _getFieldsOptions: function() {
            return {
                XY: {
                    type: 'text'
                }
            };
        },
        _getForId: function() {
            return this.options.fields.XY.field('id');
        },
        _getFieldSetUnit: function() {
            return this.options.unit.XY[this.options.lengthUnit];
        },
        _getRawValue: function() {
            return _toMeter(this.options.fields.XY.field('value'), this.options.lengthUnit);
        },
        getStringValue: function() {
            return this.options.fields.XY.field('value') + this.options.lengthUnit;
        },
        _setValue: function(value) {
            return _toMeter(this.options.fields.XY.field('value', value), this.options.lengthUnit);
        },
        _clean: function(value) {
            return this._super(_fromMeter(value, this.options.lengthUnit), this.options.lengthUnit == 'm' ? 3 : 5);
        },
        unit: function(lengthUnit) {
            if (lengthUnit !== undefined) {
                this.value();
                this.options.lengthUnit = this._cleanUnit(lengthUnit);
                this._update();
            }
            return this.options.lengthUnit;
        },
        _cleanUnit: function(value) {
            return $.inArray(value, ['m', 'km', 'us-ft']) < 0 ? 'm' : value;
        }
    });

    $.widget('twcc.zoneGeoField', $.twcc.geoField, {
        options: {
            value: 31,
            attributes: {
                Z: {size: '5', class: 'width_2'}
            }
        },
        _setFieldHandlers: function() {
            //Do not remove
        },
        _getFieldsOptions: function() {
            return {
                Z: {
                    type: 'text'
                }
            };
        },
        _getForId: function() {
            return this.options.fields.Z.field('id');
        },
        _getRawValue: function() {
            return parseInt(this.options.fields.Z.field('value'));
        },
        _setValue: function(value) {
            return this.options.fields.Z.field('value', value);
        },
        _constraint: function(value) {
            var min = 0;
            value = Math.max(value, min);
            return value;
        },
        _clean: function(value) {
            return this._constraint(this._super(value));
        }
    });

    $.widget('twcc.hemisphereGeoField', $.twcc.geoField, {
        options: {
            value: 'n',
            attributes: {
                E: {size: '1'}
            }
        },
        _setFieldHandlers: function() {
            //Do not remove
        },
        _getFieldsOptions: function() {
            return {
                E: {
                    type: 'option',
                    options: this.options.options
                }
            };
        },
        _getForId: function() {
            return this.options.fields.E.optionField('id');
        },
        _getFieldSetUnit: function() {
            //Do not remove
        },
        _buildField: function(name, fieldOptions) {
            this.options.fields[name] = $.apply(null, this.options.wrapper.field).optionField(fieldOptions);
            return this.options.fields[name];
        },
        _clean: function(value) {
            return this._constraint(value || 'n');
        },
        _getRawValue: function() {
            return this.options.fields.E.optionField('value');
        },
        _constraint: function(value) {
            return $.inArray(value, ['n', 's']) < 0 ? 'n' : value;
        },
        _setValue: function(value) {
            return this.options.fields.E.optionField('value', value);
        },
        _toggleField: function($field, enable) {
            return $field.optionField('toggle', enable);
        }
    });

    $.widget('twcc.csvGeoField', $.twcc.geoField, {
        options: {
            value: '',
            attributes: {
                CSV: {rows: '5', wrap: 'off'}
            }
        },
        _setFieldHandlers: function() {
            //Do not remove
        },
        _getFieldsOptions: function() {
            return {
                CSV: {
                    type: 'textarea'
                }
            };
        },
        _getFieldSetUnit: function() {
            return '';
        },
        _getForId: function() {
            return this.options.fields.CSV.textareaField('id');
        },
        _buildField: function(name, fieldOptions) {
            this.options.fields[name] = $.apply(null, this.options.wrapper.field).textareaField(fieldOptions);
            return this.options.fields[name];
        },
        _clean: function(value) {
            return this._constraint(value || '');
        },
        _getRawValue: function() {
            return this.options.fields.CSV.textareaField('value');
        },
        _setValue: function(value) {
            return this.options.fields.CSV.textareaField('value', value);
        },
        _toggleField: function($field, enable) {
            return $field.textareaField('toggle', enable);
        }
    });

    $.widget('twcc.convergenceGeoField', $.twcc.geoField, {
        options: {
            value: 0,
            attributes: {
                CONVERGENCE: {size: '10', class: 'width_4', readonly: true}
            }
        },
        _setFieldHandlers: function() {
            //Do not remove
        },
        _getFieldsOptions: function() {
            return {
                CONVERGENCE: {
                    type: 'text'
                }
            };
        },
        _getForId: function() {
            return this.options.fields.CONVERGENCE.field('id');
        },
        _getRawValue: function() {
            return this.options.fields.CONVERGENCE.field('value');
        },
        _constraint: function(value) {
            var max = 360,
                min = -max;
            value = Math.max(value, min);
            value = Math.min(value, max);
            return value;
        },
        _setValue: function(value) {
            return this.options.fields.CONVERGENCE.field('value', value);
        },
        _clean: function(value) {
            return this._constraint(this._super(value, 4));
        }
    });

    $.widget('twcc.connectorGeoField', $.twcc.geoField, {
        options: {
            value: ''
        },
        _setFieldHandlers: function() {
            //Do not remove
        },
        _getFieldsOptions: function() {
            return {
                XX: {type: 'text'}
            };
        },
        _appendLabelCell: function() {
            //Do not remove
        },
        _getRawValue: function() {
            return this.options.fields.XX.field('value');
        },
        _setValue: function(value) {
            return this.options.fields.XX.field('value', value);
        },
        _constraint: function(value) {
            return value;
        },
        _clean: function(value) {
            return this._constraint(value);
        }
    });

    $.widget('twcc.labelGeoField', $.twcc.geoField, {
        options: {
            value: ''
        },
        _create: function() {
            this._super();
            this.options.fields.L.text(this.options.value);
        },
        _buildField: function(name, fieldOptions) {
            this.options.fields[name] = fieldOptions;
            return this.options.fields[name];
        },
        _setFieldHandlers: function() {
            //Do not remove
        },
        _getFieldsOptions: function() {
            return {
                L: $('<span>')
            };
        },
        _getFieldSetUnit: function() {
            return '';
        },
        _getRawValue: function() {
            return this.options.fields.L.text();
        },
        _constraint: function(value) {
            return value;
        },
        _setValue: function(value) {
            this.options.fields.L.text(value);
            return value;
        },
        _clean: function(value) {
            return this._constraint(value);
        },
        _toggleField: function() {
            return this.options.readonly;
        }
    });
    //endregion

    //region Field widgets
    $.widget('twcc.field', {
        options: {
            type: null,
            value: null,
            name: null,
            glue: '_id_',
            attributes: {},
            readOnly: false
        },
        _create: function() {
            this.options.attributes = $.extend({
                val: this.options.value,
                id: this.options.name + this.options.glue + Math.floor(Math.random()*10001),
                name: this.options.name,
                disabled: this.options.readOnly,
                readonly: this.options.readOnly
            }, this.options.attributes);
            this._setTag();
        },
        _setTag: function() {
            $.extend(this.options.attributes, {type: this.options.type});
            this.element.tag({
                name: 'input',
                attributes: this.options.attributes
            });
        },
        value: function(value) {
            if (value === undefined) {
                this.options.value = this.element.tag('value');
            } else {
                this.options.value = this.element.tag('value', value);
            }
            return this.options.value;
        },
        toggle: function(enable) {
            enable = enable === undefined ? this.options.readOnly : !!enable;
            this.options.readOnly = this._toggle(enable);
            return this.options.readOnly;
        },
        _toggle: function(enable) {
            return this.element.tag('toggle', enable);
        },
        readOnly: function() {
            return this.options.readOnly;
        },
        id: function() {
            return this.options.attributes.id;
        },
        _setOption: function(key, value) {
            this.options[key] = value;
            this._update();
        },
        _update: function() {
            this._destroy();
            this._create();
        },
        _destroy: function() {
            this.element.empty();
            return this._super();
        }
    });

    $.widget('twcc.textareaField', $.twcc.field, {
        options: {
            type: 'textarea'
        },
        _setTag: function() {
            this.element.tag({
                name: 'textarea',
                attributes: this.options.attributes
            });
        }
    });

    $.widget('twcc.optionField', $.twcc.field, {
        options: {
            type: 'option',
            options: {}
        },
        _setTag: function() {
            this.element.selectTag({
                attributes: this.options.attributes,
                options: this.options.options
            });
        },
        value: function(value) {
            if (value === undefined) {
                this.options.value = this.element.selectTag('value');
            } else {
                this.options.value = this.element.selectTag('value', value);
            }
            return this.options.value;
        },
        _toggle: function(enable) {
            return this.element.selectTag('toggle', enable);
        }
    });
    //endregion

    //region Tag widgets
    $.widget('twcc.tag', {
        options: {
            name: null,
            attributes : {},
            readOnly: false
        },
        _$elt: null,
        _create: function() {
            var checked;
            if (this.options.attributes.val) {
                this.options.attributes.val = this._clean(this.options.attributes.val);
            }
            if (this.options.attributes.hasOwnProperty('checked')) {
                checked = this.options.attributes.checked;
                delete this.options.attributes.checked;
            }
            this._$elt = $('<'+this.options.name+'>', this.options.attributes);
            if (checked !== undefined) {
                this._$elt.prop('checked', checked);
            }
            this._appendChildren();
            this.value(this.options.attributes.val);
            this.element.append(this._$elt);
        },
        value: function(value) {
            if (value === undefined) {
                this.options.attributes.val = this._$elt.val();
            } else {
                this.options.attributes.val = this._clean(value);
                this._$elt.val(this.options.attributes.val);
            }
            return this.options.attributes.val;
        },
        toggle: function(enable) {
            var disable = enable === undefined ? this.options.readOnly : !enable;
            this.options.readOnly = this._toggle(disable);
            return this.options.readOnly;
        },
        _toggle: function(disable) {
            this._$elt
                .prop('disabled', disable)
                .prop('readonly', disable);
            return disable;
        },
        readOnly: function() {
            return this.options.readOnly;
        },
        _clean: function(value) {
            // Prevent scientific notation due to the Number.toString() method
            if (typeof(value) === 'number' && value.toString().split('e').length > 1) {
                value =  App.math.round(value);
            }
            return value;
        },
        _appendChildren: function() {
            //do not remove
        },
        _setOption: function(key, value) {
            this.options[key] = value;
            this._update();
        },
        _update: function() {
            this._destroy();
            this._create();
        },
        _destroy: function() {
            this._$elt.remove();
            return this._super();
        }
    });

    $.widget('twcc.selectTag', $.twcc.tag, {
        options: {
            name: 'select',
            options: {}
        },
        _$elt: null,
        _appendChildren: function() {
            var self = this;
            $.each(this.options.options, function(optVal, optText) {
                self._$elt.append($('<option>', {
                    value: optVal,
                    text: optText
                }));
            });
        }
    });
    //endregion
})(jQuery, proj4, TWCCHistory, App);
;/*
	cof2Obj.js
	Converts the WMM.COF text to a JSON object usable by geoMagFactory().
*/

function cof2Obj(cof) {
	'use strict';
	var modelLines = cof.split('\n'),
		wmm = [],
		i, vals, epoch, model, modelDate;
	for (i in modelLines) {
		if (modelLines.hasOwnProperty(i)) {
			vals = modelLines[i].replace(/^\s+|\s+$/g, "").split(/\s+/);
			if (vals.length === 3) {
				epoch = parseFloat(vals[0]);
				model = vals[1];
				modelDate = vals[2];
			} else if (vals.length === 6) {
				wmm.push({
					n: parseInt(vals[0], 10),
					m: parseInt(vals[1], 10),
					gnm: parseFloat(vals[2]),
					hnm: parseFloat(vals[3]),
					dgnm: parseFloat(vals[4]),
					dhnm: parseFloat(vals[5])
				});
			}
		}
	}

	return {epoch: epoch, model: model, modelDate: modelDate, wmm: wmm};
}
;/*	2012-03-26
    Copyright 2012 Christopher Weiss (cmweiss@gmail.com)

    Suggestions for improvements are appreciated.

    Adapted from the geomagc software and World Magnetic Model of the NOAA
    Satellite and Information Service, National Geophysical Data Center
    http://www.ngdc.noaa.gov/geomag/WMM/DoDWMM.shtml

    geoMagFactory() requires a world magnetic model (WMM) object. The helper
    function cof2Obj(), available in cof2Obj.js, takes the text of WMM.COF and
    returns an object suitable for geoMagFactory(). A syncronous XMLHttpRequest
    to fetch the WMM.COF is recommended in a web environment. The helper
    function syncXHR(), available in syncXHR.js, takes the url of the WMM.COF
    file and returns the WMM.COF file as text.

    Usage:
    geoMagFactory(wmm) returns a function which can compute the Earth's
    magnetic field.
    The returned function requires two arguments, latitude and longitude (in
    decimal degrees), and, optionally, altitude in feet (default is 0), and
    a date object (default is the current system time).

    var cof = syncXHR('http://host/path/WMM.COF'),
	    wmm = cof2Obj(cof),
	    geoMag = geoMagFactory(wmm),
	    latitude = 40.0,                // decimal degrees (north is positive)
	    longitude = -80.0,              // decimal degrees (east is positive)
	    altitude = 0,                   // feet (optional, default is 0)
	    time = new Date(2012, 4, 20),   // (optional, default is the current
                                        // system time)
	    myGeoMag = geoMag(latitude, longitude, altitude, time),
	    magneticVariation = myGeoMag.dec,   // Geomagnetic declination
                                            // (variation) in decimal degrees
                                            // -- east is positive
	    magneticDip = myGeoMag.dip, // Geomagnetic dip in decimal degrees
                                    // (down is positive)
	    magneticFieldIntensity = myGeoMag.ti,   // Total intensity of the
                                                // geomagnetic field in
                                                // nanoteslas
	    magneticBH = myGeoMag.bh,   // Horizontal intensity of the geomagnetic
                                    // field in nT
	    magneticBX = myGeoMag.bx,   // North component of the geomagnetic field
                                    // in nT
	    magneticBY = myGeoMag.by,   // East component of the geomagnetic field
                                    // in nT
	    magneticBZ = myGeoMag.bz,   // Vertical component of the geomagnetic
                                    // field (down is positive)
	    lat = myGeoMag.lat, // input latitude
	    lon = myGeoMag.lon; // input longitude
*/

/*jslint plusplus: true */
function geoMagFactory(wmm) {
	'use strict';
	function rad2deg(rad) {
		return rad * (180 / Math.PI);
	}
	function deg2rad(deg) {
		return deg * (Math.PI / 180);
	}

	var i, model, epoch = wmm.epoch,
		z = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		maxord = 12,
		tc = [z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice()],
		sp = z.slice(),
		cp = z.slice(),
		pp = z.slice(),
		p = [z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice()],
		dp = [z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice()],
		a = 6378.137,
		b = 6356.7523142,
		re = 6371.2,
		a2 = a * a,
		b2 = b * b,
		c2 = a2 - b2,
		a4 = a2 * a2,
		b4 = b2 * b2,
		c4 = a4 - b4,
		c = [z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice()],
		cd = [z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice()],
		n, m,
		snorm = [z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice(), z.slice()],
		j,
		k = [z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice(), z.slice(), z.slice(), z.slice(), z.slice(), z.slice(),
			z.slice()],
		flnmj,
		fn = [0, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
		fm = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
		D2;

	tc[0][0] = 0;
	sp[0] = 0.0;
	cp[0] = 1.0;
	pp[0] = 1.0;
	p[0][0] = 1;

	model = wmm.wmm;
	for (i in model) {
		if (model.hasOwnProperty(i)) {
			if (model[i].m <= model[i].n) {
				c[model[i].m][model[i].n] = model[i].gnm;
				cd[model[i].m][model[i].n] = model[i].dgnm;
				if (model[i].m !== 0) {
					c[model[i].n][model[i].m - 1] = model[i].hnm;
					cd[model[i].n][model[i].m - 1] = model[i].dhnm;
				}
			}
		}
	}
	wmm = null;
	model = null;

	/* CONVERT SCHMIDT NORMALIZED GAUSS COEFFICIENTS TO UNNORMALIZED */
	snorm[0][0] = 1;

	for (n = 1; n <= maxord; n++) {
		snorm[0][n] = snorm[0][n - 1] * (2 * n - 1) / n;
		j = 2;

		for (m = 0, D2 = (n - m + 1); D2 > 0; D2--, m++) {
			k[m][n] = (((n - 1) * (n - 1)) - (m * m)) /
				((2 * n - 1) * (2 * n - 3));
			if (m > 0) {
				flnmj = ((n - m + 1) * j) / (n + m);
				snorm[m][n] = snorm[m - 1][n] * Math.sqrt(flnmj);
				j = 1;
				c[n][m - 1] = snorm[m][n] * c[n][m - 1];
				cd[n][m - 1] = snorm[m][n] * cd[n][m - 1];
			}
			c[m][n] = snorm[m][n] * c[m][n];
			cd[m][n] = snorm[m][n] * cd[m][n];
		}
	}
	k[1][1] = 0.0;

	return function (glat, glon, h, date) {
		function decimalDate(date) {
			date = date || new Date();
			var year = date.getFullYear(),
				daysInYear = 365 +
					(((year % 400 === 0) || (year % 4 === 0 && (year % 100 > 0))) ? 1 : 0),
				msInYear = daysInYear * 24 * 60 * 60 * 1000;

			return date.getFullYear() + (date.valueOf() - (new Date(year, 0)).valueOf()) / msInYear;
		}

		var alt = (h / 3280.8399) || 0, // convert h (in feet) to kilometers or set default of 0
			time = decimalDate(date),
			dt = time - epoch,
			rlat = deg2rad(glat),
			rlon = deg2rad(glon),
			srlon = Math.sin(rlon),
			srlat = Math.sin(rlat),
			crlon = Math.cos(rlon),
			crlat = Math.cos(rlat),
			srlat2 = srlat * srlat,
			crlat2 = crlat * crlat,
			q,
			q1,
			q2,
			ct,
			st,
			r2,
			r,
			d,
			ca,
			sa,
			aor,
			ar,
			br = 0.0,
			bt = 0.0,
			bp = 0.0,
			bpp = 0.0,
			par,
			temp1,
			temp2,
			parp,
			D4,
			bx,
			by,
			bz,
			bh,
			ti,
			dec,
			dip,
			gv;
		sp[1] = srlon;
		cp[1] = crlon;

		/* CONVERT FROM GEODETIC COORDS. TO SPHERICAL COORDS. */
		q = Math.sqrt(a2 - c2 * srlat2);
		q1 = alt * q;
		q2 = ((q1 + a2) / (q1 + b2)) * ((q1 + a2) / (q1 + b2));
		ct = srlat / Math.sqrt(q2 * crlat2 + srlat2);
		st = Math.sqrt(1.0 - (ct * ct));
		r2 = (alt * alt) + 2.0 * q1 + (a4 - c4 * srlat2) / (q * q);
		r = Math.sqrt(r2);
		d = Math.sqrt(a2 * crlat2 + b2 * srlat2);
		ca = (alt + d) / r;
		sa = c2 * crlat * srlat / (r * d);

		for (m = 2; m <= maxord; m++) {
			sp[m] = sp[1] * cp[m - 1] + cp[1] * sp[m - 1];
			cp[m] = cp[1] * cp[m - 1] - sp[1] * sp[m - 1];
		}

		aor = re / r;
		ar = aor * aor;

		for (n = 1; n <= maxord; n++) {
			ar = ar * aor;
			for (m = 0, D4 = (n + m + 1); D4 > 0; D4--, m++) {

		/*
				COMPUTE UNNORMALIZED ASSOCIATED LEGENDRE POLYNOMIALS
				AND DERIVATIVES VIA RECURSION RELATIONS
		*/
				if (n === m) {
					p[m][n] = st * p[m - 1][n - 1];
					dp[m][n] = st * dp[m - 1][n - 1] + ct *
						p[m - 1][n - 1];
				} else if (n === 1 && m === 0) {
					p[m][n] = ct * p[m][n - 1];
					dp[m][n] = ct * dp[m][n - 1] - st * p[m][n - 1];
				} else if (n > 1 && n !== m) {
					if (m > n - 2) { p[m][n - 2] = 0; }
					if (m > n - 2) { dp[m][n - 2] = 0.0; }
					p[m][n] = ct * p[m][n - 1] - k[m][n] * p[m][n - 2];
					dp[m][n] = ct * dp[m][n - 1] - st * p[m][n - 1] -
						k[m][n] * dp[m][n - 2];
				}

		/*
				TIME ADJUST THE GAUSS COEFFICIENTS
		*/

				tc[m][n] = c[m][n] + dt * cd[m][n];
				if (m !== 0) {
					tc[n][m - 1] = c[n][m - 1] + dt * cd[n][m - 1];
				}

		/*
				ACCUMULATE TERMS OF THE SPHERICAL HARMONIC EXPANSIONS
		*/
				par = ar * p[m][n];
				if (m === 0) {
					temp1 = tc[m][n] * cp[m];
					temp2 = tc[m][n] * sp[m];
				} else {
					temp1 = tc[m][n] * cp[m] + tc[n][m - 1] * sp[m];
					temp2 = tc[m][n] * sp[m] - tc[n][m - 1] * cp[m];
				}
				bt = bt - ar * temp1 * dp[m][n];
				bp += (fm[m] * temp2 * par);
				br += (fn[n] * temp1 * par);
		/*
					SPECIAL CASE:  NORTH/SOUTH GEOGRAPHIC POLES
		*/
				if (st === 0.0 && m === 1) {
					if (n === 1) {
						pp[n] = pp[n - 1];
					} else {
						pp[n] = ct * pp[n - 1] - k[m][n] * pp[n - 2];
					}
					parp = ar * pp[n];
					bpp += (fm[m] * temp2 * parp);
				}
			}
		}

		bp = (st === 0.0 ? bpp : bp / st);
		/*
			ROTATE MAGNETIC VECTOR COMPONENTS FROM SPHERICAL TO
			GEODETIC COORDINATES
		*/
		bx = -bt * ca - br * sa;
		by = bp;
		bz = bt * sa - br * ca;

		/*
			COMPUTE DECLINATION (DEC), INCLINATION (DIP) AND
			TOTAL INTENSITY (TI)
		*/
		bh = Math.sqrt((bx * bx) + (by * by));
		ti = Math.sqrt((bh * bh) + (bz * bz));
		dec = rad2deg(Math.atan2(by, bx));
		dip = rad2deg(Math.atan2(bz, bh));

		/*
			COMPUTE MAGNETIC GRID VARIATION IF THE CURRENT
			GEODETIC POSITION IS IN THE ARCTIC OR ANTARCTIC
			(I.E. GLAT > +55 DEGREES OR GLAT < -55 DEGREES)
			OTHERWISE, SET MAGNETIC GRID VARIATION TO -999.0
		*/

		if (Math.abs(glat) >= 55.0) {
			if (glat > 0.0 && glon >= 0.0) {
				gv = dec - glon;
			} else if (glat > 0.0 && glon < 0.0) {
				gv = dec + Math.abs(glon);
			} else if (glat < 0.0 && glon >= 0.0) {
				gv = dec + glon;
			} else if (glat < 0.0 && glon < 0.0) {
				gv = dec - Math.abs(glon);
			}
			if (gv > 180.0) {
				gv -= 360.0;
			} else if (gv < -180.0) { gv += 360.0; }
		}

		return {dec: dec, dip: dip, ti: ti, bh: bh, bx: bx, by: by, bz: bz, lat: glat, lon: glon, gv: gv, epoch: epoch};
	};
}
;(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";var _ol=require("ol"),_proj=require("ol/proj/proj4.js"),_layer=require("ol/layer.js"),_source=require("ol/source"),_Vector=_interopRequireDefault(require("ol/source/Vector")),_geom=require("ol/geom"),_GeometryType=_interopRequireDefault(require("ol/geom/GeometryType.js")),_style=require("ol/style.js"),_control=require("ol/control.js"),_ScaleLine=require("ol/control/ScaleLine"),_format=require("ol/format.js"),_interaction=require("ol/interaction.js"),_proj2=require("ol/proj.js"),_coordinate=require("ol/coordinate.js"),_olGeocoder2=_interopRequireDefault(require("ol-geocoder")),_Group=_interopRequireDefault(require("ol/layer/Group")),_sphere=require("ol/sphere"),_olLayerswitcher=_interopRequireDefault(require("ol-layerswitcher")),_Graticule=_interopRequireDefault(require("ol-ext/control/Graticule"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}!function(e,t){if(void 0===window.TWCCMap){var n,r=function(n){var r,o,i,a,s,l,c,u,g,d,f,p,m,y,_=null,v={mapOptions:{zoom:2,center:[0,0],azimuthOpacity:.7},mapContainerElt:e("#map")[0],context:{languageCode:"en"}},h={HYBRID:{title:"Hybrid",lyrs:"y"},SATELLITE:{title:"Satellite",lyrs:"s"},TERRAIN:{title:"Terrain",lyrs:"p"},ROAD:{title:"Road",lyrs:"m"}};function w(e){this._array=e,this._index=0;var t=this;this.get=function(){var e=t._array[t._index];return++t._index,t._index===t._array.length&&(t._index=0),e}}function I(){return v.utils.t.apply(this,arguments)}function x(t,n){v.utils.trigger(e(v.mapContainerElt),t,n)}function b(e){return(0,_proj2.fromLonLat)(e,i.getProjection())}function G(e){return(0,_proj2.toLonLat)(e,i.getProjection())}function T(e){return b([e.x,e.y])}function S(e,t){r.setMetrics("length",e),r.setMetrics("area",t),x("map.metrics_changed",{length:e,area:t})}function C(){var e=g.getFeatures()[0];if(e){var t=e.getGeometry(),n=t.getCoordinates();n.push(n[0]);var r=new _geom.Polygon([n]);S((0,_sphere.getLength)(t),(0,_sphere.getArea)(r))}}function A(){m.setPosition(void 0)}function k(e){u.getFeatures().forEach(function(t){t.getGeometry().setCoordinates(e||t.getGeometry().getCoordinates());var n=t.get("name"),o=r.getAngleInRadians(n)||0,i="true"===n||o?v.mapOptions.azimuthOpacity:0,a=t.get("style").getImage();a.setRotation(o),a.setOpacity(i)})}function R(e){return"data:image/svg+xml,"+escape('<?xml version="1.0" encoding="UTF-8" standalone="no"?>'+e)}function M(){u.clear()}function O(t){var n=[new _style.Style({stroke:new _style.Stroke({color:"rgba(0,0,0,0.5)",width:2})})],r=0,o=t.getGeometry(),i=o.getCoordinates().length-1,a={font:"10px Arial",stroke:new _style.Stroke({color:"#fff",width:2}),fill:new _style.Fill({color:"#000"})};return o.forEachSegment(function(t,o){++r,n.push(new _style.Style({geometry:new _geom.Point(t),text:new _style.Text(e.extend(a,{text:r.toString()}))})),r===i&&n.push(new _style.Style({geometry:new _geom.Point(o),text:new _style.Text(e.extend(a,{text:(r+1).toString()}))}))}),n}function D(t){var n=new e.Deferred;return i.animate({center:t,duration:200},n.resolve),n.promise()}function L(){e("#zoom-btn").button("option","disabled",!0);var t,n,r=d.getFeatures()[0].getGeometry().getCoordinates();e.when(D(r),(t=10,n=new e.Deferred,i.animate({zoom:t,duration:200},n.resolve),n.promise())).done(function(){e("#zoom-btn").button("option","disabled",!1)})}function P(e){if(g){var t=e.map(T);g.getFeatures().length?function(e){g.getFeatures()[0].getGeometry().setCoordinates(e)}(t):(!function(e){g.addFeature(new _ol.Feature({geometry:new _geom.LineString(e)}))}(t),o.addInteraction(l)),C(),!0===r.getBoolean("autoZoom")&&o.getView().fit(g.getExtent(),{duration:200,padding:[0,270,36,204]})}}function E(t){var n,r,o,i,a="",s="",l="",c=G(t),u={key:v.mapOptions.timezonedbKey,format:"json",by:"position",lng:c[0],lat:c[1],fields:"abbreviation,gmtOffset"},g=(0,_coordinate.degreesToStringHDMS)("NS",c[1]),d=(0,_coordinate.degreesToStringHDMS)("EW",c[0]);n=e.get("https://elevation-api.io/api/elevation",{points:c[1]+","+c[0]}).done(function(e){if(e.elevations){var t=e.elevations[0].elevation.toString();"-9999"!==t&&(a='<p><img src="'+v.system.dirWsImages+'elevation_icon.png" alt="'+I("elevation")+'" title="'+I("elevation")+'" width="38" height="30"> '+t+I("unitMeter")+"</p>")}}).fail(function(){x("xhr.failed","Elevation API")}),r=e.get("https://api.timezonedb.com/v2.1/get-time-zone",u).done(function(e){if("OK"===e.status){var t=e.gmtOffset/3600;l="<p>"+e.abbreviation+" (GMT",t>0&&(l+="+"),0!==t&&(l+=t),l+=")</p>"}}).fail(function(){x("xhr.failed","Timezonedb API")}),o=e.get("https://nominatim.openstreetmap.org/reverse",{format:"json",lat:c[1],lon:c[0],"accept-language":v.context.languageCode}).done(function(e){if(e&&!e.error){var t=e.address.country_code.toUpperCase();s='<img src="'+v.system.dirWsImages+'address_icon.png" alt="'+I("address")+'" title="'+I("address")+'" width="38" height="30"><p>'+e.display_name+'   <img src="'+v.system.dirWsImages+"flags/"+t+'.png" alt="'+t+'" width="22" height="15"></p>'}}).fail(function(){x("xhr.failed","Nominatim API")}),A(),e.when(o,n,r).always(function(){i='<div id="popup" class="ol-popup">   <a href="#" id="popup-closer" class="ol-popup-closer"></a>   <div class="popup-content">       <h3>'+I("dragMe")+"</h3>       <div>"+s+'           <a id="zoom-btn" href="#" title="'+I("zoom")+'">'+I("zoom")+'</a>       </div>       <div>           <img src="'+v.system.dirWsImages+'gps_icon.png" alt="GPS (WGS84)" title="GPS (WGS84)" width="38" height="30">           <p>'+g+"<br>"+d+"</p>"+l+a+"       </div>   </div></div>",p.innerHTML=i,e("#zoom-btn").button({icons:{primary:"ui-icon-zoomin"},text:!1}).click(function(){L()}),e("#popup-closer").click(function(e){return A(),this.blur(),e.stopPropagation(),e.preventDefault(),!1}),x("infowindow.dom_ready"),m.setPosition(t)})}function j(t){if(d){var n=T(t);d.getFeatures().length?function(e){d.getFeatures().forEach(function(t){t.getGeometry().setCoordinates(e)})}(n):(!function(e){d.addFeature(new _ol.Feature({geometry:new _geom.Point(e),style:new _style.Style({image:new _style.Icon({src:v.system.dirWsImages+"twcc_icon_with_shadow.png",anchor:[19,1],anchorXUnits:"pixels"})})}))}(n),o.addInteraction(s)),u.getFeatures().length?k(n):function(t){var n=R('<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="16" height="97" viewBox="0 0 16 97" enable-background="new 0 0 512 512" xml:space="preserve"><path style="stroke:#fff;stroke-width:2;" d="M 8,12.943205 8,96.999397"/><rect style="fill:#fff;stroke:#fff;stroke-width:1;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:4;" width="8.779562" height="8.2131386" x="3.610219" y="4.5313869"/></svg>'),o={true:{src:R('<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="16" height="97" viewBox="0 0 16 97" enable-background="new 0 0 512 512" xml:space="preserve"><polygon style="fill:#fff;stroke:#fff;stroke-width:37.61520004;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10" stroke-miterlimit="10" points="374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 259.216,29.942 330.27,173.919 489.16,197.007 " transform="matrix(0.03217603,0,0,0.03217603,-0.33683664,-0.35833699)"/><path style="stroke:#fff;stroke-width:2;" d="M 8,12.943205 8,96.999397"/></svg>')},magneticDeclination:{src:R('<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 16 97" xml:space="preserve" width="16" height="97"><g transform="matrix(0.07106223,0,0,0.07106223,-0.43846047,1.8741008e-6)"><path style="fill:#fff" d="m 7.954,226.53 c -2.23,4.623 -2.295,8.072 -0.609,9.915 3.911,4.275 15.926,-3.905 23.323,-9.051 l 58.416,-40.662 c 7.397,-5.145 20.402,-11.835 29.414,-11.993 0.897,-0.016 1.8,-0.011 2.703,0.011 9.007,0.218 21.958,7.016 29.3,12.238 l 56.403,40.151 c 7.343,5.221 19.303,13.473 23.301,9.219 1.74,-1.849 1.751,-5.33 -0.381,-9.997 L 129.648,7.047 c -4.264,-9.333 -11.335,-9.404 -15.79,-0.163 L 7.954,226.53 Z"/><path style="stroke:#fff;stroke-width:28.14434624;" d="m 118.74748,174.45383 0,1190.45957"/></g></svg>'),rotation:r.getAngleInRadians("magneticDeclination")},srcConvergence:{src:n,color:"#f00",rotation:r.getAngleInRadians("srcConvergence")},dstConvergence:{src:n,rotation:r.getAngleInRadians("dstConvergence")}};for(var i in o)if(o.hasOwnProperty(i)){var a=o[i];u.addFeature(new _ol.Feature({geometry:new _geom.Point(t),name:i,style:new _style.Style({image:new _style.Icon(e.extend({anchor:[.5,1],rotateWithView:!0,opacity:"true"===i||a.rotation?v.mapOptions.azimuthOpacity:0,scale:.75,color:"#000"},a))})}))}}(n),D(n),E(n),S()}}function q(e){1===e.length?(g.clear(),o.removeInteraction(l),j(e[0])):(A(),d.clear(),o.removeInteraction(s),M(),P(e))}function z(e,t){return e.reduce(function(e,n){return e.concat(t(n))},[])}function F(e){return z(e,function(e){return e})}function N(e){switch(e.getType()){case _GeometryType.default.POINT:return[e.getCoordinates()];case _GeometryType.default.LINE_STRING:case _GeometryType.default.LINEAR_RING:case _GeometryType.default.MULTI_POINT:return e.getCoordinates();case _GeometryType.default.POLYGON:case _GeometryType.default.MULTI_LINE_STRING:return F(e.getCoordinates());case _GeometryType.default.MULTI_POLYGON:return F(F(e.getCoordinates()));case _GeometryType.default.GEOMETRY_COLLECTION:return z(e.getGeometries(),function(e){return N(e)});case _GeometryType.default.CIRCLE:return[e.getCenter()];default:return[]}}function W(e){return new _layer.Tile({title:e.title,type:"base",visible:!1,preload:1/0,source:new _source.XYZ({attributions:'© Google <a href="https://developers.google.com/maps/terms" target="_blank">Terms of Use.</a>',url:"http://mt0.google.com/vt/lyrs="+e.lyrs+"&hl=en&x={x}&y={y}&z={z}&s=Ga"})})}function V(){var t,n=(t="layers",v.utils.getPreferenceCookie(t));if(n){var r=n.opt;if(r)for(var o in r)if(r.hasOwnProperty(o)){var i=e(".ol-control.layer-switcher label:contains('"+o+"')").closest("li").children("input[type=checkbox]");i.length&&i[0].checked!==r[o]&&i.click()}var a=n.base;if(a)for(var s in a)if(a.hasOwnProperty(s)){var l=e(".ol-control.layer-switcher label:contains('"+s+"')").closest("li").find("label:contains('"+a[s]+"')").closest("li").children("input[type=radio]");l.length&&l.click()}}}function B(t){if(t.features){var n;if(e.isFunction(t.features.getArray))n=t.features.getArray();else{if(!e.isArray(t.features))return;n=t.features}x("linestring.edit_end",z(n,function(e){return N(e.getGeometry())}).map(G)),C()}}function U(){var t=e("body");a.once("tileloadend",function(){V(),x("map.tiles_loaded"),e(".ol-control.layer-switcher").on("change","input",function(t){var n=e(t.target),r=n.closest("li.group").children("label").text();r+=" "+n.closest("li.layer").children("label").text(),"checkbox"===n.attr("type")&&(r+=" ",r+=this.checked?"on":"off"),x("map.layer.change",r)}),_.resolve()}),a.on("tileloaderror",_.reject),o.on("singleclick",function(e){var t=o.forEachFeatureAtPixel(o.getEventPixel(e.originalEvent),function(e){return e});t?E(t.getGeometry().getCoordinates()):(A(),x("map.click",G(e.coordinate)))}),f.on("addresschosen",function(e){x("place.changed",G(e.coordinate))}),s.on("modifystart",function(){A(),M(),x("marker.drag_start")}),s.on("modifyend",function(e){x("marker.drag_end",G(e.features.getArray()[0].getGeometry().getCoordinates()))}),l.on("modifyend",B),c.on("addfeatures",B),o.getViewport().addEventListener("contextmenu",function(e){var t=o.forEachFeatureAtPixel(o.getEventPixel(e),function(e){return e});t?x("linestring.remove_vertice",G(t.getGeometry().getCoordinates())):x("linestring.add_vertice",G(o.getEventCoordinate(e))),C(),e.stopPropagation(),e.preventDefault()}),t.on("converter.source.selection_changed converterset.done",function(e,t){}),t.on("converterset.wgs84_changed",function(t,n){var o,i,a=v.utils.degToRad(n.convergenceInDegrees),s=v.utils.getConvergenceConvention()?-1:1;n.wgs84=(o=n.wgs84,i=[],e.each(o,function(){if(void 0===this.lat&&void 0===this.x||this.error)return!0;i.push(this)}),i),r.setAngleInDegrees("magneticDeclination",n.magneticDeclinationInDegrees),r.setAngleInRadians("srcConvergence",s*a.source),r.setAngleInRadians("dstConvergence",s*a.destination),q(n.wgs84),x("converter.changed",n)}),t.on("converterset.convergence_changed",function(e,t){if(u.getFeatures().length){var n=v.utils.degToRad(t.convergenceInDegrees),o=v.utils.getConvergenceConvention()?-1:1;r.setAngleInRadians("srcConvergence",o*n.source),r.setAngleInRadians("dstConvergence",o*n.destination),k()}}),t.on("ui.full_screen",function(){e(".ol-full-screen button").trigger("click")});var n=new w(Object.values(_ScaleLine.Units));e(".ol-scale-line").click(function(){y.setUnits(n.get())})}e.extend(!0,v,n),r={anglesInRadians:{},booleans:{autoZoom:!0},metrics:{},setAngleInRadians:function(e,t){r.anglesInRadians[e]=t},setAngleInDegrees:function(e,t){r.setAngleInRadians(e,v.utils.degToRad(t))},getAngleInRadians:function(e){return r.anglesInRadians[e]},setBoolean:function(e,t){r.booleans[e]=!!t},getBoolean:function(e){return r.booleans[e]},setMetrics:function(e,t){r.metrics[e]=t},getMetrics:function(e){return r.metrics[e]}};var Y=function(t){function n(n){var r=n||{},o=e("#c-ads-1")[0];t.call(this,{element:o,target:r.target})}return t&&(n.__proto__=t),n.prototype=Object.create(t&&t.prototype),n.prototype.constructor=n,n}(_control.Control);return function(){_=function(){return v.utils.newDeferred.apply(this,arguments)}("Map"),(0,_proj.register)(t);var n=new _style.Style({image:new _style.Circle({radius:6,fill:null,stroke:new _style.Stroke({color:"rgba(0,0,0,0.6)",width:3})})});p=e("<div>")[0],y=new _control.ScaleLine,u=new _Vector.default,d=new _Vector.default,g=new _Vector.default,s=new _interaction.Modify({source:d,style:n,pixelTolerance:30}),l=new _interaction.Modify({source:g,style:n}),c=new _interaction.DragAndDrop({formatConstructors:[_format.GPX,_format.GeoJSON,_format.IGC,_format.KML,_format.TopoJSON]}),a=new _source.XYZ({attributions:'Tiles © <a target="_blank" href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer">ArcGIS</a>',url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"}),i=new _ol.View({zoom:v.mapOptions.zoom}),f=new _olGeocoder2.default("nominatim",{autoComplete:!0,autoCompleteMinLength:2,placeholder:I("searchByAddress"),targetType:"glass-button",lang:v.context.languageCode,limit:5,keepOpen:!1,preventDefault:!0,debug:!1}),m=new _ol.Overlay({element:p,autoPan:!0,autoPanAnimation:{duration:200}});var r=b(v.mapOptions.center);i.setCenter(r),o=new _ol.Map({controls:(0,_control.defaults)().extend([new _control.FullScreen({source:"map-container"}),new _olLayerswitcher.default,f,y,new Y]),interactions:(0,_interaction.defaults)().extend([new _interaction.DragRotateAndZoom,c]),target:v.mapContainerElt,loadTilesWhileAnimating:!0,overlays:[m],layers:[new _Group.default({title:"Maps",layers:[new _Group.default({title:"ArcGIS",layers:[new _layer.Tile({title:"Satellite",type:"base",visible:!1,preload:1/0,source:new _source.XYZ({attributions:'Tiles © <a target="_blank" href="https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer">ArcGIS</a>',url:"http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}.jpg"})}),new _layer.Tile({title:"Terrain",type:"base",preload:1/0,source:a})]}),new _Group.default({title:"OSM",layers:[new _layer.Tile({title:"Stamen toner",type:"base",visible:!1,preload:1/0,source:new _source.Stamen({layer:"toner"})}),new _layer.Tile({title:"Stamen terrain",type:"base",visible:!1,preload:1/0,source:new _source.Stamen({layer:"terrain"})}),new _layer.Tile({title:"Open Street Map",type:"base",visible:!1,preload:1/0,source:new _source.OSM})]}),new _Group.default({title:"Google",layers:[W(h.HYBRID),W(h.SATELLITE),W(h.TERRAIN),W(h.ROAD)]})]}),new _Group.default({title:"Features",layers:[new _layer.Vector({title:"Azimuths",style:function(e){return e.get("style")},source:u})]}),new _layer.Vector({style:function(e){return e.get("style")},source:d}),new _layer.Vector({style:O,source:g})],view:i}),U()}(),{promise:_.promise(),setGraticule:function(){new GridOverlay(o).setMap(o)},model:{setAngleInRadians:r.setAngleInRadians,setAngleInDegrees:r.setAngleInDegrees,getMetrics:r.getMetrics,setBoolean:r.setBoolean},getMap:function(){return o},olVersion:_ol.VERSION}};window.TWCCMap={getInstance:function(e){return n=n||r(e)}}}}(jQuery,proj4);

},{"ol":160,"ol-ext/control/Graticule":4,"ol-geocoder":7,"ol-layerswitcher":8,"ol/control.js":49,"ol/control/ScaleLine":56,"ol/coordinate.js":60,"ol/format.js":74,"ol/geom":126,"ol/geom/GeometryType.js":131,"ol/interaction.js":161,"ol/layer.js":183,"ol/layer/Group":189,"ol/proj.js":205,"ol/proj/proj4.js":210,"ol/source":252,"ol/source/Vector":277,"ol/sphere":286,"ol/style.js":291}],2:[function(require,module,exports){
"use strict";exports.read=function(t,a,o,r,h){var M,p,w=8*h-r-1,e=(1<<w)-1,f=e>>1,i=-7,s=o?h-1:0,N=o?-1:1,n=t[a+s];for(s+=N,M=n&(1<<-i)-1,n>>=-i,i+=w;i>0;M=256*M+t[a+s],s+=N,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+t[a+s],s+=N,i-=8);if(0===M)M=1-f;else{if(M===e)return p?NaN:1/0*(n?-1:1);p+=Math.pow(2,r),M-=f}return(n?-1:1)*p*Math.pow(2,M-r)},exports.write=function(t,a,o,r,h,M){var p,w,e,f=8*M-h-1,i=(1<<f)-1,s=i>>1,N=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,n=r?0:M-1,u=r?1:-1,c=a<0||0===a&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(w=isNaN(a)?1:0,p=i):(p=Math.floor(Math.log(a)/Math.LN2),a*(e=Math.pow(2,-p))<1&&(p--,e*=2),(a+=p+s>=1?N/e:N*Math.pow(2,1-s))*e>=2&&(p++,e/=2),p+s>=i?(w=0,p=i):p+s>=1?(w=(a*e-1)*Math.pow(2,h),p+=s):(w=a*Math.pow(2,s-1)*Math.pow(2,h),p=0));h>=8;t[o+n]=255&w,n+=u,w/=256,h-=8);for(p=p<<h|w,f+=h;f>0;t[o+n]=255&p,n+=u,p/=256,f-=8);t[o+n-u]|=128*c};

},{}],3:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ext=_interopRequireDefault(require("../util/ext")),_Control=_interopRequireDefault(require("ol/control/Control")),_Observable=require("ol/Observable"),_Style=_interopRequireDefault(require("ol/style/Style")),_Fill=_interopRequireDefault(require("ol/style/Fill")),_Stroke=_interopRequireDefault(require("ol/style/Stroke")),_Text=_interopRequireDefault(require("ol/style/Text")),_getMapCanvas=_interopRequireDefault(require("../util/getMapCanvas"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var ol_control_CanvasBase=function(t){t||(t={}),this.setStyle(t.style),_Control.default.call(this,t)};(0,_ext.default)(ol_control_CanvasBase,_Control.default),ol_control_CanvasBase.prototype.setMap=function(t){this.getCanvas(t);var e=this.getMap();this._listener&&((0,_Observable.unByKey)(this._listener),this._listener=null),_Control.default.prototype.setMap.call(this,t),e&&e.renderSync(),t&&(this._listener=t.on("postcompose",this._draw.bind(this)))},ol_control_CanvasBase.prototype.getCanvas=function(t){return(0,_getMapCanvas.default)(t)},ol_control_CanvasBase.prototype.getContext=function(t){var e=t.context;if(!e&&this.getMap()){var o=this.getMap().getViewport().getElementsByClassName("ol-fixedoverlay")[0];e=o?o.getContext("2d"):null}return e},ol_control_CanvasBase.prototype.setStyle=function(t){this._style=t||new _Style.default({})},ol_control_CanvasBase.prototype.getStyle=function(){return this._style},ol_control_CanvasBase.prototype.getStroke=function(){return this._style.getStroke()||this._style.setStroke(new _Stroke.default({color:"#000",width:1.25})),this._style.getStroke()},ol_control_CanvasBase.prototype.getFill=function(){return this._style.getFill()||this._style.setFill(new _Fill.default({color:"#fff"})),this._style.getFill()},ol_control_CanvasBase.prototype.getTextStroke=function(){var t=this._style.getText();return t||(t=new _Text.default({})),t.getStroke()||t.setStroke(new _Stroke.default({color:"#fff",width:3})),t.getStroke()},ol_control_CanvasBase.prototype.getTextFill=function(){var t=this._style.getText();return t||(t=new _Text.default({})),t.getFill()||t.setFill(new _Fill.default({color:"#fff",width:3})),t.getFill()},ol_control_CanvasBase.prototype.getTextFont=function(){var t=this._style.getText();return t||(t=new _Text.default({})),t.getFont()||t.setFont("12px sans-serif"),t.getFont()},ol_control_CanvasBase.prototype._draw=function(){console.warn("[CanvasBase] draw function not implemented.")};var _default=ol_control_CanvasBase;exports.default=_default;

},{"../util/ext":5,"../util/getMapCanvas":6,"ol/Observable":30,"ol/control/Control":51,"ol/style/Fill":293,"ol/style/Stroke":301,"ol/style/Style":302,"ol/style/Text":303}],4:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ext=_interopRequireDefault(require("../util/ext")),_Projection=_interopRequireDefault(require("ol/proj/Projection")),_Style=_interopRequireDefault(require("ol/style/Style")),_Stroke=_interopRequireDefault(require("ol/style/Stroke")),_Fill=_interopRequireDefault(require("ol/style/Fill")),_Text=_interopRequireDefault(require("ol/style/Text")),_proj=require("ol/proj"),_CanvasBase=_interopRequireDefault(require("./CanvasBase"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var ol_control_Graticule=function(t){t||(t={});var e=document.createElement("div");e.className="ol-graticule ol-unselectable ol-hidden",_CanvasBase.default.call(this,{element:e}),this.set("projection",t.projection||"EPSG:4326");var o=new _Projection.default({code:this.get("projection")}).getMetersPerUnit();for(this.fac=1;o/this.fac>10;)this.fac*=10;this.fac=1e4/this.fac,this.set("maxResolution",t.maxResolution||1/0),this.set("step",t.step||.1),this.set("stepCoord",t.stepCoord||1),this.set("spacing",t.spacing||40),this.set("margin",t.margin||0),this.set("borderWidth",t.borderWidth||5),this.set("stroke",!1!==t.stroke),this.formatCoord=t.formatCoord||function(t){return t},t.style instanceof _Style.default?this.setStyle(t.style):this.setStyle(new _Style.default({stroke:new _Stroke.default({color:"#000",width:1}),fill:new _Fill.default({color:"#fff"}),text:new _Text.default({stroke:new _Stroke.default({color:"#fff",width:2}),fill:new _Fill.default({color:"#000"})})}))};(0,_ext.default)(ol_control_Graticule,_CanvasBase.default),ol_control_Graticule.prototype.setStyle=function(t){this._style=t},ol_control_Graticule.prototype._draw=function(t){if(!(this.get("maxResolution")<t.frameState.viewState.resolution)){for(var e,o=this.getContext(t),r=o.canvas,i=t.frameState.pixelRatio,l=r.width/i,a=r.height/i,s=this.get("projection"),n=this.getMap(),h=[n.getCoordinateFromPixel([0,0]),n.getCoordinateFromPixel([l,0]),n.getCoordinateFromPixel([l,a]),n.getCoordinateFromPixel([0,a])],f=-1/0,g=1/0,u=-1/0,d=1/0,c=0;e=h[c];c++)h[c]=(0,_proj.transform)(e,n.getView().getProjection(),s),f=Math.max(f,h[c][0]),g=Math.min(g,h[c][0]),u=Math.max(u,h[c][1]),d=Math.min(d,h[c][1]);var p=this.get("spacing"),_=this.get("step"),m=this.get("stepCoord"),x=this.get("borderWidth"),S=this.get("margin");if((f-g)/_*p>l)(_*=Math.round((f-g)/l*p/_))>this.fac&&(_=Math.round(_/this.fac)*this.fac);g=Math.floor(g/_)*_-_,d=Math.floor(d/_)*_-_,f=Math.floor(f/_)*_+2*_,u=Math.floor(u/_)*_+2*_;var y=(0,_proj.get)(s).getExtent();y&&(g<y[0]&&(g=y[0]),d<y[1]&&(d=y[1]),f>y[2]&&(f=y[2]+_),u>y[3]&&(u=y[3]+_));var k=this.getStyle().getStroke()&&this.get("stroke"),C=this.getStyle().getText(),P=this.getStyle().getFill();o.save(),o.scale(i,i),o.beginPath(),o.rect(S,S,l-2*S,a-2*S),o.clip(),o.beginPath();var v,b,j,M,T,w={top:[],left:[],bottom:[],right:[]};for(v=g;v<f;v+=_)for(M=(0,_proj.transform)([v,d],s,n.getView().getProjection()),M=n.getPixelFromCoordinate(M),k&&o.moveTo(M[0],M[1]),j=M,b=d+_;b<=u;b+=_)T=(0,_proj.transform)([v,b],s,n.getView().getProjection()),T=n.getPixelFromCoordinate(T),k&&o.lineTo(T[0],T[1]),j[1]>0&&T[1]<0&&w.top.push([v,j]),j[1]>a&&T[1]<a&&w.bottom.push([v,j]),j=T;for(b=d;b<u;b+=_)for(M=(0,_proj.transform)([g,b],s,n.getView().getProjection()),M=n.getPixelFromCoordinate(M),k&&o.moveTo(M[0],M[1]),j=M,v=g+_;v<=f;v+=_)T=(0,_proj.transform)([v,b],s,n.getView().getProjection()),T=n.getPixelFromCoordinate(T),k&&o.lineTo(T[0],T[1]),j[0]<0&&T[0]>0&&w.left.push([b,j]),j[0]<l&&T[0]>l&&w.right.push([b,j]),j=T;if(k&&(o.strokeStyle=this.getStyle().getStroke().getColor(),o.lineWidth=this.getStyle().getStroke().getWidth(),o.stroke()),C){var q,F;o.fillStyle=this.getStyle().getText().getFill().getColor(),o.strokeStyle=this.getStyle().getText().getStroke().getColor(),o.lineWidth=this.getStyle().getText().getStroke().getWidth(),o.textAlign="center",o.textBaseline="hanging";var R=(P?x:0)+S+2;for(c=0;q=w.top[c];c++)Math.round(q[0]/this.get("step"))%m||(F=this.formatCoord(q[0],"top"),o.strokeText(F,q[1][0],R),o.fillText(F,q[1][0],R));for(o.textBaseline="alphabetic",c=0;q=w.bottom[c];c++)Math.round(q[0]/this.get("step"))%m||(F=this.formatCoord(q[0],"bottom"),o.strokeText(F,q[1][0],a-R),o.fillText(F,q[1][0],a-R));for(o.textBaseline="middle",o.textAlign="left",c=0;q=w.left[c];c++)Math.round(q[0]/this.get("step"))%m||(F=this.formatCoord(q[0],"left"),o.strokeText(F,R,q[1][1]),o.fillText(F,R,q[1][1]));for(o.textAlign="right",c=0;q=w.right[c];c++)Math.round(q[0]/this.get("step"))%m||(F=this.formatCoord(q[0],"right"),o.strokeText(F,l-R,q[1][1]),o.fillText(F,l-R,q[1][1]))}if(P){var W,D,B=this.getStyle().getFill().getColor();for((D=this.getStyle().getStroke())?W=this.getStyle().getStroke().getColor():(W=B,B="#fff"),o.strokeStyle=W,o.lineWidth=D?D.getWidth():1,c=1;c<w.top.length;c++)o.beginPath(),o.rect(w.top[c-1][1][0],S,w.top[c][1][0]-w.top[c-1][1][0],x),o.fillStyle=Math.round(w.top[c][0]/_)%2?W:B,o.fill(),o.stroke();for(c=1;c<w.bottom.length;c++)o.beginPath(),o.rect(w.bottom[c-1][1][0],a-x-S,w.bottom[c][1][0]-w.bottom[c-1][1][0],x),o.fillStyle=Math.round(w.bottom[c][0]/_)%2?W:B,o.fill(),o.stroke();for(c=1;c<w.left.length;c++)o.beginPath(),o.rect(S,w.left[c-1][1][1],x,w.left[c][1][1]-w.left[c-1][1][1]),o.fillStyle=Math.round(w.left[c][0]/_)%2?W:B,o.fill(),o.stroke();for(c=1;c<w.right.length;c++)o.beginPath(),o.rect(l-x-S,w.right[c-1][1][1],x,w.right[c][1][1]-w.right[c-1][1][1]),o.fillStyle=Math.round(w.right[c][0]/_)%2?W:B,o.fill(),o.stroke();o.beginPath(),o.fillStyle=W,o.rect(S,S,x,x),o.rect(S,a-x-S,x,x),o.rect(l-x-S,S,x,x),o.rect(l-x-S,a-x-S,x,x),o.fill()}o.restore()}};var _default=ol_control_Graticule;exports.default=_default;

},{"../util/ext":5,"./CanvasBase":3,"ol/proj":205,"ol/proj/Projection":206,"ol/style/Fill":293,"ol/style/Stroke":301,"ol/style/Style":302,"ol/style/Text":303}],5:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.ol_ext_inherits=void 0,window.ol&&!ol.ext&&(ol.ext={});var ol_ext_inherits=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e};exports.ol_ext_inherits=ol_ext_inherits,window.ol&&(ol.inherits||(ol.inherits=ol_ext_inherits)),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),window.Element&&!Element.prototype.remove&&(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)});var _default=ol_ext_inherits;exports.default=_default;

},{}],6:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var ol_ext_getMapCanvas=function(e){if(!e)return null;var t=e.getViewport().getElementsByClassName("ol-fixedoverlay")[0];return t||(e.getViewport().querySelector(".ol-layers")?((t=document.createElement("canvas")).className="ol-fixedoverlay",e.getViewport().querySelector(".ol-layers").after(t),e.on("precompose",function(a){t.width=e.getSize()[0]*a.frameState.pixelRatio,t.height=e.getSize()[1]*a.frameState.pixelRatio})):t=e.getViewport().querySelector("canvas")),t},_default=ol_ext_getMapCanvas;exports.default=_default;

},{}],7:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e(require("ol/control/Control"),require("ol/style/Style"),require("ol/style/Icon"),require("ol/layer/Vector"),require("ol/source/Vector"),require("ol/geom/Point"),require("ol/Feature"),require("ol/proj")):"function"==typeof define&&define.amd?define(["ol/control/Control","ol/style/Style","ol/style/Icon","ol/layer/Vector","ol/source/Vector","ol/geom/Point","ol/Feature","ol/proj"],e):(t=t||self).Geocoder=e(t.ol.control.Control,t.ol.style.Style,t.ol.style.Icon,t.ol.layer.Vector,t.ol.source.Vector,t.ol.geom.Point,t.ol.Feature,t.ol.proj)}(void 0,function(t,e,n,s,r,o,i,a){t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n,s=s&&s.hasOwnProperty("default")?s.default:s,r=r&&r.hasOwnProperty("default")?r.default:r,o=o&&o.hasOwnProperty("default")?o.default:o,i=i&&i.hasOwnProperty("default")?i.default:i,a=a&&a.hasOwnProperty("default")?a.default:a;var l="gcd-container",c="gcd-button-control",u="gcd-input-query",d="gcd-input-reset",p={namespace:"ol-geocoder",spin:"gcd-pseudo-rotate",hidden:"gcd-hidden",address:"gcd-address",country:"gcd-country",city:"gcd-city",road:"gcd-road",olControl:"ol-control",glass:{container:"gcd-gl-container",control:"gcd-gl-control",button:"gcd-gl-btn",input:"gcd-gl-input",expanded:"gcd-gl-expanded",reset:"gcd-gl-reset",result:"gcd-gl-result"},inputText:{container:"gcd-txt-container",control:"gcd-txt-control",input:"gcd-txt-input",reset:"gcd-txt-reset",icon:"gcd-txt-glass",result:"gcd-txt-result"}},h={containerId:l,buttonControlId:c,inputQueryId:u,inputResetId:d,cssClasses:p},m=Object.freeze({__proto__:null,containerId:l,buttonControlId:c,inputQueryId:u,inputResetId:d,cssClasses:p,default:h}),f="addresschosen",g="nominatim",y="reverse",v="glass-button",w="osm",b={provider:w,placeholder:"Search for an address",featureStyle:null,targetType:v,lang:"en-US",limit:5,keepOpen:!1,preventDefault:!1,autoComplete:!1,autoCompleteMinLength:2,debug:!1};function k(t,e){if(void 0===e&&(e="Assertion failed"),!t){if("undefined"!=typeof Error)throw new Error(e);throw e}}function C(t){var e=function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}return window.performance.now()}().toString(36);return t?t+e:e}function x(t){return/^\d+$/.test(t)}function L(t,e,n){if(Array.isArray(t))t.forEach(function(t){return L(t,e)});else for(var s=Array.isArray(e)?e:e.split(/\s+/),r=s.length;r--;)E(t,s[r])||P(t,s[r],n)}function q(t,e,n){if(Array.isArray(t))t.forEach(function(t){return q(t,e,n)});else for(var s=Array.isArray(e)?e:e.split(/\s+/),r=s.length;r--;)E(t,s[r])&&N(t,s[r],n)}function E(t,e){return t.classList?t.classList.contains(e):T(e).test(t.className)}function S(t,e,n){void 0===e&&(e=window.document);var s=Array.prototype.slice,r=[];if(/^(#?[\w-]+|\.[\w-.]+)$/.test(t))switch(t[0]){case"#":r=[function(t){return t="#"===t[0]?t.substr(1,t.length):t,document.getElementById(t)}(t.substr(1))];break;case".":r=s.call(e.getElementsByClassName(t.substr(1).replace(/\./g," ")));break;default:r=s.call(e.getElementsByTagName(t))}else r=s.call(e.querySelectorAll(t));return n?r:r[0]}function j(t,e){var n;if(Array.isArray(t)){if(n=document.createElement(t[0]),t[1].id&&(n.id=t[1].id),t[1].classname&&(n.className=t[1].classname),t[1].attr){var s=t[1].attr;if(Array.isArray(s))for(var r=-1;++r<s.length;)n.setAttribute(s[r].name,s[r].value);else n.setAttribute(s.name,s.value)}}else n=document.createElement(t);n.innerHTML=e;for(var o=document.createDocumentFragment();n.childNodes[0];)o.appendChild(n.childNodes[0]);return n.appendChild(o),n}function T(t){return new RegExp("(^|\\s+) "+t+" (\\s+|$)")}function P(t,e,n){t.classList?t.classList.add(e):t.className=(t.className+" "+e).trim(),n&&x(n)&&window.setTimeout(function(){return N(t,e)},n)}function N(t,e,n){t.classList?t.classList.remove(e):t.className=t.className.replace(T(e)," ").trim(),n&&x(n)&&window.setTimeout(function(){return P(t,e)},n)}function R(t){this.options=t.options,this.els=this.createControl()}var _=m.cssClasses;function I(){this.settings={url:"https://photon.komoot.de/api/",params:{q:"",limit:10,lang:"en"},langs:["de","it","fr","en"]}}function A(){this.settings={url:"https://nominatim.openstreetmap.org/search/",params:{q:"",format:"json",addressdetails:1,limit:10,countrycodes:"","accept-language":"en-US"}}}function O(){this.settings={url:"http://open.mapquestapi.com/nominatim/v1/search.php",params:{q:"",key:"",format:"json",addressdetails:1,limit:10,countrycodes:"","accept-language":"en-US"}}}function D(){this.settings={url:"https://dev.virtualearth.net/REST/v1/Locations",callbackName:"jsonp",params:{query:"",key:"",includeNeighborhood:0,maxResults:10}}}function M(){this.settings={url:"https://api.opencagedata.com/geocode/v1/json?",params:{q:"",key:"",limit:10,countrycode:"",pretty:1,no_annotations:1}}}function B(t,e){this.Base=t,this.layerName=C("geocoder-layer-"),this.layer=new s({name:this.layerName,source:new r}),this.options=t.options,this.options.provider="string"==typeof this.options.provider?this.options.provider.toLowerCase():this.options.provider,this.provider=this.newProvider(),this.els=e,this.lastQuery="",this.container=this.els.container,this.registeredListeners={mapClick:!1},this.setListeners()}R.prototype.createControl=function(){var t,e,n;return(n="text-input"===this.options.targetType?(e=_.namespace+" "+_.inputText.container,{container:t=j(["div",{id:m.containerId,classname:e}],R.input),control:S("."+_.inputText.control,t),input:S("."+_.inputText.input,t),reset:S("."+_.inputText.reset,t),result:S("."+_.inputText.result,t)}):(e=_.namespace+" "+_.glass.container,{container:t=j(["div",{id:m.containerId,classname:e}],R.glass),control:S("."+_.glass.control,t),button:S("."+_.glass.button,t),input:S("."+_.glass.input,t),reset:S("."+_.glass.reset,t),result:S("."+_.glass.result,t)})).input.placeholder=this.options.placeholder,n},R.glass=['<div class="',_.glass.control," ",_.olControl,'">','<button type="button"',' id="',m.buttonControlId,'"',' class="',_.glass.button,'"></button>','<input type="text"',' id="',m.inputQueryId,'"',' class="',_.glass.input,'"',' autocomplete="off" placeholder="Search ...">',"<a",' id="',m.inputResetId,'"',' class="',_.glass.reset," ",_.hidden,'"',"></a>","</div>",'<ul class="',_.glass.result,'"></ul>'].join(""),R.input=['<div class="',_.inputText.control,'">','<input type="text"',' id="',m.inputQueryId,'"',' class="',_.inputText.input,'"',' autocomplete="off" placeholder="Search ...">','<span class="',_.inputText.icon,'"></span>','<button type="button"',' id="',m.inputResetId,'"',' class="',_.inputText.reset," ",_.hidden,'"',"></button>","</div>",'<ul class="',_.inputText.result,'"></ul>'].join(""),I.prototype.getParameters=function(t){return t.lang=t.lang.toLowerCase(),{url:this.settings.url,params:{q:t.query,limit:t.limit||this.settings.params.limit,lang:-1<this.settings.langs.indexOf(t.lang)?t.lang:this.settings.params.lang}}},I.prototype.handleResponse=function(t){if(t.features.length)return t.features.map(function(t){return{lon:t.geometry.coordinates[0],lat:t.geometry.coordinates[1],address:{name:t.properties.name,postcode:t.properties.postcode,city:t.properties.city,state:t.properties.state,country:t.properties.country},original:{formatted:t.properties.name,details:t.properties}}})},A.prototype.getParameters=function(t){return{url:this.settings.url,params:{q:t.query,format:this.settings.params.format,addressdetails:this.settings.params.addressdetails,limit:t.limit||this.settings.params.limit,countrycodes:t.countrycodes||this.settings.params.countrycodes,"accept-language":t.lang||this.settings.params["accept-language"]}}},A.prototype.handleResponse=function(t){if(t.length)return t.map(function(t){return{lon:t.lon,lat:t.lat,address:{name:t.display_name,road:t.address.road||"",houseNumber:t.address.house_number||"",postcode:t.address.postcode,city:t.address.city||t.address.town,state:t.address.state,country:t.address.country},original:{formatted:t.display_name,details:t.address}}})},O.prototype.getParameters=function(t){return{url:this.settings.url,params:{q:t.query,key:t.key,format:"json",addressdetails:1,limit:t.limit||this.settings.params.limit,countrycodes:t.countrycodes||this.settings.params.countrycodes,"accept-language":t.lang||this.settings.params["accept-language"]}}},O.prototype.handleResponse=function(t){if(t.length)return t.map(function(t){return{lon:t.lon,lat:t.lat,address:{name:t.address.neighbourhood||"",road:t.address.road||"",postcode:t.address.postcode,city:t.address.city||t.address.town,state:t.address.state,country:t.address.country},original:{formatted:t.display_name,details:t.address}}})},D.prototype.getParameters=function(t){return{url:this.settings.url,callbackName:this.settings.callbackName,params:{query:t.query,key:t.key,includeNeighborhood:t.includeNeighborhood||this.settings.params.includeNeighborhood,maxResults:t.maxResults||this.settings.params.maxResults}}},D.prototype.handleResponse=function(t){var e=t.resourceSets[0].resources;if(e.length)return e.map(function(t){return{lon:t.point.coordinates[1],lat:t.point.coordinates[0],address:{name:t.name},original:{formatted:t.address.formattedAddress,details:t.address}}})},M.prototype.getParameters=function(t){return{url:this.settings.url,params:{q:t.query,key:t.key,limit:t.limit||this.settings.params.limit,countrycode:t.countrycodes||this.settings.params.countrycodes}}},M.prototype.handleResponse=function(t){if(t.results.length)return t.results.map(function(t){return{lon:t.geometry.lng,lat:t.geometry.lat,address:{name:t.components.house_number||"",road:t.components.road||"",postcode:t.components.postcode,city:t.components.city||t.components.town,state:t.components.state,country:t.components.country},original:{formatted:t.formatted,details:t.components}}})};var F=m.cssClasses;return B.prototype.setListeners=function(){var t,e,n=this;this.els.input.addEventListener("keypress",function(t){var e=t.target.value.trim();(t.key?"Enter"!==t.key:t.which?13!==t.which:!t.keyCode||13!==t.keyCode)||(t.preventDefault(),n.query(e))},!1),this.els.input.addEventListener("click",function(t){t.stopPropagation()},!1),this.els.input.addEventListener("input",function(s){var r=s.target.value.trim();r.length?q(n.els.reset,F.hidden):L(n.els.reset,F.hidden),n.options.autoComplete&&r!==e&&(e=r,t&&clearTimeout(t),t=setTimeout(function(){r.length>=n.options.autoCompleteMinLength&&n.query(r)},200))},!1),this.els.reset.addEventListener("click",function(t){n.els.input.focus(),n.els.input.value="",n.lastQuery="",L(n.els.reset,F.hidden),n.clearResults()},!1),this.options.targetType===v&&this.els.button.addEventListener("click",function(t){t.stopPropagation(),E(n.els.control,F.glass.expanded)?n.collapse():n.expand()},!1)},B.prototype.query=function(t){var e=this;this.provider||(this.provider=this.newProvider());var n=this.provider.getParameters({query:t,key:this.options.key,lang:this.options.lang,countrycodes:this.options.countrycodes,limit:this.options.limit});if(this.lastQuery!==t||!this.els.result.firstChild){this.lastQuery=t,this.clearResults(),L(this.els.reset,F.spin);var s={url:n.url,data:n.params};n.callbackName&&(s.jsonp=!0,s.callbackName=n.callbackName),function(t){return new Promise(function(e,n){var s=function(t,e){return e&&"object"==_typeof(e)&&(t+=(/\?/.test(t)?"&":"?")+function t(e){return Object.keys(e).reduce(function(n,s){return n.push("object"==_typeof(e[s])?t(e[s]):encodeURIComponent(s)+"="+encodeURIComponent(e[s])),n},[]).join("&")}(e)),t}(t.url,t.data);t.jsonp?function(t,e,n){var s=document.head,r=document.createElement("script"),o="f"+Math.round(Math.random()*Date.now());r.setAttribute("src",t+(0<t.indexOf("?")?"&":"?")+e+"="+o),window[o]=function(t){window[o]=void 0,setTimeout(function(){return s.removeChild(r)},0),n(t)},s.appendChild(r)}(s,t.callbackName,e):fetch(s,{method:"GET",mode:"cors",credentials:"same-origin"}).then(function(t){return t.json()}).then(e).catch(n)})}(s).then(function(t){e.options.debug&&console.info(t),q(e.els.reset,F.spin);var n=e.provider.handleResponse(t);n&&(e.createList(n),e.listenMapClick())}).catch(function(t){q(e.els.reset,F.spin);var n=j("li","<h5>Error! No internet connection?</h5>");e.els.result.appendChild(n)})}},B.prototype.createList=function(t){var e=this,n=this.els.result;t.forEach(function(t){var s;switch(e.options.provider){case w:s='<span class="'+F.road+'">'+t.address.name+"</span>";break;default:s=e.addressTemplate(t.address)}var r=j("li",'<a href="#">'+s+"</a>");r.addEventListener("click",function(n){n.preventDefault(),e.chosen(t,s,t.address,t.original)},!1),n.appendChild(r)})},B.prototype.chosen=function(t,e,n,s){var r=this.Base.getMap(),o=[parseFloat(t.lon),parseFloat(t.lat)],i=r.getView().getProjection(),l=a.transform(o,"EPSG:4326",i),c=t.bbox;c=c&&a.transformExtent(c,"EPSG:4326",i);var u={formatted:e,details:n,original:s};if(!1===this.options.keepOpen&&this.clearResults(!0),!0===this.options.preventDefault)this.Base.dispatchEvent({type:f,address:u,coordinate:l,bbox:c});else{c?r.getView().fit(c,{duration:500}):function(t,e,n,s){s=s||2.388657133911758,n=n||500,r.getView().animate({duration:n,resolution:s},{duration:n,center:e})}(0,l);var d=this.createFeature(l,u);this.Base.dispatchEvent({type:f,address:u,feature:d,coordinate:l,bbox:c})}},B.prototype.createFeature=function(t){var e=new i(new o(t));return this.addLayer(),e.setStyle(this.options.featureStyle),e.setId(C("geocoder-ft-")),this.getSource().addFeature(e),e},B.prototype.addressTemplate=function(t){var e=[];return t.name&&e.push(['<span class="',F.road,'">{name}</span>'].join("")),(t.road||t.building||t.house_number)&&e.push(['<span class="',F.road,'">{building} {road} {house_number}</span>'].join("")),(t.city||t.town||t.village)&&e.push(['<span class="',F.city,'">{postcode} {city} {town} {village}</span>'].join("")),(t.state||t.country)&&e.push(['<span class="',F.country,'">{state} {country}</span>'].join("")),function(t,e){return t.replace(/\{ *([\w_-]+) *\}/g,function(t,n){return function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}(void 0===e[n]?"":e[n])})}(e.join("<br>"),t)},B.prototype.newProvider=function(){switch(this.options.provider){case w:return new A;case"mapquest":return new O;case"photon":return new I;case"bing":return new D;case"opencage":return new M;default:return this.options.provider}},B.prototype.expand=function(){var t=this;q(this.els.input,F.spin),L(this.els.control,F.glass.expanded),window.setTimeout(function(){return t.els.input.focus()},100),this.listenMapClick()},B.prototype.collapse=function(){this.els.input.value="",this.els.input.blur(),L(this.els.reset,F.hidden),q(this.els.control,F.glass.expanded),this.clearResults()},B.prototype.listenMapClick=function(){if(!this.registeredListeners.mapClick){var t=this,e=this.Base.getMap().getTargetElement();this.registeredListeners.mapClick=!0,e.addEventListener("click",{handleEvent:function(n){t.clearResults(!0),e.removeEventListener(n.type,this,!1),t.registeredListeners.mapClick=!1}},!1)}},B.prototype.clearResults=function(t){t&&this.options.targetType===v?this.collapse():function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}(this.els.result)},B.prototype.getSource=function(){return this.layer.getSource()},B.prototype.addLayer=function(){var t=this,e=!1,n=this.Base.getMap();n.getLayers().forEach(function(n){n===t.layer&&(e=!0)}),e||n.addLayer(this.layer)},function(t){function s(r,o){if(void 0===r&&(r=g),void 0===o&&(o={}),!(this instanceof s))return new s;var i;k("string"==typeof r,"@param `type` should be string!"),k(r===g||r===y,"@param 'type' should be '"+g+"'\n        or '"+y+"'!"),k("object"==_typeof(o),"@param `options` should be object!"),b.featureStyle=[new e({image:new n({scale:.7,src:"//cdn.rawgit.com/jonataswalker/map-utils/master/images/marker.png"})})],this.options=function(t,e){var n={};for(var s in t)n[s]=t[s];for(var r in e)n[r]=e[r];return n}(b,o),this.container=void 0;var a=new R(this);r===g&&(this.container=a.els.container,i=new B(this,a.els),this.layer=i.layer),t.call(this,{element:this.container})}return t&&(s.__proto__=t),((s.prototype=Object.create(t&&t.prototype)).constructor=s).prototype.getLayer=function(){return this.layer},s.prototype.getSource=function(){return this.getLayer().getSource()},s.prototype.setProvider=function(t){this.options.provider=t},s.prototype.setProviderKey=function(t){this.options.key=t},s}(t)});

},{"ol/Feature":13,"ol/control/Control":51,"ol/geom/Point":137,"ol/layer/Vector":196,"ol/proj":205,"ol/source/Vector":277,"ol/style/Icon":294,"ol/style/Style":302}],8:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t(require("ol/control/Control"),require("ol/Observable")):"function"==typeof define&&define.amd?define(["ol/control/Control","ol/Observable"],t):(void 0).LayerSwitcher=t((void 0).ol.control.Control,(void 0).ol.Observable)}(0,function(e,t){e="default"in e?e.default:e;var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==_typeof(t)&&"function"!=typeof t?e:t},i="layer-switcher-",a=function(a){function l(e){n(this,l);var t=e||{},r=t.tipLabel?t.tipLabel:"Legend",i=document.createElement("div"),a=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,{element:i,target:t.target}));a.activationMode=t.activationMode||"mouseover";var s=void 0!==t.collapseLabel?t.collapseLabel:"»",c=void 0!==t.label?t.label:"";a.groupSelectStyle=l.getGroupSelectStyle(t.groupSelectStyle),a.reverse=!1!==t.reverse,a.mapListeners=[],a.hiddenClassName="ol-unselectable ol-control layer-switcher",l.isTouchDevice_()&&(a.hiddenClassName+=" touch"),a.shownClassName="shown",i.className=a.hiddenClassName;var u=document.createElement("button");u.setAttribute("title",r),i.appendChild(u),a.panel=document.createElement("div"),a.panel.className="panel",i.appendChild(a.panel),l.enableTouchScroll_(a.panel);var d=a;return u.textContent=c,"click"==a.activationMode?(i.classList.add("activationModeClick"),u.onclick=function(e){e=e||window.event,d.element.classList.contains(d.shownClassName)?(d.hidePanel(),u.textContent=c):(d.showPanel(),u.textContent=s),e.preventDefault()},o(a)):(u.onmouseover=function(e){d.showPanel()},u.onclick=function(e){e=e||window.event,d.showPanel(),e.preventDefault()},d.panel.onmouseout=function(e){e=e||window.event,d.panel.contains(e.toElement||e.relatedTarget)||d.hidePanel()},a)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,e),r(l,[{key:"setMap",value:function(e){for(var n=0;n<this.mapListeners.length;n++)t.unByKey(this.mapListeners[n]);if(this.mapListeners.length=0,function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0}(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"setMap",this).call(this,e),e){if(this.renderPanel(),"click"==this.activationMode)return;var r=this;this.mapListeners.push(e.on("pointerdown",function(){r.hidePanel()}))}}},{key:"showPanel",value:function(){this.element.classList.contains(this.shownClassName)||(this.element.classList.add(this.shownClassName),this.renderPanel())}},{key:"hidePanel",value:function(){this.element.classList.contains(this.shownClassName)&&this.element.classList.remove(this.shownClassName)}},{key:"renderPanel",value:function(){this.dispatchEvent({type:"render"}),l.renderPanel(this.getMap(),this.panel,{groupSelectStyle:this.groupSelectStyle,reverse:this.reverse}),this.dispatchEvent({type:"rendercomplete"})}}],[{key:"renderPanel",value:function(e,t,n){var r=new Event("render");for(t.dispatchEvent(r),(n=n||{}).groupSelectStyle=l.getGroupSelectStyle(n.groupSelectStyle),l.ensureTopVisibleBaseLayerShown_(e);t.firstChild;)t.removeChild(t.firstChild);l.forEachRecursive(e,function(e,t,n){e.set("indeterminate",!1)}),"children"===n.groupSelectStyle||"none"===n.groupSelectStyle?l.setGroupVisibility(e):"group"===n.groupSelectStyle&&l.setChildVisibility(e);var o=document.createElement("ul");t.appendChild(o),l.renderLayers_(e,e,o,n,function(r){l.renderPanel(e,t,n)});var i=new Event("rendercomplete");t.dispatchEvent(i)}},{key:"isBaseGroup",value:function(e){var t=e.getLayers?e.getLayers().getArray():[];return t.length&&"base"===t[0].get("type")}},{key:"setGroupVisibility",value:function(e){l.getGroupsAndLayers(e,function(e){return e.getLayers&&!e.get("combine")&&!l.isBaseGroup(e)}).reverse().forEach(function(e){var t=e.getLayersArray().map(function(e){return e.getVisible()});t.every(function(e){return!0===e})?(e.setVisible(!0),e.set("indeterminate",!1)):t.every(function(e){return!1===e})?(e.setVisible(!1),e.set("indeterminate",!1)):(e.setVisible(!0),e.set("indeterminate",!0))})}},{key:"setChildVisibility",value:function(e){l.getGroupsAndLayers(e,function(e){return e.getLayers&&!e.get("combine")&&!l.isBaseGroup(e)}).forEach(function(e){var t=e.getVisible(),n=e.get("indeterminate");e.getLayers().getArray().forEach(function(e){e.set("indeterminate",!1),t&&!n||!e.getVisible()||e.set("indeterminate",!0)})})}},{key:"ensureTopVisibleBaseLayerShown_",value:function(e){var t;l.forEachRecursive(e,function(e,n,r){"base"===e.get("type")&&e.getVisible()&&(t=e)}),t&&l.setVisible_(e,t,!0)}},{key:"getGroupsAndLayers",value:function(e,t){var n=[];return t=t||function(e,t,n){return!0},l.forEachRecursive(e,function(e,r,o){e.get("title")&&t(e,r,o)&&n.push(e)}),n}},{key:"setVisible_",value:function(e,t,n,r){t.setVisible(n),n&&"base"===t.get("type")&&l.forEachRecursive(e,function(e,n,r){e!=t&&"base"===e.get("type")&&e.setVisible(!1)}),t.getLayers&&!t.get("combine")&&"children"===r&&t.getLayers().forEach(function(n){l.setVisible_(e,n,t.getVisible(),r)})}},{key:"renderLayer_",value:function(e,t,n,r,o){var a=document.createElement("li"),s=t.get("title"),c=l.uuid(),u=document.createElement("label");if(t.getLayers&&!t.get("combine")){var d=l.isBaseGroup(t);if(a.classList.add("group"),d&&a.classList.add(i+"base-group"),t.get("fold")){a.classList.add(i+"fold"),a.classList.add(i+t.get("fold"));var p=document.createElement("button");p.onclick=function(e){e=e||window.event,l.toggleFold_(t,a),e.preventDefault()},a.appendChild(p)}if(!d&&"none"!=r.groupSelectStyle){var f=document.createElement("input");f.type="checkbox",f.id=c,f.checked=t.getVisible(),f.indeterminate=t.get("indeterminate"),f.onchange=function(n){l.setVisible_(e,t,n.target.checked,r.groupSelectStyle),o(t)},a.appendChild(f),u.htmlFor=c}u.innerHTML=s,a.appendChild(u);var y=document.createElement("ul");a.appendChild(y),l.renderLayers_(e,t,y,r,o)}else{a.className="layer";var h=document.createElement("input");"base"===t.get("type")?(h.type="radio",h.name="base"):h.type="checkbox",h.id=c,h.checked=t.get("visible"),h.indeterminate=t.get("indeterminate"),h.onchange=function(n){l.setVisible_(e,t,n.target.checked,r.groupSelectStyle),o(t)},a.appendChild(h),u.htmlFor=c,u.innerHTML=s;var v=e.getView().getResolution();(v>t.getMaxResolution()||v<t.getMinResolution())&&(u.className+=" disabled"),a.appendChild(u)}return a}},{key:"renderLayers_",value:function(e,t,n,r,o){var i=t.getLayers().getArray().slice();r.reverse&&(i=i.reverse());for(var a,s=0;s<i.length;s++)(a=i[s]).get("title")&&n.appendChild(l.renderLayer_(e,a,s,r,o))}},{key:"forEachRecursive",value:function(e,t){e.getLayers().forEach(function(e,n,r){t(e,n,r),e.getLayers&&l.forEachRecursive(e,t)})}},{key:"uuid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}},{key:"enableTouchScroll_",value:function(e){if(l.isTouchDevice_()){var t=0;e.addEventListener("touchstart",function(e){t=this.scrollTop+e.touches[0].pageY},!1),e.addEventListener("touchmove",function(e){this.scrollTop=t-e.touches[0].pageY},!1)}}},{key:"isTouchDevice_",value:function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}},{key:"toggleFold_",value:function(e,t){t.classList.remove(i+e.get("fold")),e.set("fold","open"===e.get("fold")?"close":"open"),t.classList.add(i+e.get("fold"))}},{key:"getGroupSelectStyle",value:function(e){return["none","children","group"].indexOf(e)>=0?e:"children"}}]),l}();return window.ol&&window.ol.control&&(window.ol.control.LayerSwitcher=a),a});

},{"ol/Observable":30,"ol/control/Control":51}],9:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _util=require("./util.js"),__extends=function(){var t=function(r,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(r,e)};return function(r,e){function o(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),AssertionError=function(t){function r(r){var e=this,o="Assertion failed. See https://openlayers.org/en/"+("latest"===_util.VERSION?_util.VERSION:"v"+_util.VERSION.split("-")[0])+"/doc/errors/#"+r+" for details.";return(e=t.call(this,o)||this).code=r,e.name="AssertionError",e.message=o,e}return __extends(r,t),r}(Error),_default=AssertionError;exports.default=_default;

},{"./util.js":313}],10:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.CollectionEvent=void 0;var _AssertionError=_interopRequireDefault(require("./AssertionError.js")),_Object=_interopRequireDefault(require("./Object.js")),_CollectionEventType=_interopRequireDefault(require("./CollectionEventType.js")),_Event=_interopRequireDefault(require("./events/Event.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Property={LENGTH:"length"},CollectionEvent=function(t){function e(e,r,n){var o=t.call(this,e)||this;return o.element=r,o.index=n,o}return __extends(e,t),e}(_Event.default);exports.CollectionEvent=CollectionEvent;var Collection=function(t){function e(e,r){var n=t.call(this)||this,o=r||{};if(n.unique_=!!o.unique,n.array_=e||[],n.unique_)for(var i=0,s=n.array_.length;i<s;++i)n.assertUnique_(n.array_[i],i);return n.updateLength_(),n}return __extends(e,t),e.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},e.prototype.extend=function(t){for(var e=0,r=t.length;e<r;++e)this.push(t[e]);return this},e.prototype.forEach=function(t){for(var e=this.array_,r=0,n=e.length;r<n;++r)t(e[r],r,e)},e.prototype.getArray=function(){return this.array_},e.prototype.item=function(t){return this.array_[t]},e.prototype.getLength=function(){return this.get(Property.LENGTH)},e.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new CollectionEvent(_CollectionEventType.default.ADD,e,t))},e.prototype.pop=function(){return this.removeAt(this.getLength()-1)},e.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},e.prototype.remove=function(t){for(var e=this.array_,r=0,n=e.length;r<n;++r)if(e[r]===t)return this.removeAt(r)},e.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(_CollectionEventType.default.REMOVE,e,t)),e},e.prototype.setAt=function(t,e){var r=this.getLength();if(t<r){this.unique_&&this.assertUnique_(e,t);var n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new CollectionEvent(_CollectionEventType.default.REMOVE,n,t)),this.dispatchEvent(new CollectionEvent(_CollectionEventType.default.ADD,e,t))}else{for(var o=r;o<t;++o)this.insertAt(o,void 0);this.insertAt(t,e)}},e.prototype.updateLength_=function(){this.set(Property.LENGTH,this.array_.length)},e.prototype.assertUnique_=function(t,e){for(var r=0,n=this.array_.length;r<n;++r)if(this.array_[r]===t&&r!==e)throw new _AssertionError.default(58)},e}(_Object.default),_default=Collection;exports.default=_default;

},{"./AssertionError.js":9,"./CollectionEventType.js":11,"./Object.js":28,"./events/Event.js":65}],11:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={ADD:"add",REMOVE:"remove"};exports.default=_default;

},{}],12:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Disposable=function(){function e(){this.disposed=!1}return e.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},e.prototype.disposeInternal=function(){},e}(),_default=Disposable;exports.default=_default;

},{}],13:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createStyleFunction=createStyleFunction,exports.default=void 0;var _Object=_interopRequireWildcard(require("./Object.js")),_EventType=_interopRequireDefault(require("./events/EventType.js")),_asserts=require("./asserts.js"),_events=require("./events.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=n?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Feature=function(e){function t(t){var r=e.call(this)||this;if(r.id_=void 0,r.geometryName_="geometry",r.style_=null,r.styleFunction_=void 0,r.geometryChangeKey_=null,r.addEventListener((0,_Object.getChangeEventType)(r.geometryName_),r.handleGeometryChanged_),t)if("function"==typeof t.getSimplifiedGeometry){var n=t;r.setGeometry(n)}else{var o=t;r.setProperties(o)}return r}return __extends(t,e),t.prototype.clone=function(){var e=new t(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());var r=this.getGeometry();r&&e.setGeometry(r.clone());var n=this.getStyle();return n&&e.setStyle(n),e},t.prototype.getGeometry=function(){return this.get(this.geometryName_)},t.prototype.getId=function(){return this.id_},t.prototype.getGeometryName=function(){return this.geometryName_},t.prototype.getStyle=function(){return this.style_},t.prototype.getStyleFunction=function(){return this.styleFunction_},t.prototype.handleGeometryChange_=function(){this.changed()},t.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&((0,_events.unlistenByKey)(this.geometryChangeKey_),this.geometryChangeKey_=null);var e=this.getGeometry();e&&(this.geometryChangeKey_=(0,_events.listen)(e,_EventType.default.CHANGE,this.handleGeometryChange_,this)),this.changed()},t.prototype.setGeometry=function(e){this.set(this.geometryName_,e)},t.prototype.setStyle=function(e){this.style_=e,this.styleFunction_=e?createStyleFunction(e):void 0,this.changed()},t.prototype.setId=function(e){this.id_=e,this.changed()},t.prototype.setGeometryName=function(e){this.removeEventListener((0,_Object.getChangeEventType)(this.geometryName_),this.handleGeometryChanged_),this.geometryName_=e,this.addEventListener((0,_Object.getChangeEventType)(this.geometryName_),this.handleGeometryChanged_),this.handleGeometryChanged_()},t}(_Object.default);function createStyleFunction(e){return"function"==typeof e?e:(Array.isArray(e)?t=e:((0,_asserts.assert)("function"==typeof e.getZIndex,41),t=[e]),function(){return t});var t}var _default=Feature;exports.default=_default;

},{"./Object.js":28,"./asserts.js":45,"./events.js":64,"./events/EventType.js":66}],14:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Event=_interopRequireDefault(require("./events/Event.js")),_Object=_interopRequireWildcard(require("./Object.js")),_EventType=_interopRequireDefault(require("./events/EventType.js")),_Polygon=require("./geom/Polygon.js"),_proj=require("./proj.js"),_math=require("./math.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return _getRequireWildcardCache=function(){return t},t}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;if(null===t||"object"!==_typeof(t)&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=r?Object.getOwnPropertyDescriptor(t,n):null;i&&(i.get||i.set)?Object.defineProperty(o,n,i):o[n]=t[n]}return o.default=t,e&&e.set(t,o),o}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),Property={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},GeolocationError=function(t){function e(e){var o=t.call(this,_EventType.default.ERROR)||this;return o.code=e.code,o.message=e.message,o}return __extends(e,t),e}(_Event.default),Geolocation=function(t){function e(e){var o=t.call(this)||this,r=e||{};return o.position_=null,o.transform_=_proj.identityTransform,o.watchId_=void 0,o.addEventListener((0,_Object.getChangeEventType)(Property.PROJECTION),o.handleProjectionChanged_),o.addEventListener((0,_Object.getChangeEventType)(Property.TRACKING),o.handleTrackingChanged_),void 0!==r.projection&&o.setProjection(r.projection),void 0!==r.trackingOptions&&o.setTrackingOptions(r.trackingOptions),o.setTracking(void 0!==r.tracking&&r.tracking),o}return __extends(e,t),e.prototype.disposeInternal=function(){this.setTracking(!1),t.prototype.disposeInternal.call(this)},e.prototype.handleProjectionChanged_=function(){var t=this.getProjection();t&&(this.transform_=(0,_proj.getTransformFromProjections)((0,_proj.get)("EPSG:4326"),t),this.position_&&this.set(Property.POSITION,this.transform_(this.position_)))},e.prototype.handleTrackingChanged_=function(){if("geolocation"in navigator){var t=this.getTracking();t&&void 0===this.watchId_?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):t||void 0===this.watchId_||(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}},e.prototype.positionChange_=function(t){var e=t.coords;this.set(Property.ACCURACY,e.accuracy),this.set(Property.ALTITUDE,null===e.altitude?void 0:e.altitude),this.set(Property.ALTITUDE_ACCURACY,null===e.altitudeAccuracy?void 0:e.altitudeAccuracy),this.set(Property.HEADING,null===e.heading?void 0:(0,_math.toRadians)(e.heading)),this.position_?(this.position_[0]=e.longitude,this.position_[1]=e.latitude):this.position_=[e.longitude,e.latitude];var o=this.transform_(this.position_);this.set(Property.POSITION,o),this.set(Property.SPEED,null===e.speed?void 0:e.speed);var r=(0,_Polygon.circular)(this.position_,e.accuracy);r.applyTransform(this.transform_),this.set(Property.ACCURACY_GEOMETRY,r),this.changed()},e.prototype.positionError_=function(t){this.dispatchEvent(new GeolocationError(t))},e.prototype.getAccuracy=function(){return this.get(Property.ACCURACY)},e.prototype.getAccuracyGeometry=function(){return this.get(Property.ACCURACY_GEOMETRY)||null},e.prototype.getAltitude=function(){return this.get(Property.ALTITUDE)},e.prototype.getAltitudeAccuracy=function(){return this.get(Property.ALTITUDE_ACCURACY)},e.prototype.getHeading=function(){return this.get(Property.HEADING)},e.prototype.getPosition=function(){return this.get(Property.POSITION)},e.prototype.getProjection=function(){return this.get(Property.PROJECTION)},e.prototype.getSpeed=function(){return this.get(Property.SPEED)},e.prototype.getTracking=function(){return this.get(Property.TRACKING)},e.prototype.getTrackingOptions=function(){return this.get(Property.TRACKING_OPTIONS)},e.prototype.setProjection=function(t){this.set(Property.PROJECTION,(0,_proj.get)(t))},e.prototype.setTracking=function(t){this.set(Property.TRACKING,t)},e.prototype.setTrackingOptions=function(t){this.set(Property.TRACKING_OPTIONS,t)},e}(_Object.default),_default=Geolocation;exports.default=_default;

},{"./Object.js":28,"./events/Event.js":65,"./events/EventType.js":66,"./geom/Polygon.js":138,"./math.js":201,"./proj.js":205}],15:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.listenImage=listenImage,exports.default=void 0;var _EventType=_interopRequireDefault(require("./events/EventType.js")),_ImageBase=_interopRequireDefault(require("./ImageBase.js")),_ImageState=_interopRequireDefault(require("./ImageState.js")),_has=require("./has.js"),_extent=require("./extent.js"),_events=require("./events.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),ImageWrapper=function(e){function t(t,n,a,i,s,r){var o=e.call(this,t,n,a,_ImageState.default.IDLE)||this;return o.src_=i,o.image_=new Image,null!==s&&(o.image_.crossOrigin=s),o.unlisten_=null,o.state=_ImageState.default.IDLE,o.imageLoadFunction_=r,o}return __extends(t,e),t.prototype.getImage=function(){return this.image_},t.prototype.handleImageError_=function(){this.state=_ImageState.default.ERROR,this.unlistenImage_(),this.changed()},t.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=(0,_extent.getHeight)(this.extent)/this.image_.height),this.state=_ImageState.default.LOADED,this.unlistenImage_(),this.changed()},t.prototype.load=function(){this.state!=_ImageState.default.IDLE&&this.state!=_ImageState.default.ERROR||(this.state=_ImageState.default.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},t.prototype.setImage=function(e){this.image_=e},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t}(_ImageBase.default);function listenImage(e,t,n){var a=e;if(a.src&&_has.IMAGE_DECODE){var i=a.decode(),s=!0;return i.then(function(){s&&t()}).catch(function(e){s&&("EncodingError"===e.name&&"Invalid image type."===e.message?t():n())}),function(){s=!1}}var r=[(0,_events.listenOnce)(a,_EventType.default.LOAD,t),(0,_events.listenOnce)(a,_EventType.default.ERROR,n)];return function(){r.forEach(_events.unlistenByKey)}}var _default=ImageWrapper;exports.default=_default;

},{"./ImageBase.js":16,"./ImageState.js":18,"./events.js":64,"./events/EventType.js":66,"./extent.js":70,"./has.js":159}],16:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Target=_interopRequireDefault(require("./events/Target.js")),_EventType=_interopRequireDefault(require("./events/EventType.js")),_util=require("./util.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ImageBase=function(t){function e(e,r,n,o){var u=t.call(this)||this;return u.extent=e,u.pixelRatio_=n,u.resolution=r,u.state=o,u}return __extends(e,t),e.prototype.changed=function(){this.dispatchEvent(_EventType.default.CHANGE)},e.prototype.getExtent=function(){return this.extent},e.prototype.getImage=function(){return(0,_util.abstract)()},e.prototype.getPixelRatio=function(){return this.pixelRatio_},e.prototype.getResolution=function(){return this.resolution},e.prototype.getState=function(){return this.state},e.prototype.load=function(){(0,_util.abstract)()},e}(_Target.default),_default=ImageBase;exports.default=_default;

},{"./events/EventType.js":66,"./events/Target.js":68,"./util.js":313}],17:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ImageBase=_interopRequireDefault(require("./ImageBase.js")),_ImageState=_interopRequireDefault(require("./ImageState.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function r(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),ImageCanvas=function(t){function e(e,a,r,o,n){var u=this,i=void 0!==n?_ImageState.default.IDLE:_ImageState.default.LOADED;return(u=t.call(this,e,a,r,i)||this).loader_=void 0!==n?n:null,u.canvas_=o,u.error_=null,u}return __extends(e,t),e.prototype.getError=function(){return this.error_},e.prototype.handleLoad_=function(t){t?(this.error_=t,this.state=_ImageState.default.ERROR):this.state=_ImageState.default.LOADED,this.changed()},e.prototype.load=function(){this.state==_ImageState.default.IDLE&&(this.state=_ImageState.default.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))},e.prototype.getImage=function(){return this.canvas_},e}(_ImageBase.default),_default=ImageCanvas;exports.default=_default;

},{"./ImageBase.js":16,"./ImageState.js":18}],18:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};exports.default=_default;

},{}],19:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Tile=_interopRequireDefault(require("./Tile.js")),_TileState=_interopRequireDefault(require("./TileState.js")),_dom=require("./dom.js"),_Image=require("./Image.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ImageTile=function(t){function e(e,i,n,a,r,s){var o=t.call(this,e,i,s)||this;return o.crossOrigin_=a,o.src_=n,o.image_=new Image,null!==a&&(o.image_.crossOrigin=a),o.unlisten_=null,o.tileLoadFunction_=r,o}return __extends(e,t),e.prototype.getImage=function(){return this.image_},e.prototype.getKey=function(){return this.src_},e.prototype.handleImageError_=function(){this.state=_TileState.default.ERROR,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()},e.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=_TileState.default.LOADED:this.state=_TileState.default.EMPTY,this.unlistenImage_(),this.changed()},e.prototype.load=function(){this.state==_TileState.default.ERROR&&(this.state=_TileState.default.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==_TileState.default.IDLE&&(this.state=_TileState.default.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=(0,_Image.listenImage)(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(_Tile.default);function getBlankImage(){var t=(0,_dom.createCanvasContext2D)(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}var _default=ImageTile;exports.default=_default;

},{"./Image.js":15,"./Tile.js":34,"./TileState.js":38,"./dom.js":62}],20:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Kinetic=function(){function t(t,i,n){this.decay_=t,this.minVelocity_=i,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}return t.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},t.prototype.update=function(t,i){this.points_.push(t,i,Date.now())},t.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,i=this.points_.length-3;if(this.points_[i+2]<t)return!1;for(var n=i-3;n>0&&this.points_[n+2]>t;)n-=3;var e=this.points_[i+2]-this.points_[n+2];if(e<1e3/60)return!1;var s=this.points_[i]-this.points_[n],o=this.points_[i+1]-this.points_[n+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/e,this.initialVelocity_>this.minVelocity_},t.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},t.prototype.getAngle=function(){return this.angle_},t}(),_default=Kinetic;exports.default=_default;

},{}],21:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Composite=_interopRequireDefault(require("./renderer/Composite.js")),_PluggableMap=_interopRequireDefault(require("./PluggableMap.js")),_obj=require("./obj.js"),_control=require("./control.js"),_interaction=require("./interaction.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Map=function(e){function t(t){return(t=(0,_obj.assign)({},t)).controls||(t.controls=(0,_control.defaults)()),t.interactions||(t.interactions=(0,_interaction.defaults)({onFocusOnly:!0})),e.call(this,t)||this}return __extends(t,e),t.prototype.createRenderer=function(){return new _Composite.default(this)},t}(_PluggableMap.default),_default=Map;exports.default=_default;

},{"./PluggableMap.js":33,"./control.js":49,"./interaction.js":161,"./obj.js":203,"./renderer/Composite.js":232}],22:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _MapEvent=_interopRequireDefault(require("./MapEvent.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),MapBrowserEvent=function(t){function e(e,o,n,r,i){var a=t.call(this,e,o,i)||this;return a.originalEvent=n,a.pixel_=null,a.coordinate_=null,a.dragging=void 0!==r&&r,a}return __extends(e,t),Object.defineProperty(e.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(t){this.pixel_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(t){this.coordinate_=t},enumerable:!1,configurable:!0}),e.prototype.preventDefault=function(){t.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},e.prototype.stopPropagation=function(){t.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()},e}(_MapEvent.default),_default=MapBrowserEvent;exports.default=_default;

},{"./MapEvent.js":25}],23:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Target=_interopRequireDefault(require("./events/Target.js")),_EventType=_interopRequireDefault(require("./events/EventType.js")),_MapBrowserEvent=_interopRequireDefault(require("./MapBrowserEvent.js")),_MapBrowserEventType=_interopRequireDefault(require("./MapBrowserEventType.js")),_EventType2=_interopRequireDefault(require("./pointer/EventType.js")),_has=require("./has.js"),_events=require("./events.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),MapBrowserEventHandler=function(e){function t(t,n){var i=e.call(this,t)||this;i.map_=t,i.clickTimeoutId_,i.dragging_=!1,i.dragListenerKeys_=[],i.moveTolerance_=n?n*_has.DEVICE_PIXEL_RATIO:_has.DEVICE_PIXEL_RATIO,i.down_=null;var r=i.map_.getViewport();return i.activePointers_=0,i.trackedTouches_={},i.element_=r,i.pointerdownListenerKey_=(0,_events.listen)(r,_EventType2.default.POINTERDOWN,i.handlePointerDown_,i),i.originalPointerMoveEvent_,i.relayedListenerKey_=(0,_events.listen)(r,_EventType2.default.POINTERMOVE,i.relayEvent_,i),i.boundHandleTouchMove_=i.handleTouchMove_.bind(i),i.element_.addEventListener(_EventType.default.TOUCHMOVE,i.boundHandleTouchMove_,!!_has.PASSIVE_EVENT_LISTENERS&&{passive:!1}),i}return __extends(t,e),t.prototype.emulateClick_=function(e){var t=new _MapBrowserEvent.default(_MapBrowserEventType.default.CLICK,this.map_,e);this.dispatchEvent(t),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new _MapBrowserEvent.default(_MapBrowserEventType.default.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var t=new _MapBrowserEvent.default(_MapBrowserEventType.default.SINGLECLICK,this.map_,e);this.dispatchEvent(t)}.bind(this),250)},t.prototype.updateActivePointers_=function(e){var t=e;t.type==_MapBrowserEventType.default.POINTERUP||t.type==_MapBrowserEventType.default.POINTERCANCEL?delete this.trackedTouches_[t.pointerId]:t.type==_MapBrowserEventType.default.POINTERDOWN&&(this.trackedTouches_[t.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},t.prototype.handlePointerUp_=function(e){this.updateActivePointers_(e);var t=new _MapBrowserEvent.default(_MapBrowserEventType.default.POINTERUP,this.map_,e);this.dispatchEvent(t),t.propagationStopped||this.dragging_||!this.isMouseActionButton_(e)||this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(_events.unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},t.prototype.isMouseActionButton_=function(e){return 0===e.button},t.prototype.handlePointerDown_=function(e){this.updateActivePointers_(e);var t=new _MapBrowserEvent.default(_MapBrowserEventType.default.POINTERDOWN,this.map_,e);this.dispatchEvent(t),this.down_=e,0===this.dragListenerKeys_.length&&(this.dragListenerKeys_.push((0,_events.listen)(document,_MapBrowserEventType.default.POINTERMOVE,this.handlePointerMove_,this),(0,_events.listen)(document,_MapBrowserEventType.default.POINTERUP,this.handlePointerUp_,this),(0,_events.listen)(this.element_,_MapBrowserEventType.default.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==document&&this.dragListenerKeys_.push((0,_events.listen)(this.element_.getRootNode(),_MapBrowserEventType.default.POINTERUP,this.handlePointerUp_,this)))},t.prototype.handlePointerMove_=function(e){if(this.isMoving_(e)){this.dragging_=!0;var t=new _MapBrowserEvent.default(_MapBrowserEventType.default.POINTERDRAG,this.map_,e,this.dragging_);this.dispatchEvent(t)}},t.prototype.relayEvent_=function(e){this.originalPointerMoveEvent_=e;var t=!(!this.down_||!this.isMoving_(e));this.dispatchEvent(new _MapBrowserEvent.default(e.type,this.map_,e,t))},t.prototype.handleTouchMove_=function(e){this.originalPointerMoveEvent_&&!this.originalPointerMoveEvent_.defaultPrevented||e.preventDefault()},t.prototype.isMoving_=function(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_},t.prototype.disposeInternal=function(){this.relayedListenerKey_&&((0,_events.unlistenByKey)(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(_EventType.default.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&((0,_events.unlistenByKey)(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(_events.unlistenByKey),this.dragListenerKeys_.length=0,this.element_=null,e.prototype.disposeInternal.call(this)},t}(_Target.default),_default=MapBrowserEventHandler;exports.default=_default;

},{"./MapBrowserEvent.js":22,"./MapBrowserEventType.js":24,"./events.js":64,"./events/EventType.js":66,"./events/Target.js":68,"./has.js":159,"./pointer/EventType.js":204}],24:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventType=_interopRequireDefault(require("./events/EventType.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={SINGLECLICK:"singleclick",CLICK:_EventType.default.CLICK,DBLCLICK:_EventType.default.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};exports.default=_default;

},{"./events/EventType.js":66}],25:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Event=_interopRequireDefault(require("./events/Event.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),MapEvent=function(t){function e(e,n,r){var o=t.call(this,e)||this;return o.map=n,o.frameState=void 0!==r?r:null,o}return __extends(e,t),e}(_Event.default),_default=MapEvent;exports.default=_default;

},{"./events/Event.js":65}],26:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"};exports.default=_default;

},{}],27:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};exports.default=_default;

},{}],28:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChangeEventType=getChangeEventType,exports.default=exports.ObjectEvent=void 0;var _Event=_interopRequireDefault(require("./events/Event.js")),_ObjectEventType=_interopRequireDefault(require("./ObjectEventType.js")),_Observable=_interopRequireDefault(require("./Observable.js")),_obj=require("./obj.js"),_util=require("./util.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ObjectEvent=function(e){function t(t,n,r){var s=e.call(this,t)||this;return s.key=n,s.oldValue=r,s}return __extends(t,e),t}(_Event.default);exports.ObjectEvent=ObjectEvent;var BaseObject=function(e){function t(t){var n=e.call(this)||this;return(0,_util.getUid)(n),n.values_=null,void 0!==t&&n.setProperties(t),n}return __extends(t,e),t.prototype.get=function(e){var t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t},t.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},t.prototype.getProperties=function(){return this.values_&&(0,_obj.assign)({},this.values_)||{}},t.prototype.hasProperties=function(){return!!this.values_},t.prototype.notify=function(e,t){var n;n=getChangeEventType(e),this.dispatchEvent(new ObjectEvent(n,e,t)),n=_ObjectEventType.default.PROPERTYCHANGE,this.dispatchEvent(new ObjectEvent(n,e,t))},t.prototype.set=function(e,t,n){var r=this.values_||(this.values_={});if(n)r[e]=t;else{var s=r[e];r[e]=t,s!==t&&this.notify(e,s)}},t.prototype.setProperties=function(e,t){for(var n in e)this.set(n,e[n],t)},t.prototype.unset=function(e,t){if(this.values_&&e in this.values_){var n=this.values_[e];delete this.values_[e],(0,_obj.isEmpty)(this.values_)&&(this.values_=null),t||this.notify(e,n)}},t}(_Observable.default),changeEventTypeCache={};function getChangeEventType(e){return changeEventTypeCache.hasOwnProperty(e)?changeEventTypeCache[e]:changeEventTypeCache[e]="change:"+e}var _default=BaseObject;exports.default=_default;

},{"./ObjectEventType.js":29,"./Observable.js":30,"./events/Event.js":65,"./obj.js":203,"./util.js":313}],29:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={PROPERTYCHANGE:"propertychange"};exports.default=_default;

},{}],30:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unByKey=unByKey,exports.default=void 0;var _Target=_interopRequireDefault(require("./events/Target.js")),_EventType=_interopRequireDefault(require("./events/EventType.js")),_events=require("./events.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Observable=function(e){function t(){var t=e.call(this)||this;return t.revision_=0,t}return __extends(t,e),t.prototype.changed=function(){++this.revision_,this.dispatchEvent(_EventType.default.CHANGE)},t.prototype.getRevision=function(){return this.revision_},t.prototype.on=function(e,t){if(Array.isArray(e)){for(var r=e.length,n=new Array(r),i=0;i<r;++i)n[i]=(0,_events.listen)(this,e[i],t);return n}return(0,_events.listen)(this,e,t)},t.prototype.once=function(e,t){var r;if(Array.isArray(e)){var n=e.length;r=new Array(n);for(var i=0;i<n;++i)r[i]=(0,_events.listenOnce)(this,e[i],t)}else r=(0,_events.listenOnce)(this,e,t);return t.ol_key=r,r},t.prototype.un=function(e,t){var r=t.ol_key;if(r)unByKey(r);else if(Array.isArray(e))for(var n=0,i=e.length;n<i;++n)this.removeEventListener(e[n],t);else this.removeEventListener(e,t)},t}(_Target.default);function unByKey(e){if(Array.isArray(e))for(var t=0,r=e.length;t<r;++t)(0,_events.unlistenByKey)(e[t]);else(0,_events.unlistenByKey)(e)}var _default=Observable;exports.default=_default;

},{"./events.js":64,"./events/EventType.js":66,"./events/Target.js":68}],31:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Object=_interopRequireWildcard(require("./Object.js")),_MapEventType=_interopRequireDefault(require("./MapEventType.js")),_OverlayPositioning=_interopRequireDefault(require("./OverlayPositioning.js")),_css=require("./css.js"),_extent=require("./extent.js"),_events=require("./events.js"),_dom=require("./dom.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=i?Object.getOwnPropertyDescriptor(e,o):null;r&&(r.get||r.set)?Object.defineProperty(n,o,r):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var __extends=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Property={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},Overlay=function(e){function t(t){var n=e.call(this)||this;n.options=t,n.id=t.id,n.insertFirst=void 0===t.insertFirst||t.insertFirst,n.stopEvent=void 0===t.stopEvent||t.stopEvent,n.element=document.createElement("div"),n.element.className=void 0!==t.className?t.className:"ol-overlay-container "+_css.CLASS_SELECTABLE,n.element.style.position="absolute",n.element.style.pointerEvents="auto";var i=t.autoPan;return i&&"object"!==_typeof(i)&&(i={animation:t.autoPanAnimation,margin:t.autoPanMargin}),n.autoPan=i||!1,n.rendered={transform_:"",visible:!0},n.mapPostrenderListenerKey=null,n.addEventListener((0,_Object.getChangeEventType)(Property.ELEMENT),n.handleElementChanged),n.addEventListener((0,_Object.getChangeEventType)(Property.MAP),n.handleMapChanged),n.addEventListener((0,_Object.getChangeEventType)(Property.OFFSET),n.handleOffsetChanged),n.addEventListener((0,_Object.getChangeEventType)(Property.POSITION),n.handlePositionChanged),n.addEventListener((0,_Object.getChangeEventType)(Property.POSITIONING),n.handlePositioningChanged),void 0!==t.element&&n.setElement(t.element),n.setOffset(void 0!==t.offset?t.offset:[0,0]),n.setPositioning(void 0!==t.positioning?t.positioning:_OverlayPositioning.default.TOP_LEFT),void 0!==t.position&&n.setPosition(t.position),n}return __extends(t,e),t.prototype.getElement=function(){return this.get(Property.ELEMENT)},t.prototype.getId=function(){return this.id},t.prototype.getMap=function(){return this.get(Property.MAP)},t.prototype.getOffset=function(){return this.get(Property.OFFSET)},t.prototype.getPosition=function(){return this.get(Property.POSITION)},t.prototype.getPositioning=function(){return this.get(Property.POSITIONING)},t.prototype.handleElementChanged=function(){(0,_dom.removeChildren)(this.element);var e=this.getElement();e&&this.element.appendChild(e)},t.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&((0,_dom.removeNode)(this.element),(0,_events.unlistenByKey)(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var e=this.getMap();if(e){this.mapPostrenderListenerKey=(0,_events.listen)(e,_MapEventType.default.POSTRENDER,this.render,this),this.updatePixelPosition();var t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}},t.prototype.render=function(){this.updatePixelPosition()},t.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},t.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.performAutoPan()},t.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},t.prototype.setElement=function(e){this.set(Property.ELEMENT,e)},t.prototype.setMap=function(e){this.set(Property.MAP,e)},t.prototype.setOffset=function(e){this.set(Property.OFFSET,e)},t.prototype.setPosition=function(e){this.set(Property.POSITION,e)},t.prototype.performAutoPan=function(){this.autoPan&&this.panIntoView(this.autoPan)},t.prototype.panIntoView=function(e){var t=this.getMap();if(t&&t.getTargetElement()&&this.get(Property.POSITION)){var n=this.getRect(t.getTargetElement(),t.getSize()),i=this.getElement(),o=this.getRect(i,[(0,_dom.outerWidth)(i),(0,_dom.outerHeight)(i)]),r=e||{},s=void 0===r.margin?20:r.margin;if(!(0,_extent.containsExtent)(n,o)){var a=o[0]-n[0],p=n[2]-o[2],l=o[1]-n[1],u=n[3]-o[3],d=[0,0];if(a<0?d[0]=a-s:p<0&&(d[0]=Math.abs(p)+s),l<0?d[1]=l-s:u<0&&(d[1]=Math.abs(u)+s),0!==d[0]||0!==d[1]){var f=t.getView().getCenterInternal(),y=t.getPixelFromCoordinateInternal(f),g=[y[0]+d[0],y[1]+d[1]],P=r.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(g),duration:P.duration,easing:P.easing})}}}},t.prototype.getRect=function(e,t){var n=e.getBoundingClientRect(),i=n.left+window.pageXOffset,o=n.top+window.pageYOffset;return[i,o,i+t[0],o+t[1]]},t.prototype.setPositioning=function(e){this.set(Property.POSITIONING,e)},t.prototype.setVisible=function(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)},t.prototype.updatePixelPosition=function(){var e=this.getMap(),t=this.getPosition();if(e&&e.isRendered()&&t){var n=e.getPixelFromCoordinate(t),i=e.getSize();this.updateRenderedPosition(n,i)}else this.setVisible(!1)},t.prototype.updateRenderedPosition=function(e,t){var n=this.element.style,i=this.getOffset(),o=this.getPositioning();this.setVisible(!0);var r=Math.round(e[0]+i[0])+"px",s=Math.round(e[1]+i[1])+"px",a="0%",p="0%";o==_OverlayPositioning.default.BOTTOM_RIGHT||o==_OverlayPositioning.default.CENTER_RIGHT||o==_OverlayPositioning.default.TOP_RIGHT?a="-100%":o!=_OverlayPositioning.default.BOTTOM_CENTER&&o!=_OverlayPositioning.default.CENTER_CENTER&&o!=_OverlayPositioning.default.TOP_CENTER||(a="-50%"),o==_OverlayPositioning.default.BOTTOM_LEFT||o==_OverlayPositioning.default.BOTTOM_CENTER||o==_OverlayPositioning.default.BOTTOM_RIGHT?p="-100%":o!=_OverlayPositioning.default.CENTER_LEFT&&o!=_OverlayPositioning.default.CENTER_CENTER&&o!=_OverlayPositioning.default.CENTER_RIGHT||(p="-50%");var l="translate("+a+", "+p+") translate("+r+", "+s+")";this.rendered.transform_!=l&&(this.rendered.transform_=l,n.transform=l,n.msTransform=l)},t.prototype.getOptions=function(){return this.options},t}(_Object.default),_default=Overlay;exports.default=_default;

},{"./MapEventType.js":26,"./Object.js":28,"./OverlayPositioning.js":32,"./css.js":61,"./dom.js":62,"./events.js":64,"./extent.js":70}],32:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"};exports.default=_default;

},{}],33:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Object=_interopRequireWildcard(require("./Object.js")),_Collection=_interopRequireDefault(require("./Collection.js")),_CollectionEventType=_interopRequireDefault(require("./CollectionEventType.js")),_EventType=_interopRequireDefault(require("./events/EventType.js")),_Group=_interopRequireDefault(require("./layer/Group.js")),_MapBrowserEvent=_interopRequireDefault(require("./MapBrowserEvent.js")),_MapBrowserEventHandler=_interopRequireDefault(require("./MapBrowserEventHandler.js")),_MapBrowserEventType=_interopRequireDefault(require("./MapBrowserEventType.js")),_MapEvent=_interopRequireDefault(require("./MapEvent.js")),_MapEventType=_interopRequireDefault(require("./MapEventType.js")),_MapProperty=_interopRequireDefault(require("./MapProperty.js")),_ObjectEventType=_interopRequireDefault(require("./ObjectEventType.js")),_EventType2=_interopRequireDefault(require("./pointer/EventType.js")),_EventType3=_interopRequireDefault(require("./render/EventType.js")),_TileQueue=_interopRequireWildcard(require("./TileQueue.js")),_View=_interopRequireDefault(require("./View.js")),_ViewHint=_interopRequireDefault(require("./ViewHint.js")),_has=require("./has.js"),_functions=require("./functions.js"),_transform=require("./transform.js"),_asserts=require("./asserts.js"),_extent=require("./extent.js"),_proj=require("./proj.js"),_size=require("./size.js"),_events=require("./events.js"),_dom=require("./dom.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,t&&t.set(e,r),r}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),PluggableMap=function(e){function t(t){var r=e.call(this)||this,n=createOptionsInternal(t);return r.boundHandleBrowserEvent_=r.handleBrowserEvent.bind(r),r.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,r.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:_has.DEVICE_PIXEL_RATIO,r.postRenderTimeoutHandle_,r.animationDelayKey_,r.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(r),r.coordinateToPixelTransform_=(0,_transform.create)(),r.pixelToCoordinateTransform_=(0,_transform.create)(),r.frameIndex_=0,r.frameState_=null,r.previousExtent_=null,r.viewPropertyListenerKey_=null,r.viewChangeListenerKey_=null,r.layerGroupPropertyListenerKeys_=null,r.viewport_=document.createElement("div"),r.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),r.viewport_.style.position="relative",r.viewport_.style.overflow="hidden",r.viewport_.style.width="100%",r.viewport_.style.height="100%",r.overlayContainer_=document.createElement("div"),r.overlayContainer_.style.position="absolute",r.overlayContainer_.style.zIndex="0",r.overlayContainer_.style.width="100%",r.overlayContainer_.style.height="100%",r.overlayContainer_.style.pointerEvents="none",r.overlayContainer_.className="ol-overlaycontainer",r.viewport_.appendChild(r.overlayContainer_),r.overlayContainerStopEvent_=document.createElement("div"),r.overlayContainerStopEvent_.style.position="absolute",r.overlayContainerStopEvent_.style.zIndex="0",r.overlayContainerStopEvent_.style.width="100%",r.overlayContainerStopEvent_.style.height="100%",r.overlayContainerStopEvent_.style.pointerEvents="none",r.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",r.viewport_.appendChild(r.overlayContainerStopEvent_),r.mapBrowserEventHandler_=null,r.moveTolerance_=t.moveTolerance,r.keyboardEventTarget_=n.keyboardEventTarget,r.keyHandlerKeys_=null,r.controls=n.controls||new _Collection.default,r.interactions=n.interactions||new _Collection.default,r.overlays_=n.overlays,r.overlayIdIndex_={},r.renderer_=null,r.handleResize_,r.postRenderFunctions_=[],r.tileQueue_=new _TileQueue.default(r.getTilePriority.bind(r),r.handleTileChange_.bind(r)),r.addEventListener((0,_Object.getChangeEventType)(_MapProperty.default.LAYERGROUP),r.handleLayerGroupChanged_),r.addEventListener((0,_Object.getChangeEventType)(_MapProperty.default.VIEW),r.handleViewChanged_),r.addEventListener((0,_Object.getChangeEventType)(_MapProperty.default.SIZE),r.handleSizeChanged_),r.addEventListener((0,_Object.getChangeEventType)(_MapProperty.default.TARGET),r.handleTargetChanged_),r.setProperties(n.values),r.controls.forEach(function(e){e.setMap(this)}.bind(r)),r.controls.addEventListener(_CollectionEventType.default.ADD,function(e){e.element.setMap(this)}.bind(r)),r.controls.addEventListener(_CollectionEventType.default.REMOVE,function(e){e.element.setMap(null)}.bind(r)),r.interactions.forEach(function(e){e.setMap(this)}.bind(r)),r.interactions.addEventListener(_CollectionEventType.default.ADD,function(e){e.element.setMap(this)}.bind(r)),r.interactions.addEventListener(_CollectionEventType.default.REMOVE,function(e){e.element.setMap(null)}.bind(r)),r.overlays_.forEach(r.addOverlayInternal_.bind(r)),r.overlays_.addEventListener(_CollectionEventType.default.ADD,function(e){this.addOverlayInternal_(e.element)}.bind(r)),r.overlays_.addEventListener(_CollectionEventType.default.REMOVE,function(e){var t=e.element.getId();void 0!==t&&delete this.overlayIdIndex_[t.toString()],e.element.setMap(null)}.bind(r)),r}return __extends(t,e),t.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},t.prototype.addControl=function(e){this.getControls().push(e)},t.prototype.addInteraction=function(e){this.getInteractions().push(e)},t.prototype.addLayer=function(e){this.getLayerGroup().getLayers().push(e)},t.prototype.addOverlay=function(e){this.getOverlays().push(e)},t.prototype.addOverlayInternal_=function(e){var t=e.getId();void 0!==t&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)},t.prototype.disposeInternal=function(){this.setTarget(null),e.prototype.disposeInternal.call(this)},t.prototype.forEachFeatureAtPixel=function(e,t,r){if(this.frameState_){var n=this.getCoordinateFromPixelInternal(e),i=void 0!==(r=void 0!==r?r:{}).hitTolerance?r.hitTolerance*this.frameState_.pixelRatio:0,o=void 0!==r.layerFilter?r.layerFilter:_functions.TRUE,a=!1!==r.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,i,a,t,null,o,null)}},t.prototype.getFeaturesAtPixel=function(e,t){var r=[];return this.forEachFeatureAtPixel(e,function(e){r.push(e)},t),r},t.prototype.forEachLayerAtPixel=function(e,t,r){if(this.frameState_){var n=r||{},i=void 0!==n.hitTolerance?n.hitTolerance*this.frameState_.pixelRatio:0,o=n.layerFilter||_functions.TRUE;return this.renderer_.forEachLayerAtPixel(e,this.frameState_,i,t,o)}},t.prototype.hasFeatureAtPixel=function(e,t){if(!this.frameState_)return!1;var r=this.getCoordinateFromPixelInternal(e),n=void 0!==(t=void 0!==t?t:{}).layerFilter?t.layerFilter:_functions.TRUE,i=void 0!==t.hitTolerance?t.hitTolerance*this.frameState_.pixelRatio:0,o=!1!==t.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,i,o,n,null)},t.prototype.getEventCoordinate=function(e){return this.getCoordinateFromPixel(this.getEventPixel(e))},t.prototype.getEventCoordinateInternal=function(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))},t.prototype.getEventPixel=function(e){var t=this.viewport_.getBoundingClientRect(),r="changedTouches"in e?e.changedTouches[0]:e;return[r.clientX-t.left,r.clientY-t.top]},t.prototype.getTarget=function(){return this.get(_MapProperty.default.TARGET)},t.prototype.getTargetElement=function(){var e=this.getTarget();return void 0!==e?"string"==typeof e?document.getElementById(e):e:null},t.prototype.getCoordinateFromPixel=function(e){return(0,_proj.toUserCoordinate)(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())},t.prototype.getCoordinateFromPixelInternal=function(e){var t=this.frameState_;return t?(0,_transform.apply)(t.pixelToCoordinateTransform,e.slice()):null},t.prototype.getControls=function(){return this.controls},t.prototype.getOverlays=function(){return this.overlays_},t.prototype.getOverlayById=function(e){var t=this.overlayIdIndex_[e.toString()];return void 0!==t?t:null},t.prototype.getInteractions=function(){return this.interactions},t.prototype.getLayerGroup=function(){return this.get(_MapProperty.default.LAYERGROUP)},t.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},t.prototype.getLoading=function(){for(var e=this.getLayerGroup().getLayerStatesArray(),t=0,r=e.length;t<r;++t){var n=e[t].layer.getSource();if(n&&n.loading)return!0}return!1},t.prototype.getPixelFromCoordinate=function(e){var t=(0,_proj.fromUserCoordinate)(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)},t.prototype.getPixelFromCoordinateInternal=function(e){var t=this.frameState_;return t?(0,_transform.apply)(t.coordinateToPixelTransform,e.slice(0,2)):null},t.prototype.getRenderer=function(){return this.renderer_},t.prototype.getSize=function(){return this.get(_MapProperty.default.SIZE)},t.prototype.getView=function(){return this.get(_MapProperty.default.VIEW)},t.prototype.getViewport=function(){return this.viewport_},t.prototype.getOverlayContainer=function(){return this.overlayContainer_},t.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},t.prototype.getTilePriority=function(e,t,r,n){return(0,_TileQueue.getTilePriority)(this.frameState_,e,t,r,n)},t.prototype.handleBrowserEvent=function(e,t){var r=t||e.type,n=new _MapBrowserEvent.default(r,this,e);this.handleMapBrowserEvent(n)},t.prototype.handleMapBrowserEvent=function(e){if(this.frameState_){var t=e.originalEvent,r=t.type;if(r===_EventType2.default.POINTERDOWN||r===_EventType.default.WHEEL||r===_EventType.default.KEYDOWN){var n=this.viewport_.getRootNode?this.viewport_.getRootNode():document,i=n===document?t.target:n.elementFromPoint(t.clientX,t.clientY);if(!n.contains(i)||this.overlayContainerStopEvent_.contains(i))return}e.frameState=this.frameState_;var o=this.getInteractions().getArray();if(!1!==this.dispatchEvent(e))for(var a=o.length-1;a>=0;a--){var s=o[a];if(s.getActive())if(!s.handleEvent(e))break}}},t.prototype.handlePostRender=function(){var e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){var r=this.maxTilesLoading_,n=r;if(e){var i=e.viewHints;if(i[_ViewHint.default.ANIMATING]||i[_ViewHint.default.INTERACTING]){var o=!_has.IMAGE_DECODE&&Date.now()-e.time>8;r=o?0:8,n=o?0:2}}t.getTilesLoading()<r&&(t.reprioritize(),t.loadMoreTiles(r,n))}!e||!this.hasListener(_EventType3.default.RENDERCOMPLETE)||e.animate||this.tileQueue_.getTilesLoading()||this.getLoading()||this.renderer_.dispatchRenderEvent(_EventType3.default.RENDERCOMPLETE,e);for(var a=this.postRenderFunctions_,s=0,l=a.length;s<l;++s)a[s](this,e);a.length=0},t.prototype.handleSizeChanged_=function(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()},t.prototype.handleTargetChanged_=function(e){var t;if(this.getTarget()&&(t=this.getTargetElement()),e.oldValue){for(var r=0,n=this.keyHandlerKeys_.length;r<n;++r)(0,_events.unlistenByKey)(this.keyHandlerKeys_[r]);this.keyHandlerKeys_=null,this.viewport_.removeEventListener(_EventType.default.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(_EventType.default.WHEEL,this.boundHandleBrowserEvent_),void 0!==this.handleResize_&&(removeEventListener(_EventType.default.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.mapBrowserEventHandler_.dispose(),(0,_dom.removeNode)(this.viewport_)}if(t){for(var i in t.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer()),this.mapBrowserEventHandler_=new _MapBrowserEventHandler.default(this,this.moveTolerance_),_MapBrowserEventType.default)this.mapBrowserEventHandler_.addEventListener(_MapBrowserEventType.default[i],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(_EventType.default.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(_EventType.default.WHEEL,this.boundHandleBrowserEvent_,!!_has.PASSIVE_EVENT_LISTENERS&&{passive:!1});var o=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.keyHandlerKeys_=[(0,_events.listen)(o,_EventType.default.KEYDOWN,this.handleBrowserEvent,this),(0,_events.listen)(o,_EventType.default.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(_EventType.default.RESIZE,this.handleResize_,!1))}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()},t.prototype.handleTileChange_=function(){this.render()},t.prototype.handleViewPropertyChanged_=function(){this.render()},t.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&((0,_events.unlistenByKey)(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&((0,_events.unlistenByKey)(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=(0,_events.listen)(e,_ObjectEventType.default.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=(0,_events.listen)(e,_EventType.default.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()},t.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(_events.unlistenByKey),this.layerGroupPropertyListenerKeys_=null);var e=this.getLayerGroup();e&&(this.layerGroupPropertyListenerKeys_=[(0,_events.listen)(e,_ObjectEventType.default.PROPERTYCHANGE,this.render,this),(0,_events.listen)(e,_EventType.default.CHANGE,this.render,this)]),this.render()},t.prototype.isRendered=function(){return!!this.frameState_},t.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},t.prototype.redrawText=function(){for(var e=this.getLayerGroup().getLayerStatesArray(),t=0,r=e.length;t<r;++t){var n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}},t.prototype.render=function(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},t.prototype.removeControl=function(e){return this.getControls().remove(e)},t.prototype.removeInteraction=function(e){return this.getInteractions().remove(e)},t.prototype.removeLayer=function(e){return this.getLayerGroup().getLayers().remove(e)},t.prototype.removeOverlay=function(e){return this.getOverlays().remove(e)},t.prototype.renderFrame_=function(e){var t=this.getSize(),r=this.getView(),n=this.frameState_,i=null;if(void 0!==t&&(0,_size.hasArea)(t)&&r&&r.isDef()){var o=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=r.getState();i={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterItems:n?n.declutterItems:[],extent:(0,_extent.getForViewAndSize)(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{}}}if(this.frameState_=i,this.renderer_.renderFrame(i),i){if(i.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,i.postRenderFunctions),n)(!this.previousExtent_||!(0,_extent.isEmpty)(this.previousExtent_)&&!(0,_extent.equals)(i.extent,this.previousExtent_))&&(this.dispatchEvent(new _MapEvent.default(_MapEventType.default.MOVESTART,this,n)),this.previousExtent_=(0,_extent.createOrUpdateEmpty)(this.previousExtent_));this.previousExtent_&&!i.viewHints[_ViewHint.default.ANIMATING]&&!i.viewHints[_ViewHint.default.INTERACTING]&&!(0,_extent.equals)(i.extent,this.previousExtent_)&&(this.dispatchEvent(new _MapEvent.default(_MapEventType.default.MOVEEND,this,i)),(0,_extent.clone)(i.extent,this.previousExtent_))}this.dispatchEvent(new _MapEvent.default(_MapEventType.default.POSTRENDER,this,i)),this.postRenderTimeoutHandle_=setTimeout(this.handlePostRender.bind(this),0)},t.prototype.setLayerGroup=function(e){this.set(_MapProperty.default.LAYERGROUP,e)},t.prototype.setSize=function(e){this.set(_MapProperty.default.SIZE,e)},t.prototype.setTarget=function(e){this.set(_MapProperty.default.TARGET,e)},t.prototype.setView=function(e){this.set(_MapProperty.default.VIEW,e)},t.prototype.updateSize=function(){var e=this.getTargetElement();if(e){var t=getComputedStyle(e);this.setSize([e.offsetWidth-parseFloat(t.borderLeftWidth)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderRightWidth),e.offsetHeight-parseFloat(t.borderTopWidth)-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom)-parseFloat(t.borderBottomWidth)])}else this.setSize(void 0);this.updateViewportSize_()},t.prototype.updateViewportSize_=function(){var e=this.getView();if(e){var t=void 0,r=getComputedStyle(this.viewport_);r.width&&r.height&&(t=[parseInt(r.width,10),parseInt(r.height,10)]),e.setViewportSize(t)}},t}(_Object.default);function createOptionsInternal(e){var t=null;void 0!==e.keyboardEventTarget&&(t="string"==typeof e.keyboardEventTarget?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);var r,n,i,o={},a=e.layers&&"function"==typeof e.layers.getLayers?e.layers:new _Group.default({layers:e.layers});return o[_MapProperty.default.LAYERGROUP]=a,o[_MapProperty.default.TARGET]=e.target,o[_MapProperty.default.VIEW]=void 0!==e.view?e.view:new _View.default,void 0!==e.controls&&(Array.isArray(e.controls)?r=new _Collection.default(e.controls.slice()):((0,_asserts.assert)("function"==typeof e.controls.getArray,47),r=e.controls)),void 0!==e.interactions&&(Array.isArray(e.interactions)?n=new _Collection.default(e.interactions.slice()):((0,_asserts.assert)("function"==typeof e.interactions.getArray,48),n=e.interactions)),void 0!==e.overlays?Array.isArray(e.overlays)?i=new _Collection.default(e.overlays.slice()):((0,_asserts.assert)("function"==typeof e.overlays.getArray,49),i=e.overlays):i=new _Collection.default,{controls:r,interactions:n,keyboardEventTarget:t,overlays:i,values:o}}var _default=PluggableMap;exports.default=_default;

},{"./Collection.js":10,"./CollectionEventType.js":11,"./MapBrowserEvent.js":22,"./MapBrowserEventHandler.js":23,"./MapBrowserEventType.js":24,"./MapEvent.js":25,"./MapEventType.js":26,"./MapProperty.js":27,"./Object.js":28,"./ObjectEventType.js":29,"./TileQueue.js":36,"./View.js":41,"./ViewHint.js":42,"./asserts.js":45,"./dom.js":62,"./events.js":64,"./events/EventType.js":66,"./extent.js":70,"./functions.js":125,"./has.js":159,"./layer/Group.js":189,"./pointer/EventType.js":204,"./proj.js":205,"./render/EventType.js":216,"./size.js":251,"./transform.js":311}],34:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Target=_interopRequireDefault(require("./events/Target.js")),_EventType=_interopRequireDefault(require("./events/EventType.js")),_TileState=_interopRequireDefault(require("./TileState.js")),_util=require("./util.js"),_easing=require("./easing.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Tile=function(t){function e(e,i,r){var n=t.call(this)||this,o=r||{};return n.tileCoord=e,n.state=i,n.interimTile=null,n.hifi=!0,n.key="",n.transition_=void 0===o.transition?250:o.transition,n.transitionStarts_={},n}return __extends(e,t),e.prototype.changed=function(){this.dispatchEvent(_EventType.default.CHANGE)},e.prototype.release=function(){},e.prototype.getKey=function(){return this.key+"/"+this.tileCoord},e.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==_TileState.default.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this},e.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==_TileState.default.LOADED){t.interimTile=null;break}t.getState()==_TileState.default.LOADING?e=t:t.getState()==_TileState.default.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}},e.prototype.getTileCoord=function(){return this.tileCoord},e.prototype.getState=function(){return this.state},e.prototype.setState=function(t){if(this.state!==_TileState.default.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},e.prototype.load=function(){(0,_util.abstract)()},e.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;var r=e-i+1e3/60;return r>=this.transition_?1:(0,_easing.easeIn)(r/this.transition_)},e.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]},e.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},e}(_Target.default),_default=Tile;exports.default=_default;

},{"./TileState.js":38,"./easing.js":63,"./events/EventType.js":66,"./events/Target.js":68,"./util.js":313}],35:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _LRUCache=_interopRequireDefault(require("./structs/LRUCache.js")),_tilecoord=require("./tilecoord.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),TileCache=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.expireCache=function(e){for(;this.canExpireCache();){if(this.peekLast().getKey()in e)break;this.pop().release()}},t.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var e=this.peekFirstKey(),t=(0,_tilecoord.fromKey)(e)[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove((0,_tilecoord.getKey)(e.tileCoord)),e.release())}.bind(this))}},t}(_LRUCache.default),_default=TileCache;exports.default=_default;

},{"./structs/LRUCache.js":288,"./tilecoord.js":305}],36:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getTilePriority=getTilePriority,exports.default=void 0;var _EventType=_interopRequireDefault(require("./events/EventType.js")),_PriorityQueue=_interopRequireWildcard(require("./structs/PriorityQueue.js")),_TileState=_interopRequireDefault(require("./TileState.js"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),TileQueue=function(e){function t(t,r){var i=e.call(this,function(e){return t.apply(null,e)},function(e){return e[0].getKey()})||this;return i.boundHandleTileChange_=i.handleTileChange.bind(i),i.tileChangeCallback_=r,i.tilesLoading_=0,i.tilesLoadingKeys_={},i}return __extends(t,e),t.prototype.enqueue=function(t){var r=e.prototype.enqueue.call(this,t);r&&t[0].addEventListener(_EventType.default.CHANGE,this.boundHandleTileChange_);return r},t.prototype.getTilesLoading=function(){return this.tilesLoading_},t.prototype.handleTileChange=function(e){var t=e.target,r=t.getState();if(t.hifi&&r===_TileState.default.LOADED||r===_TileState.default.ERROR||r===_TileState.default.EMPTY){t.removeEventListener(_EventType.default.CHANGE,this.boundHandleTileChange_);var i=t.getKey();i in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[i],--this.tilesLoading_),this.tileChangeCallback_()}},t.prototype.loadMoreTiles=function(e,t){for(var r,i,n=0;this.tilesLoading_<e&&n<t&&this.getCount()>0;)i=(r=this.dequeue()[0]).getKey(),r.getState()!==_TileState.default.IDLE||i in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[i]=!0,++this.tilesLoading_,++n,r.load())},t}(_PriorityQueue.default),_default=TileQueue;function getTilePriority(e,t,r,i,n){if(!(e&&r in e.wantedTiles))return _PriorityQueue.DROP;if(!e.wantedTiles[r][t.getKey()])return _PriorityQueue.DROP;var o=e.viewState.center,u=i[0]-o[0],a=i[1]-o[1];return 65536*Math.log(n)+Math.sqrt(u*u+a*a)/n}exports.default=_default;

},{"./TileState.js":38,"./events/EventType.js":66,"./structs/PriorityQueue.js":289}],37:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createOrUpdate=createOrUpdate,exports.default=void 0;var TileRange=function(){function t(t,i,n,e){this.minX=t,this.maxX=i,this.minY=n,this.maxY=e}return t.prototype.contains=function(t){return this.containsXY(t[1],t[2])},t.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},t.prototype.containsXY=function(t,i){return this.minX<=t&&t<=this.maxX&&this.minY<=i&&i<=this.maxY},t.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},t.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},t.prototype.getHeight=function(){return this.maxY-this.minY+1},t.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},t.prototype.getWidth=function(){return this.maxX-this.minX+1},t.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY},t}();function createOrUpdate(t,i,n,e,m){return void 0!==m?(m.minX=t,m.maxX=i,m.minY=n,m.maxY=e,m):new TileRange(t,i,n,e)}var _default=TileRange;exports.default=_default;

},{}],38:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};exports.default=_default;

},{}],39:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Tile=_interopRequireDefault(require("./Tile.js")),_dom=require("./dom.js"),_util=require("./util.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),canvasPool=[],VectorRenderTile=function(e){function t(t,r,o,n){var i=e.call(this,t,r,{transition:0})||this;return i.context_={},i.executorGroups={},i.loadingSourceTiles=0,i.errorSourceTileKeys={},i.hitDetectionImageData={},i.replayState_={},i.sourceTiles=null,i.wantedResolution,i.getSourceTiles=n.bind(void 0,i),i.sourceZ=-1,i.hifi=!1,i.wrappedTileCoord=o,i}return __extends(t,e),t.prototype.getContext=function(e){var t=(0,_util.getUid)(e);return t in this.context_||(this.context_[t]=(0,_dom.createCanvasContext2D)(1,1,canvasPool)),this.context_[t]},t.prototype.hasContext=function(e){return(0,_util.getUid)(e)in this.context_},t.prototype.getImage=function(e){return this.hasContext(e)?this.getContext(e).canvas:null},t.prototype.getReplayState=function(e){var t=(0,_util.getUid)(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedZ:-1,renderedTileZ:-1}),this.replayState_[t]},t.prototype.load=function(){this.getSourceTiles()},t.prototype.release=function(){for(var t in this.context_)canvasPool.push(this.context_[t].canvas);e.prototype.release.call(this)},t}(_Tile.default),_default=VectorRenderTile;exports.default=_default;

},{"./Tile.js":34,"./dom.js":62,"./util.js":313}],40:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Tile=_interopRequireDefault(require("./Tile.js")),_TileState=_interopRequireDefault(require("./TileState.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),VectorTile=function(t){function e(e,o,r,i,n,u){var a=t.call(this,e,o,u)||this;return a.extent=null,a.format_=i,a.features_=null,a.loader_,a.projection=null,a.resolution,a.tileLoadFunction_=n,a.url_=r,a}return __extends(e,t),e.prototype.getFormat=function(){return this.format_},e.prototype.getFeatures=function(){return this.features_},e.prototype.getKey=function(){return this.url_},e.prototype.load=function(){this.state==_TileState.default.IDLE&&(this.setState(_TileState.default.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))},e.prototype.onLoad=function(t,e){this.setFeatures(t)},e.prototype.onError=function(){this.setState(_TileState.default.ERROR)},e.prototype.setFeatures=function(t){this.features_=t,this.setState(_TileState.default.LOADED)},e.prototype.setLoader=function(t){this.loader_=t},e}(_Tile.default),_default=VectorTile;exports.default=_default;

},{"./Tile.js":34,"./TileState.js":38}],41:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createCenterConstraint=createCenterConstraint,exports.createResolutionConstraint=createResolutionConstraint,exports.createRotationConstraint=createRotationConstraint,exports.isNoopAnimation=isNoopAnimation,exports.default=void 0;var _Object=_interopRequireDefault(require("./Object.js")),_GeometryType=_interopRequireDefault(require("./geom/GeometryType.js")),_Units=_interopRequireDefault(require("./proj/Units.js")),_ViewHint=_interopRequireDefault(require("./ViewHint.js")),_ViewProperty=_interopRequireDefault(require("./ViewProperty.js")),_common=require("./tilegrid/common.js"),_proj=require("./proj.js"),_functions=require("./functions.js"),_coordinate=require("./coordinate.js"),_asserts=require("./asserts.js"),_obj=require("./obj.js"),_centerconstraint=require("./centerconstraint.js"),_math=require("./math.js"),_resolutionconstraint=require("./resolutionconstraint.js"),_rotationconstraint=require("./rotationconstraint.js"),_easing=require("./easing.js"),_extent=require("./extent.js"),_array=require("./array.js"),_Polygon=require("./geom/Polygon.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),DEFAULT_MIN_ZOOM=0,View=function(t){function o(o){var e=t.call(this)||this,n=(0,_obj.assign)({},o);return e.hints_=[0,0],e.animations_=[],e.updateAnimationKey_,e.projection_=(0,_proj.createProjection)(n.projection,"EPSG:3857"),e.viewportSize_=[100,100],e.targetCenter_=null,e.targetResolution_,e.targetRotation_,e.cancelAnchor_=void 0,n.center&&(n.center=(0,_proj.fromUserCoordinate)(n.center,e.projection_)),n.extent&&(n.extent=(0,_proj.fromUserExtent)(n.extent,e.projection_)),e.applyOptions_(n),e}return __extends(o,t),o.prototype.applyOptions_=function(t){var o=createResolutionConstraint(t);this.maxResolution_=o.maxResolution,this.minResolution_=o.minResolution,this.zoomFactor_=o.zoomFactor,this.resolutions_=t.resolutions,this.minZoom_=o.minZoom;var e=createCenterConstraint(t),n=o.constraint,i=createRotationConstraint(t);this.constraints_={center:e,resolution:n,rotation:i},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom),this.setProperties({}),this.options_=t},o.prototype.getUpdatedOptions_=function(t){var o=(0,_obj.assign)({},this.options_);return void 0!==o.resolution?o.resolution=this.getResolution():o.zoom=this.getZoom(),o.center=this.getCenterInternal(),o.rotation=this.getRotation(),(0,_obj.assign)({},o,t)},o.prototype.animate=function(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var o=new Array(arguments.length),e=0;e<o.length;++e){var n=arguments[e];n.center&&((n=(0,_obj.assign)({},n)).center=(0,_proj.fromUserCoordinate)(n.center,this.getProjection())),n.anchor&&((n=(0,_obj.assign)({},n)).anchor=(0,_proj.fromUserCoordinate)(n.anchor,this.getProjection())),o[e]=n}this.animateInternal.apply(this,o)},o.prototype.animateInternal=function(t){var o,e=arguments.length;if(e>1&&"function"==typeof arguments[e-1]&&(o=arguments[e-1],--e),!this.isDef()){var n=arguments[e-1];return n.center&&this.setCenterInternal(n.center),void 0!==n.zoom&&this.setZoom(n.zoom),void 0!==n.rotation&&this.setRotation(n.rotation),void(o&&animationCallback(o,!0))}for(var i=Date.now(),r=this.targetCenter_.slice(),s=this.targetResolution_,a=this.targetRotation_,u=[],l=0;l<e;++l){var h=arguments[l],c={start:i,complete:!1,anchor:h.anchor,duration:void 0!==h.duration?h.duration:1e3,easing:h.easing||_easing.inAndOut,callback:o};if(h.center&&(c.sourceCenter=r,c.targetCenter=h.center.slice(),r=c.targetCenter),void 0!==h.zoom?(c.sourceResolution=s,c.targetResolution=this.getResolutionForZoom(h.zoom),s=c.targetResolution):h.resolution&&(c.sourceResolution=s,c.targetResolution=h.resolution,s=c.targetResolution),void 0!==h.rotation){c.sourceRotation=a;var p=(0,_math.modulo)(h.rotation-a+Math.PI,2*Math.PI)-Math.PI;c.targetRotation=a+p,a=c.targetRotation}isNoopAnimation(c)?c.complete=!0:i+=c.duration,u.push(c)}this.animations_.push(u),this.setHint(_ViewHint.default.ANIMATING,1),this.updateAnimations_()},o.prototype.getAnimating=function(){return this.hints_[_ViewHint.default.ANIMATING]>0},o.prototype.getInteracting=function(){return this.hints_[_ViewHint.default.INTERACTING]>0},o.prototype.cancelAnimations=function(){var t;this.setHint(_ViewHint.default.ANIMATING,-this.hints_[_ViewHint.default.ANIMATING]);for(var o=0,e=this.animations_.length;o<e;++o){var n=this.animations_[o];if(n[0].callback&&animationCallback(n[0].callback,!1),!t)for(var i=0,r=n.length;i<r;++i){var s=n[i];if(!s.complete){t=s.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t},o.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var t=Date.now(),o=!1,e=this.animations_.length-1;e>=0;--e){for(var n=this.animations_[e],i=!0,r=0,s=n.length;r<s;++r){var a=n[r];if(!a.complete){var u=t-a.start,l=a.duration>0?u/a.duration:1;l>=1?(a.complete=!0,l=1):i=!1;var h=a.easing(l);if(a.sourceCenter){var c=a.sourceCenter[0],p=a.sourceCenter[1],_=c+h*(a.targetCenter[0]-c),g=p+h*(a.targetCenter[1]-p);this.targetCenter_=[_,g]}if(a.sourceResolution&&a.targetResolution){var m=1===h?a.targetResolution:a.sourceResolution+h*(a.targetResolution-a.sourceResolution);if(a.anchor){var f=this.getViewportSize_(this.getRotation()),R=this.constraints_.resolution(m,0,f,!0);this.targetCenter_=this.calculateCenterZoom(R,a.anchor)}this.targetResolution_=m,this.applyTargetState_(!0)}if(void 0!==a.sourceRotation&&void 0!==a.targetRotation){var d=1===h?(0,_math.modulo)(a.targetRotation+Math.PI,2*Math.PI)-Math.PI:a.sourceRotation+h*(a.targetRotation-a.sourceRotation);if(a.anchor){var v=this.constraints_.rotation(d,!0);this.targetCenter_=this.calculateCenterRotate(v,a.anchor)}this.targetRotation_=d}if(this.applyTargetState_(!0),o=!0,!a.complete)break}}if(i){this.animations_[e]=null,this.setHint(_ViewHint.default.ANIMATING,-1);var y=n[0].callback;y&&animationCallback(y,!0)}}this.animations_=this.animations_.filter(Boolean),o&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},o.prototype.calculateCenterRotate=function(t,o){var e,n=this.getCenterInternal();return void 0!==n&&(e=[n[0]-o[0],n[1]-o[1]],(0,_coordinate.rotate)(e,t-this.getRotation()),(0,_coordinate.add)(e,o)),e},o.prototype.calculateCenterZoom=function(t,o){var e,n=this.getCenterInternal(),i=this.getResolution();void 0!==n&&void 0!==i&&(e=[o[0]-t*(o[0]-n[0])/i,o[1]-t*(o[1]-n[1])/i]);return e},o.prototype.getViewportSize_=function(t){var o=this.viewportSize_;if(t){var e=o[0],n=o[1];return[Math.abs(e*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(e*Math.sin(t))+Math.abs(n*Math.cos(t))]}return o},o.prototype.setViewportSize=function(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)},o.prototype.getCenter=function(){var t=this.getCenterInternal();return t?(0,_proj.toUserCoordinate)(t,this.getProjection()):t},o.prototype.getCenterInternal=function(){return this.get(_ViewProperty.default.CENTER)},o.prototype.getConstraints=function(){return this.constraints_},o.prototype.getConstrainResolution=function(){return this.options_.constrainResolution},o.prototype.getHints=function(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},o.prototype.calculateExtent=function(t){var o=this.calculateExtentInternal(t);return(0,_proj.toUserExtent)(o,this.getProjection())},o.prototype.calculateExtentInternal=function(t){var o=t||this.getViewportSize_(),e=this.getCenterInternal();(0,_asserts.assert)(e,1);var n=this.getResolution();(0,_asserts.assert)(void 0!==n,2);var i=this.getRotation();return(0,_asserts.assert)(void 0!==i,3),(0,_extent.getForViewAndSize)(e,n,i,o)},o.prototype.getMaxResolution=function(){return this.maxResolution_},o.prototype.getMinResolution=function(){return this.minResolution_},o.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},o.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},o.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},o.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},o.prototype.setConstrainResolution=function(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))},o.prototype.getProjection=function(){return this.projection_},o.prototype.getResolution=function(){return this.get(_ViewProperty.default.RESOLUTION)},o.prototype.getResolutions=function(){return this.resolutions_},o.prototype.getResolutionForExtent=function(t,o){return this.getResolutionForExtentInternal((0,_proj.fromUserExtent)(t,this.getProjection()),o)},o.prototype.getResolutionForExtentInternal=function(t,o){var e=o||this.getViewportSize_(),n=(0,_extent.getWidth)(t)/e[0],i=(0,_extent.getHeight)(t)/e[1];return Math.max(n,i)},o.prototype.getResolutionForValueFunction=function(t){var o=t||2,e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(e/n)/Math.log(o);return function(t){return e/Math.pow(o,t*i)}},o.prototype.getRotation=function(){return this.get(_ViewProperty.default.ROTATION)},o.prototype.getValueForResolutionFunction=function(t){var o=Math.log(t||2),e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(e/n)/o;return function(t){return Math.log(e/t)/o/i}},o.prototype.getState=function(){var t=this.getCenterInternal(),o=this.getProjection(),e=this.getResolution(),n=this.getRotation();return{center:t.slice(0),projection:void 0!==o?o:null,resolution:e,rotation:n,zoom:this.getZoom()}},o.prototype.getZoom=function(){var t,o=this.getResolution();return void 0!==o&&(t=this.getZoomForResolution(o)),t},o.prototype.getZoomForResolution=function(t){var o,e,n=this.minZoom_||0;if(this.resolutions_){var i=(0,_array.linearFindNearest)(this.resolutions_,t,1);n=i,o=this.resolutions_[i],e=i==this.resolutions_.length-1?2:o/this.resolutions_[i+1]}else o=this.maxResolution_,e=this.zoomFactor_;return n+Math.log(o/t)/Math.log(e)},o.prototype.getResolutionForZoom=function(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var o=(0,_math.clamp)(Math.floor(t),0,this.resolutions_.length-2),e=this.resolutions_[o]/this.resolutions_[o+1];return this.resolutions_[o]/Math.pow(e,(0,_math.clamp)(t-o,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)},o.prototype.fit=function(t,o){var e,n=(0,_obj.assign)({size:this.getViewportSize_()},o||{});if((0,_asserts.assert)(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t)){(0,_asserts.assert)(!(0,_extent.isEmpty)(t),25);var i=(0,_proj.fromUserExtent)(t,this.getProjection());e=(0,_Polygon.fromExtent)(i)}else if(t.getType()===_GeometryType.default.CIRCLE){i=(0,_proj.fromUserExtent)(t.getExtent(),this.getProjection());(e=(0,_Polygon.fromExtent)(i)).rotate(this.getRotation(),(0,_extent.getCenter)(i))}else{var r=(0,_proj.getUserProjection)();e=r?t.clone().transform(r,this.getProjection()):t}this.fitInternal(e,n)},o.prototype.fitInternal=function(t,o){var e=o||{},n=e.size;n||(n=this.getViewportSize_());var i,r=void 0!==e.padding?e.padding:[0,0,0,0],s=void 0!==e.nearest&&e.nearest;i=void 0!==e.minResolution?e.minResolution:void 0!==e.maxZoom?this.getResolutionForZoom(e.maxZoom):0;for(var a=t.getFlatCoordinates(),u=this.getRotation(),l=Math.cos(-u),h=Math.sin(-u),c=1/0,p=1/0,_=-1/0,g=-1/0,m=t.getStride(),f=0,R=a.length;f<R;f+=m){var d=a[f]*l-a[f+1]*h,v=a[f]*h+a[f+1]*l;c=Math.min(c,d),p=Math.min(p,v),_=Math.max(_,d),g=Math.max(g,v)}var y=this.getResolutionForExtentInternal([c,p,_,g],[n[0]-r[1]-r[3],n[1]-r[0]-r[2]]);y=isNaN(y)?i:Math.max(y,i),y=this.getConstrainedResolution(y,s?0:1),h=-h;var C=(c+_)/2,j=(p+g)/2,I=[(C+=(r[1]-r[3])/2*y)*l-(j+=(r[0]-r[2])/2*y)*h,j*l+C*h],x=e.callback?e.callback:_functions.VOID;void 0!==e.duration?this.animateInternal({resolution:y,center:this.getConstrainedCenter(I,y),duration:e.duration,easing:e.easing},x):(this.targetResolution_=y,this.targetCenter_=I,this.applyTargetState_(!1,!0),animationCallback(x,!0))},o.prototype.centerOn=function(t,o,e){this.centerOnInternal((0,_proj.fromUserCoordinate)(t,this.getProjection()),o,e)},o.prototype.centerOnInternal=function(t,o,e){var n=this.getRotation(),i=Math.cos(-n),r=Math.sin(-n),s=t[0]*i-t[1]*r,a=t[1]*i+t[0]*r,u=this.getResolution(),l=(s+=(o[0]/2-e[0])*u)*i-(a+=(e[1]-o[1]/2)*u)*(r=-r),h=a*i+s*r;this.setCenterInternal([l,h])},o.prototype.isDef=function(){return!!this.getCenterInternal()&&void 0!==this.getResolution()},o.prototype.adjustCenter=function(t){var o=(0,_proj.toUserCoordinate)(this.targetCenter_,this.getProjection());this.setCenter([o[0]+t[0],o[1]+t[1]])},o.prototype.adjustCenterInternal=function(t){var o=this.targetCenter_;this.setCenterInternal([o[0]+t[0],o[1]+t[1]])},o.prototype.adjustResolution=function(t,o){var e=o&&(0,_proj.fromUserCoordinate)(o,this.getProjection());this.adjustResolutionInternal(t,e)},o.prototype.adjustResolutionInternal=function(t,o){var e=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),i=this.constraints_.resolution(this.targetResolution_*t,0,n,e);o&&(this.targetCenter_=this.calculateCenterZoom(i,o)),this.targetResolution_*=t,this.applyTargetState_()},o.prototype.adjustZoom=function(t,o){this.adjustResolution(Math.pow(this.zoomFactor_,-t),o)},o.prototype.adjustRotation=function(t,o){o&&(o=(0,_proj.fromUserCoordinate)(o,this.getProjection())),this.adjustRotationInternal(t,o)},o.prototype.adjustRotationInternal=function(t,o){var e=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,e);o&&(this.targetCenter_=this.calculateCenterRotate(n,o)),this.targetRotation_+=t,this.applyTargetState_()},o.prototype.setCenter=function(t){this.setCenterInternal((0,_proj.fromUserCoordinate)(t,this.getProjection()))},o.prototype.setCenterInternal=function(t){this.targetCenter_=t,this.applyTargetState_()},o.prototype.setHint=function(t,o){return this.hints_[t]+=o,this.changed(),this.hints_[t]},o.prototype.setResolution=function(t){this.targetResolution_=t,this.applyTargetState_()},o.prototype.setRotation=function(t){this.targetRotation_=t,this.applyTargetState_()},o.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},o.prototype.applyTargetState_=function(t,o){var e=this.getAnimating()||this.getInteracting()||o,n=this.constraints_.rotation(this.targetRotation_,e),i=this.getViewportSize_(n),r=this.constraints_.resolution(this.targetResolution_,0,i,e),s=this.constraints_.center(this.targetCenter_,r,i,e);this.get(_ViewProperty.default.ROTATION)!==n&&this.set(_ViewProperty.default.ROTATION,n),this.get(_ViewProperty.default.RESOLUTION)!==r&&this.set(_ViewProperty.default.RESOLUTION,r),this.get(_ViewProperty.default.CENTER)&&(0,_coordinate.equals)(this.get(_ViewProperty.default.CENTER),s)||this.set(_ViewProperty.default.CENTER,s),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0},o.prototype.resolveConstraints=function(t,o,e){var n=void 0!==t?t:200,i=o||0,r=this.constraints_.rotation(this.targetRotation_),s=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,i,s),u=this.constraints_.center(this.targetCenter_,a,s);if(0===n&&!this.cancelAnchor_)return this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=u,void this.applyTargetState_();var l=e||(0===n?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,this.getResolution()===a&&this.getRotation()===r&&this.getCenterInternal()&&(0,_coordinate.equals)(this.getCenterInternal(),u)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:u,resolution:a,duration:n,easing:_easing.easeOut,anchor:l}))},o.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(_ViewHint.default.INTERACTING,1)},o.prototype.endInteraction=function(t,o,e){var n=e&&(0,_proj.fromUserCoordinate)(e,this.getProjection());this.endInteractionInternal(t,o,n)},o.prototype.endInteractionInternal=function(t,o,e){this.setHint(_ViewHint.default.INTERACTING,-1),this.resolveConstraints(t,o,e)},o.prototype.getConstrainedCenter=function(t,o){var e=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,o||this.getResolution(),e)},o.prototype.getConstrainedZoom=function(t,o){var e=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(e,o))},o.prototype.getConstrainedResolution=function(t,o){var e=o||0,n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)},o}(_Object.default);function animationCallback(t,o){setTimeout(function(){t(o)},0)}function createCenterConstraint(t){if(void 0!==t.extent){var o=void 0===t.smoothExtentConstraint||t.smoothExtentConstraint;return(0,_centerconstraint.createExtent)(t.extent,t.constrainOnlyCenter,o)}var e=(0,_proj.createProjection)(t.projection,"EPSG:3857");if(!0!==t.multiWorld&&e.isGlobal()){var n=e.getExtent().slice();return n[0]=-1/0,n[2]=1/0,(0,_centerconstraint.createExtent)(n,!1,!1)}return _centerconstraint.none}function createResolutionConstraint(t){var o,e,n,i=void 0!==t.minZoom?t.minZoom:DEFAULT_MIN_ZOOM,r=void 0!==t.maxZoom?t.maxZoom:28,s=void 0!==t.zoomFactor?t.zoomFactor:2,a=void 0!==t.multiWorld&&t.multiWorld,u=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,l=void 0!==t.showFullExtent&&t.showFullExtent,h=(0,_proj.createProjection)(t.projection,"EPSG:3857"),c=h.getExtent(),p=t.constrainOnlyCenter,_=t.extent;if(a||_||!h.isGlobal()||(p=!1,_=c),void 0!==t.resolutions){var g=t.resolutions;e=g[i],n=void 0!==g[r]?g[r]:g[g.length-1],o=t.constrainResolution?(0,_resolutionconstraint.createSnapToResolutions)(g,u,!p&&_,l):(0,_resolutionconstraint.createMinMaxResolution)(e,n,u,!p&&_,l)}else{var m=(c?Math.max((0,_extent.getWidth)(c),(0,_extent.getHeight)(c)):360*_proj.METERS_PER_UNIT[_Units.default.DEGREES]/h.getMetersPerUnit())/_common.DEFAULT_TILE_SIZE/Math.pow(2,DEFAULT_MIN_ZOOM),f=m/Math.pow(2,28-DEFAULT_MIN_ZOOM);void 0!==(e=t.maxResolution)?i=0:e=m/Math.pow(s,i),void 0===(n=t.minResolution)&&(n=void 0!==t.maxZoom?void 0!==t.maxResolution?e/Math.pow(s,r):m/Math.pow(s,r):f),r=i+Math.floor(Math.log(e/n)/Math.log(s)),n=e/Math.pow(s,r-i),o=t.constrainResolution?(0,_resolutionconstraint.createSnapToPower)(s,e,n,u,!p&&_,l):(0,_resolutionconstraint.createMinMaxResolution)(e,n,u,!p&&_,l)}return{constraint:o,maxResolution:e,minResolution:n,minZoom:i,zoomFactor:s}}function createRotationConstraint(t){if(void 0===t.enableRotation||t.enableRotation){var o=t.constrainRotation;return void 0===o||!0===o?(0,_rotationconstraint.createSnapToZero)():!1===o?_rotationconstraint.none:"number"==typeof o?(0,_rotationconstraint.createSnapToN)(o):_rotationconstraint.none}return _rotationconstraint.disable}function isNoopAnimation(t){return!(t.sourceCenter&&t.targetCenter&&!(0,_coordinate.equals)(t.sourceCenter,t.targetCenter))&&(t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation)}var _default=View;exports.default=_default;

},{"./Object.js":28,"./ViewHint.js":42,"./ViewProperty.js":43,"./array.js":44,"./asserts.js":45,"./centerconstraint.js":46,"./coordinate.js":60,"./easing.js":63,"./extent.js":70,"./functions.js":125,"./geom/GeometryType.js":131,"./geom/Polygon.js":138,"./math.js":201,"./obj.js":203,"./proj.js":205,"./proj/Units.js":207,"./resolutionconstraint.js":249,"./rotationconstraint.js":250,"./tilegrid/common.js":309}],42:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={ANIMATING:0,INTERACTING:1};exports.default=_default;

},{}],43:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};exports.default=_default;

},{}],44:[function(require,module,exports){
"use strict";function binarySearch(r,e,n){for(var t,u,i=n||numberSafeCompareFunction,o=0,a=r.length,f=!1;o<a;)(u=+i(r[t=o+(a-o>>1)],e))<0?o=t+1:(a=t,f=!u);return f?o:~o}function numberSafeCompareFunction(r,e){return r>e?1:r<e?-1:0}function includes(r,e){return r.indexOf(e)>=0}function linearFindNearest(r,e,n){var t=r.length;if(r[0]<=e)return 0;if(e<=r[t-1])return t-1;var u=void 0;if(n>0){for(u=1;u<t;++u)if(r[u]<e)return u-1}else if(n<0){for(u=1;u<t;++u)if(r[u]<=e)return u}else for(u=1;u<t;++u){if(r[u]==e)return u;if(r[u]<e)return r[u-1]-e<e-r[u]?u-1:u}return t-1}function reverseSubArray(r,e,n){for(;e<n;){var t=r[e];r[e]=r[n],r[n]=t,++e,--n}}function extend(r,e){for(var n=Array.isArray(e)?e:[e],t=n.length,u=0;u<t;u++)r[r.length]=n[u]}function remove(r,e){var n=r.indexOf(e),t=n>-1;return t&&r.splice(n,1),t}function find(r,e){for(var n,t=r.length>>>0,u=0;u<t;u++)if(e(n=r[u],u,r))return n;return null}function equals(r,e){var n=r.length;if(n!==e.length)return!1;for(var t=0;t<n;t++)if(r[t]!==e[t])return!1;return!0}function stableSort(r,e){var n,t=r.length,u=Array(r.length);for(n=0;n<t;n++)u[n]={index:n,value:r[n]};for(u.sort(function(r,n){return e(r.value,n.value)||r.index-n.index}),n=0;n<r.length;n++)r[n]=u[n].value}function findIndex(r,e){var n;return!r.every(function(t,u){return n=u,!e(t,u,r)})?n:-1}function isSorted(r,e,n){var t=e||numberSafeCompareFunction;return r.every(function(e,u){if(0===u)return!0;var i=t(r[u-1],e);return!(i>0||n&&0===i)})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.binarySearch=binarySearch,exports.numberSafeCompareFunction=numberSafeCompareFunction,exports.includes=includes,exports.linearFindNearest=linearFindNearest,exports.reverseSubArray=reverseSubArray,exports.extend=extend,exports.remove=remove,exports.find=find,exports.equals=equals,exports.stableSort=stableSort,exports.findIndex=findIndex,exports.isSorted=isSorted;

},{}],45:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.assert=assert;var _AssertionError=_interopRequireDefault(require("./AssertionError.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function assert(e,r){if(!e)throw new _AssertionError.default(r)}

},{"./AssertionError.js":9}],46:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createExtent=createExtent,exports.none=none;var _math=require("./math.js");function createExtent(t,e,a){return function(r,n,o,h){if(r){var c=e?0:o[0]*n,m=e?0:o[1]*n,u=t[0]+c/2,x=t[2]-c/2,M=t[1]+m/2,l=t[3]-m/2;u>x&&(x=u=(x+u)/2),M>l&&(l=M=(l+M)/2);var i=(0,_math.clamp)(r[0],u,x),s=(0,_math.clamp)(r[1],M,l),p=30*n;return h&&a&&(i+=-p*Math.log(1+Math.max(0,u-r[0])/p)+p*Math.log(1+Math.max(0,r[0]-x)/p),s+=-p*Math.log(1+Math.max(0,M-r[1])/p)+p*Math.log(1+Math.max(0,r[1]-l)/p)),[i,s]}}}function none(t){return t}

},{"./math.js":201}],47:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.asString=asString,exports.asArray=asArray,exports.normalize=normalize,exports.toString=toString,exports.isStringColor=isStringColor,exports.fromString=void 0;var _asserts=require("./asserts.js"),_math=require("./math.js"),HEX_COLOR_RE_=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,NAMED_COLOR_RE_=/^([a-z]*)$|^hsla?\(.*\)$/i;function asString(r){return"string"==typeof r?r:toString(r)}function fromNamed(r){var t=document.createElement("div");if(t.style.color=r,""!==t.style.color){document.body.appendChild(t);var e=getComputedStyle(t).color;return document.body.removeChild(t),e}return""}var fromString=function(){var r={},t=0;return function(e){var n;if(r.hasOwnProperty(e))n=r[e];else{if(t>=1024){var a=0;for(var o in r)0==(3&a++)&&(delete r[o],--t)}n=fromStringInternal_(e),r[e]=n,++t}return n}}();function asArray(r){return Array.isArray(r)?r:fromString(r)}function fromStringInternal_(r){var t,e,n,a,o;if(NAMED_COLOR_RE_.exec(r)&&(r=fromNamed(r)),HEX_COLOR_RE_.exec(r)){var i=r.length-1,s=void 0;s=i<=4?1:2;var m=4===i||8===i;t=parseInt(r.substr(1+0*s,s),16),e=parseInt(r.substr(1+1*s,s),16),n=parseInt(r.substr(1+2*s,s),16),a=m?parseInt(r.substr(1+3*s,s),16):255,1==s&&(t=(t<<4)+t,e=(e<<4)+e,n=(n<<4)+n,m&&(a=(a<<4)+a)),o=[t,e,n,a/255]}else 0==r.indexOf("rgba(")?normalize(o=r.slice(5,-1).split(",").map(Number)):0==r.indexOf("rgb(")?((o=r.slice(4,-1).split(",").map(Number)).push(1),normalize(o)):(0,_asserts.assert)(!1,14);return o}function normalize(r){return r[0]=(0,_math.clamp)(r[0]+.5|0,0,255),r[1]=(0,_math.clamp)(r[1]+.5|0,0,255),r[2]=(0,_math.clamp)(r[2]+.5|0,0,255),r[3]=(0,_math.clamp)(r[3],0,1),r}function toString(r){var t=r[0];t!=(0|t)&&(t=t+.5|0);var e=r[1];e!=(0|e)&&(e=e+.5|0);var n=r[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+t+","+e+","+n+","+(void 0===r[3]?1:r[3])+")"}function isStringColor(r){return NAMED_COLOR_RE_.test(r)&&(r=fromNamed(r)),HEX_COLOR_RE_.test(r)||0===r.indexOf("rgba(")||0===r.indexOf("rgb(")}exports.fromString=fromString;

},{"./asserts.js":45,"./math.js":201}],48:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.asColorLike=asColorLike;var _color=require("./color.js");function asColorLike(r){return Array.isArray(r)?(0,_color.toString)(r):r}

},{"./color.js":47}],49:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaults=defaults,Object.defineProperty(exports,"Attribution",{enumerable:!0,get:function(){return _Attribution.default}}),Object.defineProperty(exports,"Rotate",{enumerable:!0,get:function(){return _Rotate.default}}),Object.defineProperty(exports,"Zoom",{enumerable:!0,get:function(){return _Zoom.default}}),Object.defineProperty(exports,"Control",{enumerable:!0,get:function(){return _Control.default}}),Object.defineProperty(exports,"FullScreen",{enumerable:!0,get:function(){return _FullScreen.default}}),Object.defineProperty(exports,"MousePosition",{enumerable:!0,get:function(){return _MousePosition.default}}),Object.defineProperty(exports,"OverviewMap",{enumerable:!0,get:function(){return _OverviewMap.default}}),Object.defineProperty(exports,"ScaleLine",{enumerable:!0,get:function(){return _ScaleLine.default}}),Object.defineProperty(exports,"ZoomSlider",{enumerable:!0,get:function(){return _ZoomSlider.default}}),Object.defineProperty(exports,"ZoomToExtent",{enumerable:!0,get:function(){return _ZoomToExtent.default}});var _Attribution=_interopRequireDefault(require("./control/Attribution.js")),_Collection=_interopRequireDefault(require("./Collection.js")),_Rotate=_interopRequireDefault(require("./control/Rotate.js")),_Zoom=_interopRequireDefault(require("./control/Zoom.js")),_Control=_interopRequireDefault(require("./control/Control.js")),_FullScreen=_interopRequireDefault(require("./control/FullScreen.js")),_MousePosition=_interopRequireDefault(require("./control/MousePosition.js")),_OverviewMap=_interopRequireDefault(require("./control/OverviewMap.js")),_ScaleLine=_interopRequireDefault(require("./control/ScaleLine.js")),_ZoomSlider=_interopRequireDefault(require("./control/ZoomSlider.js")),_ZoomToExtent=_interopRequireDefault(require("./control/ZoomToExtent.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function defaults(e){var t=e||{},r=new _Collection.default;return(void 0===t.zoom||t.zoom)&&r.push(new _Zoom.default(t.zoomOptions)),(void 0===t.rotate||t.rotate)&&r.push(new _Rotate.default(t.rotateOptions)),(void 0===t.attribution||t.attribution)&&r.push(new _Attribution.default(t.attributionOptions)),r}

},{"./Collection.js":10,"./control/Attribution.js":50,"./control/Control.js":51,"./control/FullScreen.js":52,"./control/MousePosition.js":53,"./control/OverviewMap.js":54,"./control/Rotate.js":55,"./control/ScaleLine.js":56,"./control/Zoom.js":57,"./control/ZoomSlider.js":58,"./control/ZoomToExtent.js":59}],50:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Control=_interopRequireDefault(require("./Control.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_css=require("../css.js"),_array=require("../array.js"),_Layer=require("../layer/Layer.js"),_dom=require("../dom.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,l){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var l in t)t.hasOwnProperty(l)&&(e[l]=t[l])})(t,l)};return function(t,l){function o(){this.constructor=t}e(t,l),t.prototype=null===l?Object.create(l):(o.prototype=l.prototype,new o)}}(),Attribution=function(e){function t(t){var l=this,o=t||{};(l=e.call(this,{element:document.createElement("div"),render:o.render,target:o.target})||this).ulElement_=document.createElement("ul"),l.collapsed_=void 0===o.collapsed||o.collapsed,l.overrideCollapsible_=void 0!==o.collapsible,l.collapsible_=void 0===o.collapsible||o.collapsible,l.collapsible_||(l.collapsed_=!1);var i=void 0!==o.className?o.className:"ol-attribution",r=void 0!==o.tipLabel?o.tipLabel:"Attributions",s=void 0!==o.collapseLabel?o.collapseLabel:"»";"string"==typeof s?(l.collapseLabel_=document.createElement("span"),l.collapseLabel_.textContent=s):l.collapseLabel_=s;var a=void 0!==o.label?o.label:"i";"string"==typeof a?(l.label_=document.createElement("span"),l.label_.textContent=a):l.label_=a;var n=l.collapsible_&&!l.collapsed_?l.collapseLabel_:l.label_,p=document.createElement("button");p.setAttribute("type","button"),p.title=r,p.appendChild(n),p.addEventListener(_EventType.default.CLICK,l.handleClick_.bind(l),!1);var _=i+" "+_css.CLASS_UNSELECTABLE+" "+_css.CLASS_CONTROL+(l.collapsed_&&l.collapsible_?" "+_css.CLASS_COLLAPSED:"")+(l.collapsible_?"":" ol-uncollapsible"),c=l.element;return c.className=_,c.appendChild(l.ulElement_),c.appendChild(p),l.renderedAttributions_=[],l.renderedVisible_=!0,l}return __extends(t,e),t.prototype.collectSourceAttributions_=function(e){for(var t={},l=[],o=e.layerStatesArray,i=0,r=o.length;i<r;++i){var s=o[i];if((0,_Layer.inView)(s,e.viewState)){var a=s.layer.getSource();if(a){var n=a.getAttributions();if(n){var p=n(e);if(p)if(this.overrideCollapsible_||!1!==a.getAttributionsCollapsible()||this.setCollapsible(!1),Array.isArray(p))for(var _=0,c=p.length;_<c;++_)p[_]in t||(l.push(p[_]),t[p[_]]=!0);else p in t||(l.push(p),t[p]=!0)}}}}return l},t.prototype.updateElement_=function(e){if(e){var t=this.collectSourceAttributions_(e),l=t.length>0;if(this.renderedVisible_!=l&&(this.element.style.display=l?"":"none",this.renderedVisible_=l),!(0,_array.equals)(t,this.renderedAttributions_)){(0,_dom.removeChildren)(this.ulElement_);for(var o=0,i=t.length;o<i;++o){var r=document.createElement("li");r.innerHTML=t[o],this.ulElement_.appendChild(r)}this.renderedAttributions_=t}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},t.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_()},t.prototype.handleToggle_=function(){this.element.classList.toggle(_css.CLASS_COLLAPSED),this.collapsed_?(0,_dom.replaceNode)(this.collapseLabel_,this.label_):(0,_dom.replaceNode)(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},t.prototype.getCollapsible=function(){return this.collapsible_},t.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())},t.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},t.prototype.getCollapsed=function(){return this.collapsed_},t.prototype.render=function(e){this.updateElement_(e.frameState)},t}(_Control.default),_default=Attribution;exports.default=_default;

},{"../array.js":44,"../css.js":61,"../dom.js":62,"../events/EventType.js":66,"../layer/Layer.js":192,"./Control.js":51}],51:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Object=_interopRequireDefault(require("../Object.js")),_MapEventType=_interopRequireDefault(require("../MapEventType.js")),_functions=require("../functions.js"),_events=require("../events.js"),_dom=require("../dom.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Control=function(e){function t(t){var n=e.call(this)||this,r=t.element;return!r||t.target||r.style.pointerEvents||(r.style.pointerEvents="auto"),n.element=r||null,n.target_=null,n.map_=null,n.listenerKeys=[],t.render&&(n.render=t.render),t.target&&n.setTarget(t.target),n}return __extends(t,e),t.prototype.disposeInternal=function(){(0,_dom.removeNode)(this.element),e.prototype.disposeInternal.call(this)},t.prototype.getMap=function(){return this.map_},t.prototype.setMap=function(e){this.map_&&(0,_dom.removeNode)(this.element);for(var t=0,n=this.listenerKeys.length;t<n;++t)(0,_events.unlistenByKey)(this.listenerKeys[t]);(this.listenerKeys.length=0,this.map_=e,this.map_)&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==_functions.VOID&&this.listenerKeys.push((0,_events.listen)(e,_MapEventType.default.POSTRENDER,this.render,this)),e.render())},t.prototype.render=function(e){},t.prototype.setTarget=function(e){this.target_="string"==typeof e?document.getElementById(e):e},t}(_Object.default),_default=Control;exports.default=_default;

},{"../MapEventType.js":26,"../Object.js":28,"../dom.js":62,"../events.js":64,"../functions.js":125}],52:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Control=_interopRequireDefault(require("./Control.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_css=require("../css.js"),_events=require("../events.js"),_dom=require("../dom.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,l){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var l in t)t.hasOwnProperty(l)&&(e[l]=t[l])})(t,l)};return function(t,l){function s(){this.constructor=t}e(t,l),t.prototype=null===l?Object.create(l):(s.prototype=l.prototype,new s)}}(),events=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],FullScreenEventType={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"},FullScreen=function(e){function t(t){var l=this,s=t||{};(l=e.call(this,{element:document.createElement("div"),target:s.target})||this).cssClassName_=void 0!==s.className?s.className:"ol-full-screen";var n=void 0!==s.label?s.label:"⤢";l.labelNode_="string"==typeof n?document.createTextNode(n):n;var r=void 0!==s.labelActive?s.labelActive:"×";l.labelActiveNode_="string"==typeof r?document.createTextNode(r):r,l.button_=document.createElement("button");var u=s.tipLabel?s.tipLabel:"Toggle full-screen";l.setClassName_(l.button_,isFullScreen()),l.button_.setAttribute("type","button"),l.button_.title=u,l.button_.appendChild(l.labelNode_),l.button_.addEventListener(_EventType.default.CLICK,l.handleClick_.bind(l),!1);var c=l.cssClassName_+" "+_css.CLASS_UNSELECTABLE+" "+_css.CLASS_CONTROL+" "+(isFullScreenSupported()?"":_css.CLASS_UNSUPPORTED),o=l.element;return o.className=c,o.appendChild(l.button_),l.keys_=void 0!==s.keys&&s.keys,l.source_=s.source,l}return __extends(t,e),t.prototype.handleClick_=function(e){e.preventDefault(),this.handleFullScreen_()},t.prototype.handleFullScreen_=function(){if(isFullScreenSupported()){var e=this.getMap();if(e)if(isFullScreen())exitFullScreen();else{var t=void 0;t=this.source_?"string"==typeof this.source_?document.getElementById(this.source_):this.source_:e.getTargetElement(),this.keys_?requestFullScreenWithKeys(t):requestFullScreen(t)}}},t.prototype.handleFullScreenChange_=function(){var e=this.getMap();isFullScreen()?(this.setClassName_(this.button_,!0),(0,_dom.replaceNode)(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(FullScreenEventType.ENTERFULLSCREEN)):(this.setClassName_(this.button_,!1),(0,_dom.replaceNode)(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(FullScreenEventType.LEAVEFULLSCREEN)),e&&e.updateSize()},t.prototype.setClassName_=function(e,t){var l=this.cssClassName_+"-true",s=this.cssClassName_+"-false",n=t?l:s;e.classList.remove(l),e.classList.remove(s),e.classList.add(n)},t.prototype.setMap=function(t){if(e.prototype.setMap.call(this,t),t)for(var l=0,s=events.length;l<s;++l)this.listenerKeys.push((0,_events.listen)(document,events[l],this.handleFullScreenChange_,this))},t}(_Control.default);function isFullScreenSupported(){var e=document.body;return!!(e.webkitRequestFullscreen||e.msRequestFullscreen&&document.msFullscreenEnabled||e.requestFullscreen&&document.fullscreenEnabled)}function isFullScreen(){return!!(document.webkitIsFullScreen||document.msFullscreenElement||document.fullscreenElement)}function requestFullScreen(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function requestFullScreenWithKeys(e){e.webkitRequestFullscreen?e.webkitRequestFullscreen():requestFullScreen(e)}function exitFullScreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}var _default=FullScreen;exports.default=_default;

},{"../css.js":61,"../dom.js":62,"../events.js":64,"../events/EventType.js":66,"./Control.js":51}],53:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Control=_interopRequireDefault(require("./Control.js")),_EventType=_interopRequireDefault(require("../pointer/EventType.js")),_Object=require("../Object.js"),_proj=require("../proj.js"),_events=require("../events.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),PROJECTION="projection",COORDINATE_FORMAT="coordinateFormat",MousePosition=function(e){function t(t){var o=this,r=t||{},n=document.createElement("div");return n.className=void 0!==r.className?r.className:"ol-mouse-position",(o=e.call(this,{element:n,render:r.render,target:r.target})||this).addEventListener((0,_Object.getChangeEventType)(PROJECTION),o.handleProjectionChanged_),r.coordinateFormat&&o.setCoordinateFormat(r.coordinateFormat),r.projection&&o.setProjection(r.projection),o.undefinedHTML_=void 0!==r.undefinedHTML?r.undefinedHTML:"&#160;",o.renderOnMouseOut_=!!o.undefinedHTML_,o.renderedHTML_=n.innerHTML,o.mapProjection_=null,o.transform_=null,o}return __extends(t,e),t.prototype.handleProjectionChanged_=function(){this.transform_=null},t.prototype.getCoordinateFormat=function(){return this.get(COORDINATE_FORMAT)},t.prototype.getProjection=function(){return this.get(PROJECTION)},t.prototype.handleMouseMove=function(e){var t=this.getMap();this.updateHTML_(t.getEventPixel(e))},t.prototype.handleMouseOut=function(e){this.updateHTML_(null)},t.prototype.setMap=function(t){if(e.prototype.setMap.call(this,t),t){var o=t.getViewport();this.listenerKeys.push((0,_events.listen)(o,_EventType.default.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push((0,_events.listen)(o,_EventType.default.POINTEROUT,this.handleMouseOut,this))}},t.prototype.setCoordinateFormat=function(e){this.set(COORDINATE_FORMAT,e)},t.prototype.setProjection=function(e){this.set(PROJECTION,(0,_proj.get)(e))},t.prototype.updateHTML_=function(e){var t=this.undefinedHTML_;if(e&&this.mapProjection_){if(!this.transform_){var o=this.getProjection();this.transform_=o?(0,_proj.getTransformFromProjections)(this.mapProjection_,o):_proj.identityTransform}var r=this.getMap().getCoordinateFromPixelInternal(e);if(r){var n=(0,_proj.getUserProjection)();n&&(this.transform_=(0,_proj.getTransformFromProjections)(this.mapProjection_,n)),this.transform_(r,r);var i=this.getCoordinateFormat();t=i?i(r):r.toString()}}this.renderedHTML_&&t===this.renderedHTML_||(this.element.innerHTML=t,this.renderedHTML_=t)},t.prototype.render=function(e){var t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null},t}(_Control.default),_default=MousePosition;exports.default=_default;

},{"../Object.js":28,"../events.js":64,"../pointer/EventType.js":204,"../proj.js":205,"./Control.js":51}],54:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Composite=_interopRequireDefault(require("../renderer/Composite.js")),_Control=_interopRequireDefault(require("./Control.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_MapEventType=_interopRequireDefault(require("../MapEventType.js")),_MapProperty=_interopRequireDefault(require("../MapProperty.js")),_ObjectEventType=_interopRequireDefault(require("../ObjectEventType.js")),_Overlay=_interopRequireDefault(require("../Overlay.js")),_OverlayPositioning=_interopRequireDefault(require("../OverlayPositioning.js")),_PluggableMap=_interopRequireDefault(require("../PluggableMap.js")),_View=_interopRequireDefault(require("../View.js")),_ViewProperty=_interopRequireDefault(require("../ViewProperty.js")),_css=require("../css.js"),_extent=require("../extent.js"),_Object=require("../Object.js"),_events=require("../events.js"),_Polygon=require("../geom/Polygon.js"),_dom=require("../dom.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),MAX_RATIO=.75,MIN_RATIO=.1,ControlledMap=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createRenderer=function(){return new _Composite.default(this)},t}(_PluggableMap.default),OverviewMap=function(e){function t(t){var i=this,o=t||{};(i=e.call(this,{element:document.createElement("div"),render:o.render,target:o.target})||this).boundHandleRotationChanged_=i.handleRotationChanged_.bind(i),i.collapsed_=void 0===o.collapsed||o.collapsed,i.collapsible_=void 0===o.collapsible||o.collapsible,i.collapsible_||(i.collapsed_=!1),i.rotateWithView_=void 0!==o.rotateWithView&&o.rotateWithView,i.viewExtent_=void 0;var n=void 0!==o.className?o.className:"ol-overviewmap",a=void 0!==o.tipLabel?o.tipLabel:"Overview map",r=void 0!==o.collapseLabel?o.collapseLabel:"«";"string"==typeof r?(i.collapseLabel_=document.createElement("span"),i.collapseLabel_.textContent=r):i.collapseLabel_=r;var l=void 0!==o.label?o.label:"»";"string"==typeof l?(i.label_=document.createElement("span"),i.label_.textContent=l):i.label_=l;var s=i.collapsible_&&!i.collapsed_?i.collapseLabel_:i.label_,p=document.createElement("button");p.setAttribute("type","button"),p.title=a,p.appendChild(s),p.addEventListener(_EventType.default.CLICK,i.handleClick_.bind(i),!1),i.ovmapDiv_=document.createElement("div"),i.ovmapDiv_.className="ol-overviewmap-map",i.view_=o.view,i.ovmap_=new ControlledMap({view:o.view});var _=i.ovmap_;o.layers&&o.layers.forEach(function(e){_.addLayer(e)});var d=document.createElement("div");d.className="ol-overviewmap-box",d.style.boxSizing="border-box",i.boxOverlay_=new _Overlay.default({position:[0,0],positioning:_OverlayPositioning.default.CENTER_CENTER,element:d}),i.ovmap_.addOverlay(i.boxOverlay_);var u=n+" "+_css.CLASS_UNSELECTABLE+" "+_css.CLASS_CONTROL+(i.collapsed_&&i.collapsible_?" "+_css.CLASS_COLLAPSED:"")+(i.collapsible_?"":" ol-uncollapsible"),v=i.element;v.className=u,v.appendChild(i.ovmapDiv_),v.appendChild(p);var c=i,h=i.boxOverlay_,g=i.boxOverlay_.getElement(),f=function(e){var t,i={clientX:(t=e).clientX,clientY:t.clientY},o=_.getEventCoordinateInternal(i);h.setPosition(o)},y=function e(t){var i=_.getEventCoordinateInternal(t);c.getMap().getView().setCenterInternal(i),window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",e)};return g.addEventListener("mousedown",function(){window.addEventListener("mousemove",f),window.addEventListener("mouseup",y)}),i}return __extends(t,e),t.prototype.setMap=function(t){var i=this.getMap();if(t!==i){if(i){var o=i.getView();o&&this.unbindView_(o),this.ovmap_.setTarget(null)}if(e.prototype.setMap.call(this,t),t){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push((0,_events.listen)(t,_ObjectEventType.default.PROPERTYCHANGE,this.handleMapPropertyChange_,this));var n=t.getView();n&&(this.bindView_(n),n.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_()))}}},t.prototype.handleMapPropertyChange_=function(e){if(e.key===_MapProperty.default.VIEW){var t=e.oldValue;t&&this.unbindView_(t);var i=this.getMap().getView();this.bindView_(i)}},t.prototype.bindView_=function(e){if(!this.view_){var t=new _View.default({projection:e.getProjection()});this.ovmap_.setView(t)}e.addEventListener((0,_Object.getChangeEventType)(_ViewProperty.default.ROTATION),this.boundHandleRotationChanged_),this.handleRotationChanged_()},t.prototype.unbindView_=function(e){e.removeEventListener((0,_Object.getChangeEventType)(_ViewProperty.default.ROTATION),this.boundHandleRotationChanged_)},t.prototype.handleRotationChanged_=function(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())},t.prototype.validateExtent_=function(){var e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){var i=e.getSize(),o=e.getView().calculateExtentInternal(i);if(!this.viewExtent_||!(0,_extent.equals)(o,this.viewExtent_)){this.viewExtent_=o;var n=t.getSize(),a=t.getView().calculateExtentInternal(n),r=t.getPixelFromCoordinateInternal((0,_extent.getTopLeft)(o)),l=t.getPixelFromCoordinateInternal((0,_extent.getBottomRight)(o)),s=Math.abs(r[0]-l[0]),p=Math.abs(r[1]-l[1]),_=n[0],d=n[1];s<_*MIN_RATIO||p<d*MIN_RATIO||s>_*MAX_RATIO||p>d*MAX_RATIO?this.resetExtent_():(0,_extent.containsExtent)(a,o)||this.recenter_()}}},t.prototype.resetExtent_=function(){if(0!==MAX_RATIO&&0!==MIN_RATIO){var e=this.getMap(),t=this.ovmap_,i=e.getSize(),o=e.getView().calculateExtentInternal(i),n=t.getView(),a=Math.log(MAX_RATIO/MIN_RATIO)/Math.LN2,r=1/(Math.pow(2,a/2)*MIN_RATIO);(0,_extent.scaleFromCenter)(o,r),n.fitInternal((0,_Polygon.fromExtent)(o))}},t.prototype.recenter_=function(){var e=this.getMap(),t=this.ovmap_,i=e.getView();t.getView().setCenterInternal(i.getCenterInternal())},t.prototype.updateBox_=function(){var e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){var i=e.getSize(),o=e.getView(),n=t.getView(),a=this.rotateWithView_?0:-o.getRotation(),r=this.boxOverlay_,l=this.boxOverlay_.getElement(),s=o.getCenterInternal(),p=o.getResolution(),_=n.getResolution(),d=i[0]*p/_,u=i[1]*p/_;if(r.setPosition(s),l){l.style.width=d+"px",l.style.height=u+"px";var v="rotate("+a+"rad)";l.style.transform=v}}},t.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_()},t.prototype.handleToggle_=function(){this.element.classList.toggle(_css.CLASS_COLLAPSED),this.collapsed_?(0,_dom.replaceNode)(this.collapseLabel_,this.label_):(0,_dom.replaceNode)(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;var e=this.ovmap_;if(!this.collapsed_){if(e.isRendered())return this.viewExtent_=void 0,void e.render();e.updateSize(),this.resetExtent_(),(0,_events.listenOnce)(e,_MapEventType.default.POSTRENDER,function(e){this.updateBox_()},this)}},t.prototype.getCollapsible=function(){return this.collapsible_},t.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())},t.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()},t.prototype.getCollapsed=function(){return this.collapsed_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.setRotateWithView=function(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,0!==this.getMap().getView().getRotation()&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))},t.prototype.getOverviewMap=function(){return this.ovmap_},t.prototype.render=function(e){this.validateExtent_(),this.updateBox_()},t}(_Control.default),_default=OverviewMap;exports.default=_default;

},{"../MapEventType.js":26,"../MapProperty.js":27,"../Object.js":28,"../ObjectEventType.js":29,"../Overlay.js":31,"../OverlayPositioning.js":32,"../PluggableMap.js":33,"../View.js":41,"../ViewProperty.js":43,"../css.js":61,"../dom.js":62,"../events.js":64,"../events/EventType.js":66,"../extent.js":70,"../geom/Polygon.js":138,"../renderer/Composite.js":232,"./Control.js":51}],55:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Control=_interopRequireDefault(require("./Control.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_css=require("../css.js"),_easing=require("../easing.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function o(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(o.prototype=a.prototype,new o)}}(),Rotate=function(t){function e(e){var a=this,o=e||{};a=t.call(this,{element:document.createElement("div"),render:o.render,target:o.target})||this;var r=void 0!==o.className?o.className:"ol-rotate",s=void 0!==o.label?o.label:"⇧";a.label_=null,"string"==typeof s?(a.label_=document.createElement("span"),a.label_.className="ol-compass",a.label_.textContent=s):(a.label_=s,a.label_.classList.add("ol-compass"));var n=o.tipLabel?o.tipLabel:"Reset rotation",i=document.createElement("button");i.className=r+"-reset",i.setAttribute("type","button"),i.title=n,i.appendChild(a.label_),i.addEventListener(_EventType.default.CLICK,a.handleClick_.bind(a),!1);var l=r+" "+_css.CLASS_UNSELECTABLE+" "+_css.CLASS_CONTROL,_=a.element;return _.className=l,_.appendChild(i),a.callResetNorth_=o.resetNorth?o.resetNorth:void 0,a.duration_=void 0!==o.duration?o.duration:250,a.autoHide_=void 0===o.autoHide||o.autoHide,a.rotation_=void 0,a.autoHide_&&a.element.classList.add(_css.CLASS_HIDDEN),a}return __extends(e,t),e.prototype.handleClick_=function(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},e.prototype.resetNorth_=function(){var t=this.getMap().getView();if(t){var e=t.getRotation();void 0!==e&&(this.duration_>0&&e%(2*Math.PI)!=0?t.animate({rotation:0,duration:this.duration_,easing:_easing.easeOut}):t.setRotation(0))}},e.prototype.render=function(t){var e=t.frameState;if(e){var a=e.viewState.rotation;if(a!=this.rotation_){var o="rotate("+a+"rad)";if(this.autoHide_){var r=this.element.classList.contains(_css.CLASS_HIDDEN);r||0!==a?r&&0!==a&&this.element.classList.remove(_css.CLASS_HIDDEN):this.element.classList.add(_css.CLASS_HIDDEN)}this.label_.style.transform=o}this.rotation_=a}},e}(_Control.default),_default=Rotate;exports.default=_default;

},{"../css.js":61,"../easing.js":63,"../events/EventType.js":66,"./Control.js":51}],56:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Units=void 0;var _Control=_interopRequireDefault(require("./Control.js")),_Units=_interopRequireDefault(require("../proj/Units.js")),_css=require("../css.js"),_proj=require("../proj.js"),_asserts=require("../asserts.js"),_Object=require("../Object.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),UNITS_PROP="units",Units={DEGREES:"degrees",IMPERIAL:"imperial",NAUTICAL:"nautical",METRIC:"metric",US:"us"};exports.Units=Units;var LEADING_DIGITS=[1,2,5],DEFAULT_DPI=25.4/.28,ScaleLine=function(e){function t(t){var i=this,r=t||{},s=void 0!==r.className?r.className:r.bar?"ol-scale-bar":"ol-scale-line";return(i=e.call(this,{element:document.createElement("div"),render:r.render,target:r.target})||this).innerElement_=document.createElement("div"),i.innerElement_.className=s+"-inner",i.element.className=s+" "+_css.CLASS_UNSELECTABLE,i.element.appendChild(i.innerElement_),i.viewState_=null,i.minWidth_=void 0!==r.minWidth?r.minWidth:64,i.renderedVisible_=!1,i.renderedWidth_=void 0,i.renderedHTML_="",i.addEventListener((0,_Object.getChangeEventType)(UNITS_PROP),i.handleUnitsChanged_),i.setUnits(r.units||Units.METRIC),i.scaleBar_=r.bar||!1,i.scaleBarSteps_=r.steps||4,i.scaleBarText_=r.text||!1,i.dpi_=r.dpi||void 0,i}return __extends(t,e),t.prototype.getUnits=function(){return this.get(UNITS_PROP)},t.prototype.handleUnitsChanged_=function(){this.updateElement_()},t.prototype.setUnits=function(e){this.set(UNITS_PROP,e)},t.prototype.setDpi=function(e){this.dpi_=e},t.prototype.updateElement_=function(){var e=this.viewState_;if(e){var t=e.center,i=e.projection,r=this.getUnits(),s=r==Units.DEGREES?_Units.default.DEGREES:_Units.default.METERS,n=(0,_proj.getPointResolution)(i,e.resolution,t,s),a=this.minWidth_*(this.dpi_||DEFAULT_DPI)/DEFAULT_DPI,o=a*n,l="";if(r==Units.DEGREES){var d=_proj.METERS_PER_UNIT[_Units.default.DEGREES];(o*=d)<d/60?(l="″",n*=3600):o<d?(l="′",n*=60):l="°"}else r==Units.IMPERIAL?o<.9144?(l="in",n/=.0254):o<1609.344?(l="ft",n/=.3048):(l="mi",n/=1609.344):r==Units.NAUTICAL?(n/=1852,l="nm"):r==Units.METRIC?o<.001?(l="μm",n*=1e6):o<1?(l="mm",n*=1e3):o<1e3?l="m":(l="km",n/=1e3):r==Units.US?o<.9144?(l="in",n*=39.37):o<1609.344?(l="ft",n/=.30480061):(l="mi",n/=1609.3472):(0,_asserts.assert)(!1,33);for(var _,p,c,u,h=3*Math.floor(Math.log(a*n)/Math.log(10));;){c=Math.floor(h/3);var f=Math.pow(10,c);if(_=LEADING_DIGITS[(h%3+3)%3]*f,p=Math.round(_/n),isNaN(p))return this.element.style.display="none",void(this.renderedVisible_=!1);if(p>=a)break;++h}u=this.scaleBar_?this.createScaleBar(p,_,l):_.toFixed(c<0?-c:0)+" "+l,this.renderedHTML_!=u&&(this.innerElement_.innerHTML=u,this.renderedHTML_=u),this.renderedWidth_!=p&&(this.innerElement_.style.width=p+"px",this.renderedWidth_=p),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},t.prototype.createScaleBar=function(e,t,i){for(var r="1 : "+Math.round(this.getScaleForResolution()).toLocaleString(),s=[],n=e/this.scaleBarSteps_,a="#ffffff",o=0;o<this.scaleBarSteps_;o++)0===o&&s.push(this.createMarker("absolute",o)),s.push('<div><div class="ol-scale-singlebar" style="width: '+n+"px;background-color: "+a+';"></div>'+this.createMarker("relative",o)+(o%2==0||2===this.scaleBarSteps_?this.createStepText(o,e,!1,t,i):"")+"</div>"),o===this.scaleBarSteps_-1&&s.push(this.createStepText(o+1,e,!0,t,i)),a="#ffffff"===a?"#000000":"#ffffff";return'<div style="display: flex;">'+(this.scaleBarText_?'<div class="ol-scale-text" style="width: '+e+'px;">'+r+"</div>":"")+s.join("")+"</div>"},t.prototype.createMarker=function(e,t){return'<div class="ol-scale-step-marker" style="position: '+e+";top: "+("absolute"===e?3:-10)+'px;"></div>'},t.prototype.createStepText=function(e,t,i,r,s){var n=(0===e?0:Math.round(r/this.scaleBarSteps_*e*100)/100)+(0===e?"":" "+s);return'<div class="ol-scale-step-text" style="margin-left: '+(0===e?-3:t/this.scaleBarSteps_*-1)+"px;text-align: "+(0===e?"left":"center")+"; min-width: "+(0===e?0:t/this.scaleBarSteps_*2)+"px;left: "+(i?t+"px":"unset")+';">'+n+"</div>"},t.prototype.getScaleForResolution=function(){var e=(0,_proj.getPointResolution)(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center),t=this.dpi_||DEFAULT_DPI,i=this.viewState_.projection.getMetersPerUnit();return parseFloat(e.toString())*i*39.37*t},t.prototype.render=function(e){var t=e.frameState;this.viewState_=t?t.viewState:null,this.updateElement_()},t}(_Control.default),_default=ScaleLine;exports.default=_default;

},{"../Object.js":28,"../asserts.js":45,"../css.js":61,"../proj.js":205,"../proj/Units.js":207,"./Control.js":51}],57:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Control=_interopRequireDefault(require("./Control.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_css=require("../css.js"),_easing=require("../easing.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Zoom=function(e){function t(t){var o=this,n=t||{};o=e.call(this,{element:document.createElement("div"),target:n.target})||this;var a=void 0!==n.className?n.className:"ol-zoom",i=void 0!==n.delta?n.delta:1,r=void 0!==n.zoomInLabel?n.zoomInLabel:"+",u=void 0!==n.zoomOutLabel?n.zoomOutLabel:"−",l=void 0!==n.zoomInTipLabel?n.zoomInTipLabel:"Zoom in",s=void 0!==n.zoomOutTipLabel?n.zoomOutTipLabel:"Zoom out",d=document.createElement("button");d.className=a+"-in",d.setAttribute("type","button"),d.title=l,d.appendChild("string"==typeof r?document.createTextNode(r):r),d.addEventListener(_EventType.default.CLICK,o.handleClick_.bind(o,i),!1);var c=document.createElement("button");c.className=a+"-out",c.setAttribute("type","button"),c.title=s,c.appendChild("string"==typeof u?document.createTextNode(u):u),c.addEventListener(_EventType.default.CLICK,o.handleClick_.bind(o,-i),!1);var p=a+" "+_css.CLASS_UNSELECTABLE+" "+_css.CLASS_CONTROL,_=o.element;return _.className=p,_.appendChild(d),_.appendChild(c),o.duration_=void 0!==n.duration?n.duration:250,o}return __extends(t,e),t.prototype.handleClick_=function(e,t){t.preventDefault(),this.zoomByDelta_(e)},t.prototype.zoomByDelta_=function(e){var t=this.getMap().getView();if(t){var o=t.getZoom();if(void 0!==o){var n=t.getConstrainedZoom(o+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:n,duration:this.duration_,easing:_easing.easeOut})):t.setZoom(n)}}},t}(_Control.default),_default=Zoom;exports.default=_default;

},{"../css.js":61,"../easing.js":63,"../events/EventType.js":66,"./Control.js":51}],58:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Control=_interopRequireDefault(require("./Control.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_EventType2=_interopRequireDefault(require("../pointer/EventType.js")),_css=require("../css.js"),_math=require("../math.js"),_easing=require("../easing.js"),_events=require("../events.js"),_Event=require("../events/Event.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),Direction={VERTICAL:0,HORIZONTAL:1},ZoomSlider=function(t){function e(e){var i=this,n=e||{};(i=t.call(this,{element:document.createElement("div"),render:n.render})||this).dragListenerKeys_=[],i.currentResolution_=void 0,i.direction_=Direction.VERTICAL,i.dragging_,i.heightLimit_=0,i.widthLimit_=0,i.startX_,i.startY_,i.thumbSize_=null,i.sliderInitialized_=!1,i.duration_=void 0!==n.duration?n.duration:200;var r=void 0!==n.className?n.className:"ol-zoomslider",o=document.createElement("button");o.setAttribute("type","button"),o.className=r+"-thumb "+_css.CLASS_UNSELECTABLE;var s=i.element;return s.className=r+" "+_css.CLASS_UNSELECTABLE+" "+_css.CLASS_CONTROL,s.appendChild(o),s.addEventListener(_EventType2.default.POINTERDOWN,i.handleDraggerStart_.bind(i),!1),s.addEventListener(_EventType2.default.POINTERMOVE,i.handleDraggerDrag_.bind(i),!1),s.addEventListener(_EventType2.default.POINTERUP,i.handleDraggerEnd_.bind(i),!1),s.addEventListener(_EventType.default.CLICK,i.handleContainerClick_.bind(i),!1),o.addEventListener(_EventType.default.CLICK,_Event.stopPropagation,!1),i}return __extends(e,t),e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),e&&e.render()},e.prototype.initSlider_=function(){var t=this.element,e=t.offsetWidth,i=t.offsetHeight;if(0===e&&0===i)return this.sliderInitialized_=!1;var n=t.firstElementChild,r=getComputedStyle(n),o=n.offsetWidth+parseFloat(r.marginRight)+parseFloat(r.marginLeft),s=n.offsetHeight+parseFloat(r.marginTop)+parseFloat(r.marginBottom);return this.thumbSize_=[o,s],e>i?(this.direction_=Direction.HORIZONTAL,this.widthLimit_=e-o):(this.direction_=Direction.VERTICAL,this.heightLimit_=i-s),this.sliderInitialized_=!0},e.prototype.handleContainerClick_=function(t){var e=this.getMap().getView(),i=this.getRelativePosition_(t.offsetX-this.thumbSize_[0]/2,t.offsetY-this.thumbSize_[1]/2),n=this.getResolutionForPosition_(i),r=e.getConstrainedZoom(e.getZoomForResolution(n));e.animateInternal({zoom:r,duration:this.duration_,easing:_easing.easeOut})},e.prototype.handleDraggerStart_=function(t){if(!this.dragging_&&t.target===this.element.firstElementChild){var e=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=t.clientX-parseFloat(e.style.left),this.startY_=t.clientY-parseFloat(e.style.top),this.dragging_=!0,0===this.dragListenerKeys_.length){var i=this.handleDraggerDrag_,n=this.handleDraggerEnd_;this.dragListenerKeys_.push((0,_events.listen)(document,_EventType2.default.POINTERMOVE,i,this),(0,_events.listen)(document,_EventType2.default.POINTERUP,n,this))}}},e.prototype.handleDraggerDrag_=function(t){if(this.dragging_){var e=t.clientX-this.startX_,i=t.clientY-this.startY_,n=this.getRelativePosition_(e,i);this.currentResolution_=this.getResolutionForPosition_(n),this.getMap().getView().setResolution(this.currentResolution_)}},e.prototype.handleDraggerEnd_=function(t){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(_events.unlistenByKey),this.dragListenerKeys_.length=0)},e.prototype.setThumbPosition_=function(t){var e=this.getPositionForResolution_(t),i=this.element.firstElementChild;this.direction_==Direction.HORIZONTAL?i.style.left=this.widthLimit_*e+"px":i.style.top=this.heightLimit_*e+"px"},e.prototype.getRelativePosition_=function(t,e){var i;return i=this.direction_===Direction.HORIZONTAL?t/this.widthLimit_:e/this.heightLimit_,(0,_math.clamp)(i,0,1)},e.prototype.getResolutionForPosition_=function(t){return this.getMap().getView().getResolutionForValueFunction()(1-t)},e.prototype.getPositionForResolution_=function(t){var e=this.getMap().getView().getValueForResolutionFunction();return(0,_math.clamp)(1-e(t),0,1)},e.prototype.render=function(t){if(t.frameState&&(this.sliderInitialized_||this.initSlider_())){var e=t.frameState.viewState.resolution;this.currentResolution_=e,this.setThumbPosition_(e)}},e}(_Control.default),_default=ZoomSlider;exports.default=_default;

},{"../css.js":61,"../easing.js":63,"../events.js":64,"../events/Event.js":65,"../events/EventType.js":66,"../math.js":201,"../pointer/EventType.js":204,"./Control.js":51}],59:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Control=_interopRequireDefault(require("./Control.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_css=require("../css.js"),_Polygon=require("../geom/Polygon.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ZoomToExtent=function(e){function t(t){var n=this,o=t||{};(n=e.call(this,{element:document.createElement("div"),target:o.target})||this).extent=o.extent?o.extent:null;var r=void 0!==o.className?o.className:"ol-zoom-extent",i=void 0!==o.label?o.label:"E",l=void 0!==o.tipLabel?o.tipLabel:"Fit to extent",a=document.createElement("button");a.setAttribute("type","button"),a.title=l,a.appendChild("string"==typeof i?document.createTextNode(i):i),a.addEventListener(_EventType.default.CLICK,n.handleClick_.bind(n),!1);var u=r+" "+_css.CLASS_UNSELECTABLE+" "+_css.CLASS_CONTROL,s=n.element;return s.className=u,s.appendChild(a),n}return __extends(t,e),t.prototype.handleClick_=function(e){e.preventDefault(),this.handleZoomToExtent()},t.prototype.handleZoomToExtent=function(){var e=this.getMap().getView(),t=this.extent?this.extent:e.getProjection().getExtent();e.fitInternal((0,_Polygon.fromExtent)(t))},t}(_Control.default),_default=ZoomToExtent;exports.default=_default;

},{"../css.js":61,"../events/EventType.js":66,"../geom/Polygon.js":138,"./Control.js":51}],60:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.add=add,exports.closestOnCircle=closestOnCircle,exports.closestOnSegment=closestOnSegment,exports.createStringXY=createStringXY,exports.degreesToStringHDMS=degreesToStringHDMS,exports.format=format,exports.equals=equals,exports.rotate=rotate,exports.scale=scale,exports.squaredDistance=squaredDistance,exports.distance=distance,exports.squaredDistanceToSegment=squaredDistanceToSegment,exports.toStringHDMS=toStringHDMS,exports.toStringXY=toStringXY,exports.wrapX=wrapX,exports.getWorldsAway=getWorldsAway;var _extent=require("./extent.js"),_math=require("./math.js"),_string=require("./string.js");function add(t,e){return t[0]+=+e[0],t[1]+=+e[1],t}function closestOnCircle(t,e){var r=e.getRadius(),n=e.getCenter(),o=n[0],s=n[1],a=t[0]-o,i=t[1]-s;0===a&&0===i&&(a=1);var u=Math.sqrt(a*a+i*i);return[o+r*a/u,s+r*i/u]}function closestOnSegment(t,e){var r,n,o=t[0],s=t[1],a=e[0],i=e[1],u=a[0],c=a[1],g=i[0],d=i[1],S=g-u,l=d-c,f=0===S&&0===l?0:(S*(o-u)+l*(s-c))/(S*S+l*l||0);return f<=0?(r=u,n=c):f>=1?(r=g,n=d):(r=u+f*S,n=c+f*l),[r,n]}function createStringXY(t){return function(e){return toStringXY(e,t)}}function degreesToStringHDMS(t,e,r){var n=(0,_math.modulo)(e+180,360)-180,o=Math.abs(3600*n),s=r||0,a=Math.pow(10,s),i=Math.floor(o/3600),u=Math.floor((o-3600*i)/60),c=o-3600*i-60*u;return(c=Math.ceil(c*a)/a)>=60&&(c=0,u+=1),u>=60&&(u=0,i+=1),i+"° "+(0,_string.padNumber)(u,2)+"′ "+(0,_string.padNumber)(c,2,s)+"″"+(0==n?"":" "+t.charAt(n<0?1:0))}function format(t,e,r){return t?e.replace("{x}",t[0].toFixed(r)).replace("{y}",t[1].toFixed(r)):""}function equals(t,e){for(var r=!0,n=t.length-1;n>=0;--n)if(t[n]!=e[n]){r=!1;break}return r}function rotate(t,e){var r=Math.cos(e),n=Math.sin(e),o=t[0]*r-t[1]*n,s=t[1]*r+t[0]*n;return t[0]=o,t[1]=s,t}function scale(t,e){return t[0]*=e,t[1]*=e,t}function squaredDistance(t,e){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function distance(t,e){return Math.sqrt(squaredDistance(t,e))}function squaredDistanceToSegment(t,e){return squaredDistance(t,closestOnSegment(t,e))}function toStringHDMS(t,e){return t?degreesToStringHDMS("NS",t[1],e)+" "+degreesToStringHDMS("EW",t[0],e):""}function toStringXY(t,e){return format(t,"{x}, {y}",e)}function wrapX(t,e){var r=(0,_extent.getWidth)(e.getExtent()),n=getWorldsAway(t,e,r);return n&&(t[0]-=n*r),t}function getWorldsAway(t,e,r){var n=e.getExtent(),o=0;if(e.canWrapX()&&(t[0]<n[0]||t[0]>n[2])){var s=r||(0,_extent.getWidth)(n);o=Math.floor((t[0]-n[0])/s)}return o}

},{"./extent.js":70,"./math.js":201,"./string.js":287}],61:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getFontParameters=exports.CLASS_COLLAPSED=exports.CLASS_CONTROL=exports.CLASS_UNSUPPORTED=exports.CLASS_UNSELECTABLE=exports.CLASS_SELECTABLE=exports.CLASS_HIDDEN=void 0;var CLASS_HIDDEN="ol-hidden";exports.CLASS_HIDDEN=CLASS_HIDDEN;var CLASS_SELECTABLE="ol-selectable";exports.CLASS_SELECTABLE=CLASS_SELECTABLE;var CLASS_UNSELECTABLE="ol-unselectable";exports.CLASS_UNSELECTABLE=CLASS_UNSELECTABLE;var CLASS_UNSUPPORTED="ol-unsupported";exports.CLASS_UNSUPPORTED=CLASS_UNSUPPORTED;var CLASS_CONTROL="ol-control";exports.CLASS_CONTROL=CLASS_CONTROL;var CLASS_COLLAPSED="ol-collapsed";exports.CLASS_COLLAPSED=CLASS_COLLAPSED;var fontRegEx=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),fontRegExMatchIndex=["style","variant","weight","size","lineHeight","family"],getFontParameters=function(e){var S=e.match(fontRegEx);if(!S)return null;for(var t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},r=0,L=fontRegExMatchIndex.length;r<L;++r){var a=S[r+1];void 0!==a&&(t[fontRegExMatchIndex[r]]=a)}return t.families=t.family.split(/,\s?/),t};exports.getFontParameters=getFontParameters;

},{}],62:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createCanvasContext2D=createCanvasContext2D,exports.outerWidth=outerWidth,exports.outerHeight=outerHeight,exports.replaceNode=replaceNode,exports.removeNode=removeNode,exports.removeChildren=removeChildren,exports.replaceChildren=replaceChildren;var _has=require("./has.js");function createCanvasContext2D(e,t,r){var o=r&&r.length?r.shift():_has.WORKER_OFFSCREEN_CANVAS?new OffscreenCanvas(e||300,t||300):document.createElement("canvas");return e&&(o.width=e),t&&(o.height=t),o.getContext("2d")}function outerWidth(e){var t=e.offsetWidth,r=getComputedStyle(e);return t+=parseInt(r.marginLeft,10)+parseInt(r.marginRight,10)}function outerHeight(e){var t=e.offsetHeight,r=getComputedStyle(e);return t+=parseInt(r.marginTop,10)+parseInt(r.marginBottom,10)}function replaceNode(e,t){var r=t.parentNode;r&&r.replaceChild(e,t)}function removeNode(e){return e&&e.parentNode?e.parentNode.removeChild(e):null}function removeChildren(e){for(;e.lastChild;)e.removeChild(e.lastChild)}function replaceChildren(e,t){for(var r=e.childNodes,o=0;;++o){var n=r[o],a=t[o];if(!n&&!a)break;n!==a&&(n?a?e.insertBefore(a,n):(e.removeChild(n),--o):e.appendChild(a))}}

},{"./has.js":159}],63:[function(require,module,exports){
"use strict";function easeIn(n){return Math.pow(n,3)}function easeOut(n){return 1-easeIn(1-n)}function inAndOut(n){return 3*n*n-2*n*n*n}function linear(n){return n}function upAndDown(n){return n<.5?inAndOut(2*n):1-inAndOut(2*(n-.5))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.easeIn=easeIn,exports.easeOut=easeOut,exports.inAndOut=inAndOut,exports.linear=linear,exports.upAndDown=upAndDown;

},{}],64:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.listen=listen,exports.listenOnce=listenOnce,exports.unlistenByKey=unlistenByKey;var _obj=require("./obj.js");function listen(e,t,n,r,i){if(r&&r!==e&&(n=n.bind(r)),i){var s=n;n=function(){e.removeEventListener(t,n),s.apply(this,arguments)}}var l={target:e,type:t,listener:n};return e.addEventListener(t,n),l}function listenOnce(e,t,n,r){return listen(e,t,n,r,!0)}function unlistenByKey(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),(0,_obj.clear)(e))}

},{"./obj.js":203}],65:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.stopPropagation=stopPropagation,exports.preventDefault=preventDefault,exports.default=void 0;var BaseEvent=function(){function t(t){this.propagationStopped,this.type=t,this.target=null}return t.prototype.preventDefault=function(){this.propagationStopped=!0},t.prototype.stopPropagation=function(){this.propagationStopped=!0},t}();function stopPropagation(t){t.stopPropagation()}function preventDefault(t){t.preventDefault()}var _default=BaseEvent;exports.default=_default;

},{}],66:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};exports.default=_default;

},{}],67:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={LEFT:37,UP:38,RIGHT:39,DOWN:40};exports.default=_default;

},{}],68:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Disposable=_interopRequireDefault(require("../Disposable.js")),_Event=_interopRequireDefault(require("./Event.js")),_functions=require("../functions.js"),_obj=require("../obj.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Target=function(e){function t(t){var n=e.call(this)||this;return n.eventTarget_=t,n.pendingRemovals_=null,n.dispatching_=null,n.listeners_=null,n}return __extends(t,e),t.prototype.addEventListener=function(e,t){if(e&&t){var n=this.listeners_||(this.listeners_={}),i=n[e]||(n[e]=[]);-1===i.indexOf(t)&&i.push(t)}},t.prototype.dispatchEvent=function(e){var t="string"==typeof e?new _Event.default(e):e,n=t.type;t.target||(t.target=this.eventTarget_||this);var i,s=this.listeners_&&this.listeners_[n];if(s){var r=this.dispatching_||(this.dispatching_={}),o=this.pendingRemovals_||(this.pendingRemovals_={});n in r||(r[n]=0,o[n]=0),++r[n];for(var l=0,a=s.length;l<a;++l)if(!1===(i="handleEvent"in s[l]?s[l].handleEvent(t):s[l].call(this,t))||t.propagationStopped){i=!1;break}if(--r[n],0===r[n]){var _=o[n];for(delete o[n];_--;)this.removeEventListener(n,_functions.VOID);delete r[n]}return i}},t.prototype.disposeInternal=function(){this.listeners_&&(0,_obj.clear)(this.listeners_)},t.prototype.getListeners=function(e){return this.listeners_&&this.listeners_[e]||void 0},t.prototype.hasListener=function(e){return!!this.listeners_&&(e?e in this.listeners_:Object.keys(this.listeners_).length>0)},t.prototype.removeEventListener=function(e,t){var n=this.listeners_&&this.listeners_[e];if(n){var i=n.indexOf(t);-1!==i&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[i]=_functions.VOID,++this.pendingRemovals_[e]):(n.splice(i,1),0===n.length&&delete this.listeners_[e]))}},t}(_Disposable.default),_default=Target;exports.default=_default;

},{"../Disposable.js":12,"../functions.js":125,"../obj.js":203,"./Event.js":65}],69:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.all=all,exports.primaryAction=exports.penOnly=exports.touchOnly=exports.mouseOnly=exports.targetNotEditable=exports.shiftKeyOnly=exports.platformModifierKeyOnly=exports.noModifierKeys=exports.doubleClick=exports.singleClick=exports.pointerMove=exports.never=exports.mouseActionButton=exports.click=exports.always=exports.focusWithTabindex=exports.focus=exports.altShiftKeysOnly=exports.altKeyOnly=void 0;var _MapBrowserEventType=_interopRequireDefault(require("../MapBrowserEventType.js")),_functions=require("../functions.js"),_has=require("../has.js"),_asserts=require("../asserts.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function all(e){var t=arguments;return function(e){for(var r=!0,n=0,o=t.length;n<o&&(r=r&&t[n](e));++n);return r}}var altKeyOnly=function(e){var t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey};exports.altKeyOnly=altKeyOnly;var altShiftKeysOnly=function(e){var t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey};exports.altShiftKeysOnly=altShiftKeysOnly;var focus=function(e){return e.target.getTargetElement().contains(document.activeElement)};exports.focus=focus;var focusWithTabindex=function(e){return!e.map.getTargetElement().hasAttribute("tabindex")||focus(e)};exports.focusWithTabindex=focusWithTabindex;var always=_functions.TRUE;exports.always=always;var click=function(e){return e.type==_MapBrowserEventType.default.CLICK};exports.click=click;var mouseActionButton=function(e){var t=e.originalEvent;return 0==t.button&&!(_has.WEBKIT&&_has.MAC&&t.ctrlKey)};exports.mouseActionButton=mouseActionButton;var never=_functions.FALSE;exports.never=never;var pointerMove=function(e){return"pointermove"==e.type};exports.pointerMove=pointerMove;var singleClick=function(e){return e.type==_MapBrowserEventType.default.SINGLECLICK};exports.singleClick=singleClick;var doubleClick=function(e){return e.type==_MapBrowserEventType.default.DBLCLICK};exports.doubleClick=doubleClick;var noModifierKeys=function(e){var t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey};exports.noModifierKeys=noModifierKeys;var platformModifierKeyOnly=function(e){var t=e.originalEvent;return!t.altKey&&(_has.MAC?t.metaKey:t.ctrlKey)&&!t.shiftKey};exports.platformModifierKeyOnly=platformModifierKeyOnly;var shiftKeyOnly=function(e){var t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey};exports.shiftKeyOnly=shiftKeyOnly;var targetNotEditable=function(e){var t=e.originalEvent.target.tagName;return"INPUT"!==t&&"SELECT"!==t&&"TEXTAREA"!==t};exports.targetNotEditable=targetNotEditable;var mouseOnly=function(e){var t=e.originalEvent;return(0,_asserts.assert)(void 0!==t,56),"mouse"==t.pointerType};exports.mouseOnly=mouseOnly;var touchOnly=function(e){var t=e.originalEvent;return(0,_asserts.assert)(void 0!==t,56),"touch"===t.pointerType};exports.touchOnly=touchOnly;var penOnly=function(e){var t=e.originalEvent;return(0,_asserts.assert)(void 0!==t,56),"pen"===t.pointerType};exports.penOnly=penOnly;var primaryAction=function(e){var t=e.originalEvent;return(0,_asserts.assert)(void 0!==t,56),t.isPrimary&&0===t.button};exports.primaryAction=primaryAction;

},{"../MapBrowserEventType.js":24,"../asserts.js":45,"../functions.js":125,"../has.js":159}],70:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.boundingExtent=boundingExtent,exports.buffer=buffer,exports.clone=clone,exports.closestSquaredDistanceXY=closestSquaredDistanceXY,exports.containsCoordinate=containsCoordinate,exports.containsExtent=containsExtent,exports.containsXY=containsXY,exports.coordinateRelationship=coordinateRelationship,exports.createEmpty=createEmpty,exports.createOrUpdate=createOrUpdate,exports.createOrUpdateEmpty=createOrUpdateEmpty,exports.createOrUpdateFromCoordinate=createOrUpdateFromCoordinate,exports.createOrUpdateFromCoordinates=createOrUpdateFromCoordinates,exports.createOrUpdateFromFlatCoordinates=createOrUpdateFromFlatCoordinates,exports.createOrUpdateFromRings=createOrUpdateFromRings,exports.equals=equals,exports.approximatelyEquals=approximatelyEquals,exports.extend=extend,exports.extendCoordinate=extendCoordinate,exports.extendCoordinates=extendCoordinates,exports.extendFlatCoordinates=extendFlatCoordinates,exports.extendRings=extendRings,exports.extendXY=extendXY,exports.forEachCorner=forEachCorner,exports.getArea=getArea,exports.getBottomLeft=getBottomLeft,exports.getBottomRight=getBottomRight,exports.getCenter=getCenter,exports.getCorner=getCorner,exports.getEnlargedArea=getEnlargedArea,exports.getForViewAndSize=getForViewAndSize,exports.getHeight=getHeight,exports.getIntersectionArea=getIntersectionArea,exports.getIntersection=getIntersection,exports.getMargin=getMargin,exports.getSize=getSize,exports.getTopLeft=getTopLeft,exports.getTopRight=getTopRight,exports.getWidth=getWidth,exports.intersects=intersects,exports.isEmpty=isEmpty,exports.returnOrUpdate=returnOrUpdate,exports.scaleFromCenter=scaleFromCenter,exports.intersectsSegment=intersectsSegment,exports.applyTransform=applyTransform,exports.wrapX=wrapX;var _Corner=_interopRequireDefault(require("./extent/Corner.js")),_Relationship=_interopRequireDefault(require("./extent/Relationship.js")),_asserts=require("./asserts.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function boundingExtent(t){for(var e=createEmpty(),r=0,n=t.length;r<n;++r)extendCoordinate(e,t[r]);return e}function _boundingExtentXYs(t,e,r){return createOrUpdate(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),r)}function buffer(t,e,r){return r?(r[0]=t[0]-e,r[1]=t[1]-e,r[2]=t[2]+e,r[3]=t[3]+e,r):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function clone(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function closestSquaredDistanceXY(t,e,r){var n,o;return(n=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*n+(o=r<t[1]?t[1]-r:t[3]<r?r-t[3]:0)*o}function containsCoordinate(t,e){return containsXY(t,e[0],e[1])}function containsExtent(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function containsXY(t,e,r){return t[0]<=e&&e<=t[2]&&t[1]<=r&&r<=t[3]}function coordinateRelationship(t,e){var r=t[0],n=t[1],o=t[2],a=t[3],i=e[0],s=e[1],p=_Relationship.default.UNKNOWN;return i<r?p|=_Relationship.default.LEFT:i>o&&(p|=_Relationship.default.RIGHT),s<n?p|=_Relationship.default.BELOW:s>a&&(p|=_Relationship.default.ABOVE),p===_Relationship.default.UNKNOWN&&(p=_Relationship.default.INTERSECTING),p}function createEmpty(){return[1/0,1/0,-1/0,-1/0]}function createOrUpdate(t,e,r,n,o){return o?(o[0]=t,o[1]=e,o[2]=r,o[3]=n,o):[t,e,r,n]}function createOrUpdateEmpty(t){return createOrUpdate(1/0,1/0,-1/0,-1/0,t)}function createOrUpdateFromCoordinate(t,e){var r=t[0],n=t[1];return createOrUpdate(r,n,r,n,e)}function createOrUpdateFromCoordinates(t,e){return extendCoordinates(createOrUpdateEmpty(e),t)}function createOrUpdateFromFlatCoordinates(t,e,r,n,o){return extendFlatCoordinates(createOrUpdateEmpty(o),t,e,r,n)}function createOrUpdateFromRings(t,e){return extendRings(createOrUpdateEmpty(e),t)}function equals(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function approximatelyEquals(t,e,r){return Math.abs(t[0]-e[0])<r&&Math.abs(t[2]-e[2])<r&&Math.abs(t[1]-e[1])<r&&Math.abs(t[3]-e[3])<r}function extend(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function extendCoordinate(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function extendCoordinates(t,e){for(var r=0,n=e.length;r<n;++r)extendCoordinate(t,e[r]);return t}function extendFlatCoordinates(t,e,r,n,o){for(;r<n;r+=o)extendXY(t,e[r],e[r+1]);return t}function extendRings(t,e){for(var r=0,n=e.length;r<n;++r)extendCoordinates(t,e[r]);return t}function extendXY(t,e,r){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],r),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],r)}function forEachCorner(t,e){var r;return(r=e(getBottomLeft(t)))?r:(r=e(getBottomRight(t)))?r:(r=e(getTopRight(t)))?r:(r=e(getTopLeft(t)))||!1}function getArea(t){var e=0;return isEmpty(t)||(e=getWidth(t)*getHeight(t)),e}function getBottomLeft(t){return[t[0],t[1]]}function getBottomRight(t){return[t[2],t[1]]}function getCenter(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function getCorner(t,e){var r;return e===_Corner.default.BOTTOM_LEFT?r=getBottomLeft(t):e===_Corner.default.BOTTOM_RIGHT?r=getBottomRight(t):e===_Corner.default.TOP_LEFT?r=getTopLeft(t):e===_Corner.default.TOP_RIGHT?r=getTopRight(t):(0,_asserts.assert)(!1,13),r}function getEnlargedArea(t,e){var r=Math.min(t[0],e[0]),n=Math.min(t[1],e[1]);return(Math.max(t[2],e[2])-r)*(Math.max(t[3],e[3])-n)}function getForViewAndSize(t,e,r,n,o){var a=e*n[0]/2,i=e*n[1]/2,s=Math.cos(r),p=Math.sin(r),u=a*s,d=a*p,c=i*s,f=i*p,l=t[0],g=t[1],x=l-u+f,h=l-u-f,m=l+u-f,R=l+u+f,E=g-d-c,C=g-d+c,O=g+d+c,_=g+d-c;return createOrUpdate(Math.min(x,h,m,R),Math.min(E,C,O,_),Math.max(x,h,m,R),Math.max(E,C,O,_),o)}function getHeight(t){return t[3]-t[1]}function getIntersectionArea(t,e){return getArea(getIntersection(t,e))}function getIntersection(t,e,r){var n=r||createEmpty();return intersects(t,e)?(t[0]>e[0]?n[0]=t[0]:n[0]=e[0],t[1]>e[1]?n[1]=t[1]:n[1]=e[1],t[2]<e[2]?n[2]=t[2]:n[2]=e[2],t[3]<e[3]?n[3]=t[3]:n[3]=e[3]):createOrUpdateEmpty(n),n}function getMargin(t){return getWidth(t)+getHeight(t)}function getSize(t){return[t[2]-t[0],t[3]-t[1]]}function getTopLeft(t){return[t[0],t[3]]}function getTopRight(t){return[t[2],t[3]]}function getWidth(t){return t[2]-t[0]}function intersects(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function isEmpty(t){return t[2]<t[0]||t[3]<t[1]}function returnOrUpdate(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}function scaleFromCenter(t,e){var r=(t[2]-t[0])/2*(e-1),n=(t[3]-t[1])/2*(e-1);t[0]-=r,t[2]+=r,t[1]-=n,t[3]+=n}function intersectsSegment(t,e,r){var n=!1,o=coordinateRelationship(t,e),a=coordinateRelationship(t,r);if(o===_Relationship.default.INTERSECTING||a===_Relationship.default.INTERSECTING)n=!0;else{var i=t[0],s=t[1],p=t[2],u=t[3],d=e[0],c=e[1],f=r[0],l=r[1],g=(l-c)/(f-d),x=void 0,h=void 0;a&_Relationship.default.ABOVE&&!(o&_Relationship.default.ABOVE)&&(n=(x=f-(l-u)/g)>=i&&x<=p),n||!(a&_Relationship.default.RIGHT)||o&_Relationship.default.RIGHT||(n=(h=l-(f-p)*g)>=s&&h<=u),n||!(a&_Relationship.default.BELOW)||o&_Relationship.default.BELOW||(n=(x=f-(l-s)/g)>=i&&x<=p),n||!(a&_Relationship.default.LEFT)||o&_Relationship.default.LEFT||(n=(h=l-(f-i)*g)>=s&&h<=u)}return n}function applyTransform(t,e,r,n){var o=[];if(n>1)for(var a=t[2]-t[0],i=t[3]-t[1],s=0;s<n;++s)o.push(t[0]+a*s/n,t[1],t[2],t[1]+i*s/n,t[2]-a*s/n,t[3],t[0],t[3]-i*s/n);else o=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(o,o,2);for(var p=[],u=[],d=(s=0,o.length);s<d;s+=2)p.push(o[s]),u.push(o[s+1]);return _boundingExtentXYs(p,u,r)}function wrapX(t,e){var r=e.getExtent(),n=getCenter(t);if(e.canWrapX()&&(n[0]<r[0]||n[0]>=r[2])){var o=getWidth(r),a=Math.floor((n[0]-r[0])/o)*o;t[0]-=a,t[2]-=a}return t}

},{"./asserts.js":45,"./extent/Corner.js":71,"./extent/Relationship.js":72}],71:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"};exports.default=_default;

},{}],72:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};exports.default=_default;

},{}],73:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadFeaturesXhr=loadFeaturesXhr,exports.xhr=xhr,exports.setWithCredentials=setWithCredentials;var _FormatType=_interopRequireDefault(require("./format/FormatType.js")),_functions=require("./functions.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var withCredentials=!1;function loadFeaturesXhr(e,t,r,s){return function(a,n,o){var i=new XMLHttpRequest;i.open("GET","function"==typeof e?e(a,n,o):e,!0),t.getType()==_FormatType.default.ARRAY_BUFFER&&(i.responseType="arraybuffer"),i.withCredentials=withCredentials,i.onload=function(e){if(!i.status||i.status>=200&&i.status<300){var n=t.getType(),u=void 0;n==_FormatType.default.JSON||n==_FormatType.default.TEXT?u=i.responseText:n==_FormatType.default.XML?(u=i.responseXML)||(u=(new DOMParser).parseFromString(i.responseText,"application/xml")):n==_FormatType.default.ARRAY_BUFFER&&(u=i.response),u?r.call(this,t.readFeatures(u,{extent:a,featureProjection:o}),t.readProjection(u)):s.call(this)}else s.call(this)}.bind(this),i.onerror=function(){s.call(this)}.bind(this),i.send()}}function xhr(e,t){return loadFeaturesXhr(e,t,function(e,t){"function"==typeof this.addFeatures&&this.addFeatures(e)},_functions.VOID)}function setWithCredentials(e){withCredentials=e}

},{"./format/FormatType.js":77,"./functions.js":125}],74:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"EsriJSON",{enumerable:!0,get:function(){return _EsriJSON.default}}),Object.defineProperty(exports,"GeoJSON",{enumerable:!0,get:function(){return _GeoJSON.default}}),Object.defineProperty(exports,"GML",{enumerable:!0,get:function(){return _GML.default}}),Object.defineProperty(exports,"GPX",{enumerable:!0,get:function(){return _GPX.default}}),Object.defineProperty(exports,"IGC",{enumerable:!0,get:function(){return _IGC.default}}),Object.defineProperty(exports,"IIIFInfo",{enumerable:!0,get:function(){return _IIIFInfo.default}}),Object.defineProperty(exports,"KML",{enumerable:!0,get:function(){return _KML.default}}),Object.defineProperty(exports,"MVT",{enumerable:!0,get:function(){return _MVT.default}}),Object.defineProperty(exports,"OWS",{enumerable:!0,get:function(){return _OWS.default}}),Object.defineProperty(exports,"Polyline",{enumerable:!0,get:function(){return _Polyline.default}}),Object.defineProperty(exports,"TopoJSON",{enumerable:!0,get:function(){return _TopoJSON.default}}),Object.defineProperty(exports,"WFS",{enumerable:!0,get:function(){return _WFS.default}}),Object.defineProperty(exports,"WKT",{enumerable:!0,get:function(){return _WKT.default}}),Object.defineProperty(exports,"WMSCapabilities",{enumerable:!0,get:function(){return _WMSCapabilities.default}}),Object.defineProperty(exports,"WMSGetFeatureInfo",{enumerable:!0,get:function(){return _WMSGetFeatureInfo.default}}),Object.defineProperty(exports,"WMTSCapabilities",{enumerable:!0,get:function(){return _WMTSCapabilities.default}});var _EsriJSON=_interopRequireDefault(require("./format/EsriJSON.js")),_GeoJSON=_interopRequireDefault(require("./format/GeoJSON.js")),_GML=_interopRequireDefault(require("./format/GML.js")),_GPX=_interopRequireDefault(require("./format/GPX.js")),_IGC=_interopRequireDefault(require("./format/IGC.js")),_IIIFInfo=_interopRequireDefault(require("./format/IIIFInfo.js")),_KML=_interopRequireDefault(require("./format/KML.js")),_MVT=_interopRequireDefault(require("./format/MVT.js")),_OWS=_interopRequireDefault(require("./format/OWS.js")),_Polyline=_interopRequireDefault(require("./format/Polyline.js")),_TopoJSON=_interopRequireDefault(require("./format/TopoJSON.js")),_WFS=_interopRequireDefault(require("./format/WFS.js")),_WKT=_interopRequireDefault(require("./format/WKT.js")),_WMSCapabilities=_interopRequireDefault(require("./format/WMSCapabilities.js")),_WMSGetFeatureInfo=_interopRequireDefault(require("./format/WMSGetFeatureInfo.js")),_WMTSCapabilities=_interopRequireDefault(require("./format/WMTSCapabilities.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}

},{"./format/EsriJSON.js":75,"./format/GML.js":78,"./format/GPX.js":82,"./format/GeoJSON.js":83,"./format/IGC.js":84,"./format/IIIFInfo.js":85,"./format/KML.js":87,"./format/MVT.js":88,"./format/OWS.js":89,"./format/Polyline.js":90,"./format/TopoJSON.js":92,"./format/WFS.js":93,"./format/WKT.js":94,"./format/WMSCapabilities.js":95,"./format/WMSGetFeatureInfo.js":96,"./format/WMTSCapabilities.js":97}],75:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Feature=_interopRequireDefault(require("../Feature.js")),_GeometryLayout=_interopRequireDefault(require("../geom/GeometryLayout.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_JSONFeature=_interopRequireDefault(require("./JSONFeature.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_LinearRing=_interopRequireDefault(require("../geom/LinearRing.js")),_MultiLineString=_interopRequireDefault(require("../geom/MultiLineString.js")),_MultiPoint=_interopRequireDefault(require("../geom/MultiPoint.js")),_MultiPolygon=_interopRequireDefault(require("../geom/MultiPolygon.js")),_Point=_interopRequireDefault(require("../geom/Point.js")),_Polygon=_interopRequireDefault(require("../geom/Polygon.js")),_asserts=require("../asserts.js"),_obj=require("../obj.js"),_extent=require("../extent.js"),_deflate=require("../geom/flat/deflate.js"),_proj=require("../proj.js"),_orient=require("../geom/flat/orient.js"),_Feature2=require("./Feature.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),GEOMETRY_READERS={};GEOMETRY_READERS[_GeometryType.default.POINT]=readPointGeometry,GEOMETRY_READERS[_GeometryType.default.LINE_STRING]=readLineStringGeometry,GEOMETRY_READERS[_GeometryType.default.POLYGON]=readPolygonGeometry,GEOMETRY_READERS[_GeometryType.default.MULTI_POINT]=readMultiPointGeometry,GEOMETRY_READERS[_GeometryType.default.MULTI_LINE_STRING]=readMultiLineStringGeometry,GEOMETRY_READERS[_GeometryType.default.MULTI_POLYGON]=readMultiPolygonGeometry;var GEOMETRY_WRITERS={};GEOMETRY_WRITERS[_GeometryType.default.POINT]=writePointGeometry,GEOMETRY_WRITERS[_GeometryType.default.LINE_STRING]=writeLineStringGeometry,GEOMETRY_WRITERS[_GeometryType.default.POLYGON]=writePolygonGeometry,GEOMETRY_WRITERS[_GeometryType.default.MULTI_POINT]=writeMultiPointGeometry,GEOMETRY_WRITERS[_GeometryType.default.MULTI_LINE_STRING]=writeMultiLineStringGeometry,GEOMETRY_WRITERS[_GeometryType.default.MULTI_POLYGON]=writeMultiPolygonGeometry;var EsriJSON=function(e){function t(t){var r=this,o=t||{};return(r=e.call(this)||this).geometryName_=o.geometryName,r}return __extends(t,e),t.prototype.readFeatureFromObject=function(e,t,r){var o=e,a=readGeometry(o.geometry,t),n=new _Feature.default;if(this.geometryName_&&n.setGeometryName(this.geometryName_),n.setGeometry(a),o.attributes){n.setProperties(o.attributes,!0);var i=o.attributes[r];void 0!==i&&n.setId(i)}return n},t.prototype.readFeaturesFromObject=function(e,t){var r=t||{};if(e.features){for(var o=[],a=e.features,n=0,i=a.length;n<i;++n)o.push(this.readFeatureFromObject(a[n],r,e.objectIdFieldName));return o}return[this.readFeatureFromObject(e,r)]},t.prototype.readGeometryFromObject=function(e,t){return readGeometry(e,t)},t.prototype.readProjectionFromObject=function(e){if(e.spatialReference&&void 0!==e.spatialReference.wkid){var t=e.spatialReference.wkid;return(0,_proj.get)("EPSG:"+t)}return null},t.prototype.writeGeometryObject=function(e,t){return writeGeometry(e,this.adaptOptions(t))},t.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);var r={};if(!e.hasProperties())return r.attributes={},r;var o=e.getProperties(),a=e.getGeometry();return a&&(r.geometry=writeGeometry(a,t),t&&t.featureProjection&&(r.geometry.spatialReference={wkid:Number((0,_proj.get)(t.featureProjection).getCode().split(":").pop())}),delete o[e.getGeometryName()]),(0,_obj.isEmpty)(o)?r.attributes={}:r.attributes=o,r},t.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);for(var r=[],o=0,a=e.length;o<a;++o)r.push(this.writeFeatureObject(e[o],t));return{features:r}},t}(_JSONFeature.default);function readGeometry(e,t){var r,o,a;if(!e)return null;if("number"==typeof e.x&&"number"==typeof e.y)a=_GeometryType.default.POINT;else if(e.points)a=_GeometryType.default.MULTI_POINT;else if(e.paths){a=1===e.paths.length?_GeometryType.default.LINE_STRING:_GeometryType.default.MULTI_LINE_STRING}else if(e.rings){var n=e,i=getGeometryLayout(n),u=convertRings(n.rings,i);1===u.length?(a=_GeometryType.default.POLYGON,e=(0,_obj.assign)({},e,((r={}).rings=u[0],r))):(a=_GeometryType.default.MULTI_POLYGON,e=(0,_obj.assign)({},e,((o={}).rings=u,o)))}var y=GEOMETRY_READERS[a];return(0,_Feature2.transformGeometryWithOptions)(y(e),!1,t)}function convertRings(e,t){var r,o,a=[],n=[],i=[];for(r=0,o=e.length;r<o;++r){a.length=0,(0,_deflate.deflateCoordinates)(a,0,e[r],t.length),(0,_orient.linearRingIsClockwise)(a,0,a.length,t.length)?n.push([e[r]]):i.push(e[r])}for(;i.length;){var u=i.shift(),y=!1;for(r=n.length-1;r>=0;r--){var s=n[r][0];if((0,_extent.containsExtent)(new _LinearRing.default(s).getExtent(),new _LinearRing.default(u).getExtent())){n[r].push(u),y=!0;break}}y||n.push([u.reverse()])}return n}function readPointGeometry(e){return void 0!==e.m&&void 0!==e.z?new _Point.default([e.x,e.y,e.z,e.m],_GeometryLayout.default.XYZM):void 0!==e.z?new _Point.default([e.x,e.y,e.z],_GeometryLayout.default.XYZ):void 0!==e.m?new _Point.default([e.x,e.y,e.m],_GeometryLayout.default.XYM):new _Point.default([e.x,e.y])}function readLineStringGeometry(e){var t=getGeometryLayout(e);return new _LineString.default(e.paths[0],t)}function readMultiLineStringGeometry(e){var t=getGeometryLayout(e);return new _MultiLineString.default(e.paths,t)}function getGeometryLayout(e){var t=_GeometryLayout.default.XY;return!0===e.hasZ&&!0===e.hasM?t=_GeometryLayout.default.XYZM:!0===e.hasZ?t=_GeometryLayout.default.XYZ:!0===e.hasM&&(t=_GeometryLayout.default.XYM),t}function readMultiPointGeometry(e){var t=getGeometryLayout(e);return new _MultiPoint.default(e.points,t)}function readMultiPolygonGeometry(e){var t=getGeometryLayout(e);return new _MultiPolygon.default(e.rings,t)}function readPolygonGeometry(e){var t=getGeometryLayout(e);return new _Polygon.default(e.rings,t)}function writePointGeometry(e,t){var r,o=e.getCoordinates(),a=e.getLayout();return a===_GeometryLayout.default.XYZ?r={x:o[0],y:o[1],z:o[2]}:a===_GeometryLayout.default.XYM?r={x:o[0],y:o[1],m:o[2]}:a===_GeometryLayout.default.XYZM?r={x:o[0],y:o[1],z:o[2],m:o[3]}:a===_GeometryLayout.default.XY?r={x:o[0],y:o[1]}:(0,_asserts.assert)(!1,34),r}function getHasZM(e){var t=e.getLayout();return{hasZ:t===_GeometryLayout.default.XYZ||t===_GeometryLayout.default.XYZM,hasM:t===_GeometryLayout.default.XYM||t===_GeometryLayout.default.XYZM}}function writeLineStringGeometry(e,t){var r=getHasZM(e);return{hasZ:r.hasZ,hasM:r.hasM,paths:[e.getCoordinates()]}}function writePolygonGeometry(e,t){var r=getHasZM(e);return{hasZ:r.hasZ,hasM:r.hasM,rings:e.getCoordinates(!1)}}function writeMultiLineStringGeometry(e,t){var r=getHasZM(e);return{hasZ:r.hasZ,hasM:r.hasM,paths:e.getCoordinates()}}function writeMultiPointGeometry(e,t){var r=getHasZM(e);return{hasZ:r.hasZ,hasM:r.hasM,points:e.getCoordinates()}}function writeMultiPolygonGeometry(e,t){for(var r=getHasZM(e),o=e.getCoordinates(!1),a=[],n=0;n<o.length;n++)for(var i=o[n].length-1;i>=0;i--)a.push(o[n][i]);return{hasZ:r.hasZ,hasM:r.hasM,rings:a}}function writeGeometry(e,t){return(0,GEOMETRY_WRITERS[e.getType()])((0,_Feature2.transformGeometryWithOptions)(e,!0,t),t)}var _default=EsriJSON;exports.default=_default;

},{"../Feature.js":13,"../asserts.js":45,"../extent.js":70,"../geom/GeometryLayout.js":130,"../geom/GeometryType.js":131,"../geom/LineString.js":132,"../geom/LinearRing.js":133,"../geom/MultiLineString.js":134,"../geom/MultiPoint.js":135,"../geom/MultiPolygon.js":136,"../geom/Point.js":137,"../geom/Polygon.js":138,"../geom/flat/deflate.js":144,"../geom/flat/orient.js":152,"../obj.js":203,"../proj.js":205,"./Feature.js":76,"./JSONFeature.js":86}],76:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.transformGeometryWithOptions=transformGeometryWithOptions,exports.transformExtentWithOptions=transformExtentWithOptions,exports.default=void 0;var _Units=_interopRequireDefault(require("../proj/Units.js")),_util=require("../util.js"),_obj=require("../obj.js"),_proj=require("../proj.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var FeatureFormat=function(){function t(){this.dataProjection=null,this.defaultFeatureProjection=null}return t.prototype.getReadOptions=function(t,e){var r;if(e){var o=e.dataProjection?(0,_proj.get)(e.dataProjection):this.readProjection(t);e.extent&&o&&o.getUnits()===_Units.default.TILE_PIXELS&&(o=(0,_proj.get)(o)).setWorldExtent(e.extent),r={dataProjection:o,featureProjection:e.featureProjection}}return this.adaptOptions(r)},t.prototype.adaptOptions=function(t){return(0,_obj.assign)({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)},t.prototype.getType=function(){return(0,_util.abstract)()},t.prototype.readFeature=function(t,e){return(0,_util.abstract)()},t.prototype.readFeatures=function(t,e){return(0,_util.abstract)()},t.prototype.readGeometry=function(t,e){return(0,_util.abstract)()},t.prototype.readProjection=function(t){return(0,_util.abstract)()},t.prototype.writeFeature=function(t,e){return(0,_util.abstract)()},t.prototype.writeFeatures=function(t,e){return(0,_util.abstract)()},t.prototype.writeGeometry=function(t,e){return(0,_util.abstract)()},t}(),_default=FeatureFormat;function transformGeometryWithOptions(t,e,r){var o,n=r?(0,_proj.get)(r.featureProjection):null,a=r?(0,_proj.get)(r.dataProjection):null;if(o=n&&a&&!(0,_proj.equivalent)(n,a)?(e?t.clone():t).transform(e?n:a,e?a:n):t,e&&r&&void 0!==r.decimals){var i=Math.pow(10,r.decimals);o===t&&(o=t.clone()),o.applyTransform(function(t){for(var e=0,r=t.length;e<r;++e)t[e]=Math.round(t[e]*i)/i;return t})}return o}function transformExtentWithOptions(t,e){var r=e?(0,_proj.get)(e.featureProjection):null,o=e?(0,_proj.get)(e.dataProjection):null;return r&&o&&!(0,_proj.equivalent)(r,o)?(0,_proj.transformExtent)(t,o,r):t}exports.default=_default;

},{"../obj.js":203,"../proj.js":205,"../proj/Units.js":207,"../util.js":313}],77:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};exports.default=_default;

},{}],78:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GML=_interopRequireDefault(require("./GML3.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var GML=_GML.default;GML.prototype.writeFeatures,GML.prototype.writeFeaturesNode;var _default=GML;exports.default=_default;

},{"./GML3.js":80}],79:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GMLBase=_interopRequireWildcard(require("./GMLBase.js")),_xml=require("../xml.js"),_obj=require("../obj.js"),_extent=require("../extent.js"),_proj=require("../proj.js"),_Feature=require("./Feature.js"),_xsd=require("./xsd.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),schemaLocation=_GMLBase.GMLNS+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",MULTIGEOMETRY_TO_MEMBER_NODENAME={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},GML2=function(e){function t(t){var r=this,o=t||{};return(r=e.call(this,o)||this).FEATURE_COLLECTION_PARSERS[_GMLBase.GMLNS].featureMember=(0,_xml.makeArrayPusher)(r.readFeaturesInternal),r.schemaLocation=o.schemaLocation?o.schemaLocation:schemaLocation,r}return __extends(t,e),t.prototype.readFlatCoordinates=function(e,t){var r=(0,_xml.getAllTextContent)(e,!1).replace(/^\s*|\s*$/g,""),o=t[0].srsName,n="enu";if(o){var i=(0,_proj.get)(o);i&&(n=i.getAxisOrientation())}for(var a=r.trim().split(/\s+/),p=[],s=0,l=a.length;s<l;s++){var u=a[s].split(/,+/),m=parseFloat(u[0]),d=parseFloat(u[1]),_=3===u.length?parseFloat(u[2]):0;"en"===n.substr(0,2)?p.push(m,d,_):p.push(d,m,_)}return p},t.prototype.readBox=function(e,t){var r=(0,_xml.pushParseAndPop)([null],this.BOX_PARSERS_,e,t,this);return(0,_extent.createOrUpdate)(r[1][0],r[1][1],r[1][3],r[1][4])},t.prototype.innerBoundaryIsParser=function(e,t){var r=(0,_xml.pushParseAndPop)(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)},t.prototype.outerBoundaryIsParser=function(e,t){var r=(0,_xml.pushParseAndPop)(void 0,this.RING_PARSERS,e,t,this);r&&(t[t.length-1][0]=r)},t.prototype.GEOMETRY_NODE_FACTORY_=function(e,t,r){var o,n=t[t.length-1],i=n.multiSurface,a=n.surface,p=n.multiCurve;return Array.isArray(e)?o="Envelope":"MultiPolygon"===(o=e.getType())&&!0===i?o="MultiSurface":"Polygon"===o&&!0===a?o="Surface":"MultiLineString"===o&&!0===p&&(o="MultiCurve"),(0,_xml.createElementNS)("http://www.opengis.net/gml",o)},t.prototype.writeFeatureElement=function(e,t,r){var o=t.getId();o&&e.setAttribute("fid",o);var n=r[r.length-1],i=n.featureNS,a=t.getGeometryName();n.serializers||(n.serializers={},n.serializers[i]={});var p=[],s=[];if(t.hasProperties()){var l=t.getProperties();for(var u in l){var m=l[u];null!==m&&(p.push(u),s.push(m),u==a||"function"==typeof m.getSimplifiedGeometry?u in n.serializers[i]||(n.serializers[i][u]=(0,_xml.makeChildAppender)(this.writeGeometryElement,this)):u in n.serializers[i]||(n.serializers[i][u]=(0,_xml.makeChildAppender)(_xsd.writeStringTextNode)))}}var d=(0,_obj.assign)({},n);d.node=e,(0,_xml.pushSerializeAndPop)(d,n.serializers,(0,_xml.makeSimpleNodeFactory)(void 0,i),s,r,p)},t.prototype.writeCurveOrLineString=function(e,t,r){var o=r[r.length-1].srsName;if("LineStringSegment"!==e.nodeName&&o&&e.setAttribute("srsName",o),"LineString"===e.nodeName||"LineStringSegment"===e.nodeName){var n=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(n),this.writeCoordinates_(n,t,r)}else if("Curve"===e.nodeName){var i=(0,_xml.createElementNS)(e.namespaceURI,"segments");e.appendChild(i),this.writeCurveSegments_(i,t,r)}},t.prototype.writeLineStringOrCurveMember=function(e,t,r){var o=this.GEOMETRY_NODE_FACTORY_(t,r);o&&(e.appendChild(o),this.writeCurveOrLineString(o,t,r))},t.prototype.writeMultiCurveOrLineString=function(e,t,r){var o=r[r.length-1],n=o.hasZ,i=o.srsName,a=o.curve;i&&e.setAttribute("srsName",i);var p=t.getLineStrings();(0,_xml.pushSerializeAndPop)({node:e,hasZ:n,srsName:i,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,p,r,void 0,this)},t.prototype.writeGeometryElement=function(e,t,r){var o,n=r[r.length-1],i=(0,_obj.assign)({},n);i.node=e,o=Array.isArray(t)?(0,_Feature.transformExtentWithOptions)(t,n):(0,_Feature.transformGeometryWithOptions)(t,!0,n),(0,_xml.pushSerializeAndPop)(i,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],r,void 0,this)},t.prototype.createCoordinatesNode_=function(e){var t=(0,_xml.createElementNS)(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t},t.prototype.writeCoordinates_=function(e,t,r){for(var o=r[r.length-1],n=o.hasZ,i=o.srsName,a=t.getCoordinates(),p=a.length,s=new Array(p),l=0;l<p;++l){var u=a[l];s[l]=this.getCoords_(u,i,n)}(0,_xsd.writeStringTextNode)(e,s.join(" "))},t.prototype.writeCurveSegments_=function(e,t,r){var o=(0,_xml.createElementNS)(e.namespaceURI,"LineStringSegment");e.appendChild(o),this.writeCurveOrLineString(o,t,r)},t.prototype.writeSurfaceOrPolygon=function(e,t,r){var o=r[r.length-1],n=o.hasZ,i=o.srsName;if("PolygonPatch"!==e.nodeName&&i&&e.setAttribute("srsName",i),"Polygon"===e.nodeName||"PolygonPatch"===e.nodeName){var a=t.getLinearRings();(0,_xml.pushSerializeAndPop)({node:e,hasZ:n,srsName:i},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if("Surface"===e.nodeName){var p=(0,_xml.createElementNS)(e.namespaceURI,"patches");e.appendChild(p),this.writeSurfacePatches_(p,t,r)}},t.prototype.RING_NODE_FACTORY_=function(e,t,r){var o=t[t.length-1],n=o.node,i=o.exteriorWritten;return void 0===i&&(o.exteriorWritten=!0),(0,_xml.createElementNS)(n.namespaceURI,void 0!==i?"innerBoundaryIs":"outerBoundaryIs")},t.prototype.writeSurfacePatches_=function(e,t,r){var o=(0,_xml.createElementNS)(e.namespaceURI,"PolygonPatch");e.appendChild(o),this.writeSurfaceOrPolygon(o,t,r)},t.prototype.writeRing=function(e,t,r){var o=(0,_xml.createElementNS)(e.namespaceURI,"LinearRing");e.appendChild(o),this.writeLinearRing(o,t,r)},t.prototype.getCoords_=function(e,t,r){var o="enu";t&&(o=(0,_proj.get)(t).getAxisOrientation());var n="en"===o.substr(0,2)?e[0]+","+e[1]:e[1]+","+e[0];r&&(n+=","+(e[2]||0));return n},t.prototype.writePoint=function(e,t,r){var o=r[r.length-1],n=o.hasZ,i=o.srsName;i&&e.setAttribute("srsName",i);var a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);var p=t.getCoordinates(),s=this.getCoords_(p,i,n);(0,_xsd.writeStringTextNode)(a,s)},t.prototype.writeMultiPoint=function(e,t,r){var o=r[r.length-1],n=o.hasZ,i=o.srsName;i&&e.setAttribute("srsName",i);var a=t.getPoints();(0,_xml.pushSerializeAndPop)({node:e,hasZ:n,srsName:i},this.POINTMEMBER_SERIALIZERS,(0,_xml.makeSimpleNodeFactory)("pointMember"),a,r,void 0,this)},t.prototype.writePointMember=function(e,t,r){var o=(0,_xml.createElementNS)(e.namespaceURI,"Point");e.appendChild(o),this.writePoint(o,t,r)},t.prototype.writeLinearRing=function(e,t,r){var o=r[r.length-1].srsName;o&&e.setAttribute("srsName",o);var n=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(n),this.writeCoordinates_(n,t,r)},t.prototype.writeMultiSurfaceOrPolygon=function(e,t,r){var o=r[r.length-1],n=o.hasZ,i=o.srsName,a=o.surface;i&&e.setAttribute("srsName",i);var p=t.getPolygons();(0,_xml.pushSerializeAndPop)({node:e,hasZ:n,srsName:i,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,p,r,void 0,this)},t.prototype.writeSurfaceOrPolygonMember=function(e,t,r){var o=this.GEOMETRY_NODE_FACTORY_(t,r);o&&(e.appendChild(o),this.writeSurfaceOrPolygon(o,t,r))},t.prototype.writeEnvelope=function(e,t,r){var o=r[r.length-1].srsName;o&&e.setAttribute("srsName",o);var n=[t[0]+" "+t[1],t[2]+" "+t[3]];(0,_xml.pushSerializeAndPop)({node:e},this.ENVELOPE_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,n,r,["lowerCorner","upperCorner"],this)},t.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(e,t,r){var o=t[t.length-1].node;return(0,_xml.createElementNS)("http://www.opengis.net/gml",MULTIGEOMETRY_TO_MEMBER_NODENAME[o.nodeName])},t}(_GMLBase.default);GML2.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:(0,_xml.makeReplacer)(GML2.prototype.readFlatCoordinates)}},GML2.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:GML2.prototype.innerBoundaryIsParser,outerBoundaryIs:GML2.prototype.outerBoundaryIsParser}},GML2.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:(0,_xml.makeArrayPusher)(GML2.prototype.readFlatCoordinates)}},GML2.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readPoint),MultiPoint:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readMultiPoint),LineString:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readLineString),MultiLineString:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readMultiLineString),LinearRing:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readLinearRing),Polygon:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readPolygon),MultiPolygon:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readMultiPolygon),Box:(0,_xml.makeReplacer)(GML2.prototype.readBox)}},GML2.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:(0,_xml.makeChildAppender)(GML2.prototype.writeCurveOrLineString),MultiCurve:(0,_xml.makeChildAppender)(GML2.prototype.writeMultiCurveOrLineString),Point:(0,_xml.makeChildAppender)(GML2.prototype.writePoint),MultiPoint:(0,_xml.makeChildAppender)(GML2.prototype.writeMultiPoint),LineString:(0,_xml.makeChildAppender)(GML2.prototype.writeCurveOrLineString),MultiLineString:(0,_xml.makeChildAppender)(GML2.prototype.writeMultiCurveOrLineString),LinearRing:(0,_xml.makeChildAppender)(GML2.prototype.writeLinearRing),Polygon:(0,_xml.makeChildAppender)(GML2.prototype.writeSurfaceOrPolygon),MultiPolygon:(0,_xml.makeChildAppender)(GML2.prototype.writeMultiSurfaceOrPolygon),Surface:(0,_xml.makeChildAppender)(GML2.prototype.writeSurfaceOrPolygon),MultiSurface:(0,_xml.makeChildAppender)(GML2.prototype.writeMultiSurfaceOrPolygon),Envelope:(0,_xml.makeChildAppender)(GML2.prototype.writeEnvelope)}},GML2.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:(0,_xml.makeChildAppender)(GML2.prototype.writeLineStringOrCurveMember),curveMember:(0,_xml.makeChildAppender)(GML2.prototype.writeLineStringOrCurveMember)}},GML2.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:(0,_xml.makeChildAppender)(GML2.prototype.writeRing),innerBoundaryIs:(0,_xml.makeChildAppender)(GML2.prototype.writeRing)}},GML2.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:(0,_xml.makeChildAppender)(GML2.prototype.writePointMember)}},GML2.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:(0,_xml.makeChildAppender)(GML2.prototype.writeSurfaceOrPolygonMember),polygonMember:(0,_xml.makeChildAppender)(GML2.prototype.writeSurfaceOrPolygonMember)}},GML2.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),upperCorner:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode)}};var _default=GML2;exports.default=_default;

},{"../extent.js":70,"../obj.js":203,"../proj.js":205,"../xml.js":322,"./Feature.js":76,"./GMLBase.js":81,"./xsd.js":124}],80:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GMLBase=_interopRequireWildcard(require("./GMLBase.js")),_GeometryLayout=_interopRequireDefault(require("../geom/GeometryLayout.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_MultiLineString=_interopRequireDefault(require("../geom/MultiLineString.js")),_MultiPolygon=_interopRequireDefault(require("../geom/MultiPolygon.js")),_Polygon=_interopRequireDefault(require("../geom/Polygon.js")),_xml=require("../xml.js"),_obj=require("../obj.js"),_extent=require("../extent.js"),_array=require("../array.js"),_proj=require("../proj.js"),_xsd=require("./xsd.js"),_Feature=require("./Feature.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var n=i?Object.getOwnPropertyDescriptor(e,o):null;n&&(n.get||n.set)?Object.defineProperty(r,o,n):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),schemaLocation=_GMLBase.GMLNS+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",MULTIGEOMETRY_TO_MEMBER_NODENAME={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},GML3=function(e){function t(t){var r=this,i=t||{};return(r=e.call(this,i)||this).surface_=void 0!==i.surface&&i.surface,r.curve_=void 0!==i.curve&&i.curve,r.multiCurve_=void 0===i.multiCurve||i.multiCurve,r.multiSurface_=void 0===i.multiSurface||i.multiSurface,r.schemaLocation=i.schemaLocation?i.schemaLocation:schemaLocation,r.hasZ=void 0!==i.hasZ&&i.hasZ,r}return __extends(t,e),t.prototype.readMultiCurve=function(e,t){var r=(0,_xml.pushParseAndPop)([],this.MULTICURVE_PARSERS,e,t,this);return r?new _MultiLineString.default(r):void 0},t.prototype.readMultiSurface=function(e,t){var r=(0,_xml.pushParseAndPop)([],this.MULTISURFACE_PARSERS,e,t,this);if(r)return new _MultiPolygon.default(r)},t.prototype.curveMemberParser=function(e,t){(0,_xml.parseNode)(this.CURVEMEMBER_PARSERS,e,t,this)},t.prototype.surfaceMemberParser=function(e,t){(0,_xml.parseNode)(this.SURFACEMEMBER_PARSERS,e,t,this)},t.prototype.readPatch=function(e,t){return(0,_xml.pushParseAndPop)([null],this.PATCHES_PARSERS,e,t,this)},t.prototype.readSegment=function(e,t){return(0,_xml.pushParseAndPop)([null],this.SEGMENTS_PARSERS,e,t,this)},t.prototype.readPolygonPatch=function(e,t){return(0,_xml.pushParseAndPop)([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)},t.prototype.readLineStringSegment=function(e,t){return(0,_xml.pushParseAndPop)([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)},t.prototype.interiorParser=function(e,t){var r=(0,_xml.pushParseAndPop)(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)},t.prototype.exteriorParser=function(e,t){var r=(0,_xml.pushParseAndPop)(void 0,this.RING_PARSERS,e,t,this);r&&(t[t.length-1][0]=r)},t.prototype.readSurface=function(e,t){var r=(0,_xml.pushParseAndPop)([null],this.SURFACE_PARSERS,e,t,this);if(r&&r[0]){var i,o=r[0],n=[o.length],a=void 0;for(a=1,i=r.length;a<i;++a)(0,_array.extend)(o,r[a]),n.push(o.length);return new _Polygon.default(o,_GeometryLayout.default.XYZ,n)}},t.prototype.readCurve=function(e,t){var r=(0,_xml.pushParseAndPop)([null],this.CURVE_PARSERS,e,t,this);return r?new _LineString.default(r,_GeometryLayout.default.XYZ):void 0},t.prototype.readEnvelope=function(e,t){var r=(0,_xml.pushParseAndPop)([null],this.ENVELOPE_PARSERS,e,t,this);return(0,_extent.createOrUpdate)(r[1][0],r[1][1],r[2][0],r[2][1])},t.prototype.readFlatPos=function(e,t){for(var r,i=(0,_xml.getAllTextContent)(e,!1),o=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,n=[];r=o.exec(i);)n.push(parseFloat(r[1])),i=i.substr(r[0].length);if(""===i){var a=t[0].srsName,p="enu";if(a)p=(0,_proj.get)(a).getAxisOrientation();if("neu"===p){var s,l=void 0;for(l=0,s=n.length;l<s;l+=3){var u=n[l],m=n[l+1];n[l]=m,n[l+1]=u}}var _=n.length;if(2==_&&n.push(0),0!==_)return n}},t.prototype.readFlatPosList=function(e,t){var r=(0,_xml.getAllTextContent)(e,!1).replace(/^\s*|\s*$/g,""),i=t[0],o=i.srsName,n=i.srsDimension,a="enu";o&&(a=(0,_proj.get)(o).getAxisOrientation());var p,s,l,u=r.split(/\s+/),m=2;e.getAttribute("srsDimension")?m=(0,_xsd.readNonNegativeIntegerString)(e.getAttribute("srsDimension")):e.getAttribute("dimension")?m=(0,_xsd.readNonNegativeIntegerString)(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?m=(0,_xsd.readNonNegativeIntegerString)(e.parentNode.getAttribute("srsDimension")):n&&(m=(0,_xsd.readNonNegativeIntegerString)(n));for(var _=[],d=0,h=u.length;d<h;d+=m)p=parseFloat(u[d]),s=parseFloat(u[d+1]),l=3===m?parseFloat(u[d+2]):0,"en"===a.substr(0,2)?_.push(p,s,l):_.push(s,p,l);return _},t.prototype.writePos_=function(e,t,r){var i=r[r.length-1],o=i.hasZ,n=o?"3":"2";e.setAttribute("srsDimension",n);var a=i.srsName,p="enu";a&&(p=(0,_proj.get)(a).getAxisOrientation());var s,l=t.getCoordinates();(s="en"===p.substr(0,2)?l[0]+" "+l[1]:l[1]+" "+l[0],o)&&(s+=" "+(l[2]||0));(0,_xsd.writeStringTextNode)(e,s)},t.prototype.getCoords_=function(e,t,r){var i="enu";t&&(i=(0,_proj.get)(t).getAxisOrientation());var o="en"===i.substr(0,2)?e[0]+" "+e[1]:e[1]+" "+e[0];r&&(o+=" "+(e[2]||0));return o},t.prototype.writePosList_=function(e,t,r){var i=r[r.length-1],o=i.hasZ,n=o?"3":"2";e.setAttribute("srsDimension",n);for(var a,p=i.srsName,s=t.getCoordinates(),l=s.length,u=new Array(l),m=0;m<l;++m)a=s[m],u[m]=this.getCoords_(a,p,o);(0,_xsd.writeStringTextNode)(e,u.join(" "))},t.prototype.writePoint=function(e,t,r){var i=r[r.length-1].srsName;i&&e.setAttribute("srsName",i);var o=(0,_xml.createElementNS)(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,r)},t.prototype.writeEnvelope=function(e,t,r){var i=r[r.length-1].srsName;i&&e.setAttribute("srsName",i);var o=[t[0]+" "+t[1],t[2]+" "+t[3]];(0,_xml.pushSerializeAndPop)({node:e},this.ENVELOPE_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,o,r,["lowerCorner","upperCorner"],this)},t.prototype.writeLinearRing=function(e,t,r){var i=r[r.length-1].srsName;i&&e.setAttribute("srsName",i);var o=(0,_xml.createElementNS)(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,r)},t.prototype.RING_NODE_FACTORY_=function(e,t,r){var i=t[t.length-1],o=i.node,n=i.exteriorWritten;return void 0===n&&(i.exteriorWritten=!0),(0,_xml.createElementNS)(o.namespaceURI,void 0!==n?"interior":"exterior")},t.prototype.writeSurfaceOrPolygon=function(e,t,r){var i=r[r.length-1],o=i.hasZ,n=i.srsName;if("PolygonPatch"!==e.nodeName&&n&&e.setAttribute("srsName",n),"Polygon"===e.nodeName||"PolygonPatch"===e.nodeName){var a=t.getLinearRings();(0,_xml.pushSerializeAndPop)({node:e,hasZ:o,srsName:n},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,r,void 0,this)}else if("Surface"===e.nodeName){var p=(0,_xml.createElementNS)(e.namespaceURI,"patches");e.appendChild(p),this.writeSurfacePatches_(p,t,r)}},t.prototype.writeCurveOrLineString=function(e,t,r){var i=r[r.length-1].srsName;if("LineStringSegment"!==e.nodeName&&i&&e.setAttribute("srsName",i),"LineString"===e.nodeName||"LineStringSegment"===e.nodeName){var o=(0,_xml.createElementNS)(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,r)}else if("Curve"===e.nodeName){var n=(0,_xml.createElementNS)(e.namespaceURI,"segments");e.appendChild(n),this.writeCurveSegments_(n,t,r)}},t.prototype.writeMultiSurfaceOrPolygon=function(e,t,r){var i=r[r.length-1],o=i.hasZ,n=i.srsName,a=i.surface;n&&e.setAttribute("srsName",n);var p=t.getPolygons();(0,_xml.pushSerializeAndPop)({node:e,hasZ:o,srsName:n,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,p,r,void 0,this)},t.prototype.writeMultiPoint=function(e,t,r){var i=r[r.length-1],o=i.srsName,n=i.hasZ;o&&e.setAttribute("srsName",o);var a=t.getPoints();(0,_xml.pushSerializeAndPop)({node:e,hasZ:n,srsName:o},this.POINTMEMBER_SERIALIZERS,(0,_xml.makeSimpleNodeFactory)("pointMember"),a,r,void 0,this)},t.prototype.writeMultiCurveOrLineString=function(e,t,r){var i=r[r.length-1],o=i.hasZ,n=i.srsName,a=i.curve;n&&e.setAttribute("srsName",n);var p=t.getLineStrings();(0,_xml.pushSerializeAndPop)({node:e,hasZ:o,srsName:n,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,p,r,void 0,this)},t.prototype.writeRing=function(e,t,r){var i=(0,_xml.createElementNS)(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,r)},t.prototype.writeSurfaceOrPolygonMember=function(e,t,r){var i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r))},t.prototype.writePointMember=function(e,t,r){var i=(0,_xml.createElementNS)(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,r)},t.prototype.writeLineStringOrCurveMember=function(e,t,r){var i=this.GEOMETRY_NODE_FACTORY_(t,r);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,r))},t.prototype.writeSurfacePatches_=function(e,t,r){var i=(0,_xml.createElementNS)(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,r)},t.prototype.writeCurveSegments_=function(e,t,r){var i=(0,_xml.createElementNS)(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,r)},t.prototype.writeGeometryElement=function(e,t,r){var i,o=r[r.length-1],n=(0,_obj.assign)({},o);n.node=e,i=Array.isArray(t)?(0,_Feature.transformExtentWithOptions)(t,o):(0,_Feature.transformGeometryWithOptions)(t,!0,o),(0,_xml.pushSerializeAndPop)(n,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[i],r,void 0,this)},t.prototype.writeFeatureElement=function(e,t,r){var i=t.getId();i&&e.setAttribute("fid",i);var o=r[r.length-1],n=o.featureNS,a=t.getGeometryName();o.serializers||(o.serializers={},o.serializers[n]={});var p=[],s=[];if(t.hasProperties()){var l=t.getProperties();for(var u in l){var m=l[u];null!==m&&(p.push(u),s.push(m),u==a||"function"==typeof m.getSimplifiedGeometry?u in o.serializers[n]||(o.serializers[n][u]=(0,_xml.makeChildAppender)(this.writeGeometryElement,this)):u in o.serializers[n]||(o.serializers[n][u]=(0,_xml.makeChildAppender)(_xsd.writeStringTextNode)))}}var _=(0,_obj.assign)({},o);_.node=e,(0,_xml.pushSerializeAndPop)(_,o.serializers,(0,_xml.makeSimpleNodeFactory)(void 0,n),s,r,p)},t.prototype.writeFeatureMembers_=function(e,t,r){var i=r[r.length-1],o=i.featureType,n=i.featureNS,a={};a[n]={},a[n][o]=(0,_xml.makeChildAppender)(this.writeFeatureElement,this);var p=(0,_obj.assign)({},i);p.node=e,(0,_xml.pushSerializeAndPop)(p,a,(0,_xml.makeSimpleNodeFactory)(o,n),t,r)},t.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(e,t,r){var i=t[t.length-1].node;return(0,_xml.createElementNS)(this.namespace,MULTIGEOMETRY_TO_MEMBER_NODENAME[i.nodeName])},t.prototype.GEOMETRY_NODE_FACTORY_=function(e,t,r){var i,o=t[t.length-1],n=o.multiSurface,a=o.surface,p=o.curve,s=o.multiCurve;return Array.isArray(e)?i="Envelope":"MultiPolygon"===(i=e.getType())&&!0===n?i="MultiSurface":"Polygon"===i&&!0===a?i="Surface":"LineString"===i&&!0===p?i="Curve":"MultiLineString"===i&&!0===s&&(i="MultiCurve"),(0,_xml.createElementNS)(this.namespace,i)},t.prototype.writeGeometryNode=function(e,t){t=this.adaptOptions(t);var r=(0,_xml.createElementNS)(this.namespace,"geom"),i={node:r,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&(0,_obj.assign)(i,t),this.writeGeometryElement(r,e,[i]),r},t.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var r=(0,_xml.createElementNS)(this.namespace,"featureMembers");r.setAttributeNS(_xml.XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",this.schemaLocation);var i={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&(0,_obj.assign)(i,t),this.writeFeatureMembers_(r,e,[i]),r},t}(_GMLBase.default);GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:(0,_xml.makeReplacer)(GML3.prototype.readFlatPos),posList:(0,_xml.makeReplacer)(GML3.prototype.readFlatPosList)}},GML3.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:GML3.prototype.interiorParser,exterior:GML3.prototype.exteriorParser}},GML3.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readPoint),MultiPoint:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readMultiPoint),LineString:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readLineString),MultiLineString:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readMultiLineString),LinearRing:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readLinearRing),Polygon:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readPolygon),MultiPolygon:(0,_xml.makeReplacer)(_GMLBase.default.prototype.readMultiPolygon),Surface:(0,_xml.makeReplacer)(GML3.prototype.readSurface),MultiSurface:(0,_xml.makeReplacer)(GML3.prototype.readMultiSurface),Curve:(0,_xml.makeReplacer)(GML3.prototype.readCurve),MultiCurve:(0,_xml.makeReplacer)(GML3.prototype.readMultiCurve),Envelope:(0,_xml.makeReplacer)(GML3.prototype.readEnvelope)}},GML3.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:(0,_xml.makeArrayPusher)(GML3.prototype.curveMemberParser),curveMembers:(0,_xml.makeArrayPusher)(GML3.prototype.curveMemberParser)}},GML3.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:(0,_xml.makeArrayPusher)(GML3.prototype.surfaceMemberParser),surfaceMembers:(0,_xml.makeArrayPusher)(GML3.prototype.surfaceMemberParser)}},GML3.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:(0,_xml.makeArrayPusher)(_GMLBase.default.prototype.readLineString),Curve:(0,_xml.makeArrayPusher)(GML3.prototype.readCurve)}},GML3.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:(0,_xml.makeArrayPusher)(_GMLBase.default.prototype.readPolygon),Surface:(0,_xml.makeArrayPusher)(GML3.prototype.readSurface)}},GML3.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:(0,_xml.makeReplacer)(GML3.prototype.readPatch)}},GML3.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:(0,_xml.makeReplacer)(GML3.prototype.readSegment)}},GML3.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:(0,_xml.makeArrayPusher)(GML3.prototype.readFlatPosList),upperCorner:(0,_xml.makeArrayPusher)(GML3.prototype.readFlatPosList)}},GML3.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:(0,_xml.makeReplacer)(GML3.prototype.readPolygonPatch)}},GML3.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:(0,_xml.makeReplacer)(GML3.prototype.readLineStringSegment)}},GML3.prototype.writeFeatures,GML3.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:(0,_xml.makeChildAppender)(GML3.prototype.writeRing),interior:(0,_xml.makeChildAppender)(GML3.prototype.writeRing)}},GML3.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),upperCorner:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode)}},GML3.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:(0,_xml.makeChildAppender)(GML3.prototype.writeSurfaceOrPolygonMember),polygonMember:(0,_xml.makeChildAppender)(GML3.prototype.writeSurfaceOrPolygonMember)}},GML3.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:(0,_xml.makeChildAppender)(GML3.prototype.writePointMember)}},GML3.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:(0,_xml.makeChildAppender)(GML3.prototype.writeLineStringOrCurveMember),curveMember:(0,_xml.makeChildAppender)(GML3.prototype.writeLineStringOrCurveMember)}},GML3.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:(0,_xml.makeChildAppender)(GML3.prototype.writeCurveOrLineString),MultiCurve:(0,_xml.makeChildAppender)(GML3.prototype.writeMultiCurveOrLineString),Point:(0,_xml.makeChildAppender)(GML3.prototype.writePoint),MultiPoint:(0,_xml.makeChildAppender)(GML3.prototype.writeMultiPoint),LineString:(0,_xml.makeChildAppender)(GML3.prototype.writeCurveOrLineString),MultiLineString:(0,_xml.makeChildAppender)(GML3.prototype.writeMultiCurveOrLineString),LinearRing:(0,_xml.makeChildAppender)(GML3.prototype.writeLinearRing),Polygon:(0,_xml.makeChildAppender)(GML3.prototype.writeSurfaceOrPolygon),MultiPolygon:(0,_xml.makeChildAppender)(GML3.prototype.writeMultiSurfaceOrPolygon),Surface:(0,_xml.makeChildAppender)(GML3.prototype.writeSurfaceOrPolygon),MultiSurface:(0,_xml.makeChildAppender)(GML3.prototype.writeMultiSurfaceOrPolygon),Envelope:(0,_xml.makeChildAppender)(GML3.prototype.writeEnvelope)}};var _default=GML3;exports.default=_default;

},{"../array.js":44,"../extent.js":70,"../geom/GeometryLayout.js":130,"../geom/LineString.js":132,"../geom/MultiLineString.js":134,"../geom/MultiPolygon.js":136,"../geom/Polygon.js":138,"../obj.js":203,"../proj.js":205,"../xml.js":322,"./Feature.js":76,"./GMLBase.js":81,"./xsd.js":124}],81:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.GMLNS=void 0;var _Feature=_interopRequireDefault(require("../Feature.js")),_GeometryLayout=_interopRequireDefault(require("../geom/GeometryLayout.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_LinearRing=_interopRequireDefault(require("../geom/LinearRing.js")),_MultiLineString=_interopRequireDefault(require("../geom/MultiLineString.js")),_MultiPoint=_interopRequireDefault(require("../geom/MultiPoint.js")),_MultiPolygon=_interopRequireDefault(require("../geom/MultiPolygon.js")),_Point=_interopRequireDefault(require("../geom/Point.js")),_Polygon=_interopRequireDefault(require("../geom/Polygon.js")),_XMLFeature=_interopRequireDefault(require("./XMLFeature.js")),_obj=require("../obj.js"),_array=require("../array.js"),_xml=require("../xml.js"),_proj=require("../proj.js"),_Feature2=require("./Feature.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),GMLNS="http://www.opengis.net/gml";exports.GMLNS=GMLNS;var ONLY_WHITESPACE_RE=/^[\s\xa0]*$/,GMLBase=function(e){function t(t){var r=e.call(this)||this,o=t||{};return r.featureType=o.featureType,r.featureNS=o.featureNS,r.srsName=o.srsName,r.schemaLocation="",r.FEATURE_COLLECTION_PARSERS={},r.FEATURE_COLLECTION_PARSERS[r.namespace]={featureMember:(0,_xml.makeArrayPusher)(r.readFeaturesInternal),featureMembers:(0,_xml.makeReplacer)(r.readFeaturesInternal)},r}return __extends(t,e),t.prototype.readFeaturesInternal=function(e,t){var r=e.localName,o=null;if("FeatureCollection"==r)o=(0,_xml.pushParseAndPop)([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if("featureMembers"==r||"featureMember"==r){var n=t[0],a=n.featureType,i=n.featureNS;if(!a&&e.childNodes){a=[],i={};for(var s=0,u=e.childNodes.length;s<u;++s){var p=e.childNodes[s];if(1===p.nodeType){var l=p.nodeName.split(":").pop();if(-1===a.indexOf(l)){var m="",_=0,d=p.namespaceURI;for(var f in i){if(i[f]===d){m=f;break}++_}m||(i[m="p"+_]=d),a.push(m+":"+l)}}}"featureMember"!=r&&(n.featureType=a,n.featureNS=i)}if("string"==typeof i){var y=i;(i={}).p0=y}var h={},R=Array.isArray(a)?a:[a];for(var P in i){var M={};for(s=0,u=R.length;s<u;++s){(-1===R[s].indexOf(":")?"p0":R[s].split(":")[0])===P&&(M[R[s].split(":").pop()]="featureMembers"==r?(0,_xml.makeArrayPusher)(this.readFeatureElement,this):(0,_xml.makeReplacer)(this.readFeatureElement,this))}h[i[P]]=M}o="featureMember"==r?(0,_xml.pushParseAndPop)(void 0,h,e,t):(0,_xml.pushParseAndPop)([],h,e,t)}return null===o&&(o=[]),o},t.prototype.readGeometryElement=function(e,t){var r=t[0];r.srsName=e.firstElementChild.getAttribute("srsName"),r.srsDimension=e.firstElementChild.getAttribute("srsDimension");var o=(0,_xml.pushParseAndPop)(null,this.GEOMETRY_PARSERS,e,t,this);return o?Array.isArray(o)?(0,_Feature2.transformExtentWithOptions)(o,r):(0,_Feature2.transformGeometryWithOptions)(o,!1,r):void 0},t.prototype.readFeatureElementInternal=function(e,t,r){for(var o,n={},a=e.firstElementChild;a;a=a.nextElementSibling){var i=void 0,s=a.localName;0===a.childNodes.length||1===a.childNodes.length&&(3===a.firstChild.nodeType||4===a.firstChild.nodeType)?(i=(0,_xml.getAllTextContent)(a,!1),ONLY_WHITESPACE_RE.test(i)&&(i=void 0)):(r&&(i=this.readGeometryElement(a,t)),i?"boundedBy"!==s&&(o=s):i=this.readFeatureElementInternal(a,t,!1)),n[s]?(n[s]instanceof Array||(n[s]=[n[s]]),n[s].push(i)):n[s]=i;var u=a.attributes.length;if(u>0){n[s]={_content_:n[s]};for(var p=0;p<u;p++){var l=a.attributes[p].name;n[s][l]=a.attributes[p].value}}}if(r){var m=new _Feature.default(n);o&&m.setGeometryName(o);var _=e.getAttribute("fid")||(0,_xml.getAttributeNS)(e,this.namespace,"id");return _&&m.setId(_),m}return n},t.prototype.readFeatureElement=function(e,t){return this.readFeatureElementInternal(e,t,!0)},t.prototype.readPoint=function(e,t){var r=this.readFlatCoordinatesFromNode(e,t);if(r)return new _Point.default(r,_GeometryLayout.default.XYZ)},t.prototype.readMultiPoint=function(e,t){var r=(0,_xml.pushParseAndPop)([],this.MULTIPOINT_PARSERS,e,t,this);return r?new _MultiPoint.default(r):void 0},t.prototype.readMultiLineString=function(e,t){var r=(0,_xml.pushParseAndPop)([],this.MULTILINESTRING_PARSERS,e,t,this);if(r)return new _MultiLineString.default(r)},t.prototype.readMultiPolygon=function(e,t){var r=(0,_xml.pushParseAndPop)([],this.MULTIPOLYGON_PARSERS,e,t,this);if(r)return new _MultiPolygon.default(r)},t.prototype.pointMemberParser=function(e,t){(0,_xml.parseNode)(this.POINTMEMBER_PARSERS,e,t,this)},t.prototype.lineStringMemberParser=function(e,t){(0,_xml.parseNode)(this.LINESTRINGMEMBER_PARSERS,e,t,this)},t.prototype.polygonMemberParser=function(e,t){(0,_xml.parseNode)(this.POLYGONMEMBER_PARSERS,e,t,this)},t.prototype.readLineString=function(e,t){var r=this.readFlatCoordinatesFromNode(e,t);return r?new _LineString.default(r,_GeometryLayout.default.XYZ):void 0},t.prototype.readFlatLinearRing=function(e,t){var r=(0,_xml.pushParseAndPop)(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);return r||void 0},t.prototype.readLinearRing=function(e,t){var r=this.readFlatCoordinatesFromNode(e,t);if(r)return new _LinearRing.default(r,_GeometryLayout.default.XYZ)},t.prototype.readPolygon=function(e,t){var r=(0,_xml.pushParseAndPop)([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(r&&r[0]){var o,n=r[0],a=[n.length],i=void 0;for(i=1,o=r.length;i<o;++i)(0,_array.extend)(n,r[i]),a.push(n.length);return new _Polygon.default(n,_GeometryLayout.default.XYZ,a)}},t.prototype.readFlatCoordinatesFromNode=function(e,t){return(0,_xml.pushParseAndPop)(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)},t.prototype.readGeometryFromNode=function(e,t){var r=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return r||null},t.prototype.readFeaturesFromNode=function(e,t){var r={featureType:this.featureType,featureNS:this.featureNS};return t&&(0,_obj.assign)(r,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[r])||[]},t.prototype.readProjectionFromNode=function(e){return(0,_proj.get)(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))},t}(_XMLFeature.default);GMLBase.prototype.namespace=GMLNS,GMLBase.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}},GMLBase.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}},GMLBase.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}},GMLBase.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:(0,_xml.makeArrayPusher)(GMLBase.prototype.pointMemberParser),pointMembers:(0,_xml.makeArrayPusher)(GMLBase.prototype.pointMemberParser)}},GMLBase.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:(0,_xml.makeArrayPusher)(GMLBase.prototype.lineStringMemberParser),lineStringMembers:(0,_xml.makeArrayPusher)(GMLBase.prototype.lineStringMemberParser)}},GMLBase.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:(0,_xml.makeArrayPusher)(GMLBase.prototype.polygonMemberParser),polygonMembers:(0,_xml.makeArrayPusher)(GMLBase.prototype.polygonMemberParser)}},GMLBase.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:(0,_xml.makeArrayPusher)(GMLBase.prototype.readFlatCoordinatesFromNode)}},GMLBase.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:(0,_xml.makeArrayPusher)(GMLBase.prototype.readLineString)}},GMLBase.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:(0,_xml.makeArrayPusher)(GMLBase.prototype.readPolygon)}},GMLBase.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:(0,_xml.makeReplacer)(GMLBase.prototype.readFlatLinearRing)}};var _default=GMLBase;exports.default=_default;

},{"../Feature.js":13,"../array.js":44,"../geom/GeometryLayout.js":130,"../geom/LineString.js":132,"../geom/LinearRing.js":133,"../geom/MultiLineString.js":134,"../geom/MultiPoint.js":135,"../geom/MultiPolygon.js":136,"../geom/Point.js":137,"../geom/Polygon.js":138,"../obj.js":203,"../proj.js":205,"../xml.js":322,"./Feature.js":76,"./XMLFeature.js":100}],82:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Feature=_interopRequireDefault(require("../Feature.js")),_GeometryLayout=_interopRequireDefault(require("../geom/GeometryLayout.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_MultiLineString=_interopRequireDefault(require("../geom/MultiLineString.js")),_Point=_interopRequireDefault(require("../geom/Point.js")),_XMLFeature=_interopRequireDefault(require("./XMLFeature.js")),_xml=require("../xml.js"),_proj=require("../proj.js"),_array=require("../array.js"),_xsd=require("./xsd.js"),_Feature2=require("./Feature.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),NAMESPACE_URIS=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],SCHEMA_LOCATION="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",FEATURE_READER={rte:readRte,trk:readTrk,wpt:readWpt},GPX_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{rte:(0,_xml.makeArrayPusher)(readRte),trk:(0,_xml.makeArrayPusher)(readTrk),wpt:(0,_xml.makeArrayPusher)(readWpt)}),LINK_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{text:(0,_xml.makeObjectPropertySetter)(_xsd.readString,"linkText"),type:(0,_xml.makeObjectPropertySetter)(_xsd.readString,"linkType")}),GPX_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{rte:(0,_xml.makeChildAppender)(writeRte),trk:(0,_xml.makeChildAppender)(writeTrk),wpt:(0,_xml.makeChildAppender)(writeWpt)}),GPX=function(e){function t(t){var r=e.call(this)||this,a=t||{};return r.dataProjection=(0,_proj.get)("EPSG:4326"),r.readExtensions_=a.readExtensions,r}return __extends(t,e),t.prototype.handleReadExtensions_=function(e){e||(e=[]);for(var t=0,r=e.length;t<r;++t){var a=e[t];if(this.readExtensions_){var i=a.get("extensionsNode_")||null;this.readExtensions_(a,i)}a.set("extensionsNode_",void 0)}},t.prototype.readFeatureFromNode=function(e,t){if(!(0,_array.includes)(NAMESPACE_URIS,e.namespaceURI))return null;var r=FEATURE_READER[e.localName];if(!r)return null;var a=r(e,[this.getReadOptions(e,t)]);return a?(this.handleReadExtensions_([a]),a):null},t.prototype.readFeaturesFromNode=function(e,t){if(!(0,_array.includes)(NAMESPACE_URIS,e.namespaceURI))return[];if("gpx"==e.localName){var r=(0,_xml.pushParseAndPop)([],GPX_PARSERS,e,[this.getReadOptions(e,t)]);return r?(this.handleReadExtensions_(r),r):[]}return[]},t.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var r=(0,_xml.createElementNS)("http://www.topografix.com/GPX/1/1","gpx");return r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",_xml.XML_SCHEMA_INSTANCE_URI),r.setAttributeNS(_xml.XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATION),r.setAttribute("version","1.1"),r.setAttribute("creator","OpenLayers"),(0,_xml.pushSerializeAndPop)({node:r},GPX_SERIALIZERS,GPX_NODE_FACTORY,e,[t]),r},t}(_XMLFeature.default),RTE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{name:(0,_xml.makeObjectPropertySetter)(_xsd.readString),cmt:(0,_xml.makeObjectPropertySetter)(_xsd.readString),desc:(0,_xml.makeObjectPropertySetter)(_xsd.readString),src:(0,_xml.makeObjectPropertySetter)(_xsd.readString),link:parseLink,number:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),extensions:parseExtensions,type:(0,_xml.makeObjectPropertySetter)(_xsd.readString),rtept:parseRtePt}),RTEPT_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{ele:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),time:(0,_xml.makeObjectPropertySetter)(_xsd.readDateTime)}),TRK_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{name:(0,_xml.makeObjectPropertySetter)(_xsd.readString),cmt:(0,_xml.makeObjectPropertySetter)(_xsd.readString),desc:(0,_xml.makeObjectPropertySetter)(_xsd.readString),src:(0,_xml.makeObjectPropertySetter)(_xsd.readString),link:parseLink,number:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),type:(0,_xml.makeObjectPropertySetter)(_xsd.readString),extensions:parseExtensions,trkseg:parseTrkSeg}),TRKSEG_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{trkpt:parseTrkPt}),TRKPT_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{ele:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),time:(0,_xml.makeObjectPropertySetter)(_xsd.readDateTime)}),WPT_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{ele:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),time:(0,_xml.makeObjectPropertySetter)(_xsd.readDateTime),magvar:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),geoidheight:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),name:(0,_xml.makeObjectPropertySetter)(_xsd.readString),cmt:(0,_xml.makeObjectPropertySetter)(_xsd.readString),desc:(0,_xml.makeObjectPropertySetter)(_xsd.readString),src:(0,_xml.makeObjectPropertySetter)(_xsd.readString),link:parseLink,sym:(0,_xml.makeObjectPropertySetter)(_xsd.readString),type:(0,_xml.makeObjectPropertySetter)(_xsd.readString),fix:(0,_xml.makeObjectPropertySetter)(_xsd.readString),sat:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),hdop:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),vdop:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),pdop:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),ageofdgpsdata:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),dgpsid:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),extensions:parseExtensions}),LINK_SEQUENCE=["text","type"],LINK_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{text:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),type:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode)}),RTE_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["name","cmt","desc","src","link","number","type","rtept"]),RTE_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{name:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),cmt:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),desc:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),src:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),link:(0,_xml.makeChildAppender)(writeLink),number:(0,_xml.makeChildAppender)(_xsd.writeNonNegativeIntegerTextNode),type:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),rtept:(0,_xml.makeArraySerializer)((0,_xml.makeChildAppender)(writeWptType))}),RTEPT_TYPE_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["ele","time"]),TRK_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["name","cmt","desc","src","link","number","type","trkseg"]),TRK_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{name:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),cmt:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),desc:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),src:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),link:(0,_xml.makeChildAppender)(writeLink),number:(0,_xml.makeChildAppender)(_xsd.writeNonNegativeIntegerTextNode),type:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),trkseg:(0,_xml.makeArraySerializer)((0,_xml.makeChildAppender)(writeTrkSeg))}),TRKSEG_NODE_FACTORY=(0,_xml.makeSimpleNodeFactory)("trkpt"),TRKSEG_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{trkpt:(0,_xml.makeChildAppender)(writeWptType)}),WPT_TYPE_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),WPT_TYPE_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{ele:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode),time:(0,_xml.makeChildAppender)(_xsd.writeDateTimeTextNode),magvar:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode),geoidheight:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode),name:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),cmt:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),desc:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),src:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),link:(0,_xml.makeChildAppender)(writeLink),sym:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),type:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),fix:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),sat:(0,_xml.makeChildAppender)(_xsd.writeNonNegativeIntegerTextNode),hdop:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode),vdop:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode),pdop:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode),ageofdgpsdata:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode),dgpsid:(0,_xml.makeChildAppender)(_xsd.writeNonNegativeIntegerTextNode)}),GEOMETRY_TYPE_TO_NODENAME={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function GPX_NODE_FACTORY(e,t,r){var a=e.getGeometry();if(a){var i=GEOMETRY_TYPE_TO_NODENAME[a.getType()];if(i){var n=t[t.length-1].node;return(0,_xml.createElementNS)(n.namespaceURI,i)}}}function appendCoordinate(e,t,r,a){return e.push(parseFloat(r.getAttribute("lon")),parseFloat(r.getAttribute("lat"))),"ele"in a?(e.push(a.ele),delete a.ele,t.hasZ=!0):e.push(0),"time"in a?(e.push(a.time),delete a.time,t.hasM=!0):e.push(0),e}function applyLayoutOptions(e,t,r){var a=_GeometryLayout.default.XY,i=2;if(e.hasZ&&e.hasM?(a=_GeometryLayout.default.XYZM,i=4):e.hasZ?(a=_GeometryLayout.default.XYZ,i=3):e.hasM&&(a=_GeometryLayout.default.XYM,i=3),4!==i){for(var n=0,o=t.length/4;n<o;n++)t[n*i]=t[4*n],t[n*i+1]=t[4*n+1],e.hasZ&&(t[n*i+2]=t[4*n+2]),e.hasM&&(t[n*i+2]=t[4*n+3]);if(t.length=t.length/4*i,r)for(n=0,o=r.length;n<o;n++)r[n]=r[n]/4*i}return a}function parseLink(e,t){var r=t[t.length-1],a=e.getAttribute("href");null!==a&&(r.link=a),(0,_xml.parseNode)(LINK_PARSERS,e,t)}function parseExtensions(e,t){t[t.length-1].extensionsNode_=e}function parseRtePt(e,t){var r=(0,_xml.pushParseAndPop)({},RTEPT_PARSERS,e,t);if(r){var a=t[t.length-1];appendCoordinate(a.flatCoordinates,a.layoutOptions,e,r)}}function parseTrkPt(e,t){var r=(0,_xml.pushParseAndPop)({},TRKPT_PARSERS,e,t);if(r){var a=t[t.length-1];appendCoordinate(a.flatCoordinates,a.layoutOptions,e,r)}}function parseTrkSeg(e,t){var r=t[t.length-1];(0,_xml.parseNode)(TRKSEG_PARSERS,e,t);var a=r.flatCoordinates;r.ends.push(a.length)}function readRte(e,t){var r=t[0],a=(0,_xml.pushParseAndPop)({flatCoordinates:[],layoutOptions:{}},RTE_PARSERS,e,t);if(a){var i=a.flatCoordinates;delete a.flatCoordinates;var n=a.layoutOptions;delete a.layoutOptions;var o=applyLayoutOptions(n,i),d=new _LineString.default(i,o);(0,_Feature2.transformGeometryWithOptions)(d,!1,r);var _=new _Feature.default(d);return _.setProperties(a,!0),_}}function readTrk(e,t){var r=t[0],a=(0,_xml.pushParseAndPop)({flatCoordinates:[],ends:[],layoutOptions:{}},TRK_PARSERS,e,t);if(a){var i=a.flatCoordinates;delete a.flatCoordinates;var n=a.ends;delete a.ends;var o=a.layoutOptions;delete a.layoutOptions;var d=applyLayoutOptions(o,i,n),_=new _MultiLineString.default(i,d,n);(0,_Feature2.transformGeometryWithOptions)(_,!1,r);var m=new _Feature.default(_);return m.setProperties(a,!0),m}}function readWpt(e,t){var r=t[0],a=(0,_xml.pushParseAndPop)({},WPT_PARSERS,e,t);if(a){var i={},n=appendCoordinate([],i,e,a),o=applyLayoutOptions(i,n),d=new _Point.default(n,o);(0,_Feature2.transformGeometryWithOptions)(d,!1,r);var _=new _Feature.default(d);return _.setProperties(a,!0),_}}function writeLink(e,t,r){e.setAttribute("href",t);var a=r[r.length-1].properties,i=[a.linkText,a.linkType];(0,_xml.pushSerializeAndPop)({node:e},LINK_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,i,r,LINK_SEQUENCE)}function writeWptType(e,t,r){var a=r[r.length-1],i=a.node.namespaceURI,n=a.properties;switch(e.setAttributeNS(null,"lat",String(t[1])),e.setAttributeNS(null,"lon",String(t[0])),a.geometryLayout){case _GeometryLayout.default.XYZM:0!==t[3]&&(n.time=t[3]);case _GeometryLayout.default.XYZ:0!==t[2]&&(n.ele=t[2]);break;case _GeometryLayout.default.XYM:0!==t[2]&&(n.time=t[2])}var o="rtept"==e.nodeName?RTEPT_TYPE_SEQUENCE[i]:WPT_TYPE_SEQUENCE[i],d=(0,_xml.makeSequence)(n,o);(0,_xml.pushSerializeAndPop)({node:e,properties:n},WPT_TYPE_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,d,r,o)}function writeRte(e,t,r){var a=r[0],i=t.getProperties(),n={node:e};n.properties=i;var o=t.getGeometry();if(o.getType()==_GeometryType.default.LINE_STRING){var d=(0,_Feature2.transformGeometryWithOptions)(o,!0,a);n.geometryLayout=d.getLayout(),i.rtept=d.getCoordinates()}var _=r[r.length-1].node,m=RTE_SEQUENCE[_.namespaceURI],p=(0,_xml.makeSequence)(i,m);(0,_xml.pushSerializeAndPop)(n,RTE_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,p,r,m)}function writeTrk(e,t,r){var a=r[0],i=t.getProperties(),n={node:e};n.properties=i;var o=t.getGeometry();if(o.getType()==_GeometryType.default.MULTI_LINE_STRING){var d=(0,_Feature2.transformGeometryWithOptions)(o,!0,a);i.trkseg=d.getLineStrings()}var _=r[r.length-1].node,m=TRK_SEQUENCE[_.namespaceURI],p=(0,_xml.makeSequence)(i,m);(0,_xml.pushSerializeAndPop)(n,TRK_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,p,r,m)}function writeTrkSeg(e,t,r){var a={node:e};a.geometryLayout=t.getLayout(),a.properties={},(0,_xml.pushSerializeAndPop)(a,TRKSEG_SERIALIZERS,TRKSEG_NODE_FACTORY,t.getCoordinates(),r)}function writeWpt(e,t,r){var a=r[0],i=r[r.length-1];i.properties=t.getProperties();var n=t.getGeometry();if(n.getType()==_GeometryType.default.POINT){var o=(0,_Feature2.transformGeometryWithOptions)(n,!0,a);i.geometryLayout=o.getLayout(),writeWptType(e,o.getCoordinates(),r)}}var _default=GPX;exports.default=_default;

},{"../Feature.js":13,"../array.js":44,"../geom/GeometryLayout.js":130,"../geom/GeometryType.js":131,"../geom/LineString.js":132,"../geom/MultiLineString.js":134,"../geom/Point.js":137,"../proj.js":205,"../xml.js":322,"./Feature.js":76,"./XMLFeature.js":100,"./xsd.js":124}],83:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Feature=_interopRequireDefault(require("../Feature.js")),_GeometryCollection=_interopRequireDefault(require("../geom/GeometryCollection.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_JSONFeature=_interopRequireDefault(require("./JSONFeature.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_MultiLineString=_interopRequireDefault(require("../geom/MultiLineString.js")),_MultiPoint=_interopRequireDefault(require("../geom/MultiPoint.js")),_MultiPolygon=_interopRequireDefault(require("../geom/MultiPolygon.js")),_Point=_interopRequireDefault(require("../geom/Point.js")),_Polygon=_interopRequireDefault(require("../geom/Polygon.js")),_asserts=require("../asserts.js"),_obj=require("../obj.js"),_proj=require("../proj.js"),_Feature2=require("./Feature.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),GeoJSON=function(e){function t(t){var r=this,o=t||{};return(r=e.call(this)||this).dataProjection=(0,_proj.get)(o.dataProjection?o.dataProjection:"EPSG:4326"),o.featureProjection&&(r.defaultFeatureProjection=(0,_proj.get)(o.featureProjection)),r.geometryName_=o.geometryName,r.extractGeometryName_=o.extractGeometryName,r}return __extends(t,e),t.prototype.readFeatureFromObject=function(e,t){var r=null,o=readGeometry((r="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null}).geometry,t),n=new _Feature.default;return this.geometryName_?n.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in r!==void 0&&n.setGeometryName(r.geometry_name),n.setGeometry(o),"id"in r&&n.setId(r.id),r.properties&&n.setProperties(r.properties,!0),n},t.prototype.readFeaturesFromObject=function(e,t){var r=null;if("FeatureCollection"===e.type){r=[];for(var o=e.features,n=0,i=o.length;n<i;++n)r.push(this.readFeatureFromObject(o[n],t))}else r=[this.readFeatureFromObject(e,t)];return r},t.prototype.readGeometryFromObject=function(e,t){return readGeometry(e,t)},t.prototype.readProjectionFromObject=function(e){var t,r=e.crs;return r?"name"==r.type?t=(0,_proj.get)(r.properties.name):"EPSG"===r.type?t=(0,_proj.get)("EPSG:"+r.properties.code):(0,_asserts.assert)(!1,36):t=this.dataProjection,t},t.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);var r={type:"Feature",geometry:null,properties:null},o=e.getId();if(void 0!==o&&(r.id=o),!e.hasProperties())return r;var n=e.getProperties(),i=e.getGeometry();return i&&(r.geometry=writeGeometry(i,t),delete n[e.getGeometryName()]),(0,_obj.isEmpty)(n)||(r.properties=n),r},t.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);for(var r=[],o=0,n=e.length;o<n;++o)r.push(this.writeFeatureObject(e[o],t));return{type:"FeatureCollection",features:r}},t.prototype.writeGeometryObject=function(e,t){return writeGeometry(e,this.adaptOptions(t))},t}(_JSONFeature.default);function readGeometry(e,t){if(!e)return null;var r;switch(e.type){case _GeometryType.default.POINT:r=readPointGeometry(e);break;case _GeometryType.default.LINE_STRING:r=readLineStringGeometry(e);break;case _GeometryType.default.POLYGON:r=readPolygonGeometry(e);break;case _GeometryType.default.MULTI_POINT:r=readMultiPointGeometry(e);break;case _GeometryType.default.MULTI_LINE_STRING:r=readMultiLineStringGeometry(e);break;case _GeometryType.default.MULTI_POLYGON:r=readMultiPolygonGeometry(e);break;case _GeometryType.default.GEOMETRY_COLLECTION:r=readGeometryCollectionGeometry(e);break;default:throw new Error("Unsupported GeoJSON type: "+e.type)}return(0,_Feature2.transformGeometryWithOptions)(r,!1,t)}function readGeometryCollectionGeometry(e,t){var r=e.geometries.map(function(e){return readGeometry(e,t)});return new _GeometryCollection.default(r)}function readPointGeometry(e){return new _Point.default(e.coordinates)}function readLineStringGeometry(e){return new _LineString.default(e.coordinates)}function readMultiLineStringGeometry(e){return new _MultiLineString.default(e.coordinates)}function readMultiPointGeometry(e){return new _MultiPoint.default(e.coordinates)}function readMultiPolygonGeometry(e){return new _MultiPolygon.default(e.coordinates)}function readPolygonGeometry(e){return new _Polygon.default(e.coordinates)}function writeGeometry(e,t){var r,o=(e=(0,_Feature2.transformGeometryWithOptions)(e,!0,t)).getType();switch(o){case _GeometryType.default.POINT:r=writePointGeometry(e,t);break;case _GeometryType.default.LINE_STRING:r=writeLineStringGeometry(e,t);break;case _GeometryType.default.POLYGON:r=writePolygonGeometry(e,t);break;case _GeometryType.default.MULTI_POINT:r=writeMultiPointGeometry(e,t);break;case _GeometryType.default.MULTI_LINE_STRING:r=writeMultiLineStringGeometry(e,t);break;case _GeometryType.default.MULTI_POLYGON:r=writeMultiPolygonGeometry(e,t);break;case _GeometryType.default.GEOMETRY_COLLECTION:r=writeGeometryCollectionGeometry(e,t);break;case _GeometryType.default.CIRCLE:r={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+o)}return r}function writeGeometryCollectionGeometry(e,t){return{type:"GeometryCollection",geometries:e.getGeometriesArray().map(function(e){var r=(0,_obj.assign)({},t);return delete r.featureProjection,writeGeometry(e,r)})}}function writeLineStringGeometry(e,t){return{type:"LineString",coordinates:e.getCoordinates()}}function writeMultiLineStringGeometry(e,t){return{type:"MultiLineString",coordinates:e.getCoordinates()}}function writeMultiPointGeometry(e,t){return{type:"MultiPoint",coordinates:e.getCoordinates()}}function writeMultiPolygonGeometry(e,t){var r;return t&&(r=t.rightHanded),{type:"MultiPolygon",coordinates:e.getCoordinates(r)}}function writePointGeometry(e,t){return{type:"Point",coordinates:e.getCoordinates()}}function writePolygonGeometry(e,t){var r;return t&&(r=t.rightHanded),{type:"Polygon",coordinates:e.getCoordinates(r)}}var _default=GeoJSON;exports.default=_default;

},{"../Feature.js":13,"../asserts.js":45,"../geom/GeometryCollection.js":129,"../geom/GeometryType.js":131,"../geom/LineString.js":132,"../geom/MultiLineString.js":134,"../geom/MultiPoint.js":135,"../geom/MultiPolygon.js":136,"../geom/Point.js":137,"../geom/Polygon.js":138,"../obj.js":203,"../proj.js":205,"./Feature.js":76,"./JSONFeature.js":86}],84:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Feature=_interopRequireDefault(require("../Feature.js")),_GeometryLayout=_interopRequireDefault(require("../geom/GeometryLayout.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_TextFeature=_interopRequireDefault(require("./TextFeature.js")),_proj=require("../proj.js"),_Feature2=require("./Feature.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),IGCZ={BAROMETRIC:"barometric",GPS:"gps",NONE:"none"},B_RECORD_RE=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,H_RECORD_RE=/^H.([A-Z]{3}).*?:(.*)/,HFDTE_RECORD_RE=/^HFDTE(\d{2})(\d{2})(\d{2})/,NEWLINE_RE=/\r\n|\r|\n/,IGC=function(e){function t(t){var r=e.call(this)||this,a=t||{};return r.dataProjection=(0,_proj.get)("EPSG:4326"),r.altitudeMode_=a.altitudeMode?a.altitudeMode:IGCZ.NONE,r}return __extends(t,e),t.prototype.readFeatureFromText=function(e,t){var r,a,n=this.altitudeMode_,o=e.split(NEWLINE_RE),u={},i=[],_=2e3,s=0,p=1,d=-1;for(r=0,a=o.length;r<a;++r){var f=o[r],l=void 0;if("B"==f.charAt(0)){if(l=B_RECORD_RE.exec(f)){var E=parseInt(l[1],10),R=parseInt(l[2],10),c=parseInt(l[3],10),I=parseInt(l[4],10)+parseInt(l[5],10)/6e4;"S"==l[6]&&(I=-I);var y=parseInt(l[7],10)+parseInt(l[8],10)/6e4;if("W"==l[9]&&(y=-y),i.push(y,I),n!=IGCZ.NONE){var C=void 0;C=n==IGCZ.GPS?parseInt(l[11],10):n==IGCZ.BAROMETRIC?parseInt(l[12],10):0,i.push(C)}var F=Date.UTC(_,s,p,E,R,c);F<d&&(F=Date.UTC(_,s,p+1,E,R,c)),i.push(F/1e3),d=F}}else"H"==f.charAt(0)&&((l=HFDTE_RECORD_RE.exec(f))?(p=parseInt(l[1],10),s=parseInt(l[2],10)-1,_=2e3+parseInt(l[3],10)):(l=H_RECORD_RE.exec(f))&&(u[l[1]]=l[2].trim()))}if(0===i.length)return null;var O=n==IGCZ.NONE?_GeometryLayout.default.XYM:_GeometryLayout.default.XYZM,v=new _LineString.default(i,O),D=new _Feature.default((0,_Feature2.transformGeometryWithOptions)(v,!1,t));return D.setProperties(u,!0),D},t.prototype.readFeaturesFromText=function(e,t){var r=this.readFeatureFromText(e,t);return r?[r]:[]},t}(_TextFeature.default),_default=IGC;exports.default=_default;

},{"../Feature.js":13,"../geom/GeometryLayout.js":130,"../geom/LineString.js":132,"../proj.js":205,"./Feature.js":76,"./TextFeature.js":91}],85:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Versions=void 0;var _asserts=require("../asserts.js"),__spreadArrays=function(){for(var e=0,i=0,o=arguments.length;i<o;i++)e+=arguments[i].length;var t=Array(e),r=0;for(i=0;i<o;i++)for(var s=arguments[i],n=0,a=s.length;n<a;n++,r++)t[r]=s[n];return t},Versions={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"};exports.Versions=Versions;var IIIF_PROFILE_VALUES={};IIIF_PROFILE_VALUES[Versions.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}},IIIF_PROFILE_VALUES[Versions.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}},IIIF_PROFILE_VALUES[Versions.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}},IIIF_PROFILE_VALUES.none={none:{supports:[],formats:[],qualities:[]}};var COMPLIANCE_VERSION1=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,COMPLIANCE_VERSION2=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,COMPLIANCE_VERSION3=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function generateVersion1Options(e){var i=e.getComplianceLevelSupportedFeatures();return void 0===i&&(i=IIIF_PROFILE_VALUES[Versions.VERSION1].level0),{url:void 0===e.imageInfo["@id"]?void 0:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:i.supports,formats:__spreadArrays(i.formats,[void 0===e.imageInfo.formats?[]:e.imageInfo.formats]),qualities:__spreadArrays(i.qualities,[void 0===e.imageInfo.qualities?[]:e.imageInfo.qualities]),resolutions:e.imageInfo.scale_factors,tileSize:void 0!==e.imageInfo.tile_width?void 0!==e.imageInfo.tile_height?[e.imageInfo.tile_width,e.imageInfo.tile_height]:[e.imageInfo.tile_width,e.imageInfo.tile_width]:null!=e.imageInfo.tile_height?[e.imageInfo.tile_height,e.imageInfo.tile_height]:void 0}}function generateVersion2Options(e){var i=e.getComplianceLevelSupportedFeatures(),o=Array.isArray(e.imageInfo.profile)&&e.imageInfo.profile.length>1,t=o&&e.imageInfo.profile[1].supports?e.imageInfo.profile[1].supports:[],r=o&&e.imageInfo.profile[1].formats?e.imageInfo.profile[1].formats:[],s=o&&e.imageInfo.profile[1].qualities?e.imageInfo.profile[1].qualities:[];return{url:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:void 0===e.imageInfo.sizes?void 0:e.imageInfo.sizes.map(function(e){return[e.width,e.height]}),tileSize:void 0===e.imageInfo.tiles?void 0:[e.imageInfo.tiles.map(function(e){return e.width})[0],e.imageInfo.tiles.map(function(e){return void 0===e.height?e.width:e.height})[0]],resolutions:void 0===e.imageInfo.tiles?void 0:e.imageInfo.tiles.map(function(e){return e.scaleFactors})[0],supports:__spreadArrays(i.supports,t),formats:__spreadArrays(i.formats,r),qualities:__spreadArrays(i.qualities,s)}}function generateVersion3Options(e){var i=e.getComplianceLevelSupportedFeatures(),o=void 0===e.imageInfo.extraFormats?i.formats:__spreadArrays(i.formats,e.imageInfo.extraFormats),t=void 0!==e.imageInfo.preferredFormats&&Array.isArray(e.imageInfo.preferredFormats)&&e.imageInfo.preferredFormats.length>0?e.imageInfo.preferredFormats.filter(function(e){return["jpg","png","gif"].includes(e)}).reduce(function(e,i){return void 0===e&&o.includes(i)?i:e},void 0):void 0;return{url:e.imageInfo.id,sizes:void 0===e.imageInfo.sizes?void 0:e.imageInfo.sizes.map(function(e){return[e.width,e.height]}),tileSize:void 0===e.imageInfo.tiles?void 0:[e.imageInfo.tiles.map(function(e){return e.width})[0],e.imageInfo.tiles.map(function(e){return e.height})[0]],resolutions:void 0===e.imageInfo.tiles?void 0:e.imageInfo.tiles.map(function(e){return e.scaleFactors})[0],supports:void 0===e.imageInfo.extraFeatures?i.supports:__spreadArrays(i.supports,e.imageInfo.extraFeatures),formats:o,qualities:void 0===e.imageInfo.extraQualities?i.qualities:__spreadArrays(i.qualities,e.imageInfo.extraQualities),preferredFormat:t}}var versionFunctions={};versionFunctions[Versions.VERSION1]=generateVersion1Options,versionFunctions[Versions.VERSION2]=generateVersion2Options,versionFunctions[Versions.VERSION3]=generateVersion3Options;var IIIFInfo=function(){function e(e){this.setImageInfo(e)}return e.prototype.setImageInfo=function(e){this.imageInfo="string"==typeof e?JSON.parse(e):e},e.prototype.getImageApiVersion=function(){if(void 0!==this.imageInfo){var e=this.imageInfo["@context"]||"ol-no-context";"string"==typeof e&&(e=[e]);for(var i=0;i<e.length;i++)switch(e[i]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return Versions.VERSION1;case"http://iiif.io/api/image/2/context.json":return Versions.VERSION2;case"http://iiif.io/api/image/3/context.json":return Versions.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(Versions.VERSION1)&&this.imageInfo.identifier)return Versions.VERSION1}(0,_asserts.assert)(!1,61)}},e.prototype.getComplianceLevelEntryFromProfile=function(e){if(void 0!==this.imageInfo&&void 0!==this.imageInfo.profile)switch(void 0===e&&(e=this.getImageApiVersion()),e){case Versions.VERSION1:if(COMPLIANCE_VERSION1.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Versions.VERSION3:if(COMPLIANCE_VERSION3.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Versions.VERSION2:if("string"==typeof this.imageInfo.profile&&COMPLIANCE_VERSION2.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&"string"==typeof this.imageInfo.profile[0]&&COMPLIANCE_VERSION2.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0]}},e.prototype.getComplianceLevelFromProfile=function(e){var i=this.getComplianceLevelEntryFromProfile(e);if(void 0!==i){var o=i.match(/level[0-2](?:\.json)?$/g);return Array.isArray(o)?o[0].replace(".json",""):void 0}},e.prototype.getComplianceLevelSupportedFeatures=function(){if(void 0!==this.imageInfo){var e=this.getImageApiVersion(),i=this.getComplianceLevelFromProfile(e);return void 0===i?IIIF_PROFILE_VALUES.none.none:IIIF_PROFILE_VALUES[e][i]}},e.prototype.getTileSourceOptions=function(e){var i=e||{},o=this.getImageApiVersion();if(void 0!==o){var t=void 0===o?void 0:versionFunctions[o](this);if(void 0!==t)return{url:t.url,version:o,size:[this.imageInfo.width,this.imageInfo.height],sizes:t.sizes,format:void 0!==i.format&&t.formats.includes(i.format)?i.format:void 0!==t.preferredFormat?t.preferredFormat:"jpg",supports:t.supports,quality:i.quality&&t.qualities.includes(i.quality)?i.quality:t.qualities.includes("native")?"native":"default",resolutions:Array.isArray(t.resolutions)?t.resolutions.sort(function(e,i){return i-e}):void 0,tileSize:t.tileSize}}},e}(),_default=IIIFInfo;exports.default=_default;

},{"../asserts.js":45}],86:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Feature=_interopRequireDefault(require("./Feature.js")),_FormatType=_interopRequireDefault(require("./FormatType.js")),_util=require("../util.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),JSONFeature=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getType=function(){return _FormatType.default.JSON},e.prototype.readFeature=function(t,e){return this.readFeatureFromObject(getObject(t),this.getReadOptions(t,e))},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromObject(getObject(t),this.getReadOptions(t,e))},e.prototype.readFeatureFromObject=function(t,e){return(0,_util.abstract)()},e.prototype.readFeaturesFromObject=function(t,e){return(0,_util.abstract)()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromObject(getObject(t),this.getReadOptions(t,e))},e.prototype.readGeometryFromObject=function(t,e){return(0,_util.abstract)()},e.prototype.readProjection=function(t){return this.readProjectionFromObject(getObject(t))},e.prototype.readProjectionFromObject=function(t){return(0,_util.abstract)()},e.prototype.writeFeature=function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))},e.prototype.writeFeatureObject=function(t,e){return(0,_util.abstract)()},e.prototype.writeFeatures=function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))},e.prototype.writeFeaturesObject=function(t,e){return(0,_util.abstract)()},e.prototype.writeGeometry=function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))},e.prototype.writeGeometryObject=function(t,e){return(0,_util.abstract)()},e}(_Feature.default);function getObject(t){if("string"==typeof t){var e=JSON.parse(t);return e||null}return null!==t?t:null}var _default=JSONFeature;exports.default=_default;

},{"../util.js":313,"./Feature.js":76,"./FormatType.js":77}],87:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDefaultFillStyle=getDefaultFillStyle,exports.getDefaultImageStyle=getDefaultImageStyle,exports.getDefaultStrokeStyle=getDefaultStrokeStyle,exports.getDefaultTextStyle=getDefaultTextStyle,exports.getDefaultStyle=getDefaultStyle,exports.getDefaultStyleArray=getDefaultStyleArray,exports.readFlatCoordinates=readFlatCoordinates,exports.default=void 0;var _Feature=_interopRequireDefault(require("../Feature.js")),_Fill=_interopRequireDefault(require("../style/Fill.js")),_GeometryCollection=_interopRequireDefault(require("../geom/GeometryCollection.js")),_GeometryLayout=_interopRequireDefault(require("../geom/GeometryLayout.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_Icon=_interopRequireDefault(require("../style/Icon.js")),_IconAnchorUnits=_interopRequireDefault(require("../style/IconAnchorUnits.js")),_IconOrigin=_interopRequireDefault(require("../style/IconOrigin.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_MultiLineString=_interopRequireDefault(require("../geom/MultiLineString.js")),_MultiPoint=_interopRequireDefault(require("../geom/MultiPoint.js")),_MultiPolygon=_interopRequireDefault(require("../geom/MultiPolygon.js")),_Point=_interopRequireDefault(require("../geom/Point.js")),_Polygon=_interopRequireDefault(require("../geom/Polygon.js")),_Stroke=_interopRequireDefault(require("../style/Stroke.js")),_Style=_interopRequireDefault(require("../style/Style.js")),_Text=_interopRequireDefault(require("../style/Text.js")),_XMLFeature=_interopRequireDefault(require("./XMLFeature.js")),_xml=require("../xml.js"),_color=require("../color.js"),_asserts=require("../asserts.js"),_array=require("../array.js"),_proj=require("../proj.js"),_xsd=require("./xsd.js"),_math=require("../math.js"),_Feature2=require("./Feature.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var DEFAULT_COLOR,DEFAULT_IMAGE_STYLE_ANCHOR,DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,DEFAULT_IMAGE_STYLE_SIZE,DEFAULT_IMAGE_STYLE_SRC,DEFAULT_IMAGE_SCALE_MULTIPLIER,__extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),GX_NAMESPACE_URIS=["http://www.google.com/kml/ext/2.2"],NAMESPACE_URIS=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],SCHEMA_LOCATION="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",ICON_ANCHOR_UNITS_MAP={fraction:_IconAnchorUnits.default.FRACTION,pixels:_IconAnchorUnits.default.PIXELS,insetPixels:_IconAnchorUnits.default.PIXELS},PLACEMARK_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{ExtendedData:extendedDataParser,Region:regionParser,MultiGeometry:(0,_xml.makeObjectPropertySetter)(readMultiGeometry,"geometry"),LineString:(0,_xml.makeObjectPropertySetter)(readLineString,"geometry"),LinearRing:(0,_xml.makeObjectPropertySetter)(readLinearRing,"geometry"),Point:(0,_xml.makeObjectPropertySetter)(readPoint,"geometry"),Polygon:(0,_xml.makeObjectPropertySetter)(readPolygon,"geometry"),Style:(0,_xml.makeObjectPropertySetter)(readStyle),StyleMap:placemarkStyleMapParser,address:(0,_xml.makeObjectPropertySetter)(_xsd.readString),description:(0,_xml.makeObjectPropertySetter)(_xsd.readString),name:(0,_xml.makeObjectPropertySetter)(_xsd.readString),open:(0,_xml.makeObjectPropertySetter)(_xsd.readBoolean),phoneNumber:(0,_xml.makeObjectPropertySetter)(_xsd.readString),styleUrl:(0,_xml.makeObjectPropertySetter)(readURI),visibility:(0,_xml.makeObjectPropertySetter)(_xsd.readBoolean)},(0,_xml.makeStructureNS)(GX_NAMESPACE_URIS,{MultiTrack:(0,_xml.makeObjectPropertySetter)(readGxMultiTrack,"geometry"),Track:(0,_xml.makeObjectPropertySetter)(readGxTrack,"geometry")})),NETWORK_LINK_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{ExtendedData:extendedDataParser,Region:regionParser,Link:linkParser,address:(0,_xml.makeObjectPropertySetter)(_xsd.readString),description:(0,_xml.makeObjectPropertySetter)(_xsd.readString),name:(0,_xml.makeObjectPropertySetter)(_xsd.readString),open:(0,_xml.makeObjectPropertySetter)(_xsd.readBoolean),phoneNumber:(0,_xml.makeObjectPropertySetter)(_xsd.readString),visibility:(0,_xml.makeObjectPropertySetter)(_xsd.readBoolean)}),LINK_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{href:(0,_xml.makeObjectPropertySetter)(readURI)}),REGION_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{LatLonAltBox:latLonAltBoxParser,Lod:lodParser}),KML_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["Document","Placemark"]),KML_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Document:(0,_xml.makeChildAppender)(writeDocument),Placemark:(0,_xml.makeChildAppender)(writePlacemark)}),DEFAULT_FILL_STYLE=null;function getDefaultFillStyle(){return DEFAULT_FILL_STYLE}var DEFAULT_NO_IMAGE_STYLE,DEFAULT_IMAGE_STYLE=null;function getDefaultImageStyle(){return DEFAULT_IMAGE_STYLE}var DEFAULT_TEXT_STROKE_STYLE,DEFAULT_STROKE_STYLE=null;function getDefaultStrokeStyle(){return DEFAULT_STROKE_STYLE}var DEFAULT_TEXT_STYLE=null;function getDefaultTextStyle(){return DEFAULT_TEXT_STYLE}var DEFAULT_STYLE=null;function getDefaultStyle(){return DEFAULT_STYLE}var TEXTAREA,DEFAULT_STYLE_ARRAY=null;function getDefaultStyleArray(){return DEFAULT_STYLE_ARRAY}function createStyleDefaults(){DEFAULT_COLOR=[255,255,255,1],DEFAULT_FILL_STYLE=new _Fill.default({color:DEFAULT_COLOR}),DEFAULT_IMAGE_STYLE_ANCHOR=[20,2],DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS=_IconAnchorUnits.default.PIXELS,DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS=_IconAnchorUnits.default.PIXELS,DEFAULT_IMAGE_STYLE_SIZE=[64,64],DEFAULT_IMAGE_STYLE_SRC="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",DEFAULT_IMAGE_SCALE_MULTIPLIER=.5,DEFAULT_IMAGE_STYLE=new _Icon.default({anchor:DEFAULT_IMAGE_STYLE_ANCHOR,anchorOrigin:_IconOrigin.default.BOTTOM_LEFT,anchorXUnits:DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,anchorYUnits:DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS,crossOrigin:"anonymous",rotation:0,scale:DEFAULT_IMAGE_SCALE_MULTIPLIER,size:DEFAULT_IMAGE_STYLE_SIZE,src:DEFAULT_IMAGE_STYLE_SRC}),DEFAULT_NO_IMAGE_STYLE="NO_IMAGE",DEFAULT_STROKE_STYLE=new _Stroke.default({color:DEFAULT_COLOR,width:1}),DEFAULT_TEXT_STROKE_STYLE=new _Stroke.default({color:[51,51,51,1],width:2}),DEFAULT_TEXT_STYLE=new _Text.default({font:"bold 16px Helvetica",fill:DEFAULT_FILL_STYLE,stroke:DEFAULT_TEXT_STROKE_STYLE,scale:.8}),DEFAULT_STYLE=new _Style.default({fill:DEFAULT_FILL_STYLE,image:DEFAULT_IMAGE_STYLE,text:DEFAULT_TEXT_STYLE,stroke:DEFAULT_STROKE_STYLE,zIndex:0}),DEFAULT_STYLE_ARRAY=[DEFAULT_STYLE]}var KML=function(e){function t(t){var r=e.call(this)||this,a=t||{};return DEFAULT_STYLE_ARRAY||createStyleDefaults(),r.dataProjection=(0,_proj.get)("EPSG:4326"),r.defaultStyle_=a.defaultStyle?a.defaultStyle:DEFAULT_STYLE_ARRAY,r.extractStyles_=void 0===a.extractStyles||a.extractStyles,r.writeStyles_=void 0===a.writeStyles||a.writeStyles,r.sharedStyles_={},r.showPointNames_=void 0===a.showPointNames||a.showPointNames,r.crossOrigin_=void 0!==a.crossOrigin?a.crossOrigin:"anonymous",r}return __extends(t,e),t.prototype.readDocumentOrFolder_=function(e,t){var r=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Document:(0,_xml.makeArrayExtender)(this.readDocumentOrFolder_,this),Folder:(0,_xml.makeArrayExtender)(this.readDocumentOrFolder_,this),Placemark:(0,_xml.makeArrayPusher)(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),a=(0,_xml.pushParseAndPop)([],r,e,t,this);return a||void 0},t.prototype.readPlacemark_=function(e,t){var r=(0,_xml.pushParseAndPop)({geometry:null},PLACEMARK_PARSERS,e,t,this);if(r){var a=new _Feature.default,l=e.getAttribute("id");null!==l&&a.setId(l);var o=t[0],n=r.geometry;if(n&&(0,_Feature2.transformGeometryWithOptions)(n,!1,o),a.setGeometry(n),delete r.geometry,this.extractStyles_){var i=createFeatureStyleFunction(r.Style,r.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);a.setStyle(i)}return delete r.Style,a.setProperties(r,!0),a}},t.prototype.readSharedStyle_=function(e,t){var r=e.getAttribute("id");if(null!==r){var a=readStyle.call(this,e,t);if(a){var l=void 0,o=e.baseURI;if(o&&"about:blank"!=o||(o=window.location.href),o)l=new URL("#"+r,o).href;else l="#"+r;this.sharedStyles_[l]=a}}},t.prototype.readSharedStyleMap_=function(e,t){var r=e.getAttribute("id");if(null!==r){var a=readStyleMapValue.call(this,e,t);if(a){var l,o=e.baseURI;if(o&&"about:blank"!=o||(o=window.location.href),o)l=new URL("#"+r,o).href;else l="#"+r;this.sharedStyles_[l]=a}}},t.prototype.readFeatureFromNode=function(e,t){if(!(0,_array.includes)(NAMESPACE_URIS,e.namespaceURI))return null;var r=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return r||null},t.prototype.readFeaturesFromNode=function(e,t){if(!(0,_array.includes)(NAMESPACE_URIS,e.namespaceURI))return[];var r,a=e.localName;if("Document"==a||"Folder"==a)return(r=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]))||[];if("Placemark"==a){var l=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return l?[l]:[]}if("kml"==a){r=[];for(var o=e.firstElementChild;o;o=o.nextElementSibling){var n=this.readFeaturesFromNode(o,t);n&&(0,_array.extend)(r,n)}return r}return[]},t.prototype.readName=function(e){if(e){if("string"==typeof e){var t=(0,_xml.parse)(e);return this.readNameFromDocument(t)}return(0,_xml.isDocument)(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}},t.prototype.readNameFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){var r=this.readNameFromNode(t);if(r)return r}},t.prototype.readNameFromNode=function(e){for(var t=e.firstElementChild;t;t=t.nextElementSibling)if((0,_array.includes)(NAMESPACE_URIS,t.namespaceURI)&&"name"==t.localName)return(0,_xsd.readString)(t);for(t=e.firstElementChild;t;t=t.nextElementSibling){var r=t.localName;if((0,_array.includes)(NAMESPACE_URIS,t.namespaceURI)&&("Document"==r||"Folder"==r||"Placemark"==r||"kml"==r)){var a=this.readNameFromNode(t);if(a)return a}}},t.prototype.readNetworkLinks=function(e){var t=[];if("string"==typeof e){var r=(0,_xml.parse)(e);(0,_array.extend)(t,this.readNetworkLinksFromDocument(r))}else(0,_xml.isDocument)(e)?(0,_array.extend)(t,this.readNetworkLinksFromDocument(e)):(0,_array.extend)(t,this.readNetworkLinksFromNode(e));return t},t.prototype.readNetworkLinksFromDocument=function(e){for(var t=[],r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&(0,_array.extend)(t,this.readNetworkLinksFromNode(r));return t},t.prototype.readNetworkLinksFromNode=function(e){for(var t=[],r=e.firstElementChild;r;r=r.nextElementSibling)if((0,_array.includes)(NAMESPACE_URIS,r.namespaceURI)&&"NetworkLink"==r.localName){var a=(0,_xml.pushParseAndPop)({},NETWORK_LINK_PARSERS,r,[]);t.push(a)}for(r=e.firstElementChild;r;r=r.nextElementSibling){var l=r.localName;!(0,_array.includes)(NAMESPACE_URIS,r.namespaceURI)||"Document"!=l&&"Folder"!=l&&"kml"!=l||(0,_array.extend)(t,this.readNetworkLinksFromNode(r))}return t},t.prototype.readRegion=function(e){var t=[];if("string"==typeof e){var r=(0,_xml.parse)(e);(0,_array.extend)(t,this.readRegionFromDocument(r))}else(0,_xml.isDocument)(e)?(0,_array.extend)(t,this.readRegionFromDocument(e)):(0,_array.extend)(t,this.readRegionFromNode(e));return t},t.prototype.readRegionFromDocument=function(e){for(var t=[],r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&(0,_array.extend)(t,this.readRegionFromNode(r));return t},t.prototype.readRegionFromNode=function(e){for(var t=[],r=e.firstElementChild;r;r=r.nextElementSibling)if((0,_array.includes)(NAMESPACE_URIS,r.namespaceURI)&&"Region"==r.localName){var a=(0,_xml.pushParseAndPop)({},REGION_PARSERS,r,[]);t.push(a)}for(r=e.firstElementChild;r;r=r.nextElementSibling){var l=r.localName;!(0,_array.includes)(NAMESPACE_URIS,r.namespaceURI)||"Document"!=l&&"Folder"!=l&&"kml"!=l||(0,_array.extend)(t,this.readRegionFromNode(r))}return t},t.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var r=(0,_xml.createElementNS)(NAMESPACE_URIS[4],"kml"),a="http://www.w3.org/2000/xmlns/";r.setAttributeNS(a,"xmlns:gx",GX_NAMESPACE_URIS[0]),r.setAttributeNS(a,"xmlns:xsi",_xml.XML_SCHEMA_INSTANCE_URI),r.setAttributeNS(_xml.XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",SCHEMA_LOCATION);var l={node:r},o={};e.length>1?o.Document=e:1==e.length&&(o.Placemark=e[0]);var n=KML_SEQUENCE[r.namespaceURI],i=(0,_xml.makeSequence)(o,n);return(0,_xml.pushSerializeAndPop)(l,KML_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,i,[t],n,this),r},t}(_XMLFeature.default);function createNameStyleFunction(e,t){var r=[0,0],a="start",l=e.getImage();if(l){var o=l.getImageSize();if(null===o&&(o=DEFAULT_IMAGE_STYLE_SIZE),2==o.length){var n=l.getScaleArray();r[0]=n[0]*o[0]/2,r[1]=-n[1]*o[1]/2,a="left"}}var i=e.getText();return i?((i=i.clone()).setFont(i.getFont()||DEFAULT_TEXT_STYLE.getFont()),i.setScale(i.getScale()||DEFAULT_TEXT_STYLE.getScale()),i.setFill(i.getFill()||DEFAULT_TEXT_STYLE.getFill()),i.setStroke(i.getStroke()||DEFAULT_TEXT_STROKE_STYLE)):i=DEFAULT_TEXT_STYLE.clone(),i.setText(t),i.setOffsetX(r[0]),i.setOffsetY(r[1]),i.setTextAlign(a),new _Style.default({image:l,text:i})}function createFeatureStyleFunction(e,t,r,a,l){return function(o,n){var i=l,_="",S=[];if(i){var m=o.getGeometry();if(m){var E=m.getType();i=E===_GeometryType.default.GEOMETRY_COLLECTION?(S=m.getGeometriesArrayRecursive().filter(function(e){var t=e.getType();return t===_GeometryType.default.POINT||t===_GeometryType.default.MULTI_POINT})).length>0:E===_GeometryType.default.POINT||E===_GeometryType.default.MULTI_POINT}}i&&(_=o.get("name"),(i=i&&!!_)&&_.search(/&[^&]+;/)>-1&&(TEXTAREA||(TEXTAREA=document.createElement("textarea")),TEXTAREA.innerHTML=_,_=TEXTAREA.value));var d=r;if(e?d=e:t&&(d=findStyle(t,r,a)),i){var u=createNameStyleFunction(d[0],_);return S.length>0?(u.setGeometry(new _GeometryCollection.default(S)),[u,new _Style.default({geometry:d[0].getGeometry(),image:null,fill:d[0].getFill(),stroke:d[0].getStroke(),text:null})].concat(d.slice(1))):u}return d}}function findStyle(e,t,r){return Array.isArray(e)?e:"string"==typeof e?(!(e in r)&&"#"+e in r&&(e="#"+e),findStyle(r[e],t,r)):t}function readColor(e){var t=(0,_xml.getAllTextContent)(e,!1),r=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(r){var a=r[1];return[parseInt(a.substr(6,2),16),parseInt(a.substr(4,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(0,2),16)/255]}}function readFlatCoordinates(e){for(var t,r=(0,_xml.getAllTextContent)(e,!1),a=[],l=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;t=l.exec(r);){var o=parseFloat(t[1]),n=parseFloat(t[2]),i=t[3]?parseFloat(t[3]):0;a.push(o,n,i),r=r.substr(t[0].length)}if(""===r)return a}function readURI(e){var t=(0,_xml.getAllTextContent)(e,!1).trim(),r=e.baseURI;return r&&"about:blank"!=r||(r=window.location.href),r?new URL(t,r).href:t}function readVec2(e){var t,r=e.getAttribute("xunits"),a=e.getAttribute("yunits");return t="insetPixels"!==r?"insetPixels"!==a?_IconOrigin.default.BOTTOM_LEFT:_IconOrigin.default.TOP_LEFT:"insetPixels"!==a?_IconOrigin.default.BOTTOM_RIGHT:_IconOrigin.default.TOP_RIGHT,{x:parseFloat(e.getAttribute("x")),xunits:ICON_ANCHOR_UNITS_MAP[r],y:parseFloat(e.getAttribute("y")),yunits:ICON_ANCHOR_UNITS_MAP[a],origin:t}}function readScale(e){return(0,_xsd.readDecimal)(e)}var STYLE_MAP_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Pair:pairDataParser});function readStyleMapValue(e,t){return(0,_xml.pushParseAndPop)(void 0,STYLE_MAP_PARSERS,e,t,this)}var ICON_STYLE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Icon:(0,_xml.makeObjectPropertySetter)(readIcon),color:(0,_xml.makeObjectPropertySetter)(readColor),heading:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),hotSpot:(0,_xml.makeObjectPropertySetter)(readVec2),scale:(0,_xml.makeObjectPropertySetter)(readScale)});function iconStyleParser(e,t){var r=(0,_xml.pushParseAndPop)({},ICON_STYLE_PARSERS,e,t);if(r){var a,l,o,n,i=t[t.length-1],_="Icon"in r?r.Icon:{},S=!("Icon"in r)||Object.keys(_).length>0,m=_.href;m?a=m:S&&(a=DEFAULT_IMAGE_STYLE_SRC);var E,d=_IconOrigin.default.BOTTOM_LEFT,u=r.hotSpot;u?(l=[u.x,u.y],o=u.xunits,n=u.yunits,d=u.origin):a===DEFAULT_IMAGE_STYLE_SRC?(l=DEFAULT_IMAGE_STYLE_ANCHOR,o=DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS,n=DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS):/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(a)&&(l=[.5,0],o=_IconAnchorUnits.default.FRACTION,n=_IconAnchorUnits.default.FRACTION);var s,A=_.x,y=_.y;void 0!==A&&void 0!==y&&(E=[A,y]);var c,T=_.w,p=_.h;void 0!==T&&void 0!==p&&(s=[T,p]);var R=r.heading;void 0!==R&&(c=(0,_math.toRadians)(R));var x=r.scale,N=r.color;if(S){a==DEFAULT_IMAGE_STYLE_SRC&&(s=DEFAULT_IMAGE_STYLE_SIZE,void 0===x&&(x=DEFAULT_IMAGE_SCALE_MULTIPLIER));var P=new _Icon.default({anchor:l,anchorOrigin:d,anchorXUnits:o,anchorYUnits:n,crossOrigin:this.crossOrigin_,offset:E,offsetOrigin:_IconOrigin.default.BOTTOM_LEFT,rotation:c,scale:x,size:s,src:a,color:N});i.imageStyle=P}else i.imageStyle=DEFAULT_NO_IMAGE_STYLE}}var LABEL_STYLE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{color:(0,_xml.makeObjectPropertySetter)(readColor),scale:(0,_xml.makeObjectPropertySetter)(readScale)});function labelStyleParser(e,t){var r=(0,_xml.pushParseAndPop)({},LABEL_STYLE_PARSERS,e,t);if(r){var a=t[t.length-1],l=new _Text.default({fill:new _Fill.default({color:"color"in r?r.color:DEFAULT_COLOR}),scale:r.scale});a.textStyle=l}}var LINE_STYLE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{color:(0,_xml.makeObjectPropertySetter)(readColor),width:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal)});function lineStyleParser(e,t){var r=(0,_xml.pushParseAndPop)({},LINE_STYLE_PARSERS,e,t);if(r){var a=t[t.length-1],l=new _Stroke.default({color:"color"in r?r.color:DEFAULT_COLOR,width:"width"in r?r.width:1});a.strokeStyle=l}}var POLY_STYLE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{color:(0,_xml.makeObjectPropertySetter)(readColor),fill:(0,_xml.makeObjectPropertySetter)(_xsd.readBoolean),outline:(0,_xml.makeObjectPropertySetter)(_xsd.readBoolean)});function polyStyleParser(e,t){var r=(0,_xml.pushParseAndPop)({},POLY_STYLE_PARSERS,e,t);if(r){var a=t[t.length-1],l=new _Fill.default({color:"color"in r?r.color:DEFAULT_COLOR});a.fillStyle=l;var o=r.fill;void 0!==o&&(a.fill=o);var n=r.outline;void 0!==n&&(a.outline=n)}}var FLAT_LINEAR_RING_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{coordinates:(0,_xml.makeReplacer)(readFlatCoordinates)});function readFlatLinearRing(e,t){return(0,_xml.pushParseAndPop)(null,FLAT_LINEAR_RING_PARSERS,e,t)}function gxCoordParser(e,t){var r=t[t.length-1].flatCoordinates,a=(0,_xml.getAllTextContent)(e,!1),l=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(a);if(l){var o=parseFloat(l[1]),n=parseFloat(l[2]),i=parseFloat(l[3]);r.push(o,n,i,0)}else r.push(0,0,0,0)}var GX_MULTITRACK_GEOMETRY_PARSERS=(0,_xml.makeStructureNS)(GX_NAMESPACE_URIS,{Track:(0,_xml.makeArrayPusher)(readGxTrack)});function readGxMultiTrack(e,t){var r=(0,_xml.pushParseAndPop)([],GX_MULTITRACK_GEOMETRY_PARSERS,e,t);if(r)return new _MultiLineString.default(r)}var GX_TRACK_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{when:whenParser},(0,_xml.makeStructureNS)(GX_NAMESPACE_URIS,{coord:gxCoordParser}));function readGxTrack(e,t){var r=(0,_xml.pushParseAndPop)({flatCoordinates:[],whens:[]},GX_TRACK_PARSERS,e,t);if(r){for(var a=r.flatCoordinates,l=r.whens,o=0,n=Math.min(a.length,l.length);o<n;++o)a[4*o+3]=l[o];return new _LineString.default(a,_GeometryLayout.default.XYZM)}}var ICON_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{href:(0,_xml.makeObjectPropertySetter)(readURI)},(0,_xml.makeStructureNS)(GX_NAMESPACE_URIS,{x:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),y:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),w:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),h:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal)}));function readIcon(e,t){var r=(0,_xml.pushParseAndPop)({},ICON_PARSERS,e,t);return r||null}var GEOMETRY_FLAT_COORDINATES_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{coordinates:(0,_xml.makeReplacer)(readFlatCoordinates)});function readFlatCoordinatesFromNode(e,t){return(0,_xml.pushParseAndPop)(null,GEOMETRY_FLAT_COORDINATES_PARSERS,e,t)}var EXTRUDE_AND_ALTITUDE_MODE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{extrude:(0,_xml.makeObjectPropertySetter)(_xsd.readBoolean),tessellate:(0,_xml.makeObjectPropertySetter)(_xsd.readBoolean),altitudeMode:(0,_xml.makeObjectPropertySetter)(_xsd.readString)});function readLineString(e,t){var r=(0,_xml.pushParseAndPop)({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),a=readFlatCoordinatesFromNode(e,t);if(a){var l=new _LineString.default(a,_GeometryLayout.default.XYZ);return l.setProperties(r,!0),l}}function readLinearRing(e,t){var r=(0,_xml.pushParseAndPop)({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),a=readFlatCoordinatesFromNode(e,t);if(a){var l=new _Polygon.default(a,_GeometryLayout.default.XYZ,[a.length]);return l.setProperties(r,!0),l}}var MULTI_GEOMETRY_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{LineString:(0,_xml.makeArrayPusher)(readLineString),LinearRing:(0,_xml.makeArrayPusher)(readLinearRing),MultiGeometry:(0,_xml.makeArrayPusher)(readMultiGeometry),Point:(0,_xml.makeArrayPusher)(readPoint),Polygon:(0,_xml.makeArrayPusher)(readPolygon)});function readMultiGeometry(e,t){var r,a=(0,_xml.pushParseAndPop)([],MULTI_GEOMETRY_PARSERS,e,t);if(!a)return null;if(0===a.length)return new _GeometryCollection.default(a);for(var l,o=!0,n=a[0].getType(),i=1,_=a.length;i<_;++i)if((l=a[i]).getType()!=n){o=!1;break}if(o){var S=void 0,m=void 0;if(n==_GeometryType.default.POINT){var E=a[0];S=E.getLayout(),m=E.getFlatCoordinates();for(i=1,_=a.length;i<_;++i)l=a[i],(0,_array.extend)(m,l.getFlatCoordinates());setCommonGeometryProperties(r=new _MultiPoint.default(m,S),a)}else n==_GeometryType.default.LINE_STRING?setCommonGeometryProperties(r=new _MultiLineString.default(a),a):n==_GeometryType.default.POLYGON?setCommonGeometryProperties(r=new _MultiPolygon.default(a),a):n==_GeometryType.default.GEOMETRY_COLLECTION?r=new _GeometryCollection.default(a):(0,_asserts.assert)(!1,37)}else r=new _GeometryCollection.default(a);return r}function readPoint(e,t){var r=(0,_xml.pushParseAndPop)({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),a=readFlatCoordinatesFromNode(e,t);if(a){var l=new _Point.default(a,_GeometryLayout.default.XYZ);return l.setProperties(r,!0),l}}var FLAT_LINEAR_RINGS_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{innerBoundaryIs:innerBoundaryIsParser,outerBoundaryIs:outerBoundaryIsParser});function readPolygon(e,t){var r=(0,_xml.pushParseAndPop)({},EXTRUDE_AND_ALTITUDE_MODE_PARSERS,e,t),a=(0,_xml.pushParseAndPop)([null],FLAT_LINEAR_RINGS_PARSERS,e,t);if(a&&a[0]){for(var l=a[0],o=[l.length],n=1,i=a.length;n<i;++n)(0,_array.extend)(l,a[n]),o.push(l.length);var _=new _Polygon.default(l,_GeometryLayout.default.XYZ,o);return _.setProperties(r,!0),_}}var STYLE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{IconStyle:iconStyleParser,LabelStyle:labelStyleParser,LineStyle:lineStyleParser,PolyStyle:polyStyleParser});function readStyle(e,t){var r=(0,_xml.pushParseAndPop)({},STYLE_PARSERS,e,t,this);if(!r)return null;var a,l="fillStyle"in r?r.fillStyle:DEFAULT_FILL_STYLE,o=r.fill;void 0===o||o||(l=null),"imageStyle"in r?r.imageStyle!=DEFAULT_NO_IMAGE_STYLE&&(a=r.imageStyle):a=DEFAULT_IMAGE_STYLE;var n="textStyle"in r?r.textStyle:DEFAULT_TEXT_STYLE,i="strokeStyle"in r?r.strokeStyle:DEFAULT_STROKE_STYLE,_=r.outline;return void 0===_||_?[new _Style.default({fill:l,image:a,stroke:i,text:n,zIndex:void 0})]:[new _Style.default({geometry:function(e){var t=e.getGeometry(),r=t.getType();return r===_GeometryType.default.GEOMETRY_COLLECTION?new _GeometryCollection.default(t.getGeometriesArrayRecursive().filter(function(e){var t=e.getType();return t!==_GeometryType.default.POLYGON&&t!==_GeometryType.default.MULTI_POLYGON})):r!==_GeometryType.default.POLYGON&&r!==_GeometryType.default.MULTI_POLYGON?t:void 0},fill:l,image:a,stroke:i,text:n,zIndex:void 0}),new _Style.default({geometry:function(e){var t=e.getGeometry(),r=t.getType();return r===_GeometryType.default.GEOMETRY_COLLECTION?new _GeometryCollection.default(t.getGeometriesArrayRecursive().filter(function(e){var t=e.getType();return t===_GeometryType.default.POLYGON||t===_GeometryType.default.MULTI_POLYGON})):r===_GeometryType.default.POLYGON||r===_GeometryType.default.MULTI_POLYGON?t:void 0},fill:l,stroke:null,zIndex:void 0})]}function setCommonGeometryProperties(e,t){var r,a,l,o=t.length,n=new Array(t.length),i=new Array(t.length),_=new Array(t.length);r=!1,a=!1,l=!1;for(var S=0;S<o;++S){var m=t[S];n[S]=m.get("extrude"),i[S]=m.get("tessellate"),_[S]=m.get("altitudeMode"),r=r||void 0!==n[S],a=a||void 0!==i[S],l=l||_[S]}r&&e.set("extrude",n),a&&e.set("tessellate",i),l&&e.set("altitudeMode",_)}var DATA_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{displayName:(0,_xml.makeObjectPropertySetter)(_xsd.readString),value:(0,_xml.makeObjectPropertySetter)(_xsd.readString)});function dataParser(e,t){var r=e.getAttribute("name");(0,_xml.parseNode)(DATA_PARSERS,e,t);var a=t[t.length-1];r&&a.displayName?a[r]={value:a.value,displayName:a.displayName,toString:function(){return a.value}}:null!==r?a[r]=a.value:null!==a.displayName&&(a[a.displayName]=a.value),delete a.value}var EXTENDED_DATA_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Data:dataParser,SchemaData:schemaDataParser});function extendedDataParser(e,t){(0,_xml.parseNode)(EXTENDED_DATA_PARSERS,e,t)}function regionParser(e,t){(0,_xml.parseNode)(REGION_PARSERS,e,t)}var PAIR_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Style:(0,_xml.makeObjectPropertySetter)(readStyle),key:(0,_xml.makeObjectPropertySetter)(_xsd.readString),styleUrl:(0,_xml.makeObjectPropertySetter)(readURI)});function pairDataParser(e,t){var r=(0,_xml.pushParseAndPop)({},PAIR_PARSERS,e,t,this);if(r){var a=r.key;if(a&&"normal"==a){var l=r.styleUrl;l&&(t[t.length-1]=l);var o=r.Style;o&&(t[t.length-1]=o)}}}function placemarkStyleMapParser(e,t){var r=readStyleMapValue.call(this,e,t);if(r){var a=t[t.length-1];Array.isArray(r)?a.Style=r:"string"==typeof r?a.styleUrl=r:(0,_asserts.assert)(!1,38)}}var SCHEMA_DATA_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{SimpleData:simpleDataParser});function schemaDataParser(e,t){(0,_xml.parseNode)(SCHEMA_DATA_PARSERS,e,t)}function simpleDataParser(e,t){var r=e.getAttribute("name");if(null!==r){var a=(0,_xsd.readString)(e);t[t.length-1][r]=a}}var LAT_LON_ALT_BOX_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{altitudeMode:(0,_xml.makeObjectPropertySetter)(_xsd.readString),minAltitude:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),maxAltitude:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),north:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),south:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),east:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),west:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal)});function latLonAltBoxParser(e,t){var r=(0,_xml.pushParseAndPop)({},LAT_LON_ALT_BOX_PARSERS,e,t);if(r){var a=t[t.length-1],l=[parseFloat(r.west),parseFloat(r.south),parseFloat(r.east),parseFloat(r.north)];a.extent=l,a.altitudeMode=r.altitudeMode,a.minAltitude=parseFloat(r.minAltitude),a.maxAltitude=parseFloat(r.maxAltitude)}}var LOD_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{minLodPixels:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),maxLodPixels:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),minFadeExtent:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),maxFadeExtent:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal)});function lodParser(e,t){var r=(0,_xml.pushParseAndPop)({},LOD_PARSERS,e,t);if(r){var a=t[t.length-1];a.minLodPixels=parseFloat(r.minLodPixels),a.maxLodPixels=parseFloat(r.maxLodPixels),a.minFadeExtent=parseFloat(r.minFadeExtent),a.maxFadeExtent=parseFloat(r.maxFadeExtent)}}var INNER_BOUNDARY_IS_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{LinearRing:(0,_xml.makeReplacer)(readFlatLinearRing)});function innerBoundaryIsParser(e,t){var r=(0,_xml.pushParseAndPop)(void 0,INNER_BOUNDARY_IS_PARSERS,e,t);r&&t[t.length-1].push(r)}var OUTER_BOUNDARY_IS_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{LinearRing:(0,_xml.makeReplacer)(readFlatLinearRing)});function outerBoundaryIsParser(e,t){var r=(0,_xml.pushParseAndPop)(void 0,OUTER_BOUNDARY_IS_PARSERS,e,t);r&&(t[t.length-1][0]=r)}function linkParser(e,t){(0,_xml.parseNode)(LINK_PARSERS,e,t)}function whenParser(e,t){var r=t[t.length-1].whens,a=(0,_xml.getAllTextContent)(e,!1),l=Date.parse(a);r.push(isNaN(l)?0:l)}function writeColorTextNode(e,t){for(var r=(0,_color.asArray)(t),a=[255*(4==r.length?r[3]:1),r[2],r[1],r[0]],l=0;l<4;++l){var o=Math.floor(a[l]).toString(16);a[l]=1==o.length?"0"+o:o}(0,_xsd.writeStringTextNode)(e,a.join(""))}function writeCoordinatesTextNode(e,t,r){var a,l=r[r.length-1],o=l.layout,n=l.stride;o==_GeometryLayout.default.XY||o==_GeometryLayout.default.XYM?a=2:o==_GeometryLayout.default.XYZ||o==_GeometryLayout.default.XYZM?a=3:(0,_asserts.assert)(!1,34);var i=t.length,_="";if(i>0){_+=t[0];for(var S=1;S<a;++S)_+=","+t[S];for(var m=n;m<i;m+=n){_+=" "+t[m];for(S=1;S<a;++S)_+=","+t[m+S]}}(0,_xsd.writeStringTextNode)(e,_)}var EXTENDEDDATA_NODE_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Data:(0,_xml.makeChildAppender)(writeDataNode),value:(0,_xml.makeChildAppender)(writeDataNodeValue),displayName:(0,_xml.makeChildAppender)(writeDataNodeName)});function writeDataNode(e,t,r){e.setAttribute("name",t.name);var a={node:e},l=t.value;"object"==_typeof(l)?(null!==l&&l.displayName&&(0,_xml.pushSerializeAndPop)(a,EXTENDEDDATA_NODE_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,[l.displayName],r,["displayName"]),null!==l&&l.value&&(0,_xml.pushSerializeAndPop)(a,EXTENDEDDATA_NODE_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,[l.value],r,["value"])):(0,_xml.pushSerializeAndPop)(a,EXTENDEDDATA_NODE_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,[l],r,["value"])}function writeDataNodeName(e,t){(0,_xsd.writeCDATASection)(e,t)}function writeDataNodeValue(e,t){(0,_xsd.writeStringTextNode)(e,t)}var DOCUMENT_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Placemark:(0,_xml.makeChildAppender)(writePlacemark)}),DOCUMENT_NODE_FACTORY=function(e,t,r){var a=t[t.length-1].node;return(0,_xml.createElementNS)(a.namespaceURI,"Placemark")};function writeDocument(e,t,r){var a={node:e};(0,_xml.pushSerializeAndPop)(a,DOCUMENT_SERIALIZERS,DOCUMENT_NODE_FACTORY,t,r,void 0,this)}var DATA_NODE_FACTORY=(0,_xml.makeSimpleNodeFactory)("Data");function writeExtendedData(e,t,r){for(var a={node:e},l=t.names,o=t.values,n=l.length,i=0;i<n;i++)(0,_xml.pushSerializeAndPop)(a,EXTENDEDDATA_NODE_SERIALIZERS,DATA_NODE_FACTORY,[{name:l[i],value:o[i]}],r)}var ICON_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["href"],(0,_xml.makeStructureNS)(GX_NAMESPACE_URIS,["x","y","w","h"])),ICON_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{href:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode)},(0,_xml.makeStructureNS)(GX_NAMESPACE_URIS,{x:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode),y:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode),w:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode),h:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode)})),GX_NODE_FACTORY=function(e,t,r){return(0,_xml.createElementNS)(GX_NAMESPACE_URIS[0],"gx:"+r)};function writeIcon(e,t,r){var a={node:e},l=r[r.length-1].node,o=ICON_SEQUENCE[l.namespaceURI],n=(0,_xml.makeSequence)(t,o);(0,_xml.pushSerializeAndPop)(a,ICON_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,n,r,o),o=ICON_SEQUENCE[GX_NAMESPACE_URIS[0]],n=(0,_xml.makeSequence)(t,o),(0,_xml.pushSerializeAndPop)(a,ICON_SERIALIZERS,GX_NODE_FACTORY,n,r,o)}var ICON_STYLE_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["scale","heading","Icon","color","hotSpot"]),ICON_STYLE_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Icon:(0,_xml.makeChildAppender)(writeIcon),color:(0,_xml.makeChildAppender)(writeColorTextNode),heading:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode),hotSpot:(0,_xml.makeChildAppender)(writeVec2),scale:(0,_xml.makeChildAppender)(writeScaleTextNode)});function writeIconStyle(e,t,r){var a={node:e},l={},o=t.getSrc(),n=t.getSize(),i=t.getImageSize(),_={href:o};if(n){_.w=n[0],_.h=n[1];var S=t.getAnchor(),m=t.getOrigin();if(m&&i&&0!==m[0]&&m[1]!==n[1]&&(_.x=m[0],_.y=i[1]-(m[1]+n[1])),S&&(S[0]!==n[0]/2||S[1]!==n[1]/2)){var E={x:S[0],xunits:_IconAnchorUnits.default.PIXELS,y:n[1]-S[1],yunits:_IconAnchorUnits.default.PIXELS};l.hotSpot=E}}l.Icon=_;var d=t.getScale();1!==d&&(l.scale=d);var u=t.getRotation();0!==u&&(l.heading=u);var s=t.getColor();s&&(l.color=s);var A=r[r.length-1].node,y=ICON_STYLE_SEQUENCE[A.namespaceURI],c=(0,_xml.makeSequence)(l,y);(0,_xml.pushSerializeAndPop)(a,ICON_STYLE_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,c,r,y)}var LABEL_STYLE_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["color","scale"]),LABEL_STYLE_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{color:(0,_xml.makeChildAppender)(writeColorTextNode),scale:(0,_xml.makeChildAppender)(writeScaleTextNode)});function writeLabelStyle(e,t,r){var a={node:e},l={},o=t.getFill();o&&(l.color=o.getColor());var n=t.getScale();n&&1!==n&&(l.scale=n);var i=r[r.length-1].node,_=LABEL_STYLE_SEQUENCE[i.namespaceURI],S=(0,_xml.makeSequence)(l,_);(0,_xml.pushSerializeAndPop)(a,LABEL_STYLE_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,S,r,_)}var LINE_STYLE_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["color","width"]),LINE_STYLE_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{color:(0,_xml.makeChildAppender)(writeColorTextNode),width:(0,_xml.makeChildAppender)(_xsd.writeDecimalTextNode)});function writeLineStyle(e,t,r){var a={node:e},l={color:t.getColor(),width:Number(t.getWidth())||1},o=r[r.length-1].node,n=LINE_STYLE_SEQUENCE[o.namespaceURI],i=(0,_xml.makeSequence)(l,n);(0,_xml.pushSerializeAndPop)(a,LINE_STYLE_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,i,r,n)}var GEOMETRY_TYPE_TO_NODENAME={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},GEOMETRY_NODE_FACTORY=function(e,t,r){if(e){var a=t[t.length-1].node;return(0,_xml.createElementNS)(a.namespaceURI,GEOMETRY_TYPE_TO_NODENAME[e.getType()])}},POINT_NODE_FACTORY=(0,_xml.makeSimpleNodeFactory)("Point"),LINE_STRING_NODE_FACTORY=(0,_xml.makeSimpleNodeFactory)("LineString"),LINEAR_RING_NODE_FACTORY=(0,_xml.makeSimpleNodeFactory)("LinearRing"),POLYGON_NODE_FACTORY=(0,_xml.makeSimpleNodeFactory)("Polygon"),MULTI_GEOMETRY_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{LineString:(0,_xml.makeChildAppender)(writePrimitiveGeometry),Point:(0,_xml.makeChildAppender)(writePrimitiveGeometry),Polygon:(0,_xml.makeChildAppender)(writePolygon),GeometryCollection:(0,_xml.makeChildAppender)(writeMultiGeometry)});function writeMultiGeometry(e,t,r){var a,l={node:e},o=t.getType(),n=[];o===_GeometryType.default.GEOMETRY_COLLECTION?(t.getGeometriesArrayRecursive().forEach(function(e){var t=e.getType();t===_GeometryType.default.MULTI_POINT?n=n.concat(e.getPoints()):t===_GeometryType.default.MULTI_LINE_STRING?n=n.concat(e.getLineStrings()):t===_GeometryType.default.MULTI_POLYGON?n=n.concat(e.getPolygons()):t===_GeometryType.default.POINT||t===_GeometryType.default.LINE_STRING||t===_GeometryType.default.POLYGON?n.push(e):(0,_asserts.assert)(!1,39)}),a=GEOMETRY_NODE_FACTORY):o===_GeometryType.default.MULTI_POINT?(n=t.getPoints(),a=POINT_NODE_FACTORY):o===_GeometryType.default.MULTI_LINE_STRING?(n=t.getLineStrings(),a=LINE_STRING_NODE_FACTORY):o===_GeometryType.default.MULTI_POLYGON?(n=t.getPolygons(),a=POLYGON_NODE_FACTORY):(0,_asserts.assert)(!1,39),(0,_xml.pushSerializeAndPop)(l,MULTI_GEOMETRY_SERIALIZERS,a,n,r)}var BOUNDARY_IS_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{LinearRing:(0,_xml.makeChildAppender)(writePrimitiveGeometry)});function writeBoundaryIs(e,t,r){var a={node:e};(0,_xml.pushSerializeAndPop)(a,BOUNDARY_IS_SERIALIZERS,LINEAR_RING_NODE_FACTORY,[t],r)}var PLACEMARK_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{ExtendedData:(0,_xml.makeChildAppender)(writeExtendedData),MultiGeometry:(0,_xml.makeChildAppender)(writeMultiGeometry),LineString:(0,_xml.makeChildAppender)(writePrimitiveGeometry),LinearRing:(0,_xml.makeChildAppender)(writePrimitiveGeometry),Point:(0,_xml.makeChildAppender)(writePrimitiveGeometry),Polygon:(0,_xml.makeChildAppender)(writePolygon),Style:(0,_xml.makeChildAppender)(writeStyle),address:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),description:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),name:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),open:(0,_xml.makeChildAppender)(_xsd.writeBooleanTextNode),phoneNumber:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),styleUrl:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),visibility:(0,_xml.makeChildAppender)(_xsd.writeBooleanTextNode)}),PLACEMARK_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),EXTENDEDDATA_NODE_FACTORY=(0,_xml.makeSimpleNodeFactory)("ExtendedData");function writePlacemark(e,t,r){var a={node:e};t.getId()&&e.setAttribute("id",t.getId());var l=t.getProperties(),o={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};o[t.getGeometryName()]=1;var n=Object.keys(l||{}).sort().filter(function(e){return!o[e]}),i=t.getStyleFunction();if(i){var _=i(t,0);if(_){var S=Array.isArray(_)?_:[_],m=S;if(t.getGeometry()&&(m=S.filter(function(e){var r=e.getGeometryFunction()(t);if(r){var a=r.getType();return a===_GeometryType.default.GEOMETRY_COLLECTION?r.getGeometriesArrayRecursive().filter(function(e){var t=e.getType();return t===_GeometryType.default.POINT||t===_GeometryType.default.MULTI_POINT}).length:a===_GeometryType.default.POINT||a===_GeometryType.default.MULTI_POINT}})),this.writeStyles_){var E=S,d=S;t.getGeometry()&&(E=S.filter(function(e){var r=e.getGeometryFunction()(t);if(r){var a=r.getType();return a===_GeometryType.default.GEOMETRY_COLLECTION?r.getGeometriesArrayRecursive().filter(function(e){var t=e.getType();return t===_GeometryType.default.LINE_STRING||t===_GeometryType.default.MULTI_LINE_STRING}).length:a===_GeometryType.default.LINE_STRING||a===_GeometryType.default.MULTI_LINE_STRING}}),d=S.filter(function(e){var r=e.getGeometryFunction()(t);if(r){var a=r.getType();return a===_GeometryType.default.GEOMETRY_COLLECTION?r.getGeometriesArrayRecursive().filter(function(e){var t=e.getType();return t===_GeometryType.default.POLYGON||t===_GeometryType.default.MULTI_POLYGON}).length:a===_GeometryType.default.POLYGON||a===_GeometryType.default.MULTI_POLYGON}})),l.Style={pointStyles:m,lineStyles:E,polyStyles:d}}if(m.length&&void 0===l.name){var u=m[0].getText();u&&(l.name=u.getText())}}}var s=r[r.length-1].node,A=PLACEMARK_SEQUENCE[s.namespaceURI],y=(0,_xml.makeSequence)(l,A);if((0,_xml.pushSerializeAndPop)(a,PLACEMARK_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,y,r,A),n.length>0){var c={names:n,values:(0,_xml.makeSequence)(l,n)};(0,_xml.pushSerializeAndPop)(a,PLACEMARK_SERIALIZERS,EXTENDEDDATA_NODE_FACTORY,[c],r)}var T=r[0],p=t.getGeometry();p&&(p=(0,_Feature2.transformGeometryWithOptions)(p,!0,T)),(0,_xml.pushSerializeAndPop)(a,PLACEMARK_SERIALIZERS,GEOMETRY_NODE_FACTORY,[p],r)}var PRIMITIVE_GEOMETRY_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["extrude","tessellate","altitudeMode","coordinates"]),PRIMITIVE_GEOMETRY_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{extrude:(0,_xml.makeChildAppender)(_xsd.writeBooleanTextNode),tessellate:(0,_xml.makeChildAppender)(_xsd.writeBooleanTextNode),altitudeMode:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode),coordinates:(0,_xml.makeChildAppender)(writeCoordinatesTextNode)});function writePrimitiveGeometry(e,t,r){var a=t.getFlatCoordinates(),l={node:e};l.layout=t.getLayout(),l.stride=t.getStride();var o=t.getProperties();o.coordinates=a;var n=r[r.length-1].node,i=PRIMITIVE_GEOMETRY_SEQUENCE[n.namespaceURI],_=(0,_xml.makeSequence)(o,i);(0,_xml.pushSerializeAndPop)(l,PRIMITIVE_GEOMETRY_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,_,r,i)}var POLY_STYLE_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["color","fill","outline"]),POLYGON_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{outerBoundaryIs:(0,_xml.makeChildAppender)(writeBoundaryIs),innerBoundaryIs:(0,_xml.makeChildAppender)(writeBoundaryIs)}),INNER_BOUNDARY_NODE_FACTORY=(0,_xml.makeSimpleNodeFactory)("innerBoundaryIs"),OUTER_BOUNDARY_NODE_FACTORY=(0,_xml.makeSimpleNodeFactory)("outerBoundaryIs");function writePolygon(e,t,r){var a=t.getLinearRings(),l=a.shift(),o={node:e};(0,_xml.pushSerializeAndPop)(o,POLYGON_SERIALIZERS,INNER_BOUNDARY_NODE_FACTORY,a,r),(0,_xml.pushSerializeAndPop)(o,POLYGON_SERIALIZERS,OUTER_BOUNDARY_NODE_FACTORY,[l],r)}var POLY_STYLE_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{color:(0,_xml.makeChildAppender)(writeColorTextNode),fill:(0,_xml.makeChildAppender)(_xsd.writeBooleanTextNode),outline:(0,_xml.makeChildAppender)(_xsd.writeBooleanTextNode)});function writePolyStyle(e,t,r){var a={node:e},l=t.getFill(),o=t.getStroke(),n={color:l?l.getColor():void 0,fill:!!l&&void 0,outline:!!o&&void 0},i=r[r.length-1].node,_=POLY_STYLE_SEQUENCE[i.namespaceURI],S=(0,_xml.makeSequence)(n,_);(0,_xml.pushSerializeAndPop)(a,POLY_STYLE_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,S,r,_)}function writeScaleTextNode(e,t){(0,_xsd.writeDecimalTextNode)(e,Math.round(1e6*t)/1e6)}var STYLE_SEQUENCE=(0,_xml.makeStructureNS)(NAMESPACE_URIS,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),STYLE_SERIALIZERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{IconStyle:(0,_xml.makeChildAppender)(writeIconStyle),LabelStyle:(0,_xml.makeChildAppender)(writeLabelStyle),LineStyle:(0,_xml.makeChildAppender)(writeLineStyle),PolyStyle:(0,_xml.makeChildAppender)(writePolyStyle)});function writeStyle(e,t,r){var a,l={node:e},o={};if(t.pointStyles.length){var n=t.pointStyles[0].getText();n&&(o.LabelStyle=n);var i=t.pointStyles[0].getImage();i&&"function"==typeof i.getSrc&&(o.IconStyle=i)}t.lineStyles.length&&((a=t.lineStyles[0].getStroke())&&(o.LineStyle=a));t.polyStyles.length&&((a=t.polyStyles[0].getStroke())&&!o.LineStyle&&(o.LineStyle=a),o.PolyStyle=t.polyStyles[0]);var _=r[r.length-1].node,S=STYLE_SEQUENCE[_.namespaceURI],m=(0,_xml.makeSequence)(o,S);(0,_xml.pushSerializeAndPop)(l,STYLE_SERIALIZERS,_xml.OBJECT_PROPERTY_NODE_FACTORY,m,r,S)}function writeVec2(e,t){e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("xunits",t.xunits),e.setAttribute("yunits",t.yunits)}var _default=KML;exports.default=_default;

},{"../Feature.js":13,"../array.js":44,"../asserts.js":45,"../color.js":47,"../geom/GeometryCollection.js":129,"../geom/GeometryLayout.js":130,"../geom/GeometryType.js":131,"../geom/LineString.js":132,"../geom/MultiLineString.js":134,"../geom/MultiPoint.js":135,"../geom/MultiPolygon.js":136,"../geom/Point.js":137,"../geom/Polygon.js":138,"../math.js":201,"../proj.js":205,"../style/Fill.js":293,"../style/Icon.js":294,"../style/IconAnchorUnits.js":295,"../style/IconOrigin.js":298,"../style/Stroke.js":301,"../style/Style.js":302,"../style/Text.js":303,"../xml.js":322,"./Feature.js":76,"./XMLFeature.js":100,"./xsd.js":124}],88:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Feature=_interopRequireWildcard(require("./Feature.js")),_FormatType=_interopRequireDefault(require("./FormatType.js")),_GeometryLayout=_interopRequireDefault(require("../geom/GeometryLayout.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_MultiLineString=_interopRequireDefault(require("../geom/MultiLineString.js")),_MultiPoint=_interopRequireDefault(require("../geom/MultiPoint.js")),_MultiPolygon=_interopRequireDefault(require("../geom/MultiPolygon.js")),_pbf=_interopRequireDefault(require("pbf")),_Point=_interopRequireDefault(require("../geom/Point.js")),_Polygon=_interopRequireDefault(require("../geom/Polygon.js")),_Projection=_interopRequireDefault(require("../proj/Projection.js")),_Feature2=_interopRequireDefault(require("../render/Feature.js")),_Units=_interopRequireDefault(require("../proj/Units.js")),_asserts=require("../asserts.js"),_proj=require("../proj.js"),_orient=require("../geom/flat/orient.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var n=a?Object.getOwnPropertyDescriptor(e,o):null;n&&(n.get||n.set)?Object.defineProperty(r,o,n):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),MVT=function(e){function t(t){var r=e.call(this)||this,a=t||{};return r.dataProjection=new _Projection.default({code:"",units:_Units.default.TILE_PIXELS}),r.featureClass_=a.featureClass?a.featureClass:_Feature2.default,r.geometryName_=a.geometryName,r.layerName_=a.layerName?a.layerName:"layer",r.layers_=a.layers?a.layers:null,r.idProperty_=a.idProperty,r}return __extends(t,e),t.prototype.readRawGeometry_=function(e,t,r,a){e.pos=t.geometry;for(var o=e.readVarint()+e.pos,n=1,i=0,u=0,l=0,s=0,f=0;e.pos<o;){if(!i){var y=e.readVarint();n=7&y,i=y>>3}i--,1===n||2===n?(u+=e.readSVarint(),l+=e.readSVarint(),1===n&&s>f&&(a.push(s),f=s),r.push(u,l),s+=2):7===n?s>f&&(r.push(r[f],r[f+1]),s+=2):(0,_asserts.assert)(!1,59)}s>f&&(a.push(s),f=s)},t.prototype.createFeature_=function(e,t,r){var a,o=t.type;if(0===o)return null;var n,i=t.properties;this.idProperty_?(n=i[this.idProperty_],delete i[this.idProperty_]):n=t.id,i[this.layerName_]=t.layer.name;var u=[],l=[];this.readRawGeometry_(e,t,u,l);var s=getGeometryType(o,l.length);if(this.featureClass_===_Feature2.default)(a=new this.featureClass_(s,u,l,i,n)).transform(r.dataProjection,r.featureProjection);else{var f=void 0;if(s==_GeometryType.default.POLYGON){for(var y=[],p=0,_=0,d=0,c=l.length;d<c;++d){var m=l[d];if((0,_orient.linearRingIsClockwise)(u,p,m,2)){if(0===y.length)continue;y[y.length-1].push(l[_])}else y.push(l.slice(_,d+1));_=d+1,p=m}f=y.length>1?new _MultiPolygon.default(u,_GeometryLayout.default.XY,y):new _Polygon.default(u,_GeometryLayout.default.XY,l)}else f=s===_GeometryType.default.POINT?new _Point.default(u,_GeometryLayout.default.XY):s===_GeometryType.default.LINE_STRING?new _LineString.default(u,_GeometryLayout.default.XY):s===_GeometryType.default.POLYGON?new _Polygon.default(u,_GeometryLayout.default.XY,l):s===_GeometryType.default.MULTI_POINT?new _MultiPoint.default(u,_GeometryLayout.default.XY):s===_GeometryType.default.MULTI_LINE_STRING?new _MultiLineString.default(u,_GeometryLayout.default.XY,l):null;a=new(0,this.featureClass_),this.geometryName_&&a.setGeometryName(this.geometryName_);var g=(0,_Feature.transformGeometryWithOptions)(f,!1,r);a.setGeometry(g),a.setId(n),a.setProperties(i,!0)}return a},t.prototype.getType=function(){return _FormatType.default.ARRAY_BUFFER},t.prototype.readFeatures=function(e,t){var r=this.layers_,a=this.adaptOptions(t),o=(0,_proj.get)(a.dataProjection);o.setWorldExtent(a.extent),a.dataProjection=o;var n=new _pbf.default(e),i=n.readFields(layersPBFReader,{}),u=[];for(var l in i)if(!r||-1!=r.indexOf(l)){var s=i[l],f=s?[0,0,s.extent,s.extent]:null;o.setExtent(f);for(var y=0,p=s.length;y<p;++y){var _=readRawFeature(n,s,y);u.push(this.createFeature_(n,_,a))}}return u},t.prototype.readProjection=function(e){return this.dataProjection},t.prototype.setLayers=function(e){this.layers_=e},t}(_Feature.default);function layersPBFReader(e,t,r){if(3===e){var a={keys:[],values:[],features:[]},o=r.readVarint()+r.pos;r.readFields(layerPBFReader,a,o),a.length=a.features.length,a.length&&(t[a.name]=a)}}function layerPBFReader(e,t,r){if(15===e)t.version=r.readVarint();else if(1===e)t.name=r.readString();else if(5===e)t.extent=r.readVarint();else if(2===e)t.features.push(r.pos);else if(3===e)t.keys.push(r.readString());else if(4===e){for(var a=null,o=r.readVarint()+r.pos;r.pos<o;)a=1===(e=r.readVarint()>>3)?r.readString():2===e?r.readFloat():3===e?r.readDouble():4===e?r.readVarint64():5===e?r.readVarint():6===e?r.readSVarint():7===e?r.readBoolean():null;t.values.push(a)}}function featurePBFReader(e,t,r){if(1==e)t.id=r.readVarint();else if(2==e)for(var a=r.readVarint()+r.pos;r.pos<a;){var o=t.layer.keys[r.readVarint()],n=t.layer.values[r.readVarint()];t.properties[o]=n}else 3==e?t.type=r.readVarint():4==e&&(t.geometry=r.pos)}function readRawFeature(e,t,r){e.pos=t.features[r];var a=e.readVarint()+e.pos,o={layer:t,type:0,properties:{}};return e.readFields(featurePBFReader,o,a),o}function getGeometryType(e,t){var r;return 1===e?r=1===t?_GeometryType.default.POINT:_GeometryType.default.MULTI_POINT:2===e?r=1===t?_GeometryType.default.LINE_STRING:_GeometryType.default.MULTI_LINE_STRING:3===e&&(r=_GeometryType.default.POLYGON),r}var _default=MVT;exports.default=_default;

},{"../asserts.js":45,"../geom/GeometryLayout.js":130,"../geom/GeometryType.js":131,"../geom/LineString.js":132,"../geom/MultiLineString.js":134,"../geom/MultiPoint.js":135,"../geom/MultiPolygon.js":136,"../geom/Point.js":137,"../geom/Polygon.js":138,"../geom/flat/orient.js":152,"../proj.js":205,"../proj/Projection.js":206,"../proj/Units.js":207,"../render/Feature.js":217,"./Feature.js":76,"./FormatType.js":77,"pbf":323}],89:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _XML=_interopRequireDefault(require("./XML.js")),_xml=require("../xml.js"),_XLink=require("./XLink.js"),_xsd=require("./xsd.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function S(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(S.prototype=t.prototype,new S)}}(),NAMESPACE_URIS=[null,"http://www.opengis.net/ows/1.1"],PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{ServiceIdentification:(0,_xml.makeObjectPropertySetter)(readServiceIdentification),ServiceProvider:(0,_xml.makeObjectPropertySetter)(readServiceProvider),OperationsMetadata:(0,_xml.makeObjectPropertySetter)(readOperationsMetadata)}),OWS=function(e){function r(){return e.call(this)||this}return __extends(r,e),r.prototype.readFromNode=function(e){var r=(0,_xml.pushParseAndPop)({},PARSERS,e,[]);return r||null},r}(_XML.default),ADDRESS_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{DeliveryPoint:(0,_xml.makeObjectPropertySetter)(_xsd.readString),City:(0,_xml.makeObjectPropertySetter)(_xsd.readString),AdministrativeArea:(0,_xml.makeObjectPropertySetter)(_xsd.readString),PostalCode:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Country:(0,_xml.makeObjectPropertySetter)(_xsd.readString),ElectronicMailAddress:(0,_xml.makeObjectPropertySetter)(_xsd.readString)}),ALLOWED_VALUES_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Value:(0,_xml.makeObjectPropertyPusher)(readValue)}),CONSTRAINT_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{AllowedValues:(0,_xml.makeObjectPropertySetter)(readAllowedValues)}),CONTACT_INFO_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Phone:(0,_xml.makeObjectPropertySetter)(readPhone),Address:(0,_xml.makeObjectPropertySetter)(readAddress)}),DCP_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{HTTP:(0,_xml.makeObjectPropertySetter)(readHttp)}),HTTP_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Get:(0,_xml.makeObjectPropertyPusher)(readGet),Post:void 0}),OPERATION_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{DCP:(0,_xml.makeObjectPropertySetter)(readDcp)}),OPERATIONS_METADATA_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Operation:readOperation}),PHONE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Voice:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Facsimile:(0,_xml.makeObjectPropertySetter)(_xsd.readString)}),REQUEST_METHOD_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Constraint:(0,_xml.makeObjectPropertyPusher)(readConstraint)}),SERVICE_CONTACT_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{IndividualName:(0,_xml.makeObjectPropertySetter)(_xsd.readString),PositionName:(0,_xml.makeObjectPropertySetter)(_xsd.readString),ContactInfo:(0,_xml.makeObjectPropertySetter)(readContactInfo)}),SERVICE_IDENTIFICATION_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Abstract:(0,_xml.makeObjectPropertySetter)(_xsd.readString),AccessConstraints:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Fees:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Title:(0,_xml.makeObjectPropertySetter)(_xsd.readString),ServiceTypeVersion:(0,_xml.makeObjectPropertySetter)(_xsd.readString),ServiceType:(0,_xml.makeObjectPropertySetter)(_xsd.readString)}),SERVICE_PROVIDER_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{ProviderName:(0,_xml.makeObjectPropertySetter)(_xsd.readString),ProviderSite:(0,_xml.makeObjectPropertySetter)(_XLink.readHref),ServiceContact:(0,_xml.makeObjectPropertySetter)(readServiceContact)});function readAddress(e,r){return(0,_xml.pushParseAndPop)({},ADDRESS_PARSERS,e,r)}function readAllowedValues(e,r){return(0,_xml.pushParseAndPop)({},ALLOWED_VALUES_PARSERS,e,r)}function readConstraint(e,r){var t=e.getAttribute("name");if(t)return(0,_xml.pushParseAndPop)({name:t},CONSTRAINT_PARSERS,e,r)}function readContactInfo(e,r){return(0,_xml.pushParseAndPop)({},CONTACT_INFO_PARSERS,e,r)}function readDcp(e,r){return(0,_xml.pushParseAndPop)({},DCP_PARSERS,e,r)}function readGet(e,r){var t=(0,_XLink.readHref)(e);if(t)return(0,_xml.pushParseAndPop)({href:t},REQUEST_METHOD_PARSERS,e,r)}function readHttp(e,r){return(0,_xml.pushParseAndPop)({},HTTP_PARSERS,e,r)}function readOperation(e,r){var t=e.getAttribute("name"),S=(0,_xml.pushParseAndPop)({},OPERATION_PARSERS,e,r);S&&(r[r.length-1][t]=S)}function readOperationsMetadata(e,r){return(0,_xml.pushParseAndPop)({},OPERATIONS_METADATA_PARSERS,e,r)}function readPhone(e,r){return(0,_xml.pushParseAndPop)({},PHONE_PARSERS,e,r)}function readServiceIdentification(e,r){return(0,_xml.pushParseAndPop)({},SERVICE_IDENTIFICATION_PARSERS,e,r)}function readServiceContact(e,r){return(0,_xml.pushParseAndPop)({},SERVICE_CONTACT_PARSERS,e,r)}function readServiceProvider(e,r){return(0,_xml.pushParseAndPop)({},SERVICE_PROVIDER_PARSERS,e,r)}function readValue(e,r){return(0,_xsd.readString)(e)}var _default=OWS;exports.default=_default;

},{"../xml.js":322,"./XLink.js":98,"./XML.js":99,"./xsd.js":124}],90:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.encodeDeltas=encodeDeltas,exports.decodeDeltas=decodeDeltas,exports.encodeFloats=encodeFloats,exports.decodeFloats=decodeFloats,exports.encodeSignedIntegers=encodeSignedIntegers,exports.decodeSignedIntegers=decodeSignedIntegers,exports.encodeUnsignedIntegers=encodeUnsignedIntegers,exports.decodeUnsignedIntegers=decodeUnsignedIntegers,exports.encodeUnsignedInteger=encodeUnsignedInteger,exports.default=void 0;var _Feature=_interopRequireDefault(require("../Feature.js")),_GeometryLayout=_interopRequireDefault(require("../geom/GeometryLayout.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_TextFeature=_interopRequireDefault(require("./TextFeature.js")),_asserts=require("../asserts.js"),_flip=require("../geom/flat/flip.js"),_proj=require("../proj.js"),_SimpleGeometry=require("../geom/SimpleGeometry.js"),_inflate=require("../geom/flat/inflate.js"),_Feature2=require("./Feature.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Polyline=function(e){function t(t){var r=e.call(this)||this,o=t||{};return r.dataProjection=(0,_proj.get)("EPSG:4326"),r.factor_=o.factor?o.factor:1e5,r.geometryLayout_=o.geometryLayout?o.geometryLayout:_GeometryLayout.default.XY,r}return __extends(t,e),t.prototype.readFeatureFromText=function(e,t){var r=this.readGeometryFromText(e,t);return new _Feature.default(r)},t.prototype.readFeaturesFromText=function(e,t){return[this.readFeatureFromText(e,t)]},t.prototype.readGeometryFromText=function(e,t){var r=(0,_SimpleGeometry.getStrideForLayout)(this.geometryLayout_),o=decodeDeltas(e,r,this.factor_);(0,_flip.flipXY)(o,0,o.length,r,o);var n=(0,_inflate.inflateCoordinates)(o,0,o.length,r),a=new _LineString.default(n,this.geometryLayout_);return(0,_Feature2.transformGeometryWithOptions)(a,!1,this.adaptOptions(t))},t.prototype.writeFeatureText=function(e,t){var r=e.getGeometry();return r?this.writeGeometryText(r,t):((0,_asserts.assert)(!1,40),"")},t.prototype.writeFeaturesText=function(e,t){return this.writeFeatureText(e[0],t)},t.prototype.writeGeometryText=function(e,t){var r=(e=(0,_Feature2.transformGeometryWithOptions)(e,!0,this.adaptOptions(t))).getFlatCoordinates(),o=e.getStride();return(0,_flip.flipXY)(r,0,r.length,o,r),encodeDeltas(r,o,this.factor_)},t}(_TextFeature.default);function encodeDeltas(e,t,r){var o,n=r||1e5,a=new Array(t);for(o=0;o<t;++o)a[o]=0;for(var i=0,s=e.length;i<s;)for(o=0;o<t;++o,++i){var u=e[i],d=u-a[o];a[o]=u,e[i]=d}return encodeFloats(e,n)}function decodeDeltas(e,t,r){var o,n=r||1e5,a=new Array(t);for(o=0;o<t;++o)a[o]=0;for(var i=decodeFloats(e,n),s=0,u=i.length;s<u;)for(o=0;o<t;++o,++s)a[o]+=i[s],i[s]=a[o];return i}function encodeFloats(e,t){for(var r=t||1e5,o=0,n=e.length;o<n;++o)e[o]=Math.round(e[o]*r);return encodeSignedIntegers(e)}function decodeFloats(e,t){for(var r=t||1e5,o=decodeSignedIntegers(e),n=0,a=o.length;n<a;++n)o[n]/=r;return o}function encodeSignedIntegers(e){for(var t=0,r=e.length;t<r;++t){var o=e[t];e[t]=o<0?~(o<<1):o<<1}return encodeUnsignedIntegers(e)}function decodeSignedIntegers(e){for(var t=decodeUnsignedIntegers(e),r=0,o=t.length;r<o;++r){var n=t[r];t[r]=1&n?~(n>>1):n>>1}return t}function encodeUnsignedIntegers(e){for(var t="",r=0,o=e.length;r<o;++r)t+=encodeUnsignedInteger(e[r]);return t}function decodeUnsignedIntegers(e){for(var t=[],r=0,o=0,n=0,a=e.length;n<a;++n){var i=e.charCodeAt(n)-63;r|=(31&i)<<o,i<32?(t.push(r),r=0,o=0):o+=5}return t}function encodeUnsignedInteger(e){for(var t,r="";e>=32;)t=63+(32|31&e),r+=String.fromCharCode(t),e>>=5;return t=e+63,r+=String.fromCharCode(t)}var _default=Polyline;exports.default=_default;

},{"../Feature.js":13,"../asserts.js":45,"../geom/GeometryLayout.js":130,"../geom/LineString.js":132,"../geom/SimpleGeometry.js":139,"../geom/flat/flip.js":145,"../geom/flat/inflate.js":147,"../proj.js":205,"./Feature.js":76,"./TextFeature.js":91}],91:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Feature=_interopRequireDefault(require("../format/Feature.js")),_FormatType=_interopRequireDefault(require("../format/FormatType.js")),_util=require("../util.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),TextFeature=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getType=function(){return _FormatType.default.TEXT},e.prototype.readFeature=function(t,e){return this.readFeatureFromText(getText(t),this.adaptOptions(e))},e.prototype.readFeatureFromText=function(t,e){return(0,_util.abstract)()},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromText(getText(t),this.adaptOptions(e))},e.prototype.readFeaturesFromText=function(t,e){return(0,_util.abstract)()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromText(getText(t),this.adaptOptions(e))},e.prototype.readGeometryFromText=function(t,e){return(0,_util.abstract)()},e.prototype.readProjection=function(t){return this.readProjectionFromText(getText(t))},e.prototype.readProjectionFromText=function(t){return this.dataProjection},e.prototype.writeFeature=function(t,e){return this.writeFeatureText(t,this.adaptOptions(e))},e.prototype.writeFeatureText=function(t,e){return(0,_util.abstract)()},e.prototype.writeFeatures=function(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))},e.prototype.writeFeaturesText=function(t,e){return(0,_util.abstract)()},e.prototype.writeGeometry=function(t,e){return this.writeGeometryText(t,this.adaptOptions(e))},e.prototype.writeGeometryText=function(t,e){return(0,_util.abstract)()},e}(_Feature.default);function getText(t){return"string"==typeof t?t:""}var _default=TextFeature;exports.default=_default;

},{"../format/Feature.js":76,"../format/FormatType.js":77,"../util.js":313}],92:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Feature=_interopRequireDefault(require("../Feature.js")),_JSONFeature=_interopRequireDefault(require("./JSONFeature.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_MultiLineString=_interopRequireDefault(require("../geom/MultiLineString.js")),_MultiPoint=_interopRequireDefault(require("../geom/MultiPoint.js")),_MultiPolygon=_interopRequireDefault(require("../geom/MultiPolygon.js")),_Point=_interopRequireDefault(require("../geom/Point.js")),_Polygon=_interopRequireDefault(require("../geom/Polygon.js")),_proj=require("../proj.js"),_Feature2=require("./Feature.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function o(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),TopoJSON=function(e){function r(r){var t=e.call(this)||this,o=r||{};return t.layerName_=o.layerName,t.layers_=o.layers?o.layers:null,t.dataProjection=(0,_proj.get)(o.dataProjection?o.dataProjection:"EPSG:4326"),t}return __extends(r,e),r.prototype.readFeaturesFromObject=function(e,r){if("Topology"==e.type){var t=e,o=void 0,n=null,i=null;t.transform&&(n=(o=t.transform).scale,i=o.translate);var a=t.arcs;o&&transformArcs(a,n,i);var u=[],l=t.objects,s=this.layerName_,c=void 0;for(var f in l)this.layers_&&-1==this.layers_.indexOf(f)||("GeometryCollection"===l[f].type?(c=l[f],u.push.apply(u,readFeaturesFromGeometryCollection(c,a,n,i,s,f,r))):(c=l[f],u.push(readFeatureFromGeometry(c,a,n,i,s,f,r))));return u}return[]},r.prototype.readProjectionFromObject=function(e){return this.dataProjection},r}(_JSONFeature.default),GEOMETRY_READERS={Point:readPointGeometry,LineString:readLineStringGeometry,Polygon:readPolygonGeometry,MultiPoint:readMultiPointGeometry,MultiLineString:readMultiLineStringGeometry,MultiPolygon:readMultiPolygonGeometry};function concatenateArcs(e,r){for(var t,o,n=[],i=0,a=e.length;i<a;++i)t=e[i],i>0&&n.pop(),o=t>=0?r[t]:r[~t].slice().reverse(),n.push.apply(n,o);for(var u=0,l=n.length;u<l;++u)n[u]=n[u].slice();return n}function readPointGeometry(e,r,t){var o=e.coordinates;return r&&t&&transformVertex(o,r,t),new _Point.default(o)}function readMultiPointGeometry(e,r,t){var o=e.coordinates;if(r&&t)for(var n=0,i=o.length;n<i;++n)transformVertex(o[n],r,t);return new _MultiPoint.default(o)}function readLineStringGeometry(e,r){var t=concatenateArcs(e.arcs,r);return new _LineString.default(t)}function readMultiLineStringGeometry(e,r){for(var t=[],o=0,n=e.arcs.length;o<n;++o)t[o]=concatenateArcs(e.arcs[o],r);return new _MultiLineString.default(t)}function readPolygonGeometry(e,r){for(var t=[],o=0,n=e.arcs.length;o<n;++o)t[o]=concatenateArcs(e.arcs[o],r);return new _Polygon.default(t)}function readMultiPolygonGeometry(e,r){for(var t=[],o=0,n=e.arcs.length;o<n;++o){for(var i=e.arcs[o],a=[],u=0,l=i.length;u<l;++u)a[u]=concatenateArcs(i[u],r);t[o]=a}return new _MultiPolygon.default(t)}function readFeaturesFromGeometryCollection(e,r,t,o,n,i,a){for(var u=e.geometries,l=[],s=0,c=u.length;s<c;++s)l[s]=readFeatureFromGeometry(u[s],r,t,o,n,i,a);return l}function readFeatureFromGeometry(e,r,t,o,n,i,a){var u,l=e.type,s=GEOMETRY_READERS[l];u="Point"===l||"MultiPoint"===l?s(e,t,o):s(e,r);var c=new _Feature.default;c.setGeometry((0,_Feature2.transformGeometryWithOptions)(u,!1,a)),void 0!==e.id&&c.setId(e.id);var f=e.properties;return n&&(f||(f={}),f[n]=i),f&&c.setProperties(f,!0),c}function transformArcs(e,r,t){for(var o=0,n=e.length;o<n;++o)transformArc(e[o],r,t)}function transformArc(e,r,t){for(var o=0,n=0,i=0,a=e.length;i<a;++i){var u=e[i];o+=u[0],n+=u[1],u[0]=o,u[1]=n,transformVertex(u,r,t)}}function transformVertex(e,r,t){e[0]=e[0]*r[0]+t[0],e[1]=e[1]*r[1]+t[1]}var _default=TopoJSON;exports.default=_default;

},{"../Feature.js":13,"../geom/LineString.js":132,"../geom/MultiLineString.js":134,"../geom/MultiPoint.js":135,"../geom/MultiPolygon.js":136,"../geom/Point.js":137,"../geom/Polygon.js":138,"../proj.js":205,"./Feature.js":76,"./JSONFeature.js":86}],93:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.writeFilter=writeFilter,exports.default=void 0;var _GML=_interopRequireDefault(require("./GML2.js")),_GML2=_interopRequireDefault(require("./GML3.js")),_GMLBase=_interopRequireWildcard(require("./GMLBase.js")),_XMLFeature=_interopRequireDefault(require("./XMLFeature.js")),_xml=require("../xml.js"),_filter=require("./filter.js"),_asserts=require("../asserts.js"),_obj=require("../obj.js"),_proj=require("../proj.js"),_xsd=require("./xsd.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=a?Object.getOwnPropertyDescriptor(e,i):null;n&&(n.get||n.set)?Object.defineProperty(r,i,n):r[i]=e[i]}return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),FEATURE_COLLECTION_PARSERS={"http://www.opengis.net/gml":{boundedBy:(0,_xml.makeObjectPropertySetter)(_GMLBase.default.prototype.readGeometryElement,"bounds")}},TRANSACTION_SUMMARY_PARSERS={"http://www.opengis.net/wfs":{totalInserted:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),totalUpdated:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),totalDeleted:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger)}},TRANSACTION_RESPONSE_PARSERS={"http://www.opengis.net/wfs":{TransactionSummary:(0,_xml.makeObjectPropertySetter)(readTransactionSummary,"transactionSummary"),InsertResults:(0,_xml.makeObjectPropertySetter)(readInsertResults,"insertIds")}},QUERY_SERIALIZERS={"http://www.opengis.net/wfs":{PropertyName:(0,_xml.makeChildAppender)(_xsd.writeStringTextNode)}},TRANSACTION_SERIALIZERS={"http://www.opengis.net/wfs":{Insert:(0,_xml.makeChildAppender)(writeFeature),Update:(0,_xml.makeChildAppender)(writeUpdate),Delete:(0,_xml.makeChildAppender)(writeDelete),Property:(0,_xml.makeChildAppender)(writeProperty),Native:(0,_xml.makeChildAppender)(writeNative)}},FEATURE_PREFIX="feature",XMLNS="http://www.w3.org/2000/xmlns/",OGCNS="http://www.opengis.net/ogc",WFSNS="http://www.opengis.net/wfs",FESNS="http://www.opengis.net/fes",SCHEMA_LOCATIONS={"1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},DEFAULT_VERSION="1.1.0",WFS=function(e){function t(t){var r=e.call(this)||this,a=t||{};return r.featureType_=a.featureType,r.featureNS_=a.featureNS,r.gmlFormat_=a.gmlFormat?a.gmlFormat:new _GML2.default,r.schemaLocation_=a.schemaLocation?a.schemaLocation:SCHEMA_LOCATIONS[DEFAULT_VERSION],r}return __extends(t,e),t.prototype.getFeatureType=function(){return this.featureType_},t.prototype.setFeatureType=function(e){this.featureType_=e},t.prototype.readFeaturesFromNode=function(e,t){var r={node:e};(0,_obj.assign)(r,{featureType:this.featureType_,featureNS:this.featureNS_}),(0,_obj.assign)(r,this.getReadOptions(e,t||{}));var a=[r];this.gmlFormat_.FEATURE_COLLECTION_PARSERS[_GMLBase.GMLNS].featureMember=(0,_xml.makeArrayPusher)(_GMLBase.default.prototype.readFeaturesInternal);var i=(0,_xml.pushParseAndPop)([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,a,this.gmlFormat_);return i||(i=[]),i},t.prototype.readTransactionResponse=function(e){if(e){if("string"==typeof e){var t=(0,_xml.parse)(e);return this.readTransactionResponseFromDocument(t)}return(0,_xml.isDocument)(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}},t.prototype.readFeatureCollectionMetadata=function(e){if(e){if("string"==typeof e){var t=(0,_xml.parse)(e);return this.readFeatureCollectionMetadataFromDocument(t)}return(0,_xml.isDocument)(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}},t.prototype.readFeatureCollectionMetadataFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)},t.prototype.readFeatureCollectionMetadataFromNode=function(e){var t={},r=(0,_xsd.readNonNegativeIntegerString)(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=r,(0,_xml.pushParseAndPop)(t,FEATURE_COLLECTION_PARSERS,e,[],this.gmlFormat_)},t.prototype.readTransactionResponseFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)},t.prototype.readTransactionResponseFromNode=function(e){return(0,_xml.pushParseAndPop)({},TRANSACTION_RESPONSE_PARSERS,e,[])},t.prototype.writeGetFeature=function(e){var t,r=(0,_xml.createElementNS)(WFSNS,"GetFeature");if(r.setAttribute("service","WFS"),r.setAttribute("version","1.1.0"),e&&(e.handle&&r.setAttribute("handle",e.handle),e.outputFormat&&r.setAttribute("outputFormat",e.outputFormat),void 0!==e.maxFeatures&&r.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&r.setAttribute("resultType",e.resultType),void 0!==e.startIndex&&r.setAttribute("startIndex",String(e.startIndex)),void 0!==e.count&&r.setAttribute("count",String(e.count)),void 0!==e.viewParams&&r.setAttribute("viewParams",e.viewParams),t=e.filter,e.bbox)){(0,_asserts.assert)(e.geometryName,12);var a=(0,_filter.bbox)(e.geometryName,e.bbox,e.srsName);t=t?(0,_filter.and)(t,a):a}r.setAttributeNS(_xml.XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",this.schemaLocation_);var i={node:r};return(0,_obj.assign)(i,{srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,geometryName:e.geometryName,filter:t,propertyNames:e.propertyNames?e.propertyNames:[]}),(0,_asserts.assert)(Array.isArray(e.featureTypes),11),writeGetFeature(r,e.featureTypes,[i]),r},t.prototype.writeTransaction=function(e,t,r,a){var i,n,o=[],s=(0,_xml.createElementNS)(WFSNS,"Transaction"),l=a.version?a.version:DEFAULT_VERSION,p="1.0.0"===l?2:3;s.setAttribute("service","WFS"),s.setAttribute("version",l),a&&(i=a.gmlOptions?a.gmlOptions:{},a.handle&&s.setAttribute("handle",a.handle));var m=SCHEMA_LOCATIONS[l];s.setAttributeNS(_xml.XML_SCHEMA_INSTANCE_URI,"xsi:schemaLocation",m);var u=a.featurePrefix?a.featurePrefix:FEATURE_PREFIX;return e&&(n=(0,_obj.assign)({node:s},{featureNS:a.featureNS,featureType:a.featureType,featurePrefix:u,gmlVersion:p,hasZ:a.hasZ,srsName:a.srsName}),(0,_obj.assign)(n,i),(0,_xml.pushSerializeAndPop)(n,TRANSACTION_SERIALIZERS,(0,_xml.makeSimpleNodeFactory)("Insert"),e,o)),t&&(n=(0,_obj.assign)({node:s},{featureNS:a.featureNS,featureType:a.featureType,featurePrefix:u,gmlVersion:p,hasZ:a.hasZ,srsName:a.srsName}),(0,_obj.assign)(n,i),(0,_xml.pushSerializeAndPop)(n,TRANSACTION_SERIALIZERS,(0,_xml.makeSimpleNodeFactory)("Update"),t,o)),r&&(0,_xml.pushSerializeAndPop)({node:s,featureNS:a.featureNS,featureType:a.featureType,featurePrefix:u,gmlVersion:p,srsName:a.srsName},TRANSACTION_SERIALIZERS,(0,_xml.makeSimpleNodeFactory)("Delete"),r,o),a.nativeElements&&(0,_xml.pushSerializeAndPop)({node:s,featureNS:a.featureNS,featureType:a.featureType,featurePrefix:u,gmlVersion:p,srsName:a.srsName},TRANSACTION_SERIALIZERS,(0,_xml.makeSimpleNodeFactory)("Native"),a.nativeElements,o),s},t.prototype.readProjectionFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null},t.prototype.readProjectionFromNode=function(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild)for(var t=(e=e.firstElementChild.firstElementChild).firstElementChild;t;t=t.nextElementSibling)if(0!==t.childNodes.length&&(1!==t.childNodes.length||3!==t.firstChild.nodeType)){var r=[{}];return this.gmlFormat_.readGeometryElement(t,r),(0,_proj.get)(r.pop().srsName)}return null},t}(_XMLFeature.default);function readTransactionSummary(e,t){return(0,_xml.pushParseAndPop)({},TRANSACTION_SUMMARY_PARSERS,e,t)}var OGC_FID_PARSERS={"http://www.opengis.net/ogc":{FeatureId:(0,_xml.makeArrayPusher)(function(e,t){return e.getAttribute("fid")})}};function fidParser(e,t){(0,_xml.parseNode)(OGC_FID_PARSERS,e,t)}var INSERT_RESULTS_PARSERS={"http://www.opengis.net/wfs":{Feature:fidParser}};function readInsertResults(e,t){return(0,_xml.pushParseAndPop)([],INSERT_RESULTS_PARSERS,e,t)}function writeFeature(e,t,r){var a=r[r.length-1],i=a.featureType,n=a.featureNS,o=a.gmlVersion,s=(0,_xml.createElementNS)(n,i);e.appendChild(s),2===o?_GML.default.prototype.writeFeatureElement(s,t,r):_GML2.default.prototype.writeFeatureElement(s,t,r)}function writeOgcFidFilter(e,t,r){var a=(0,_xml.createElementNS)(OGCNS,"Filter"),i=(0,_xml.createElementNS)(OGCNS,"FeatureId");a.appendChild(i),i.setAttribute("fid",t),e.appendChild(a)}function getTypeName(e,t){var r=(e=e||FEATURE_PREFIX)+":";return 0===t.indexOf(r)?t:r+t}function writeDelete(e,t,r){var a=r[r.length-1];(0,_asserts.assert)(void 0!==t.getId(),26);var i=a.featureType,n=a.featurePrefix,o=a.featureNS,s=getTypeName(n,i);e.setAttribute("typeName",s),e.setAttributeNS(XMLNS,"xmlns:"+n,o);var l=t.getId();void 0!==l&&writeOgcFidFilter(e,l,r)}function writeUpdate(e,t,r){var a=r[r.length-1];(0,_asserts.assert)(void 0!==t.getId(),27);var i=a.featureType,n=a.featurePrefix,o=a.featureNS,s=getTypeName(n,i),l=t.getGeometryName();e.setAttribute("typeName",s),e.setAttributeNS(XMLNS,"xmlns:"+n,o);var p=t.getId();if(void 0!==p){for(var m=t.getKeys(),u=[],d=0,f=m.length;d<f;d++){var _=t.get(m[d]);if(void 0!==_){var N=m[d];_&&"function"==typeof _.getSimplifiedGeometry&&(N=l),u.push({name:N,value:_})}}(0,_xml.pushSerializeAndPop)({gmlVersion:a.gmlVersion,node:e,hasZ:a.hasZ,srsName:a.srsName},TRANSACTION_SERIALIZERS,(0,_xml.makeSimpleNodeFactory)("Property"),u,r),writeOgcFidFilter(e,p,r)}}function writeProperty(e,t,r){var a=(0,_xml.createElementNS)(WFSNS,"Name"),i=r[r.length-1].gmlVersion;if(e.appendChild(a),(0,_xsd.writeStringTextNode)(a,t.name),void 0!==t.value&&null!==t.value){var n=(0,_xml.createElementNS)(WFSNS,"Value");e.appendChild(n),t.value&&"function"==typeof t.value.getSimplifiedGeometry?2===i?_GML.default.prototype.writeGeometryElement(n,t.value,r):_GML2.default.prototype.writeGeometryElement(n,t.value,r):(0,_xsd.writeStringTextNode)(n,t.value)}}function writeNative(e,t,r){t.vendorId&&e.setAttribute("vendorId",t.vendorId),void 0!==t.safeToIgnore&&e.setAttribute("safeToIgnore",String(t.safeToIgnore)),void 0!==t.value&&(0,_xsd.writeStringTextNode)(e,t.value)}var GETFEATURE_SERIALIZERS={"http://www.opengis.net/wfs":{Query:(0,_xml.makeChildAppender)(writeQuery)},"http://www.opengis.net/ogc":{During:(0,_xml.makeChildAppender)(writeDuringFilter),And:(0,_xml.makeChildAppender)(writeLogicalFilter),Or:(0,_xml.makeChildAppender)(writeLogicalFilter),Not:(0,_xml.makeChildAppender)(writeNotFilter),BBOX:(0,_xml.makeChildAppender)(writeBboxFilter),Contains:(0,_xml.makeChildAppender)(writeContainsFilter),Intersects:(0,_xml.makeChildAppender)(writeIntersectsFilter),Within:(0,_xml.makeChildAppender)(writeWithinFilter),PropertyIsEqualTo:(0,_xml.makeChildAppender)(writeComparisonFilter),PropertyIsNotEqualTo:(0,_xml.makeChildAppender)(writeComparisonFilter),PropertyIsLessThan:(0,_xml.makeChildAppender)(writeComparisonFilter),PropertyIsLessThanOrEqualTo:(0,_xml.makeChildAppender)(writeComparisonFilter),PropertyIsGreaterThan:(0,_xml.makeChildAppender)(writeComparisonFilter),PropertyIsGreaterThanOrEqualTo:(0,_xml.makeChildAppender)(writeComparisonFilter),PropertyIsNull:(0,_xml.makeChildAppender)(writeIsNullFilter),PropertyIsBetween:(0,_xml.makeChildAppender)(writeIsBetweenFilter),PropertyIsLike:(0,_xml.makeChildAppender)(writeIsLikeFilter)}};function writeQuery(e,t,r){var a,i=r[r.length-1],n=i.featurePrefix,o=i.featureNS,s=i.propertyNames,l=i.srsName;a=n?getTypeName(n,t):t,e.setAttribute("typeName",a),l&&e.setAttribute("srsName",l),o&&e.setAttributeNS(XMLNS,"xmlns:"+n,o);var p=(0,_obj.assign)({},i);p.node=e,(0,_xml.pushSerializeAndPop)(p,QUERY_SERIALIZERS,(0,_xml.makeSimpleNodeFactory)("PropertyName"),s,r);var m=i.filter;if(m){var u=(0,_xml.createElementNS)(OGCNS,"Filter");e.appendChild(u),writeFilterCondition(u,m,r)}}function writeFilterCondition(e,t,r){var a={node:e};(0,_xml.pushSerializeAndPop)(a,GETFEATURE_SERIALIZERS,(0,_xml.makeSimpleNodeFactory)(t.getTagName()),[t],r)}function writeBboxFilter(e,t,r){r[r.length-1].srsName=t.srsName,writeOgcPropertyName(e,t.geometryName),_GML2.default.prototype.writeGeometryElement(e,t.extent,r)}function writeContainsFilter(e,t,r){r[r.length-1].srsName=t.srsName,writeOgcPropertyName(e,t.geometryName),_GML2.default.prototype.writeGeometryElement(e,t.geometry,r)}function writeIntersectsFilter(e,t,r){r[r.length-1].srsName=t.srsName,writeOgcPropertyName(e,t.geometryName),_GML2.default.prototype.writeGeometryElement(e,t.geometry,r)}function writeWithinFilter(e,t,r){r[r.length-1].srsName=t.srsName,writeOgcPropertyName(e,t.geometryName),_GML2.default.prototype.writeGeometryElement(e,t.geometry,r)}function writeDuringFilter(e,t,r){var a=(0,_xml.createElementNS)(FESNS,"ValueReference");(0,_xsd.writeStringTextNode)(a,t.propertyName),e.appendChild(a);var i=(0,_xml.createElementNS)(_GMLBase.GMLNS,"TimePeriod");e.appendChild(i);var n=(0,_xml.createElementNS)(_GMLBase.GMLNS,"begin");i.appendChild(n),writeTimeInstant(n,t.begin);var o=(0,_xml.createElementNS)(_GMLBase.GMLNS,"end");i.appendChild(o),writeTimeInstant(o,t.end)}function writeLogicalFilter(e,t,r){for(var a={node:e},i=t.conditions,n=0,o=i.length;n<o;++n){var s=i[n];(0,_xml.pushSerializeAndPop)(a,GETFEATURE_SERIALIZERS,(0,_xml.makeSimpleNodeFactory)(s.getTagName()),[s],r)}}function writeNotFilter(e,t,r){var a={node:e},i=t.condition;(0,_xml.pushSerializeAndPop)(a,GETFEATURE_SERIALIZERS,(0,_xml.makeSimpleNodeFactory)(i.getTagName()),[i],r)}function writeComparisonFilter(e,t,r){void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString()),writeOgcPropertyName(e,t.propertyName),writeOgcLiteral(e,""+t.expression)}function writeIsNullFilter(e,t,r){writeOgcPropertyName(e,t.propertyName)}function writeIsBetweenFilter(e,t,r){writeOgcPropertyName(e,t.propertyName);var a=(0,_xml.createElementNS)(OGCNS,"LowerBoundary");e.appendChild(a),writeOgcLiteral(a,""+t.lowerBoundary);var i=(0,_xml.createElementNS)(OGCNS,"UpperBoundary");e.appendChild(i),writeOgcLiteral(i,""+t.upperBoundary)}function writeIsLikeFilter(e,t,r){e.setAttribute("wildCard",t.wildCard),e.setAttribute("singleChar",t.singleChar),e.setAttribute("escapeChar",t.escapeChar),void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString()),writeOgcPropertyName(e,t.propertyName),writeOgcLiteral(e,""+t.pattern)}function writeOgcExpression(e,t,r){var a=(0,_xml.createElementNS)(OGCNS,e);(0,_xsd.writeStringTextNode)(a,r),t.appendChild(a)}function writeOgcPropertyName(e,t){writeOgcExpression("PropertyName",e,t)}function writeOgcLiteral(e,t){writeOgcExpression("Literal",e,t)}function writeTimeInstant(e,t){var r=(0,_xml.createElementNS)(_GMLBase.GMLNS,"TimeInstant");e.appendChild(r);var a=(0,_xml.createElementNS)(_GMLBase.GMLNS,"timePosition");r.appendChild(a),(0,_xsd.writeStringTextNode)(a,t)}function writeFilter(e){var t=(0,_xml.createElementNS)(OGCNS,"Filter");return writeFilterCondition(t,e,[]),t}function writeGetFeature(e,t,r){var a=r[r.length-1],i=(0,_obj.assign)({},a);i.node=e,(0,_xml.pushSerializeAndPop)(i,GETFEATURE_SERIALIZERS,(0,_xml.makeSimpleNodeFactory)("Query"),t,r)}var _default=WFS;exports.default=_default;

},{"../asserts.js":45,"../obj.js":203,"../proj.js":205,"../xml.js":322,"./GML2.js":79,"./GML3.js":80,"./GMLBase.js":81,"./XMLFeature.js":100,"./filter.js":101,"./xsd.js":124}],94:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Feature=_interopRequireDefault(require("../Feature.js")),_GeometryCollection=_interopRequireDefault(require("../geom/GeometryCollection.js")),_GeometryLayout=_interopRequireDefault(require("../geom/GeometryLayout.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_MultiLineString=_interopRequireDefault(require("../geom/MultiLineString.js")),_MultiPoint=_interopRequireDefault(require("../geom/MultiPoint.js")),_MultiPolygon=_interopRequireDefault(require("../geom/MultiPolygon.js")),_Point=_interopRequireDefault(require("../geom/Point.js")),_Polygon=_interopRequireDefault(require("../geom/Polygon.js")),_TextFeature=_interopRequireDefault(require("./TextFeature.js")),_Feature2=require("./Feature.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),GeometryConstructor={POINT:_Point.default,LINESTRING:_LineString.default,POLYGON:_Polygon.default,MULTIPOINT:_MultiPoint.default,MULTILINESTRING:_MultiLineString.default,MULTIPOLYGON:_MultiPolygon.default},EMPTY="EMPTY",Z="Z",M="M",ZM="ZM",TokenType={TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},WKTGeometryType={};for(var type in _GeometryType.default)WKTGeometryType[type]=_GeometryType.default[type].toUpperCase();var Lexer=function(){function e(e){this.wkt=e,this.index_=-1}return e.prototype.isAlpha_=function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"},e.prototype.isNumeric_=function(e,t){return e>="0"&&e<="9"||"."==e&&!(void 0!==t&&t)},e.prototype.isWhiteSpace_=function(e){return" "==e||"\t"==e||"\r"==e||"\n"==e},e.prototype.nextChar_=function(){return this.wkt.charAt(++this.index_)},e.prototype.nextToken=function(){var e,t=this.nextChar_(),r=this.index_,o=t;if("("==t)e=TokenType.LEFT_PAREN;else if(","==t)e=TokenType.COMMA;else if(")"==t)e=TokenType.RIGHT_PAREN;else if(this.isNumeric_(t)||"-"==t)e=TokenType.NUMBER,o=this.readNumber_();else if(this.isAlpha_(t))e=TokenType.TEXT,o=this.readText_();else{if(this.isWhiteSpace_(t))return this.nextToken();if(""!==t)throw new Error("Unexpected character: "+t);e=TokenType.EOF}return{position:r,value:o,type:e}},e.prototype.readNumber_=function(){var e,t=this.index_,r=!1,o=!1;do{"."==e?r=!0:"e"!=e&&"E"!=e||(o=!0),e=this.nextChar_()}while(this.isNumeric_(e,r)||!o&&("e"==e||"E"==e)||o&&("-"==e||"+"==e));return parseFloat(this.wkt.substring(t,this.index_--))},e.prototype.readText_=function(){var e,t=this.index_;do{e=this.nextChar_()}while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()},e}(),Parser=function(){function e(e){this.lexer_=e,this.token_,this.layout_=_GeometryLayout.default.XY}return e.prototype.consume_=function(){this.token_=this.lexer_.nextToken()},e.prototype.isTokenType=function(e){return this.token_.type==e},e.prototype.match=function(e){var t=this.isTokenType(e);return t&&this.consume_(),t},e.prototype.parse=function(){return this.consume_(),this.parseGeometry_()},e.prototype.parseGeometryLayout_=function(){var e=_GeometryLayout.default.XY,t=this.token_;if(this.isTokenType(TokenType.TEXT)){var r=t.value;r===Z?e=_GeometryLayout.default.XYZ:r===M?e=_GeometryLayout.default.XYM:r===ZM&&(e=_GeometryLayout.default.XYZM),e!==_GeometryLayout.default.XY&&this.consume_()}return e},e.prototype.parseGeometryCollectionText_=function(){if(this.match(TokenType.LEFT_PAREN)){var e=[];do{e.push(this.parseGeometry_())}while(this.match(TokenType.COMMA));if(this.match(TokenType.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},e.prototype.parsePointText_=function(){if(this.match(TokenType.LEFT_PAREN)){var e=this.parsePoint_();if(this.match(TokenType.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())},e.prototype.parseLineStringText_=function(){if(this.match(TokenType.LEFT_PAREN)){var e=this.parsePointList_();if(this.match(TokenType.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},e.prototype.parsePolygonText_=function(){if(this.match(TokenType.LEFT_PAREN)){var e=this.parseLineStringTextList_();if(this.match(TokenType.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},e.prototype.parseMultiPointText_=function(){if(this.match(TokenType.LEFT_PAREN)){var e=void 0;if(e=this.token_.type==TokenType.LEFT_PAREN?this.parsePointTextList_():this.parsePointList_(),this.match(TokenType.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},e.prototype.parseMultiLineStringText_=function(){if(this.match(TokenType.LEFT_PAREN)){var e=this.parseLineStringTextList_();if(this.match(TokenType.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},e.prototype.parseMultiPolygonText_=function(){if(this.match(TokenType.LEFT_PAREN)){var e=this.parsePolygonTextList_();if(this.match(TokenType.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())},e.prototype.parsePoint_=function(){for(var e=[],t=this.layout_.length,r=0;r<t;++r){var o=this.token_;if(!this.match(TokenType.NUMBER))break;e.push(o.value)}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())},e.prototype.parsePointList_=function(){for(var e=[this.parsePoint_()];this.match(TokenType.COMMA);)e.push(this.parsePoint_());return e},e.prototype.parsePointTextList_=function(){for(var e=[this.parsePointText_()];this.match(TokenType.COMMA);)e.push(this.parsePointText_());return e},e.prototype.parseLineStringTextList_=function(){for(var e=[this.parseLineStringText_()];this.match(TokenType.COMMA);)e.push(this.parseLineStringText_());return e},e.prototype.parsePolygonTextList_=function(){for(var e=[this.parsePolygonText_()];this.match(TokenType.COMMA);)e.push(this.parsePolygonText_());return e},e.prototype.isEmptyGeometry_=function(){var e=this.isTokenType(TokenType.TEXT)&&this.token_.value==EMPTY;return e&&this.consume_(),e},e.prototype.formatErrorMessage_=function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"},e.prototype.parseGeometry_=function(){var e=this.token_;if(this.match(TokenType.TEXT)){var t=e.value;if(this.layout_=this.parseGeometryLayout_(),"GEOMETRYCOLLECTION"==t){var r=this.parseGeometryCollectionText_();return new _GeometryCollection.default(r)}var o=GeometryConstructor[t];if(!o)throw new Error("Invalid geometry type: "+t);var n=void 0;switch(t){case"POINT":n=this.parsePointText_();break;case"LINESTRING":n=this.parseLineStringText_();break;case"POLYGON":n=this.parsePolygonText_();break;case"MULTIPOINT":n=this.parseMultiPointText_();break;case"MULTILINESTRING":n=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":n=this.parseMultiPolygonText_();break;default:throw new Error("Invalid geometry type: "+t)}return n||(n=o===GeometryConstructor.POINT?[NaN,NaN]:[]),new o(n,this.layout_)}throw new Error(this.formatErrorMessage_())},e}(),WKT=function(e){function t(t){var r=e.call(this)||this,o=t||{};return r.splitCollection_=void 0!==o.splitCollection&&o.splitCollection,r}return __extends(t,e),t.prototype.parse_=function(e){var t=new Lexer(e);return new Parser(t).parse()},t.prototype.readFeatureFromText=function(e,t){var r=this.readGeometryFromText(e,t);if(r){var o=new _Feature.default;return o.setGeometry(r),o}return null},t.prototype.readFeaturesFromText=function(e,t){for(var r=[],o=this.readGeometryFromText(e,t),n=[],i=0,s=(r=this.splitCollection_&&o.getType()==_GeometryType.default.GEOMETRY_COLLECTION?o.getGeometriesArray():[o]).length;i<s;++i){var u=new _Feature.default;u.setGeometry(r[i]),n.push(u)}return n},t.prototype.readGeometryFromText=function(e,t){var r=this.parse_(e);return r?(0,_Feature2.transformGeometryWithOptions)(r,!1,t):null},t.prototype.writeFeatureText=function(e,t){var r=e.getGeometry();return r?this.writeGeometryText(r,t):""},t.prototype.writeFeaturesText=function(e,t){if(1==e.length)return this.writeFeatureText(e[0],t);for(var r=[],o=0,n=e.length;o<n;++o)r.push(e[o].getGeometry());var i=new _GeometryCollection.default(r);return this.writeGeometryText(i,t)},t.prototype.writeGeometryText=function(e,t){return encode((0,_Feature2.transformGeometryWithOptions)(e,!0,t))},t}(_TextFeature.default);function encodePointGeometry(e){var t=e.getCoordinates();return 0===t.length?"":t.join(" ")}function encodeMultiPointGeometry(e){for(var t=[],r=e.getPoints(),o=0,n=r.length;o<n;++o)t.push("("+encodePointGeometry(r[o])+")");return t.join(",")}function encodeGeometryCollectionGeometry(e){for(var t=[],r=e.getGeometries(),o=0,n=r.length;o<n;++o)t.push(encode(r[o]));return t.join(",")}function encodeLineStringGeometry(e){for(var t=e.getCoordinates(),r=[],o=0,n=t.length;o<n;++o)r.push(t[o].join(" "));return r.join(",")}function encodeMultiLineStringGeometry(e){for(var t=[],r=e.getLineStrings(),o=0,n=r.length;o<n;++o)t.push("("+encodeLineStringGeometry(r[o])+")");return t.join(",")}function encodePolygonGeometry(e){for(var t=[],r=e.getLinearRings(),o=0,n=r.length;o<n;++o)t.push("("+encodeLineStringGeometry(r[o])+")");return t.join(",")}function encodeMultiPolygonGeometry(e){for(var t=[],r=e.getPolygons(),o=0,n=r.length;o<n;++o)t.push("("+encodePolygonGeometry(r[o])+")");return t.join(",")}function encodeGeometryLayout(e){var t=e.getLayout(),r="";return t!==_GeometryLayout.default.XYZ&&t!==_GeometryLayout.default.XYZM||(r+=Z),t!==_GeometryLayout.default.XYM&&t!==_GeometryLayout.default.XYZM||(r+=M),r}var GeometryEncoder={Point:encodePointGeometry,LineString:encodeLineStringGeometry,Polygon:encodePolygonGeometry,MultiPoint:encodeMultiPointGeometry,MultiLineString:encodeMultiLineStringGeometry,MultiPolygon:encodeMultiPolygonGeometry,GeometryCollection:encodeGeometryCollectionGeometry};function encode(e){var t=e.getType(),r=(0,GeometryEncoder[t])(e);if(t=t.toUpperCase(),"function"==typeof e.getFlatCoordinates){var o=encodeGeometryLayout(e);o.length>0&&(t+=" "+o)}return 0===r.length?t+" "+EMPTY:t+"("+r+")"}var _default=WKT;exports.default=_default;

},{"../Feature.js":13,"../geom/GeometryCollection.js":129,"../geom/GeometryLayout.js":130,"../geom/GeometryType.js":131,"../geom/LineString.js":132,"../geom/MultiLineString.js":134,"../geom/MultiPoint.js":135,"../geom/MultiPolygon.js":136,"../geom/Point.js":137,"../geom/Polygon.js":138,"./Feature.js":76,"./TextFeature.js":91}],95:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _XML=_interopRequireDefault(require("./XML.js")),_xml=require("../xml.js"),_xsd=require("./xsd.js"),_XLink=require("./XLink.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),NAMESPACE_URIS=[null,"http://www.opengis.net/wms"],PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Service:(0,_xml.makeObjectPropertySetter)(readService),Capability:(0,_xml.makeObjectPropertySetter)(readCapability)}),CAPABILITY_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Request:(0,_xml.makeObjectPropertySetter)(readRequest),Exception:(0,_xml.makeObjectPropertySetter)(readException),Layer:(0,_xml.makeObjectPropertySetter)(readCapabilityLayer)}),WMSCapabilities=function(e){function t(){var t=e.call(this)||this;return t.version=void 0,t}return __extends(t,e),t.prototype.readFromNode=function(e){this.version=e.getAttribute("version").trim();var t=(0,_xml.pushParseAndPop)({version:this.version},PARSERS,e,[]);return t||null},t}(_XML.default),SERVICE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Name:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Title:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Abstract:(0,_xml.makeObjectPropertySetter)(_xsd.readString),KeywordList:(0,_xml.makeObjectPropertySetter)(readKeywordList),OnlineResource:(0,_xml.makeObjectPropertySetter)(_XLink.readHref),ContactInformation:(0,_xml.makeObjectPropertySetter)(readContactInformation),Fees:(0,_xml.makeObjectPropertySetter)(_xsd.readString),AccessConstraints:(0,_xml.makeObjectPropertySetter)(_xsd.readString),LayerLimit:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),MaxWidth:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),MaxHeight:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger)}),CONTACT_INFORMATION_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{ContactPersonPrimary:(0,_xml.makeObjectPropertySetter)(readContactPersonPrimary),ContactPosition:(0,_xml.makeObjectPropertySetter)(_xsd.readString),ContactAddress:(0,_xml.makeObjectPropertySetter)(readContactAddress),ContactVoiceTelephone:(0,_xml.makeObjectPropertySetter)(_xsd.readString),ContactFacsimileTelephone:(0,_xml.makeObjectPropertySetter)(_xsd.readString),ContactElectronicMailAddress:(0,_xml.makeObjectPropertySetter)(_xsd.readString)}),CONTACT_PERSON_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{ContactPerson:(0,_xml.makeObjectPropertySetter)(_xsd.readString),ContactOrganization:(0,_xml.makeObjectPropertySetter)(_xsd.readString)}),CONTACT_ADDRESS_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{AddressType:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Address:(0,_xml.makeObjectPropertySetter)(_xsd.readString),City:(0,_xml.makeObjectPropertySetter)(_xsd.readString),StateOrProvince:(0,_xml.makeObjectPropertySetter)(_xsd.readString),PostCode:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Country:(0,_xml.makeObjectPropertySetter)(_xsd.readString)}),EXCEPTION_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Format:(0,_xml.makeArrayPusher)(_xsd.readString)}),LAYER_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Name:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Title:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Abstract:(0,_xml.makeObjectPropertySetter)(_xsd.readString),KeywordList:(0,_xml.makeObjectPropertySetter)(readKeywordList),CRS:(0,_xml.makeObjectPropertyPusher)(_xsd.readString),EX_GeographicBoundingBox:(0,_xml.makeObjectPropertySetter)(readEXGeographicBoundingBox),BoundingBox:(0,_xml.makeObjectPropertyPusher)(readBoundingBox),Dimension:(0,_xml.makeObjectPropertyPusher)(readDimension),Attribution:(0,_xml.makeObjectPropertySetter)(readAttribution),AuthorityURL:(0,_xml.makeObjectPropertyPusher)(readAuthorityURL),Identifier:(0,_xml.makeObjectPropertyPusher)(_xsd.readString),MetadataURL:(0,_xml.makeObjectPropertyPusher)(readMetadataURL),DataURL:(0,_xml.makeObjectPropertyPusher)(readFormatOnlineresource),FeatureListURL:(0,_xml.makeObjectPropertyPusher)(readFormatOnlineresource),Style:(0,_xml.makeObjectPropertyPusher)(readStyle),MinScaleDenominator:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),MaxScaleDenominator:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),Layer:(0,_xml.makeObjectPropertyPusher)(readLayer)}),ATTRIBUTION_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Title:(0,_xml.makeObjectPropertySetter)(_xsd.readString),OnlineResource:(0,_xml.makeObjectPropertySetter)(_XLink.readHref),LogoURL:(0,_xml.makeObjectPropertySetter)(readSizedFormatOnlineresource)}),EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{westBoundLongitude:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),eastBoundLongitude:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),southBoundLatitude:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),northBoundLatitude:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal)}),REQUEST_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{GetCapabilities:(0,_xml.makeObjectPropertySetter)(readOperationType),GetMap:(0,_xml.makeObjectPropertySetter)(readOperationType),GetFeatureInfo:(0,_xml.makeObjectPropertySetter)(readOperationType)}),OPERATIONTYPE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Format:(0,_xml.makeObjectPropertyPusher)(_xsd.readString),DCPType:(0,_xml.makeObjectPropertyPusher)(readDCPType)}),DCPTYPE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{HTTP:(0,_xml.makeObjectPropertySetter)(readHTTP)}),HTTP_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Get:(0,_xml.makeObjectPropertySetter)(readFormatOnlineresource),Post:(0,_xml.makeObjectPropertySetter)(readFormatOnlineresource)}),STYLE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Name:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Title:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Abstract:(0,_xml.makeObjectPropertySetter)(_xsd.readString),LegendURL:(0,_xml.makeObjectPropertyPusher)(readSizedFormatOnlineresource),StyleSheetURL:(0,_xml.makeObjectPropertySetter)(readFormatOnlineresource),StyleURL:(0,_xml.makeObjectPropertySetter)(readFormatOnlineresource)}),FORMAT_ONLINERESOURCE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Format:(0,_xml.makeObjectPropertySetter)(_xsd.readString),OnlineResource:(0,_xml.makeObjectPropertySetter)(_XLink.readHref)}),KEYWORDLIST_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Keyword:(0,_xml.makeArrayPusher)(_xsd.readString)});function readAttribution(e,t){return(0,_xml.pushParseAndPop)({},ATTRIBUTION_PARSERS,e,t)}function readBoundingBox(e,t){var r=[(0,_xsd.readDecimalString)(e.getAttribute("minx")),(0,_xsd.readDecimalString)(e.getAttribute("miny")),(0,_xsd.readDecimalString)(e.getAttribute("maxx")),(0,_xsd.readDecimalString)(e.getAttribute("maxy"))],a=[(0,_xsd.readDecimalString)(e.getAttribute("resx")),(0,_xsd.readDecimalString)(e.getAttribute("resy"))];return{crs:e.getAttribute("CRS"),extent:r,res:a}}function readEXGeographicBoundingBox(e,t){var r=(0,_xml.pushParseAndPop)({},EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS,e,t);if(r){var a=r.westBoundLongitude,n=r.southBoundLatitude,o=r.eastBoundLongitude,i=r.northBoundLatitude;if(void 0!==a&&void 0!==n&&void 0!==o&&void 0!==i)return[a,n,o,i]}}function readCapability(e,t){return(0,_xml.pushParseAndPop)({},CAPABILITY_PARSERS,e,t)}function readService(e,t){return(0,_xml.pushParseAndPop)({},SERVICE_PARSERS,e,t)}function readContactInformation(e,t){return(0,_xml.pushParseAndPop)({},CONTACT_INFORMATION_PARSERS,e,t)}function readContactPersonPrimary(e,t){return(0,_xml.pushParseAndPop)({},CONTACT_PERSON_PARSERS,e,t)}function readContactAddress(e,t){return(0,_xml.pushParseAndPop)({},CONTACT_ADDRESS_PARSERS,e,t)}function readException(e,t){return(0,_xml.pushParseAndPop)([],EXCEPTION_PARSERS,e,t)}function readCapabilityLayer(e,t){return(0,_xml.pushParseAndPop)({},LAYER_PARSERS,e,t)}function readLayer(e,t){var r=t[t.length-1],a=(0,_xml.pushParseAndPop)({},LAYER_PARSERS,e,t);if(a){var n=(0,_xsd.readBooleanString)(e.getAttribute("queryable"));void 0===n&&(n=r.queryable),a.queryable=void 0!==n&&n;var o=(0,_xsd.readNonNegativeIntegerString)(e.getAttribute("cascaded"));void 0===o&&(o=r.cascaded),a.cascaded=o;var i=(0,_xsd.readBooleanString)(e.getAttribute("opaque"));void 0===i&&(i=r.opaque),a.opaque=void 0!==i&&i;var S=(0,_xsd.readBooleanString)(e.getAttribute("noSubsets"));void 0===S&&(S=r.noSubsets),a.noSubsets=void 0!==S&&S;var d=(0,_xsd.readDecimalString)(e.getAttribute("fixedWidth"));d||(d=r.fixedWidth),a.fixedWidth=d;var m=(0,_xsd.readDecimalString)(e.getAttribute("fixedHeight"));m||(m=r.fixedHeight),a.fixedHeight=m;["Style","CRS","AuthorityURL"].forEach(function(e){if(e in r){var t=a[e]||[];a[e]=t.concat(r[e])}});return["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(e){if(!(e in a)){var t=r[e];a[e]=t}}),a}}function readDimension(e,t){return{name:e.getAttribute("name"),units:e.getAttribute("units"),unitSymbol:e.getAttribute("unitSymbol"),default:e.getAttribute("default"),multipleValues:(0,_xsd.readBooleanString)(e.getAttribute("multipleValues")),nearestValue:(0,_xsd.readBooleanString)(e.getAttribute("nearestValue")),current:(0,_xsd.readBooleanString)(e.getAttribute("current")),values:(0,_xsd.readString)(e)}}function readFormatOnlineresource(e,t){return(0,_xml.pushParseAndPop)({},FORMAT_ONLINERESOURCE_PARSERS,e,t)}function readRequest(e,t){return(0,_xml.pushParseAndPop)({},REQUEST_PARSERS,e,t)}function readDCPType(e,t){return(0,_xml.pushParseAndPop)({},DCPTYPE_PARSERS,e,t)}function readHTTP(e,t){return(0,_xml.pushParseAndPop)({},HTTP_PARSERS,e,t)}function readOperationType(e,t){return(0,_xml.pushParseAndPop)({},OPERATIONTYPE_PARSERS,e,t)}function readSizedFormatOnlineresource(e,t){var r=readFormatOnlineresource(e,t);if(r){var a=[(0,_xsd.readNonNegativeIntegerString)(e.getAttribute("width")),(0,_xsd.readNonNegativeIntegerString)(e.getAttribute("height"))];return r.size=a,r}}function readAuthorityURL(e,t){var r=readFormatOnlineresource(e,t);if(r)return r.name=e.getAttribute("name"),r}function readMetadataURL(e,t){var r=readFormatOnlineresource(e,t);if(r)return r.type=e.getAttribute("type"),r}function readStyle(e,t){return(0,_xml.pushParseAndPop)({},STYLE_PARSERS,e,t)}function readKeywordList(e,t){return(0,_xml.pushParseAndPop)([],KEYWORDLIST_PARSERS,e,t)}var _default=WMSCapabilities;exports.default=_default;

},{"../xml.js":322,"./XLink.js":98,"./XML.js":99,"./xsd.js":124}],96:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GML=_interopRequireDefault(require("./GML2.js")),_XMLFeature=_interopRequireDefault(require("./XMLFeature.js")),_obj=require("../obj.js"),_array=require("../array.js"),_xml=require("../xml.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function a(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}}(),featureIdentifier="_feature",layerIdentifier="_layer",WMSGetFeatureInfo=function(e){function r(r){var t=e.call(this)||this,a=r||{};return t.featureNS_="http://mapserver.gis.umn.edu/mapserver",t.gmlFormat_=new _GML.default,t.layers_=a.layers?a.layers:null,t}return __extends(r,e),r.prototype.getLayers=function(){return this.layers_},r.prototype.setLayers=function(e){this.layers_=e},r.prototype.readFeatures_=function(e,r){e.setAttribute("namespaceURI",this.featureNS_);var t=e.localName,a=[];if(0===e.childNodes.length)return a;if("msGMLOutput"==t)for(var u=0,o=e.childNodes.length;u<o;u++){var n=e.childNodes[u];if(n.nodeType===Node.ELEMENT_NODE){var i=n,s=r[0],l=layerIdentifier,_=i.localName.replace(l,"");if(!this.layers_||(0,_array.includes)(this.layers_,_)){var f=_+featureIdentifier;s.featureType=f,s.featureNS=this.featureNS_;var p={};p[f]=(0,_xml.makeArrayPusher)(this.gmlFormat_.readFeatureElement,this.gmlFormat_);var d=(0,_xml.makeStructureNS)([s.featureNS,null],p);i.setAttribute("namespaceURI",this.featureNS_);var c=(0,_xml.pushParseAndPop)([],d,i,r,this.gmlFormat_);c&&(0,_array.extend)(a,c)}}}if("FeatureCollection"==t){var m=(0,_xml.pushParseAndPop)([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);m&&(a=m)}return a},r.prototype.readFeaturesFromNode=function(e,r){var t={};return r&&(0,_obj.assign)(t,this.getReadOptions(e,r)),this.readFeatures_(e,[t])},r}(_XMLFeature.default),_default=WMSGetFeatureInfo;exports.default=_default;

},{"../array.js":44,"../obj.js":203,"../xml.js":322,"./GML2.js":79,"./XMLFeature.js":100}],97:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _OWS=_interopRequireDefault(require("./OWS.js")),_XML=_interopRequireDefault(require("./XML.js")),_extent=require("../extent.js"),_xml=require("../xml.js"),_xsd=require("./xsd.js"),_XLink=require("./XLink.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function a(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}}(),NAMESPACE_URIS=[null,"http://www.opengis.net/wmts/1.0"],OWS_NAMESPACE_URIS=[null,"http://www.opengis.net/ows/1.1"],PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Contents:(0,_xml.makeObjectPropertySetter)(readContents)}),WMTSCapabilities=function(e){function r(){var r=e.call(this)||this;return r.owsParser_=new _OWS.default,r}return __extends(r,e),r.prototype.readFromNode=function(e){var r=e.getAttribute("version");r&&(r=r.trim());var t=this.owsParser_.readFromNode(e);return t?(t.version=r,(t=(0,_xml.pushParseAndPop)(t,PARSERS,e,[]))||null):null},r}(_XML.default),CONTENTS_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Layer:(0,_xml.makeObjectPropertyPusher)(readLayer),TileMatrixSet:(0,_xml.makeObjectPropertyPusher)(readTileMatrixSet)}),LAYER_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Style:(0,_xml.makeObjectPropertyPusher)(readStyle),Format:(0,_xml.makeObjectPropertyPusher)(_xsd.readString),TileMatrixSetLink:(0,_xml.makeObjectPropertyPusher)(readTileMatrixSetLink),Dimension:(0,_xml.makeObjectPropertyPusher)(readDimensions),ResourceURL:(0,_xml.makeObjectPropertyPusher)(readResourceUrl)},(0,_xml.makeStructureNS)(OWS_NAMESPACE_URIS,{Title:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Abstract:(0,_xml.makeObjectPropertySetter)(_xsd.readString),WGS84BoundingBox:(0,_xml.makeObjectPropertySetter)(readWgs84BoundingBox),Identifier:(0,_xml.makeObjectPropertySetter)(_xsd.readString)})),STYLE_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{LegendURL:(0,_xml.makeObjectPropertyPusher)(readLegendUrl)},(0,_xml.makeStructureNS)(OWS_NAMESPACE_URIS,{Title:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Identifier:(0,_xml.makeObjectPropertySetter)(_xsd.readString)})),TMS_LINKS_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{TileMatrixSet:(0,_xml.makeObjectPropertySetter)(_xsd.readString),TileMatrixSetLimits:(0,_xml.makeObjectPropertySetter)(readTileMatrixLimitsList)}),TMS_LIMITS_LIST_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{TileMatrixLimits:(0,_xml.makeArrayPusher)(readTileMatrixLimits)}),TMS_LIMITS_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{TileMatrix:(0,_xml.makeObjectPropertySetter)(_xsd.readString),MinTileRow:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),MaxTileRow:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),MinTileCol:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),MaxTileCol:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger)}),DIMENSION_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{Default:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Value:(0,_xml.makeObjectPropertyPusher)(_xsd.readString)},(0,_xml.makeStructureNS)(OWS_NAMESPACE_URIS,{Identifier:(0,_xml.makeObjectPropertySetter)(_xsd.readString)})),WGS84_BBOX_READERS=(0,_xml.makeStructureNS)(OWS_NAMESPACE_URIS,{LowerCorner:(0,_xml.makeArrayPusher)(readCoordinates),UpperCorner:(0,_xml.makeArrayPusher)(readCoordinates)}),TMS_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{WellKnownScaleSet:(0,_xml.makeObjectPropertySetter)(_xsd.readString),TileMatrix:(0,_xml.makeObjectPropertyPusher)(readTileMatrix)},(0,_xml.makeStructureNS)(OWS_NAMESPACE_URIS,{SupportedCRS:(0,_xml.makeObjectPropertySetter)(_xsd.readString),Identifier:(0,_xml.makeObjectPropertySetter)(_xsd.readString)})),TM_PARSERS=(0,_xml.makeStructureNS)(NAMESPACE_URIS,{TopLeftCorner:(0,_xml.makeObjectPropertySetter)(readCoordinates),ScaleDenominator:(0,_xml.makeObjectPropertySetter)(_xsd.readDecimal),TileWidth:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),TileHeight:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),MatrixWidth:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger),MatrixHeight:(0,_xml.makeObjectPropertySetter)(_xsd.readNonNegativeInteger)},(0,_xml.makeStructureNS)(OWS_NAMESPACE_URIS,{Identifier:(0,_xml.makeObjectPropertySetter)(_xsd.readString)}));function readContents(e,r){return(0,_xml.pushParseAndPop)({},CONTENTS_PARSERS,e,r)}function readLayer(e,r){return(0,_xml.pushParseAndPop)({},LAYER_PARSERS,e,r)}function readTileMatrixSet(e,r){return(0,_xml.pushParseAndPop)({},TMS_PARSERS,e,r)}function readStyle(e,r){var t=(0,_xml.pushParseAndPop)({},STYLE_PARSERS,e,r);if(t){var a="true"===e.getAttribute("isDefault");return t.isDefault=a,t}}function readTileMatrixSetLink(e,r){return(0,_xml.pushParseAndPop)({},TMS_LINKS_PARSERS,e,r)}function readDimensions(e,r){return(0,_xml.pushParseAndPop)({},DIMENSION_PARSERS,e,r)}function readResourceUrl(e,r){var t=e.getAttribute("format"),a=e.getAttribute("template"),S=e.getAttribute("resourceType"),i={};return t&&(i.format=t),a&&(i.template=a),S&&(i.resourceType=S),i}function readWgs84BoundingBox(e,r){var t=(0,_xml.pushParseAndPop)([],WGS84_BBOX_READERS,e,r);if(2==t.length)return(0,_extent.boundingExtent)(t)}function readLegendUrl(e,r){var t={};return t.format=e.getAttribute("format"),t.href=(0,_XLink.readHref)(e),t}function readCoordinates(e,r){var t=(0,_xsd.readString)(e).split(/\s+/);if(t&&2==t.length){var a=+t[0],S=+t[1];if(!isNaN(a)&&!isNaN(S))return[a,S]}}function readTileMatrix(e,r){return(0,_xml.pushParseAndPop)({},TM_PARSERS,e,r)}function readTileMatrixLimitsList(e,r){return(0,_xml.pushParseAndPop)([],TMS_LIMITS_LIST_PARSERS,e,r)}function readTileMatrixLimits(e,r){return(0,_xml.pushParseAndPop)({},TMS_LIMITS_PARSERS,e,r)}var _default=WMTSCapabilities;exports.default=_default;

},{"../extent.js":70,"../xml.js":322,"./OWS.js":89,"./XLink.js":98,"./XML.js":99,"./xsd.js":124}],98:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.readHref=readHref;var NAMESPACE_URI="http://www.w3.org/1999/xlink";function readHref(e){return e.getAttributeNS(NAMESPACE_URI,"href")}

},{}],99:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xml=require("../xml.js"),XML=function(){function e(){}return e.prototype.read=function(e){if(e){if("string"==typeof e){var r=(0,_xml.parse)(e);return this.readFromDocument(r)}return(0,_xml.isDocument)(e)?this.readFromDocument(e):this.readFromNode(e)}return null},e.prototype.readFromDocument=function(e){for(var r=e.firstChild;r;r=r.nextSibling)if(r.nodeType==Node.ELEMENT_NODE)return this.readFromNode(r);return null},e.prototype.readFromNode=function(e){},e}(),_default=XML;exports.default=_default;

},{"../xml.js":322}],100:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Feature=_interopRequireDefault(require("../format/Feature.js")),_FormatType=_interopRequireDefault(require("../format/FormatType.js")),_util=require("../util.js"),_array=require("../array.js"),_xml=require("../xml.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function o(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),XMLFeature=function(e){function r(){var r=e.call(this)||this;return r.xmlSerializer_=(0,_xml.getXMLSerializer)(),r}return __extends(r,e),r.prototype.getType=function(){return _FormatType.default.XML},r.prototype.readFeature=function(e,r){if(e){if("string"==typeof e){var t=(0,_xml.parse)(e);return this.readFeatureFromDocument(t,r)}return(0,_xml.isDocument)(e)?this.readFeatureFromDocument(e,r):this.readFeatureFromNode(e,r)}return null},r.prototype.readFeatureFromDocument=function(e,r){var t=this.readFeaturesFromDocument(e,r);return t.length>0?t[0]:null},r.prototype.readFeatureFromNode=function(e,r){return null},r.prototype.readFeatures=function(e,r){if(e){if("string"==typeof e){var t=(0,_xml.parse)(e);return this.readFeaturesFromDocument(t,r)}return(0,_xml.isDocument)(e)?this.readFeaturesFromDocument(e,r):this.readFeaturesFromNode(e,r)}return[]},r.prototype.readFeaturesFromDocument=function(e,r){for(var t=[],o=e.firstChild;o;o=o.nextSibling)o.nodeType==Node.ELEMENT_NODE&&(0,_array.extend)(t,this.readFeaturesFromNode(o,r));return t},r.prototype.readFeaturesFromNode=function(e,r){return(0,_util.abstract)()},r.prototype.readGeometry=function(e,r){if(e){if("string"==typeof e){var t=(0,_xml.parse)(e);return this.readGeometryFromDocument(t,r)}return(0,_xml.isDocument)(e)?this.readGeometryFromDocument(e,r):this.readGeometryFromNode(e,r)}return null},r.prototype.readGeometryFromDocument=function(e,r){return null},r.prototype.readGeometryFromNode=function(e,r){return null},r.prototype.readProjection=function(e){if(e){if("string"==typeof e){var r=(0,_xml.parse)(e);return this.readProjectionFromDocument(r)}return(0,_xml.isDocument)(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}return null},r.prototype.readProjectionFromDocument=function(e){return this.dataProjection},r.prototype.readProjectionFromNode=function(e){return this.dataProjection},r.prototype.writeFeature=function(e,r){var t=this.writeFeatureNode(e,r);return this.xmlSerializer_.serializeToString(t)},r.prototype.writeFeatureNode=function(e,r){return null},r.prototype.writeFeatures=function(e,r){var t=this.writeFeaturesNode(e,r);return this.xmlSerializer_.serializeToString(t)},r.prototype.writeFeaturesNode=function(e,r){return null},r.prototype.writeGeometry=function(e,r){var t=this.writeGeometryNode(e,r);return this.xmlSerializer_.serializeToString(t)},r.prototype.writeGeometryNode=function(e,r){return null},r}(_Feature.default),_default=XMLFeature;exports.default=_default;

},{"../array.js":44,"../format/Feature.js":76,"../format/FormatType.js":77,"../util.js":313,"../xml.js":322}],101:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.and=and,exports.or=or,exports.not=not,exports.bbox=bbox,exports.contains=contains,exports.intersects=intersects,exports.within=within,exports.equalTo=equalTo,exports.notEqualTo=notEqualTo,exports.lessThan=lessThan,exports.lessThanOrEqualTo=lessThanOrEqualTo,exports.greaterThan=greaterThan,exports.greaterThanOrEqualTo=greaterThanOrEqualTo,exports.isNull=isNull,exports.between=between,exports.like=like,exports.during=during;var _And=_interopRequireDefault(require("./filter/And.js")),_Bbox=_interopRequireDefault(require("./filter/Bbox.js")),_Contains=_interopRequireDefault(require("./filter/Contains.js")),_During=_interopRequireDefault(require("./filter/During.js")),_EqualTo=_interopRequireDefault(require("./filter/EqualTo.js")),_GreaterThan=_interopRequireDefault(require("./filter/GreaterThan.js")),_GreaterThanOrEqualTo=_interopRequireDefault(require("./filter/GreaterThanOrEqualTo.js")),_Intersects=_interopRequireDefault(require("./filter/Intersects.js")),_IsBetween=_interopRequireDefault(require("./filter/IsBetween.js")),_IsLike=_interopRequireDefault(require("./filter/IsLike.js")),_IsNull=_interopRequireDefault(require("./filter/IsNull.js")),_LessThan=_interopRequireDefault(require("./filter/LessThan.js")),_LessThanOrEqualTo=_interopRequireDefault(require("./filter/LessThanOrEqualTo.js")),_Not=_interopRequireDefault(require("./filter/Not.js")),_NotEqualTo=_interopRequireDefault(require("./filter/NotEqualTo.js")),_Or=_interopRequireDefault(require("./filter/Or.js")),_Within=_interopRequireDefault(require("./filter/Within.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function and(e){var r=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(_And.default,r))}function or(e){var r=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(_Or.default,r))}function not(e){return new _Not.default(e)}function bbox(e,r,t){return new _Bbox.default(e,r,t)}function contains(e,r,t){return new _Contains.default(e,r,t)}function intersects(e,r,t){return new _Intersects.default(e,r,t)}function within(e,r,t){return new _Within.default(e,r,t)}function equalTo(e,r,t){return new _EqualTo.default(e,r,t)}function notEqualTo(e,r,t){return new _NotEqualTo.default(e,r,t)}function lessThan(e,r){return new _LessThan.default(e,r)}function lessThanOrEqualTo(e,r){return new _LessThanOrEqualTo.default(e,r)}function greaterThan(e,r){return new _GreaterThan.default(e,r)}function greaterThanOrEqualTo(e,r){return new _GreaterThanOrEqualTo.default(e,r)}function isNull(e){return new _IsNull.default(e)}function between(e,r,t){return new _IsBetween.default(e,r,t)}function like(e,r,t,n,u,i){return new _IsLike.default(e,r,t,n,u,i)}function during(e,r,t){return new _During.default(e,r,t)}

},{"./filter/And.js":102,"./filter/Bbox.js":103,"./filter/Contains.js":106,"./filter/During.js":107,"./filter/EqualTo.js":108,"./filter/GreaterThan.js":110,"./filter/GreaterThanOrEqualTo.js":111,"./filter/Intersects.js":112,"./filter/IsBetween.js":113,"./filter/IsLike.js":114,"./filter/IsNull.js":115,"./filter/LessThan.js":116,"./filter/LessThanOrEqualTo.js":117,"./filter/Not.js":119,"./filter/NotEqualTo.js":120,"./filter/Or.js":121,"./filter/Within.js":123}],102:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _LogicalNary=_interopRequireDefault(require("./LogicalNary.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),And=function(t){function e(e){return t.call(this,"And",Array.prototype.slice.call(arguments))||this}return __extends(e,t),e}(_LogicalNary.default),_default=And;exports.default=_default;

},{"./LogicalNary.js":118}],103:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Filter=_interopRequireDefault(require("./Filter.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Bbox=function(e){function t(t,r,n){var o=e.call(this,"BBOX")||this;if(o.geometryName=t,o.extent=r,4!==r.length)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");return o.srsName=n,o}return __extends(t,e),t}(_Filter.default),_default=Bbox;exports.default=_default;

},{"./Filter.js":109}],104:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Filter=_interopRequireDefault(require("./Filter.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Comparison=function(t){function e(e,r){var o=t.call(this,e)||this;return o.propertyName=r,o}return __extends(e,t),e}(_Filter.default),_default=Comparison;exports.default=_default;

},{"./Filter.js":109}],105:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Comparison=_interopRequireDefault(require("./Comparison.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),ComparisonBinary=function(t){function e(e,r,o,n){var u=t.call(this,e,r)||this;return u.expression=o,u.matchCase=n,u}return __extends(e,t),e}(_Comparison.default),_default=ComparisonBinary;exports.default=_default;

},{"./Comparison.js":104}],106:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Spatial=_interopRequireDefault(require("./Spatial.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Contains=function(t){function e(e,n,r){return t.call(this,"Contains",e,n,r)||this}return __extends(e,t),e}(_Spatial.default),_default=Contains;exports.default=_default;

},{"./Spatial.js":122}],107:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Comparison=_interopRequireDefault(require("./Comparison.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),During=function(t){function e(e,r,n){var o=t.call(this,"During",e)||this;return o.begin=r,o.end=n,o}return __extends(e,t),e}(_Comparison.default),_default=During;exports.default=_default;

},{"./Comparison.js":104}],108:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ComparisonBinary=_interopRequireDefault(require("./ComparisonBinary.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),EqualTo=function(t){function e(e,r,o){return t.call(this,"PropertyIsEqualTo",e,r,o)||this}return __extends(e,t),e}(_ComparisonBinary.default),_default=EqualTo;exports.default=_default;

},{"./ComparisonBinary.js":105}],109:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Filter=function(){function t(t){this.tagName_=t}return t.prototype.getTagName=function(){return this.tagName_},t}(),_default=Filter;exports.default=_default;

},{}],110:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ComparisonBinary=_interopRequireDefault(require("./ComparisonBinary.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),GreaterThan=function(t){function e(e,r){return t.call(this,"PropertyIsGreaterThan",e,r)||this}return __extends(e,t),e}(_ComparisonBinary.default),_default=GreaterThan;exports.default=_default;

},{"./ComparisonBinary.js":105}],111:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ComparisonBinary=_interopRequireDefault(require("./ComparisonBinary.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),GreaterThanOrEqualTo=function(t){function e(e,r){return t.call(this,"PropertyIsGreaterThanOrEqualTo",e,r)||this}return __extends(e,t),e}(_ComparisonBinary.default),_default=GreaterThanOrEqualTo;exports.default=_default;

},{"./ComparisonBinary.js":105}],112:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Spatial=_interopRequireDefault(require("./Spatial.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Intersects=function(t){function e(e,r,n){return t.call(this,"Intersects",e,r,n)||this}return __extends(e,t),e}(_Spatial.default),_default=Intersects;exports.default=_default;

},{"./Spatial.js":122}],113:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Comparison=_interopRequireDefault(require("./Comparison.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),IsBetween=function(e){function t(t,r,o){var n=e.call(this,"PropertyIsBetween",t)||this;return n.lowerBoundary=r,n.upperBoundary=o,n}return __extends(t,e),t}(_Comparison.default),_default=IsBetween;exports.default=_default;

},{"./Comparison.js":104}],114:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Comparison=_interopRequireDefault(require("./Comparison.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),IsLike=function(e){function t(t,r,o,n,i,u){var a=e.call(this,"PropertyIsLike",t)||this;return a.pattern=r,a.wildCard=void 0!==o?o:"*",a.singleChar=void 0!==n?n:".",a.escapeChar=void 0!==i?i:"!",a.matchCase=u,a}return __extends(t,e),t}(_Comparison.default),_default=IsLike;exports.default=_default;

},{"./Comparison.js":104}],115:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Comparison=_interopRequireDefault(require("./Comparison.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),IsNull=function(t){function e(e){return t.call(this,"PropertyIsNull",e)||this}return __extends(e,t),e}(_Comparison.default),_default=IsNull;exports.default=_default;

},{"./Comparison.js":104}],116:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ComparisonBinary=_interopRequireDefault(require("./ComparisonBinary.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),LessThan=function(t){function e(e,r){return t.call(this,"PropertyIsLessThan",e,r)||this}return __extends(e,t),e}(_ComparisonBinary.default),_default=LessThan;exports.default=_default;

},{"./ComparisonBinary.js":105}],117:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ComparisonBinary=_interopRequireDefault(require("./ComparisonBinary.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),LessThanOrEqualTo=function(t){function e(e,r){return t.call(this,"PropertyIsLessThanOrEqualTo",e,r)||this}return __extends(e,t),e}(_ComparisonBinary.default),_default=LessThanOrEqualTo;exports.default=_default;

},{"./ComparisonBinary.js":105}],118:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Filter=_interopRequireDefault(require("./Filter.js")),_asserts=require("../../asserts.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),LogicalNary=function(t){function e(e,r){var o=t.call(this,e)||this;return o.conditions=r,(0,_asserts.assert)(o.conditions.length>=2,57),o}return __extends(e,t),e}(_Filter.default),_default=LogicalNary;exports.default=_default;

},{"../../asserts.js":45,"./Filter.js":109}],119:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Filter=_interopRequireDefault(require("./Filter.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Not=function(t){function e(e){var r=t.call(this,"Not")||this;return r.condition=e,r}return __extends(e,t),e}(_Filter.default),_default=Not;exports.default=_default;

},{"./Filter.js":109}],120:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ComparisonBinary=_interopRequireDefault(require("./ComparisonBinary.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),NotEqualTo=function(t){function e(e,o,r){return t.call(this,"PropertyIsNotEqualTo",e,o,r)||this}return __extends(e,t),e}(_ComparisonBinary.default),_default=NotEqualTo;exports.default=_default;

},{"./ComparisonBinary.js":105}],121:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _LogicalNary=_interopRequireDefault(require("./LogicalNary.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Or=function(t){function e(e){return t.call(this,"Or",Array.prototype.slice.call(arguments))||this}return __extends(e,t),e}(_LogicalNary.default),_default=Or;exports.default=_default;

},{"./LogicalNary.js":118}],122:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Filter=_interopRequireDefault(require("./Filter.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Spatial=function(t){function e(e,r,o,n){var u=t.call(this,e)||this;return u.geometryName=r||"the_geom",u.geometry=o,u.srsName=n,u}return __extends(e,t),e}(_Filter.default),_default=Spatial;exports.default=_default;

},{"./Filter.js":109}],123:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Spatial=_interopRequireDefault(require("./Spatial.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Within=function(t){function e(e,r,n){return t.call(this,"Within",e,r,n)||this}return __extends(e,t),e}(_Spatial.default),_default=Within;exports.default=_default;

},{"./Spatial.js":122}],124:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.readBoolean=readBoolean,exports.readBooleanString=readBooleanString,exports.readDateTime=readDateTime,exports.readDecimal=readDecimal,exports.readDecimalString=readDecimalString,exports.readNonNegativeInteger=readNonNegativeInteger,exports.readNonNegativeIntegerString=readNonNegativeIntegerString,exports.readString=readString,exports.writeBooleanTextNode=writeBooleanTextNode,exports.writeCDATASection=writeCDATASection,exports.writeDateTimeTextNode=writeDateTimeTextNode,exports.writeDecimalTextNode=writeDecimalTextNode,exports.writeNonNegativeIntegerTextNode=writeNonNegativeIntegerTextNode,exports.writeStringTextNode=writeStringTextNode;var _xml=require("../xml.js"),_string=require("../string.js");function readBoolean(e){return readBooleanString((0,_xml.getAllTextContent)(e,!1))}function readBooleanString(e){var t=/^\s*(true|1)|(false|0)\s*$/.exec(e);return t?void 0!==t[1]||!1:void 0}function readDateTime(e){var t=(0,_xml.getAllTextContent)(e,!1),r=Date.parse(t);return isNaN(r)?void 0:r/1e3}function readDecimal(e){return readDecimalString((0,_xml.getAllTextContent)(e,!1))}function readDecimalString(e){var t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(e);return t?parseFloat(t[1]):void 0}function readNonNegativeInteger(e){return readNonNegativeIntegerString((0,_xml.getAllTextContent)(e,!1))}function readNonNegativeIntegerString(e){var t=/^\s*(\d+)\s*$/.exec(e);return t?parseInt(t[1],10):void 0}function readString(e){return(0,_xml.getAllTextContent)(e,!1).trim()}function writeBooleanTextNode(e,t){writeStringTextNode(e,t?"1":"0")}function writeCDATASection(e,t){e.appendChild((0,_xml.getDocument)().createCDATASection(t))}function writeDateTimeTextNode(e,t){var r=new Date(1e3*t),n=r.getUTCFullYear()+"-"+(0,_string.padNumber)(r.getUTCMonth()+1,2)+"-"+(0,_string.padNumber)(r.getUTCDate(),2)+"T"+(0,_string.padNumber)(r.getUTCHours(),2)+":"+(0,_string.padNumber)(r.getUTCMinutes(),2)+":"+(0,_string.padNumber)(r.getUTCSeconds(),2)+"Z";e.appendChild((0,_xml.getDocument)().createTextNode(n))}function writeDecimalTextNode(e,t){var r=t.toPrecision();e.appendChild((0,_xml.getDocument)().createTextNode(r))}function writeNonNegativeIntegerTextNode(e,t){var r=t.toString();e.appendChild((0,_xml.getDocument)().createTextNode(r))}function writeStringTextNode(e,t){e.appendChild((0,_xml.getDocument)().createTextNode(t))}

},{"../string.js":287,"../xml.js":322}],125:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TRUE=TRUE,exports.FALSE=FALSE,exports.VOID=VOID,exports.memoizeOne=memoizeOne;var _array=require("./array.js");function TRUE(){return!0}function FALSE(){return!1}function VOID(){}function memoizeOne(e){var r,t,n,o=!1;return function(){var i=Array.prototype.slice.call(arguments);return o&&this===n&&(0,_array.equals)(i,t)||(o=!0,n=this,t=i,r=e.apply(this,arguments)),r}}

},{"./array.js":44}],126:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Circle",{enumerable:!0,get:function(){return _Circle.default}}),Object.defineProperty(exports,"Geometry",{enumerable:!0,get:function(){return _Geometry.default}}),Object.defineProperty(exports,"GeometryCollection",{enumerable:!0,get:function(){return _GeometryCollection.default}}),Object.defineProperty(exports,"LinearRing",{enumerable:!0,get:function(){return _LinearRing.default}}),Object.defineProperty(exports,"LineString",{enumerable:!0,get:function(){return _LineString.default}}),Object.defineProperty(exports,"MultiLineString",{enumerable:!0,get:function(){return _MultiLineString.default}}),Object.defineProperty(exports,"MultiPoint",{enumerable:!0,get:function(){return _MultiPoint.default}}),Object.defineProperty(exports,"MultiPolygon",{enumerable:!0,get:function(){return _MultiPolygon.default}}),Object.defineProperty(exports,"Point",{enumerable:!0,get:function(){return _Point.default}}),Object.defineProperty(exports,"Polygon",{enumerable:!0,get:function(){return _Polygon.default}}),Object.defineProperty(exports,"SimpleGeometry",{enumerable:!0,get:function(){return _SimpleGeometry.default}});var _Circle=_interopRequireDefault(require("./geom/Circle.js")),_Geometry=_interopRequireDefault(require("./geom/Geometry.js")),_GeometryCollection=_interopRequireDefault(require("./geom/GeometryCollection.js")),_LinearRing=_interopRequireDefault(require("./geom/LinearRing.js")),_LineString=_interopRequireDefault(require("./geom/LineString.js")),_MultiLineString=_interopRequireDefault(require("./geom/MultiLineString.js")),_MultiPoint=_interopRequireDefault(require("./geom/MultiPoint.js")),_MultiPolygon=_interopRequireDefault(require("./geom/MultiPolygon.js")),_Point=_interopRequireDefault(require("./geom/Point.js")),_Polygon=_interopRequireDefault(require("./geom/Polygon.js")),_SimpleGeometry=_interopRequireDefault(require("./geom/SimpleGeometry.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}

},{"./geom/Circle.js":127,"./geom/Geometry.js":128,"./geom/GeometryCollection.js":129,"./geom/LineString.js":132,"./geom/LinearRing.js":133,"./geom/MultiLineString.js":134,"./geom/MultiPoint.js":135,"./geom/MultiPolygon.js":136,"./geom/Point.js":137,"./geom/Polygon.js":138,"./geom/SimpleGeometry.js":139}],127:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GeometryType=_interopRequireDefault(require("./GeometryType.js")),_SimpleGeometry=_interopRequireDefault(require("./SimpleGeometry.js")),_extent=require("../extent.js"),_deflate=require("./flat/deflate.js"),_transform=require("./flat/transform.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Circle=function(t){function e(e,r,o){var i=t.call(this)||this;if(void 0!==o&&void 0===r)i.setFlatCoordinates(o,e);else{var n=r||0;i.setCenterAndRadius(e,n,o)}return i}return __extends(e,t),e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),void 0,this.layout)},e.prototype.closestPointXY=function(t,e,r,o){var i=this.flatCoordinates,n=t-i[0],s=e-i[1],a=n*n+s*s;if(a<o){if(0===a)for(var u=0;u<this.stride;++u)r[u]=i[u];else{var d=this.getRadius()/Math.sqrt(a);r[0]=i[0]+d*n,r[1]=i[1]+d*s;for(u=2;u<this.stride;++u)r[u]=i[u]}return r.length=this.stride,a}return o},e.prototype.containsXY=function(t,e){var r=this.flatCoordinates,o=t-r[0],i=e-r[1];return o*o+i*i<=this.getRadiusSquared_()},e.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.computeExtent=function(t){var e=this.flatCoordinates,r=e[this.stride]-e[0];return(0,_extent.createOrUpdate)(e[0]-r,e[1]-r,e[0]+r,e[1]+r,t)},e.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},e.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e},e.prototype.getType=function(){return _GeometryType.default.CIRCLE},e.prototype.intersectsExtent=function(t){var e=this.getExtent();if((0,_extent.intersects)(t,e)){var r=this.getCenter();return t[0]<=r[0]&&t[2]>=r[0]||(t[1]<=r[1]&&t[3]>=r[1]||(0,_extent.forEachCorner)(t,this.intersectsCoordinate.bind(this)))}return!1},e.prototype.setCenter=function(t){var e=this.stride,r=this.flatCoordinates[e]-this.flatCoordinates[0],o=t.slice();o[e]=o[0]+r;for(var i=1;i<e;++i)o[e+i]=t[i];this.setFlatCoordinates(this.layout,o),this.changed()},e.prototype.setCenterAndRadius=function(t,e,r){this.setLayout(r,t,0),this.flatCoordinates||(this.flatCoordinates=[]);var o=this.flatCoordinates,i=(0,_deflate.deflateCoordinate)(o,0,t,this.stride);o[i++]=o[0]+e;for(var n=1,s=this.stride;n<s;++n)o[i++]=o[n];o.length=i,this.changed()},e.prototype.getCoordinates=function(){return null},e.prototype.setCoordinates=function(t,e){},e.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()},e.prototype.rotate=function(t,e){var r=this.getCenter(),o=this.getStride();this.setCenter((0,_transform.rotate)(r,0,r.length,o,t,e,r)),this.changed()},e.prototype.translate=function(t,e){var r=this.getCenter(),o=this.getStride();this.setCenter((0,_transform.translate)(r,0,r.length,o,t,e,r)),this.changed()},e}(_SimpleGeometry.default);Circle.prototype.transform;var _default=Circle;exports.default=_default;

},{"../extent.js":70,"./GeometryType.js":131,"./SimpleGeometry.js":139,"./flat/deflate.js":144,"./flat/transform.js":158}],128:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Object=_interopRequireDefault(require("../Object.js")),_Units=_interopRequireDefault(require("../proj/Units.js")),_util=require("../util.js"),_transform=require("../transform.js"),_extent=require("../extent.js"),_proj=require("../proj.js"),_functions=require("../functions.js"),_transform2=require("./flat/transform.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),tmpTransform=(0,_transform.create)(),Geometry=function(t){function e(){var e=t.call(this)||this;return e.extent_=(0,_extent.createEmpty)(),e.extentRevision_=-1,e.simplifiedGeometryMaxMinSquaredTolerance=0,e.simplifiedGeometryRevision=0,e.simplifyTransformedInternal=(0,_functions.memoizeOne)(function(t,e,r){if(!r)return this.getSimplifiedGeometry(e);var n=this.clone();return n.applyTransform(r),n.getSimplifiedGeometry(e)}),e}return __extends(e,t),e.prototype.simplifyTransformed=function(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)},e.prototype.clone=function(){return(0,_util.abstract)()},e.prototype.closestPointXY=function(t,e,r,n){return(0,_util.abstract)()},e.prototype.containsXY=function(t,e){var r=this.getClosestPoint([t,e]);return r[0]===t&&r[1]===e},e.prototype.getClosestPoint=function(t,e){var r=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],r,1/0),r},e.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},e.prototype.computeExtent=function(t){return(0,_util.abstract)()},e.prototype.getExtent=function(t){if(this.extentRevision_!=this.getRevision()){var e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&(0,_extent.createOrUpdateEmpty)(e),this.extentRevision_=this.getRevision()}return(0,_extent.returnOrUpdate)(this.extent_,t)},e.prototype.rotate=function(t,e){(0,_util.abstract)()},e.prototype.scale=function(t,e,r){(0,_util.abstract)()},e.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},e.prototype.getSimplifiedGeometry=function(t){return(0,_util.abstract)()},e.prototype.getType=function(){return(0,_util.abstract)()},e.prototype.applyTransform=function(t){(0,_util.abstract)()},e.prototype.intersectsExtent=function(t){return(0,_util.abstract)()},e.prototype.translate=function(t,e){(0,_util.abstract)()},e.prototype.transform=function(t,e){var r=(0,_proj.get)(t),n=r.getUnits()==_Units.default.TILE_PIXELS?function(t,n,o){var i=r.getExtent(),s=r.getWorldExtent(),u=(0,_extent.getHeight)(s)/(0,_extent.getHeight)(i);return(0,_transform.compose)(tmpTransform,s[0],s[3],u,-u,0,0,0),(0,_transform2.transform2D)(t,0,t.length,o,tmpTransform,n),(0,_proj.getTransform)(r,e)(t,n,o)}:(0,_proj.getTransform)(r,e);return this.applyTransform(n),this},e}(_Object.default),_default=Geometry;exports.default=_default;

},{"../Object.js":28,"../extent.js":70,"../functions.js":125,"../proj.js":205,"../proj/Units.js":207,"../transform.js":311,"../util.js":313,"./flat/transform.js":158}],129:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_Geometry=_interopRequireDefault(require("./Geometry.js")),_GeometryType=_interopRequireDefault(require("./GeometryType.js")),_extent=require("../extent.js"),_events=require("../events.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),GeometryCollection=function(e){function t(t){var r=e.call(this)||this;return r.geometries_=t||null,r.changeEventsKeys_=[],r.listenGeometriesChange_(),r}return __extends(t,e),t.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(_events.unlistenByKey),this.changeEventsKeys_.length=0},t.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var e=0,t=this.geometries_.length;e<t;++e)this.changeEventsKeys_.push((0,_events.listen)(this.geometries_[e],_EventType.default.CHANGE,this.changed,this))},t.prototype.clone=function(){var e=new t(null);return e.setGeometries(this.geometries_),e},t.prototype.closestPointXY=function(e,t,r,n){if(n<(0,_extent.closestSquaredDistanceXY)(this.getExtent(),e,t))return n;for(var i=this.geometries_,o=0,s=i.length;o<s;++o)n=i[o].closestPointXY(e,t,r,n);return n},t.prototype.containsXY=function(e,t){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)if(r[n].containsXY(e,t))return!0;return!1},t.prototype.computeExtent=function(e){(0,_extent.createOrUpdateEmpty)(e);for(var t=this.geometries_,r=0,n=t.length;r<n;++r)(0,_extent.extend)(e,t[r].getExtent());return e},t.prototype.getGeometries=function(){return cloneGeometries(this.geometries_)},t.prototype.getGeometriesArray=function(){return this.geometries_},t.prototype.getGeometriesArrayRecursive=function(){for(var e=[],t=this.geometries_,r=0,n=t.length;r<n;++r)t[r].getType()===this.getType()?e=e.concat(t[r].getGeometriesArrayRecursive()):e.push(t[r]);return e},t.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var r=[],n=this.geometries_,i=!1,o=0,s=n.length;o<s;++o){var u=n[o],a=u.getSimplifiedGeometry(e);r.push(a),a!==u&&(i=!0)}if(i){var p=new t(null);return p.setGeometriesArray(r),p}return this.simplifiedGeometryMaxMinSquaredTolerance=e,this},t.prototype.getType=function(){return _GeometryType.default.GEOMETRY_COLLECTION},t.prototype.intersectsExtent=function(e){for(var t=this.geometries_,r=0,n=t.length;r<n;++r)if(t[r].intersectsExtent(e))return!0;return!1},t.prototype.isEmpty=function(){return 0===this.geometries_.length},t.prototype.rotate=function(e,t){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].rotate(e,t);this.changed()},t.prototype.scale=function(e,t,r){var n=r;n||(n=(0,_extent.getCenter)(this.getExtent()));for(var i=this.geometries_,o=0,s=i.length;o<s;++o)i[o].scale(e,t,n);this.changed()},t.prototype.setGeometries=function(e){this.setGeometriesArray(cloneGeometries(e))},t.prototype.setGeometriesArray=function(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()},t.prototype.applyTransform=function(e){for(var t=this.geometries_,r=0,n=t.length;r<n;++r)t[r].applyTransform(e);this.changed()},t.prototype.translate=function(e,t){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].translate(e,t);this.changed()},t.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),e.prototype.disposeInternal.call(this)},t}(_Geometry.default);function cloneGeometries(e){for(var t=[],r=0,n=e.length;r<n;++r)t.push(e[r].clone());return t}var _default=GeometryCollection;exports.default=_default;

},{"../events.js":64,"../events/EventType.js":66,"../extent.js":70,"./Geometry.js":128,"./GeometryType.js":131}],130:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};exports.default=_default;

},{}],131:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};exports.default=_default;

},{}],132:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GeometryLayout=_interopRequireDefault(require("./GeometryLayout.js")),_GeometryType=_interopRequireDefault(require("./GeometryType.js")),_SimpleGeometry=_interopRequireDefault(require("./SimpleGeometry.js")),_closest=require("./flat/closest.js"),_extent=require("../extent.js"),_deflate=require("./flat/deflate.js"),_simplify=require("./flat/simplify.js"),_array=require("../array.js"),_segments=require("./flat/segments.js"),_inflate=require("./flat/inflate.js"),_interpolate=require("./flat/interpolate.js"),_intersectsextent=require("./flat/intersectsextent.js"),_length=require("./flat/length.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),LineString=function(t){function e(e,i){var o=t.call(this)||this;return o.flatMidpoint_=null,o.flatMidpointRevision_=-1,o.maxDelta_=-1,o.maxDeltaRevision_=-1,void 0===i||Array.isArray(e[0])?o.setCoordinates(e,i):o.setFlatCoordinates(i,e),o}return __extends(e,t),e.prototype.appendCoordinate=function(t){this.flatCoordinates?(0,_array.extend)(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,i,o){return o<(0,_extent.closestSquaredDistanceXY)(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,_closest.maxSquaredDelta)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,_closest.assignClosestPoint)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,o))},e.prototype.forEachSegment=function(t){return(0,_segments.forEach)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,e){if(this.layout!=_GeometryLayout.default.XYM&&this.layout!=_GeometryLayout.default.XYZM)return null;var i=void 0!==e&&e;return(0,_interpolate.lineStringCoordinateAtM)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i)},e.prototype.getCoordinates=function(){return(0,_inflate.inflateCoordinates)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,e){return(0,_interpolate.interpolatePoint)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)},e.prototype.getLength=function(){return(0,_length.lineStringLength)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[];return i.length=(0,_simplify.douglasPeucker)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new e(i,_GeometryLayout.default.XY)},e.prototype.getType=function(){return _GeometryType.default.LINE_STRING},e.prototype.intersectsExtent=function(t){return(0,_intersectsextent.intersectsLineString)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,_deflate.deflateCoordinates)(this.flatCoordinates,0,t,this.stride),this.changed()},e}(_SimpleGeometry.default),_default=LineString;exports.default=_default;

},{"../array.js":44,"../extent.js":70,"./GeometryLayout.js":130,"./GeometryType.js":131,"./SimpleGeometry.js":139,"./flat/closest.js":142,"./flat/deflate.js":144,"./flat/inflate.js":147,"./flat/interpolate.js":149,"./flat/intersectsextent.js":150,"./flat/length.js":151,"./flat/segments.js":154,"./flat/simplify.js":155}],133:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GeometryLayout=_interopRequireDefault(require("./GeometryLayout.js")),_GeometryType=_interopRequireDefault(require("./GeometryType.js")),_SimpleGeometry=_interopRequireDefault(require("./SimpleGeometry.js")),_closest=require("./flat/closest.js"),_extent=require("../extent.js"),_deflate=require("./flat/deflate.js"),_simplify=require("./flat/simplify.js"),_inflate=require("./flat/inflate.js"),_area=require("./flat/area.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),LinearRing=function(t){function e(e,i){var r=t.call(this)||this;return r.maxDelta_=-1,r.maxDeltaRevision_=-1,void 0===i||Array.isArray(e[0])?r.setCoordinates(e,i):r.setFlatCoordinates(i,e),r}return __extends(e,t),e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,i,r){return r<(0,_extent.closestSquaredDistanceXY)(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,_closest.maxSquaredDelta)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,_closest.assignClosestPoint)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,r))},e.prototype.getArea=function(){return(0,_area.linearRing)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinates=function(){return(0,_inflate.inflateCoordinates)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[];return i.length=(0,_simplify.douglasPeucker)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new e(i,_GeometryLayout.default.XY)},e.prototype.getType=function(){return _GeometryType.default.LINEAR_RING},e.prototype.intersectsExtent=function(t){return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,_deflate.deflateCoordinates)(this.flatCoordinates,0,t,this.stride),this.changed()},e}(_SimpleGeometry.default),_default=LinearRing;exports.default=_default;

},{"../extent.js":70,"./GeometryLayout.js":130,"./GeometryType.js":131,"./SimpleGeometry.js":139,"./flat/area.js":140,"./flat/closest.js":142,"./flat/deflate.js":144,"./flat/inflate.js":147,"./flat/simplify.js":155}],134:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GeometryLayout=_interopRequireDefault(require("./GeometryLayout.js")),_GeometryType=_interopRequireDefault(require("./GeometryType.js")),_LineString=_interopRequireDefault(require("./LineString.js")),_SimpleGeometry=_interopRequireDefault(require("./SimpleGeometry.js")),_closest=require("./flat/closest.js"),_extent=require("../extent.js"),_deflate=require("./flat/deflate.js"),_simplify=require("./flat/simplify.js"),_array=require("../array.js"),_inflate=require("./flat/inflate.js"),_interpolate=require("./flat/interpolate.js"),_intersectsextent=require("./flat/intersectsextent.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),MultiLineString=function(t){function e(e,i,r){var n=t.call(this)||this;if(n.ends_=[],n.maxDelta_=-1,n.maxDeltaRevision_=-1,Array.isArray(e[0]))n.setCoordinates(e,i);else if(void 0!==i&&r)n.setFlatCoordinates(i,e),n.ends_=r;else{for(var s=n.getLayout(),o=e,a=[],l=[],u=0,d=o.length;u<d;++u){var f=o[u];0===u&&(s=f.getLayout()),(0,_array.extend)(a,f.getFlatCoordinates()),l.push(a.length)}n.setFlatCoordinates(s,a),n.ends_=l}return n}return __extends(e,t),e.prototype.appendLineString=function(t){this.flatCoordinates?(0,_array.extend)(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,i,r){return r<(0,_extent.closestSquaredDistanceXY)(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,_closest.arrayMaxSquaredDelta)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,_closest.assignClosestArrayPoint)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,r))},e.prototype.getCoordinateAtM=function(t,e,i){if(this.layout!=_GeometryLayout.default.XYM&&this.layout!=_GeometryLayout.default.XYZM||0===this.flatCoordinates.length)return null;var r=void 0!==e&&e,n=void 0!==i&&i;return(0,_interpolate.lineStringsCoordinateAtM)(this.flatCoordinates,0,this.ends_,this.stride,t,r,n)},e.prototype.getCoordinates=function(){return(0,_inflate.inflateCoordinatesArray)(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new _LineString.default(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,i=this.layout,r=[],n=0,s=0,o=e.length;s<o;++s){var a=e[s],l=new _LineString.default(t.slice(n,a),i);r.push(l),n=a}return r},e.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,i=0,r=this.ends_,n=this.stride,s=0,o=r.length;s<o;++s){var a=r[s],l=(0,_interpolate.interpolatePoint)(e,i,a,n,.5);(0,_array.extend)(t,l),i=a}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],r=[];return i.length=(0,_simplify.douglasPeuckerArray)(this.flatCoordinates,0,this.ends_,this.stride,t,i,0,r),new e(i,_GeometryLayout.default.XY,r)},e.prototype.getType=function(){return _GeometryType.default.MULTI_LINE_STRING},e.prototype.intersectsExtent=function(t){return(0,_intersectsextent.intersectsLineStringArray)(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=(0,_deflate.deflateCoordinatesArray)(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},e}(_SimpleGeometry.default),_default=MultiLineString;exports.default=_default;

},{"../array.js":44,"../extent.js":70,"./GeometryLayout.js":130,"./GeometryType.js":131,"./LineString.js":132,"./SimpleGeometry.js":139,"./flat/closest.js":142,"./flat/deflate.js":144,"./flat/inflate.js":147,"./flat/interpolate.js":149,"./flat/intersectsextent.js":150,"./flat/simplify.js":155}],135:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GeometryType=_interopRequireDefault(require("./GeometryType.js")),_Point=_interopRequireDefault(require("./Point.js")),_SimpleGeometry=_interopRequireDefault(require("./SimpleGeometry.js")),_extent=require("../extent.js"),_deflate=require("./flat/deflate.js"),_array=require("../array.js"),_inflate=require("./flat/inflate.js"),_math=require("../math.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),MultiPoint=function(t){function e(e,r){var o=t.call(this)||this;return r&&!Array.isArray(e[0])?o.setFlatCoordinates(r,e):o.setCoordinates(e,r),o}return __extends(e,t),e.prototype.appendPoint=function(t){this.flatCoordinates?(0,_array.extend)(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,o){if(o<(0,_extent.closestSquaredDistanceXY)(this.getExtent(),t,e))return o;for(var i=this.flatCoordinates,n=this.stride,a=0,s=i.length;a<s;a+=n){var l=(0,_math.squaredDistance)(t,e,i[a],i[a+1]);if(l<o){o=l;for(var u=0;u<n;++u)r[u]=i[a+u];r.length=n}}return o},e.prototype.getCoordinates=function(){return(0,_inflate.inflateCoordinates)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new _Point.default(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,r=this.stride,o=[],i=0,n=t.length;i<n;i+=r){var a=new _Point.default(t.slice(i,i+r),e);o.push(a)}return o},e.prototype.getType=function(){return _GeometryType.default.MULTI_POINT},e.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,r=this.stride,o=0,i=e.length;o<i;o+=r){var n=e[o],a=e[o+1];if((0,_extent.containsXY)(t,n,a))return!0}return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,_deflate.deflateCoordinates)(this.flatCoordinates,0,t,this.stride),this.changed()},e}(_SimpleGeometry.default),_default=MultiPoint;exports.default=_default;

},{"../array.js":44,"../extent.js":70,"../math.js":201,"./GeometryType.js":131,"./Point.js":137,"./SimpleGeometry.js":139,"./flat/deflate.js":144,"./flat/inflate.js":147}],136:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GeometryLayout=_interopRequireDefault(require("./GeometryLayout.js")),_GeometryType=_interopRequireDefault(require("./GeometryType.js")),_MultiPoint=_interopRequireDefault(require("./MultiPoint.js")),_Polygon=_interopRequireDefault(require("./Polygon.js")),_SimpleGeometry=_interopRequireDefault(require("./SimpleGeometry.js")),_closest=require("./flat/closest.js"),_extent=require("../extent.js"),_deflate=require("./flat/deflate.js"),_array=require("../array.js"),_interiorpoint=require("./flat/interiorpoint.js"),_inflate=require("./flat/inflate.js"),_intersectsextent=require("./flat/intersectsextent.js"),_orient=require("./flat/orient.js"),_area=require("./flat/area.js"),_center=require("./flat/center.js"),_contains=require("./flat/contains.js"),_simplify=require("./flat/simplify.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),MultiPolygon=function(t){function e(e,i,r){var s=t.call(this)||this;if(s.endss_=[],s.flatInteriorPointsRevision_=-1,s.flatInteriorPoints_=null,s.maxDelta_=-1,s.maxDeltaRevision_=-1,s.orientedRevision_=-1,s.orientedFlatCoordinates_=null,!r&&!Array.isArray(e[0])){for(var n=s.getLayout(),o=e,a=[],l=[],d=0,u=o.length;d<u;++d){var h=o[d];0===d&&(n=h.getLayout());for(var _=a.length,f=h.getEnds(),y=0,g=f.length;y<g;++y)f[y]+=_;(0,_array.extend)(a,h.getFlatCoordinates()),l.push(f)}i=n,e=a,r=l}return void 0!==i&&r?(s.setFlatCoordinates(i,e),s.endss_=r):s.setCoordinates(e,i),s}return __extends(e,t),e.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var i=this.flatCoordinates.length;(0,_array.extend)(this.flatCoordinates,t.getFlatCoordinates());for(var r=0,s=(e=t.getEnds().slice()).length;r<s;++r)e[r]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,i=new Array(t),r=0;r<t;++r)i[r]=this.endss_[r].slice();return new e(this.flatCoordinates.slice(),this.layout,i)},e.prototype.closestPointXY=function(t,e,i,r){return r<(0,_extent.closestSquaredDistanceXY)(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,_closest.multiArrayMaxSquaredDelta)(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,_closest.assignClosestMultiArrayPoint)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,r))},e.prototype.containsXY=function(t,e){return(0,_contains.linearRingssContainsXY)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},e.prototype.getArea=function(){return(0,_area.linearRingss)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),(0,_orient.orientLinearRingsArray)(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,(0,_inflate.inflateMultiCoordinatesArray)(e,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=(0,_center.linearRingss)(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=(0,_interiorpoint.getInteriorPointsOfMultiArray)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new _MultiPoint.default(this.getFlatInteriorPoints().slice(),_GeometryLayout.default.XYM)},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;(0,_orient.linearRingssAreOriented)(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=(0,_orient.orientLinearRingsArray)(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],r=[];return i.length=(0,_simplify.quantizeMultiArray)(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),i,0,r),new e(i,_GeometryLayout.default.XY,r)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var i=this.endss_[t-1];e=i[i.length-1]}var r=this.endss_[t].slice(),s=r[r.length-1];if(0!==e)for(var n=0,o=r.length;n<o;++n)r[n]-=e;return new _Polygon.default(this.flatCoordinates.slice(e,s),this.layout,r)},e.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.endss_,r=[],s=0,n=0,o=i.length;n<o;++n){var a=i[n].slice(),l=a[a.length-1];if(0!==s)for(var d=0,u=a.length;d<u;++d)a[d]-=s;var h=new _Polygon.default(e.slice(s,l),t,a);r.push(h),s=l}return r},e.prototype.getType=function(){return _GeometryType.default.MULTI_POLYGON},e.prototype.intersectsExtent=function(t){return(0,_intersectsextent.intersectsLinearRingMultiArray)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var i=(0,_deflate.deflateMultiCoordinatesArray)(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{var r=i[i.length-1];this.flatCoordinates.length=0===r.length?0:r[r.length-1]}this.changed()},e}(_SimpleGeometry.default),_default=MultiPolygon;exports.default=_default;

},{"../array.js":44,"../extent.js":70,"./GeometryLayout.js":130,"./GeometryType.js":131,"./MultiPoint.js":135,"./Polygon.js":138,"./SimpleGeometry.js":139,"./flat/area.js":140,"./flat/center.js":141,"./flat/closest.js":142,"./flat/contains.js":143,"./flat/deflate.js":144,"./flat/inflate.js":147,"./flat/interiorpoint.js":148,"./flat/intersectsextent.js":150,"./flat/orient.js":152,"./flat/simplify.js":155}],137:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GeometryType=_interopRequireDefault(require("./GeometryType.js")),_SimpleGeometry=_interopRequireDefault(require("./SimpleGeometry.js")),_extent=require("../extent.js"),_deflate=require("./flat/deflate.js"),_math=require("../math.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),Point=function(t){function e(e,o){var r=t.call(this)||this;return r.setCoordinates(e,o),r}return __extends(e,t),e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,o,r){var n=this.flatCoordinates,i=(0,_math.squaredDistance)(t,e,n[0],n[1]);if(i<r){for(var a=this.stride,s=0;s<a;++s)o[s]=n[s];return o.length=a,i}return r},e.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},e.prototype.computeExtent=function(t){return(0,_extent.createOrUpdateFromCoordinate)(this.flatCoordinates,t)},e.prototype.getType=function(){return _GeometryType.default.POINT},e.prototype.intersectsExtent=function(t){return(0,_extent.containsXY)(t,this.flatCoordinates[0],this.flatCoordinates[1])},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,_deflate.deflateCoordinate)(this.flatCoordinates,0,t,this.stride),this.changed()},e}(_SimpleGeometry.default),_default=Point;exports.default=_default;

},{"../extent.js":70,"../math.js":201,"./GeometryType.js":131,"./SimpleGeometry.js":139,"./flat/deflate.js":144}],138:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.circular=circular,exports.fromExtent=fromExtent,exports.fromCircle=fromCircle,exports.makeRegular=makeRegular,exports.default=void 0;var _GeometryLayout=_interopRequireDefault(require("./GeometryLayout.js")),_GeometryType=_interopRequireDefault(require("./GeometryType.js")),_LinearRing=_interopRequireDefault(require("./LinearRing.js")),_Point=_interopRequireDefault(require("./Point.js")),_SimpleGeometry=_interopRequireDefault(require("./SimpleGeometry.js")),_closest=require("./flat/closest.js"),_extent=require("../extent.js"),_deflate=require("./flat/deflate.js"),_array=require("../array.js"),_interiorpoint=require("./flat/interiorpoint.js"),_inflate=require("./flat/inflate.js"),_intersectsextent=require("./flat/intersectsextent.js"),_orient=require("./flat/orient.js"),_area=require("./flat/area.js"),_contains=require("./flat/contains.js"),_math=require("../math.js"),_simplify=require("./flat/simplify.js"),_sphere=require("../sphere.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Polygon=function(t){function e(e,i,r){var n=t.call(this)||this;return n.ends_=[],n.flatInteriorPointRevision_=-1,n.flatInteriorPoint_=null,n.maxDelta_=-1,n.maxDeltaRevision_=-1,n.orientedRevision_=-1,n.orientedFlatCoordinates_=null,void 0!==i&&r?(n.setFlatCoordinates(i,e),n.ends_=r):n.setCoordinates(e,i),n}return __extends(e,t),e.prototype.appendLinearRing=function(t){this.flatCoordinates?(0,_array.extend)(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,i,r){return r<(0,_extent.closestSquaredDistanceXY)(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,_closest.arrayMaxSquaredDelta)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,_closest.assignClosestArrayPoint)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,r))},e.prototype.containsXY=function(t,e){return(0,_contains.linearRingsContainsXY)(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},e.prototype.getArea=function(){return(0,_area.linearRings)(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),(0,_orient.orientLinearRings)(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,(0,_inflate.inflateCoordinatesArray)(e,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=(0,_extent.getCenter)(this.getExtent());this.flatInteriorPoint_=(0,_interiorpoint.getInteriorPointOfArray)(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},e.prototype.getInteriorPoint=function(){return new _Point.default(this.getFlatInteriorPoint(),_GeometryLayout.default.XYM)},e.prototype.getLinearRingCount=function(){return this.ends_.length},e.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new _LinearRing.default(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.ends_,r=[],n=0,o=0,s=i.length;o<s;++o){var a=i[o],l=new _LinearRing.default(e.slice(n,a),t);r.push(l),n=a}return r},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;(0,_orient.linearRingsAreOriented)(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=(0,_orient.orientLinearRings)(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],r=[];return i.length=(0,_simplify.quantizeArray)(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),i,0,r),new e(i,_GeometryLayout.default.XY,r)},e.prototype.getType=function(){return _GeometryType.default.POLYGON},e.prototype.intersectsExtent=function(t){return(0,_intersectsextent.intersectsLinearRingArray)(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=(0,_deflate.deflateCoordinatesArray)(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},e}(_SimpleGeometry.default),_default=Polygon;function circular(t,e,i,r){for(var n=i||32,o=[],s=0;s<n;++s)(0,_array.extend)(o,(0,_sphere.offset)(t,e,2*Math.PI*s/n,r));return o.push(o[0],o[1]),new Polygon(o,_GeometryLayout.default.XY,[o.length])}function fromExtent(t){var e=t[0],i=t[1],r=t[2],n=t[3],o=[e,i,e,n,r,n,r,i,e,i];return new Polygon(o,_GeometryLayout.default.XY,[o.length])}function fromCircle(t,e,i){for(var r=e||32,n=t.getStride(),o=t.getLayout(),s=t.getCenter(),a=n*(r+1),l=new Array(a),u=0;u<a;u+=n){l[u]=0,l[u+1]=0;for(var d=2;d<n;d++)l[u+d]=s[d]}var h=[l.length],f=new Polygon(l,o,h);return makeRegular(f,s,t.getRadius(),i),f}function makeRegular(t,e,i,r){for(var n=t.getFlatCoordinates(),o=t.getStride(),s=n.length/o-1,a=r||0,l=0;l<=s;++l){var u=l*o,d=a+2*(0,_math.modulo)(l,s)*Math.PI/s;n[u]=e[0]+i*Math.cos(d),n[u+1]=e[1]+i*Math.sin(d)}t.changed()}exports.default=_default;

},{"../array.js":44,"../extent.js":70,"../math.js":201,"../sphere.js":286,"./GeometryLayout.js":130,"./GeometryType.js":131,"./LinearRing.js":133,"./Point.js":137,"./SimpleGeometry.js":139,"./flat/area.js":140,"./flat/closest.js":142,"./flat/contains.js":143,"./flat/deflate.js":144,"./flat/inflate.js":147,"./flat/interiorpoint.js":148,"./flat/intersectsextent.js":150,"./flat/orient.js":152,"./flat/simplify.js":155}],139:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStrideForLayout=getStrideForLayout,exports.transformGeom2D=transformGeom2D,exports.default=void 0;var _Geometry=_interopRequireDefault(require("./Geometry.js")),_GeometryLayout=_interopRequireDefault(require("./GeometryLayout.js")),_util=require("../util.js"),_extent=require("../extent.js"),_transform=require("./flat/transform.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),SimpleGeometry=function(t){function e(){var e=t.call(this)||this;return e.layout=_GeometryLayout.default.XY,e.stride=2,e.flatCoordinates=null,e}return __extends(e,t),e.prototype.computeExtent=function(t){return(0,_extent.createOrUpdateFromFlatCoordinates)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinates=function(){return(0,_util.abstract)()},e.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},e.prototype.getFlatCoordinates=function(){return this.flatCoordinates},e.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},e.prototype.getLayout=function(){return this.layout},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},e.prototype.getSimplifiedGeometryInternal=function(t){return this},e.prototype.getStride=function(){return this.stride},e.prototype.setFlatCoordinates=function(t,e){this.stride=getStrideForLayout(t),this.layout=t,this.flatCoordinates=e},e.prototype.setCoordinates=function(t,e){(0,_util.abstract)()},e.prototype.setLayout=function(t,e,r){var o;if(t)o=getStrideForLayout(t);else{for(var i=0;i<r;++i){if(0===e.length)return this.layout=_GeometryLayout.default.XY,void(this.stride=2);e=e[0]}t=getLayoutForStride(o=e.length)}this.layout=t,this.stride=o},e.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},e.prototype.rotate=function(t,e){var r=this.getFlatCoordinates();if(r){var o=this.getStride();(0,_transform.rotate)(r,0,r.length,o,t,e,r),this.changed()}},e.prototype.scale=function(t,e,r){var o=e;void 0===o&&(o=t);var i=r;i||(i=(0,_extent.getCenter)(this.getExtent()));var n=this.getFlatCoordinates();if(n){var a=this.getStride();(0,_transform.scale)(n,0,n.length,a,t,o,i,n),this.changed()}},e.prototype.translate=function(t,e){var r=this.getFlatCoordinates();if(r){var o=this.getStride();(0,_transform.translate)(r,0,r.length,o,t,e,r),this.changed()}},e}(_Geometry.default);function getLayoutForStride(t){var e;return 2==t?e=_GeometryLayout.default.XY:3==t?e=_GeometryLayout.default.XYZ:4==t&&(e=_GeometryLayout.default.XYZM),e}function getStrideForLayout(t){var e;return t==_GeometryLayout.default.XY?e=2:t==_GeometryLayout.default.XYZ||t==_GeometryLayout.default.XYM?e=3:t==_GeometryLayout.default.XYZM&&(e=4),e}function transformGeom2D(t,e,r){var o=t.getFlatCoordinates();if(o){var i=t.getStride();return(0,_transform.transform2D)(o,0,o.length,i,e,r)}return null}var _default=SimpleGeometry;exports.default=_default;

},{"../extent.js":70,"../util.js":313,"./Geometry.js":128,"./GeometryLayout.js":130,"./flat/transform.js":158}],140:[function(require,module,exports){
"use strict";function linearRing(n,r,e,i){for(var a=0,s=n[e-i],t=n[e-i+1];r<e;r+=i){var l=n[r],g=n[r+1];a+=t*l-s*g,s=l,t=g}return a/2}function linearRings(n,r,e,i){for(var a=0,s=0,t=e.length;s<t;++s){var l=e[s];a+=linearRing(n,r,l,i),r=l}return a}function linearRingss(n,r,e,i){for(var a=0,s=0,t=e.length;s<t;++s){var l=e[s];a+=linearRings(n,r,l,i),r=l[l.length-1]}return a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.linearRing=linearRing,exports.linearRings=linearRings,exports.linearRingss=linearRingss;

},{}],141:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.linearRingss=linearRingss;var _extent=require("../../extent.js");function linearRingss(e,t,r,n){for(var s=[],a=(0,_extent.createEmpty)(),i=0,o=r.length;i<o;++i){var l=r[i];a=(0,_extent.createOrUpdateFromFlatCoordinates)(e,t,l[0],n),s.push((a[0]+a[2])/2,(a[1]+a[3])/2),t=l[l.length-1]}return s}

},{"../../extent.js":70}],142:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.maxSquaredDelta=maxSquaredDelta,exports.arrayMaxSquaredDelta=arrayMaxSquaredDelta,exports.multiArrayMaxSquaredDelta=multiArrayMaxSquaredDelta,exports.assignClosestPoint=assignClosestPoint,exports.assignClosestArrayPoint=assignClosestArrayPoint,exports.assignClosestMultiArrayPoint=assignClosestMultiArrayPoint;var _math=require("../../math.js");function assignClosest(a,r,t,e,s,n,i){var o,l=a[r],u=a[r+1],f=a[t]-l,g=a[t+1]-u;if(0===f&&0===g)o=r;else{var h=((s-l)*f+(n-u)*g)/(f*f+g*g);if(h>1)o=t;else{if(h>0){for(var x=0;x<e;++x)i[x]=(0,_math.lerp)(a[r+x],a[t+x],h);return void(i.length=e)}o=r}}for(x=0;x<e;++x)i[x]=a[o+x];i.length=e}function maxSquaredDelta(a,r,t,e,s){var n=a[r],i=a[r+1];for(r+=e;r<t;r+=e){var o=a[r],l=a[r+1],u=(0,_math.squaredDistance)(n,i,o,l);u>s&&(s=u),n=o,i=l}return s}function arrayMaxSquaredDelta(a,r,t,e,s){for(var n=0,i=t.length;n<i;++n){var o=t[n];s=maxSquaredDelta(a,r,o,e,s),r=o}return s}function multiArrayMaxSquaredDelta(a,r,t,e,s){for(var n=0,i=t.length;n<i;++n){var o=t[n];s=arrayMaxSquaredDelta(a,r,o,e,s),r=o[o.length-1]}return s}function assignClosestPoint(a,r,t,e,s,n,i,o,l,u,f){if(r==t)return u;var g,h;if(0===s){if((h=(0,_math.squaredDistance)(i,o,a[r],a[r+1]))<u){for(g=0;g<e;++g)l[g]=a[r+g];return l.length=e,h}return u}for(var x=f||[NaN,NaN],d=r+e;d<t;)if(assignClosest(a,d-e,d,e,i,o,x),(h=(0,_math.squaredDistance)(i,o,x[0],x[1]))<u){for(u=h,g=0;g<e;++g)l[g]=x[g];l.length=e,d+=e}else d+=e*Math.max((Math.sqrt(h)-Math.sqrt(u))/s|0,1);if(n&&(assignClosest(a,t-e,r,e,i,o,x),(h=(0,_math.squaredDistance)(i,o,x[0],x[1]))<u)){for(u=h,g=0;g<e;++g)l[g]=x[g];l.length=e}return u}function assignClosestArrayPoint(a,r,t,e,s,n,i,o,l,u,f){for(var g=f||[NaN,NaN],h=0,x=t.length;h<x;++h){var d=t[h];u=assignClosestPoint(a,r,d,e,s,n,i,o,l,u,g),r=d}return u}function assignClosestMultiArrayPoint(a,r,t,e,s,n,i,o,l,u,f){for(var g=f||[NaN,NaN],h=0,x=t.length;h<x;++h){var d=t[h];u=assignClosestArrayPoint(a,r,d,e,s,n,i,o,l,u,g),r=d[d.length-1]}return u}

},{"../../math.js":201}],143:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.linearRingContainsExtent=linearRingContainsExtent,exports.linearRingContainsXY=linearRingContainsXY,exports.linearRingsContainsXY=linearRingsContainsXY,exports.linearRingssContainsXY=linearRingssContainsXY;var _extent=require("../../extent.js");function linearRingContainsExtent(n,i,r,t,e){return!(0,_extent.forEachCorner)(e,function(e){return!linearRingContainsXY(n,i,r,t,e[0],e[1])})}function linearRingContainsXY(n,i,r,t,e,a){for(var s=0,o=n[r-t],l=n[r-t+1];i<r;i+=t){var g=n[i],u=n[i+1];l<=a?u>a&&(g-o)*(a-l)-(e-o)*(u-l)>0&&s++:u<=a&&(g-o)*(a-l)-(e-o)*(u-l)<0&&s--,o=g,l=u}return 0!==s}function linearRingsContainsXY(n,i,r,t,e,a){if(0===r.length)return!1;if(!linearRingContainsXY(n,i,r[0],t,e,a))return!1;for(var s=1,o=r.length;s<o;++s)if(linearRingContainsXY(n,r[s-1],r[s],t,e,a))return!1;return!0}function linearRingssContainsXY(n,i,r,t,e,a){if(0===r.length)return!1;for(var s=0,o=r.length;s<o;++s){var l=r[s];if(linearRingsContainsXY(n,i,l,t,e,a))return!0;i=l[l.length-1]}return!1}

},{"../../extent.js":70}],144:[function(require,module,exports){
"use strict";function deflateCoordinate(e,r,t,o){for(var a=0,n=t.length;a<n;++a)e[r++]=t[a];return r}function deflateCoordinates(e,r,t,o){for(var a=0,n=t.length;a<n;++a)for(var d=t[a],l=0;l<o;++l)e[r++]=d[l];return r}function deflateCoordinatesArray(e,r,t,o,a){for(var n=a||[],d=0,l=0,f=t.length;l<f;++l){var i=deflateCoordinates(e,r,t[l],o);n[d++]=i,r=i}return n.length=d,n}function deflateMultiCoordinatesArray(e,r,t,o,a){for(var n=a||[],d=0,l=0,f=t.length;l<f;++l){var i=deflateCoordinatesArray(e,r,t[l],o,n[d]);n[d++]=i,r=i[i.length-1]}return n.length=d,n}Object.defineProperty(exports,"__esModule",{value:!0}),exports.deflateCoordinate=deflateCoordinate,exports.deflateCoordinates=deflateCoordinates,exports.deflateCoordinatesArray=deflateCoordinatesArray,exports.deflateMultiCoordinatesArray=deflateMultiCoordinatesArray;

},{}],145:[function(require,module,exports){
"use strict";function flipXY(r,e,o,t,i,f){var v,l;void 0!==i?(v=i,l=void 0!==f?f:0):(v=[],l=0);for(var p=e;p<o;){var a=r[p++];v[l++]=r[p++],v[l++]=a;for(var n=2;n<t;++n)v[l++]=r[p++]}return v.length=l,v}Object.defineProperty(exports,"__esModule",{value:!0}),exports.flipXY=flipXY;

},{}],146:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.greatCircleArc=greatCircleArc,exports.meridian=meridian,exports.parallel=parallel;var _proj=require("../../proj.js"),_math=require("../../math.js");function line(t,a,r){for(var e,n,o,i,s,h,p=[],u=t(0),c=t(1),_=a(u),l=a(c),m=[c,u],M=[l,_],g=[1,0],d={},f=1e5;--f>0&&g.length>0;)o=g.pop(),u=m.pop(),_=M.pop(),(h=o.toString())in d||(p.push(_[0],_[1]),d[h]=!0),i=g.pop(),c=m.pop(),l=M.pop(),n=a(e=t(s=(o+i)/2)),(0,_math.squaredSegmentDistance)(n[0],n[1],_[0],_[1],l[0],l[1])<r?(p.push(l[0],l[1]),d[h=i.toString()]=!0):(g.push(i,s,s,o),M.push(l,n,n,_),m.push(c,e,e,u));return p}function greatCircleArc(t,a,r,e,n,o){var i=(0,_proj.get)("EPSG:4326"),s=Math.cos((0,_math.toRadians)(a)),h=Math.sin((0,_math.toRadians)(a)),p=Math.cos((0,_math.toRadians)(e)),u=Math.sin((0,_math.toRadians)(e)),c=Math.cos((0,_math.toRadians)(r-t)),_=Math.sin((0,_math.toRadians)(r-t)),l=h*u+s*p*c;return line(function(a){if(1<=l)return[r,e];var n=a*Math.acos(l),o=Math.cos(n),i=Math.sin(n),m=_*p,M=s*u-h*p*c,g=Math.atan2(m,M),d=Math.asin(h*o+s*i*Math.cos(g)),f=(0,_math.toRadians)(t)+Math.atan2(Math.sin(g)*i*s,o-h*Math.sin(d));return[(0,_math.toDegrees)(f),(0,_math.toDegrees)(d)]},(0,_proj.getTransform)(i,n),o)}function meridian(t,a,r,e,n){var o=(0,_proj.get)("EPSG:4326");return line(function(e){return[t,a+(r-a)*e]},(0,_proj.getTransform)(o,e),n)}function parallel(t,a,r,e,n){var o=(0,_proj.get)("EPSG:4326");return line(function(e){return[a+(r-a)*e,t]},(0,_proj.getTransform)(o,e),n)}

},{"../../math.js":201,"../../proj.js":205}],147:[function(require,module,exports){
"use strict";function inflateCoordinates(r,t,e,n,o){for(var a=void 0!==o?o:[],i=0,l=t;l<e;l+=n)a[i++]=r.slice(l,l+n);return a.length=i,a}function inflateCoordinatesArray(r,t,e,n,o){for(var a=void 0!==o?o:[],i=0,l=0,s=e.length;l<s;++l){var f=e[l];a[i++]=inflateCoordinates(r,t,f,n,a[i]),t=f}return a.length=i,a}function inflateMultiCoordinatesArray(r,t,e,n,o){for(var a=void 0!==o?o:[],i=0,l=0,s=e.length;l<s;++l){var f=e[l];a[i++]=inflateCoordinatesArray(r,t,f,n,a[i]),t=f[f.length-1]}return a.length=i,a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.inflateCoordinates=inflateCoordinates,exports.inflateCoordinatesArray=inflateCoordinatesArray,exports.inflateMultiCoordinatesArray=inflateMultiCoordinatesArray;

},{}],148:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getInteriorPointOfArray=getInteriorPointOfArray,exports.getInteriorPointsOfMultiArray=getInteriorPointsOfMultiArray;var _contains=require("./contains.js"),_array=require("../../array.js");function getInteriorPointOfArray(r,t,e,n,a,o,i){for(var s,u,f,g,y,l,c,v=a[o+1],O=[],P=0,h=e.length;P<h;++P){var p=e[P];for(g=r[p-n],l=r[p-n+1],s=t;s<p;s+=n)y=r[s],c=r[s+1],(v<=l&&c<=v||l<=v&&v<=c)&&(f=(v-l)/(c-l)*(y-g)+g,O.push(f)),g=y,l=c}var A=NaN,I=-1/0;for(O.sort(_array.numberSafeCompareFunction),g=O[0],s=1,u=O.length;s<u;++s){y=O[s];var _=Math.abs(y-g);_>I&&(f=(g+y)/2,(0,_contains.linearRingsContainsXY)(r,t,e,n,f,v)&&(A=f,I=_)),g=y}return isNaN(A)&&(A=a[o]),i?(i.push(A,v,I),i):[A,v,I]}function getInteriorPointsOfMultiArray(r,t,e,n,a){for(var o=[],i=0,s=e.length;i<s;++i){var u=e[i];o=getInteriorPointOfArray(r,t,u,n,a,2*i,o),t=u[u.length-1]}return o}

},{"../../array.js":44,"./contains.js":143}],149:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.interpolatePoint=interpolatePoint,exports.lineStringCoordinateAtM=lineStringCoordinateAtM,exports.lineStringsCoordinateAtM=lineStringsCoordinateAtM;var _array=require("../../array.js"),_math=require("../../math.js");function interpolatePoint(r,e,t,n,i,a,l){var o,u,s=(t-e)/n;if(1===s)o=e;else if(2===s)o=e,u=i;else if(0!==s){for(var f=r[e],v=r[e+1],h=0,p=[0],c=e+n;c<t;c+=n){var d=r[c],g=r[c+1];h+=Math.sqrt((d-f)*(d-f)+(g-v)*(g-v)),p.push(h),f=d,v=g}var M=i*h,A=(0,_array.binarySearch)(p,M);A<0?(u=(M-p[-A-2])/(p[-A-1]-p[-A-2]),o=e+(-A-2)*n):o=e+A*n}var S=l>1?l:2,C=a||new Array(S);for(c=0;c<S;++c)C[c]=void 0===o?NaN:void 0===u?r[o+c]:(0,_math.lerp)(r[o+c],r[o+n+c],u);return C}function lineStringCoordinateAtM(r,e,t,n,i,a){if(t==e)return null;var l;if(i<r[e+n-1])return a?((l=r.slice(e,e+n))[n-1]=i,l):null;if(r[t-1]<i)return a?((l=r.slice(t-n,t))[n-1]=i,l):null;if(i==r[e+n-1])return r.slice(e,e+n);for(var o=e/n,u=t/n;o<u;){var s=o+u>>1;i<r[(s+1)*n-1]?u=s:o=s+1}var f=r[o*n-1];if(i==f)return r.slice((o-1)*n,(o-1)*n+n);var v=(i-f)/(r[(o+1)*n-1]-f);l=[];for(var h=0;h<n-1;++h)l.push((0,_math.lerp)(r[(o-1)*n+h],r[o*n+h],v));return l.push(i),l}function lineStringsCoordinateAtM(r,e,t,n,i,a,l){if(l)return lineStringCoordinateAtM(r,e,t[t.length-1],n,i,a);var o;if(i<r[n-1])return a?((o=r.slice(0,n))[n-1]=i,o):null;if(r[r.length-1]<i)return a?((o=r.slice(r.length-n))[n-1]=i,o):null;for(var u=0,s=t.length;u<s;++u){var f=t[u];if(e!=f){if(i<r[e+n-1])return null;if(i<=r[f-1])return lineStringCoordinateAtM(r,e,f,n,i,!1);e=f}}return null}

},{"../../array.js":44,"../../math.js":201}],150:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.intersectsLineString=intersectsLineString,exports.intersectsLineStringArray=intersectsLineStringArray,exports.intersectsLinearRing=intersectsLinearRing,exports.intersectsLinearRingArray=intersectsLinearRingArray,exports.intersectsLinearRingMultiArray=intersectsLinearRingMultiArray;var _extent=require("../../extent.js"),_segments=require("./segments.js"),_contains=require("./contains.js");function intersectsLineString(n,e,t,r,i){var s=(0,_extent.extendFlatCoordinates)((0,_extent.createEmpty)(),n,e,t,r);return!!(0,_extent.intersects)(i,s)&&(!!(0,_extent.containsExtent)(i,s)||(s[0]>=i[0]&&s[2]<=i[2]||(s[1]>=i[1]&&s[3]<=i[3]||(0,_segments.forEach)(n,e,t,r,function(n,e){return(0,_extent.intersectsSegment)(i,n,e)}))))}function intersectsLineStringArray(n,e,t,r,i){for(var s=0,a=t.length;s<a;++s){if(intersectsLineString(n,e,t[s],r,i))return!0;e=t[s]}return!1}function intersectsLinearRing(n,e,t,r,i){return!!intersectsLineString(n,e,t,r,i)||(!!(0,_contains.linearRingContainsXY)(n,e,t,r,i[0],i[1])||(!!(0,_contains.linearRingContainsXY)(n,e,t,r,i[0],i[3])||(!!(0,_contains.linearRingContainsXY)(n,e,t,r,i[2],i[1])||!!(0,_contains.linearRingContainsXY)(n,e,t,r,i[2],i[3]))))}function intersectsLinearRingArray(n,e,t,r,i){if(!intersectsLinearRing(n,e,t[0],r,i))return!1;if(1===t.length)return!0;for(var s=1,a=t.length;s<a;++s)if((0,_contains.linearRingContainsExtent)(n,t[s-1],t[s],r,i)&&!intersectsLineString(n,t[s-1],t[s],r,i))return!1;return!0}function intersectsLinearRingMultiArray(n,e,t,r,i){for(var s=0,a=t.length;s<a;++s){var c=t[s];if(intersectsLinearRingArray(n,e,c,r,i))return!0;e=c[c.length-1]}return!1}

},{"../../extent.js":70,"./contains.js":143,"./segments.js":154}],151:[function(require,module,exports){
"use strict";function lineStringLength(n,e,t,r){for(var i=n[e],g=n[e+1],a=0,h=e+r;h<t;h+=r){var l=n[h],o=n[h+1];a+=Math.sqrt((l-i)*(l-i)+(o-g)*(o-g)),i=l,g=o}return a}function linearRingLength(n,e,t,r){var i=lineStringLength(n,e,t,r),g=n[t-r]-n[e],a=n[t-r+1]-n[e+1];return i+=Math.sqrt(g*g+a*a)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.lineStringLength=lineStringLength,exports.linearRingLength=linearRingLength;

},{}],152:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.linearRingIsClockwise=linearRingIsClockwise,exports.linearRingsAreOriented=linearRingsAreOriented,exports.linearRingssAreOriented=linearRingssAreOriented,exports.orientLinearRings=orientLinearRings,exports.orientLinearRingsArray=orientLinearRingsArray;var _reverse=require("./reverse.js");function linearRingIsClockwise(r,e,n,i){for(var t=!0,s=0;s<i;++s)if(r[e+s]!==r[n-i+s]){t=!1;break}t&&(n-=i);var a=findCornerVertex(r,e,n,i),o=a-i;o<e&&(o=n-i);var l=a+i;l>=n&&(l=e);var g=r[o],f=r[o+1],v=r[a],u=r[a+1],R=r[l],c=r[l+1];return v*c+g*u+f*R-(f*v+u*R+g*c)<0}function findCornerVertex(r,e,n,i){for(var t=-1,s=1/0,a=1/0,o=e;o<n;o+=i){var l=r[o],g=r[o+1];g>s||(g==s&&l>=a||(t=o,s=g,a=l))}return t}function linearRingsAreOriented(r,e,n,i,t){for(var s=void 0!==t&&t,a=0,o=n.length;a<o;++a){var l=n[a],g=linearRingIsClockwise(r,e,l,i);if(0===a){if(s&&g||!s&&!g)return!1}else if(s&&!g||!s&&g)return!1;e=l}return!0}function linearRingssAreOriented(r,e,n,i,t){for(var s=0,a=n.length;s<a;++s){var o=n[s];if(!linearRingsAreOriented(r,e,o,i,t))return!1;o.length&&(e=o[o.length-1])}return!0}function orientLinearRings(r,e,n,i,t){for(var s=void 0!==t&&t,a=0,o=n.length;a<o;++a){var l=n[a],g=linearRingIsClockwise(r,e,l,i);(0===a?s&&g||!s&&!g:s&&!g||!s&&g)&&(0,_reverse.coordinates)(r,e,l,i),e=l}return e}function orientLinearRingsArray(r,e,n,i,t){for(var s=0,a=n.length;s<a;++s)e=orientLinearRings(r,e,n[s],i,t);return e}

},{"./reverse.js":153}],153:[function(require,module,exports){
"use strict";function coordinates(e,o,r,t){for(;o<r-t;){for(var s=0;s<t;++s){var a=e[o+s];e[o+s]=e[r-t+s],e[r-t+s]=a}o+=t,r-=t}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.coordinates=coordinates;

},{}],154:[function(require,module,exports){
"use strict";function forEach(r,e,o,t,f){for(var c,u=[r[e],r[e+1]],a=[];e+t<o;e+=t){if(a[0]=r[e+t],a[1]=r[e+t+1],c=f(u,a))return c;u[0]=a[0],u[1]=a[1]}return!1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.forEach=forEach;

},{}],155:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.simplifyLineString=simplifyLineString,exports.douglasPeucker=douglasPeucker,exports.douglasPeuckerArray=douglasPeuckerArray,exports.douglasPeuckerMultiArray=douglasPeuckerMultiArray,exports.radialDistance=radialDistance,exports.snap=snap,exports.quantize=quantize,exports.quantizeArray=quantizeArray,exports.quantizeMultiArray=quantizeMultiArray;var _math=require("../../math.js");function simplifyLineString(r,e,a,t,u,n,i){var s=void 0!==i?i:[];return n||(a=radialDistance(r,e,a,t,u,s,0),r=s,e=0,t=2),s.length=douglasPeucker(r,e,a,t,u,s,0),s}function douglasPeucker(r,e,a,t,u,n,i){var s=(a-e)/t;if(s<3){for(;e<a;e+=t)n[i++]=r[e],n[i++]=r[e+1];return i}var o=new Array(s);o[0]=1,o[s-1]=1;for(var l=[e,a-t],p=0;l.length>0;){for(var c=l.pop(),f=l.pop(),g=0,d=r[f],v=r[f+1],h=r[c],y=r[c+1],A=f+t;A<c;A+=t){var q=r[A],P=r[A+1],k=(0,_math.squaredSegmentDistance)(q,P,d,v,h,y);k>g&&(p=A,g=k)}g>u&&(o[(p-e)/t]=1,f+t<p&&l.push(f,p),p+t<c&&l.push(p,c))}for(A=0;A<s;++A)o[A]&&(n[i++]=r[e+A*t],n[i++]=r[e+A*t+1]);return i}function douglasPeuckerArray(r,e,a,t,u,n,i,s){for(var o=0,l=a.length;o<l;++o){var p=a[o];i=douglasPeucker(r,e,p,t,u,n,i),s.push(i),e=p}return i}function douglasPeuckerMultiArray(r,e,a,t,u,n,i,s){for(var o=0,l=a.length;o<l;++o){var p=a[o],c=[];i=douglasPeuckerArray(r,e,p,t,u,n,i,c),s.push(c),e=p[p.length-1]}return i}function radialDistance(r,e,a,t,u,n,i){if(a<=e+t){for(;e<a;e+=t)n[i++]=r[e],n[i++]=r[e+1];return i}var s=r[e],o=r[e+1];n[i++]=s,n[i++]=o;var l=s,p=o;for(e+=t;e<a;e+=t)l=r[e],p=r[e+1],(0,_math.squaredDistance)(s,o,l,p)>u&&(n[i++]=l,n[i++]=p,s=l,o=p);return l==s&&p==o||(n[i++]=l,n[i++]=p),i}function snap(r,e){return e*Math.round(r/e)}function quantize(r,e,a,t,u,n,i){if(e==a)return i;var s,o,l=snap(r[e],u),p=snap(r[e+1],u);e+=t,n[i++]=l,n[i++]=p;do{if(s=snap(r[e],u),o=snap(r[e+1],u),(e+=t)==a)return n[i++]=s,n[i++]=o,i}while(s==l&&o==p);for(;e<a;){var c=snap(r[e],u),f=snap(r[e+1],u);if(e+=t,c!=s||f!=o){var g=s-l,d=o-p,v=c-l,h=f-p;g*h==d*v&&(g<0&&v<g||g==v||g>0&&v>g)&&(d<0&&h<d||d==h||d>0&&h>d)?(s=c,o=f):(n[i++]=s,n[i++]=o,l=s,p=o,s=c,o=f)}}return n[i++]=s,n[i++]=o,i}function quantizeArray(r,e,a,t,u,n,i,s){for(var o=0,l=a.length;o<l;++o){var p=a[o];i=quantize(r,e,p,t,u,n,i),s.push(i),e=p}return i}function quantizeMultiArray(r,e,a,t,u,n,i,s){for(var o=0,l=a.length;o<l;++o){var p=a[o],c=[];i=quantizeArray(r,e,p,t,u,n,i,c),s.push(c),e=p[p.length-1]}return i}

},{"../../math.js":201}],156:[function(require,module,exports){
"use strict";function matchingChunk(t,e,r,n,a){var o,h,i,u,c,s,v,d,f,g=r,k=r,m=0,p=0,C=r;for(o=r;o<n;o+=a){var M=e[o],l=e[o+1];void 0!==u&&(d=M-u,f=l-c,i=Math.sqrt(d*d+f*f),void 0!==s&&(p+=h,Math.acos((s*d+v*f)/(h*i))>t&&(p>m&&(m=p,g=C,k=o),p=0,C=o-a)),h=i,s=d,v=f),u=M,c=l}return(p+=i)>m?[C,o]:[g,k]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.matchingChunk=matchingChunk;

},{}],157:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.drawTextOnPath=drawTextOnPath;var _math=require("../../math.js"),_transform=require("./transform.js");function drawTextOnPath(t,a,r,e,h,o,n,M,s,f,v,P){var i,l=[];if(P){var p=(0,_transform.rotate)(t,a,r,e,P,[t[a],t[a+1]]);i=p[0]>p[p.length-e]}else i=t[a]>t[r-e];for(var u,m,w=h.length,_=t[a],d=t[a+1],I=t[a+=e],x=t[a+1],q=0,O=Math.sqrt(Math.pow(I-_,2)+Math.pow(x-d,2)),c=!1,j=0;j<w;++j){for(var T=h[u=i?w-j-1:j],b=M*s(f,T,v),g=o+b/2;a<r-e&&q+O<g;)_=I,d=x,I=t[a+=e],x=t[a+1],q+=O,O=Math.sqrt(Math.pow(I-_,2)+Math.pow(x-d,2));var y=g-q,k=Math.atan2(x-d,I-_);if(i&&(k+=k>0?-Math.PI:Math.PI),void 0!==m){var z=k-m;if(c=c||0!==z,z+=z>Math.PI?-2*Math.PI:z<-Math.PI?2*Math.PI:0,Math.abs(z)>n)return null}m=k;var A=y/O,B=(0,_math.lerp)(_,I,A),C=(0,_math.lerp)(d,x,A);l[u]=[B,C,b/2,k,T],o+=b}return c?l:[[l[0][0],l[0][1],l[0][2],l[0][3],h]]}

},{"../../math.js":201,"./transform.js":158}],158:[function(require,module,exports){
"use strict";function transform2D(r,t,e,a,n,o){for(var s=o||[],l=0,f=t;f<e;f+=a){var u=r[f],v=r[f+1];s[l++]=n[0]*u+n[2]*v+n[4],s[l++]=n[1]*u+n[3]*v+n[5]}return o&&s.length!=l&&(s.length=l),s}function rotate(r,t,e,a,n,o,s){for(var l=s||[],f=Math.cos(n),u=Math.sin(n),v=o[0],c=o[1],h=0,g=t;g<e;g+=a){var i=r[g]-v,p=r[g+1]-c;l[h++]=v+i*f-p*u,l[h++]=c+i*u+p*f;for(var x=g+2;x<g+a;++x)l[h++]=r[x]}return s&&l.length!=h&&(l.length=h),l}function scale(r,t,e,a,n,o,s,l){for(var f=l||[],u=s[0],v=s[1],c=0,h=t;h<e;h+=a){var g=r[h]-u,i=r[h+1]-v;f[c++]=u+n*g,f[c++]=v+o*i;for(var p=h+2;p<h+a;++p)f[c++]=r[p]}return l&&f.length!=c&&(f.length=c),f}function translate(r,t,e,a,n,o,s){for(var l=s||[],f=0,u=t;u<e;u+=a){l[f++]=r[u]+n,l[f++]=r[u+1]+o;for(var v=u+2;v<u+a;++v)l[f++]=r[v]}return s&&l.length!=f&&(l.length=f),l}Object.defineProperty(exports,"__esModule",{value:!0}),exports.transform2D=transform2D,exports.rotate=rotate,exports.scale=scale,exports.translate=translate;

},{}],159:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PASSIVE_EVENT_LISTENERS=exports.IMAGE_DECODE=exports.WORKER_OFFSCREEN_CANVAS=exports.DEVICE_PIXEL_RATIO=exports.MAC=exports.WEBKIT=exports.SAFARI=exports.FIREFOX=void 0;var ua="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",FIREFOX=-1!==ua.indexOf("firefox");exports.FIREFOX=FIREFOX;var SAFARI=-1!==ua.indexOf("safari")&&-1==ua.indexOf("chrom");exports.SAFARI=SAFARI;var WEBKIT=-1!==ua.indexOf("webkit")&&-1==ua.indexOf("edge");exports.WEBKIT=WEBKIT;var MAC=-1!==ua.indexOf("macintosh");exports.MAC=MAC;var DEVICE_PIXEL_RATIO="undefined"!=typeof devicePixelRatio?devicePixelRatio:1;exports.DEVICE_PIXEL_RATIO=DEVICE_PIXEL_RATIO;var WORKER_OFFSCREEN_CANVAS="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope;exports.WORKER_OFFSCREEN_CANVAS=WORKER_OFFSCREEN_CANVAS;var IMAGE_DECODE="undefined"!=typeof Image&&Image.prototype.decode;exports.IMAGE_DECODE=IMAGE_DECODE;var PASSIVE_EVENT_LISTENERS=function(){var e=!1;try{var E=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,E),window.removeEventListener("_",null,E)}catch(e){}return e}();exports.PASSIVE_EVENT_LISTENERS=PASSIVE_EVENT_LISTENERS;

},{}],160:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"AssertionError",{enumerable:!0,get:function(){return _AssertionError.default}}),Object.defineProperty(exports,"Collection",{enumerable:!0,get:function(){return _Collection.default}}),Object.defineProperty(exports,"Disposable",{enumerable:!0,get:function(){return _Disposable.default}}),Object.defineProperty(exports,"Feature",{enumerable:!0,get:function(){return _Feature.default}}),Object.defineProperty(exports,"Geolocation",{enumerable:!0,get:function(){return _Geolocation.default}}),Object.defineProperty(exports,"Graticule",{enumerable:!0,get:function(){return _Graticule.default}}),Object.defineProperty(exports,"Image",{enumerable:!0,get:function(){return _Image.default}}),Object.defineProperty(exports,"ImageBase",{enumerable:!0,get:function(){return _ImageBase.default}}),Object.defineProperty(exports,"ImageCanvas",{enumerable:!0,get:function(){return _ImageCanvas.default}}),Object.defineProperty(exports,"ImageTile",{enumerable:!0,get:function(){return _ImageTile.default}}),Object.defineProperty(exports,"Kinetic",{enumerable:!0,get:function(){return _Kinetic.default}}),Object.defineProperty(exports,"Map",{enumerable:!0,get:function(){return _Map.default}}),Object.defineProperty(exports,"MapBrowserEvent",{enumerable:!0,get:function(){return _MapBrowserEvent.default}}),Object.defineProperty(exports,"MapBrowserEventHandler",{enumerable:!0,get:function(){return _MapBrowserEventHandler.default}}),Object.defineProperty(exports,"MapEvent",{enumerable:!0,get:function(){return _MapEvent.default}}),Object.defineProperty(exports,"Object",{enumerable:!0,get:function(){return _Object.default}}),Object.defineProperty(exports,"Observable",{enumerable:!0,get:function(){return _Observable.default}}),Object.defineProperty(exports,"Overlay",{enumerable:!0,get:function(){return _Overlay.default}}),Object.defineProperty(exports,"PluggableMap",{enumerable:!0,get:function(){return _PluggableMap.default}}),Object.defineProperty(exports,"Tile",{enumerable:!0,get:function(){return _Tile.default}}),Object.defineProperty(exports,"TileCache",{enumerable:!0,get:function(){return _TileCache.default}}),Object.defineProperty(exports,"TileQueue",{enumerable:!0,get:function(){return _TileQueue.default}}),Object.defineProperty(exports,"TileRange",{enumerable:!0,get:function(){return _TileRange.default}}),Object.defineProperty(exports,"VectorRenderTile",{enumerable:!0,get:function(){return _VectorRenderTile.default}}),Object.defineProperty(exports,"VectorTile",{enumerable:!0,get:function(){return _VectorTile.default}}),Object.defineProperty(exports,"View",{enumerable:!0,get:function(){return _View.default}}),Object.defineProperty(exports,"getUid",{enumerable:!0,get:function(){return _util.getUid}}),Object.defineProperty(exports,"VERSION",{enumerable:!0,get:function(){return _util.VERSION}});var _AssertionError=_interopRequireDefault(require("./AssertionError.js")),_Collection=_interopRequireDefault(require("./Collection.js")),_Disposable=_interopRequireDefault(require("./Disposable.js")),_Feature=_interopRequireDefault(require("./Feature.js")),_Geolocation=_interopRequireDefault(require("./Geolocation.js")),_Graticule=_interopRequireDefault(require("./layer/Graticule.js")),_Image=_interopRequireDefault(require("./Image.js")),_ImageBase=_interopRequireDefault(require("./ImageBase.js")),_ImageCanvas=_interopRequireDefault(require("./ImageCanvas.js")),_ImageTile=_interopRequireDefault(require("./ImageTile.js")),_Kinetic=_interopRequireDefault(require("./Kinetic.js")),_Map=_interopRequireDefault(require("./Map.js")),_MapBrowserEvent=_interopRequireDefault(require("./MapBrowserEvent.js")),_MapBrowserEventHandler=_interopRequireDefault(require("./MapBrowserEventHandler.js")),_MapEvent=_interopRequireDefault(require("./MapEvent.js")),_Object=_interopRequireDefault(require("./Object.js")),_Observable=_interopRequireDefault(require("./Observable.js")),_Overlay=_interopRequireDefault(require("./Overlay.js")),_PluggableMap=_interopRequireDefault(require("./PluggableMap.js")),_Tile=_interopRequireDefault(require("./Tile.js")),_TileCache=_interopRequireDefault(require("./TileCache.js")),_TileQueue=_interopRequireDefault(require("./TileQueue.js")),_TileRange=_interopRequireDefault(require("./TileRange.js")),_VectorRenderTile=_interopRequireDefault(require("./VectorRenderTile.js")),_VectorTile=_interopRequireDefault(require("./VectorTile.js")),_View=_interopRequireDefault(require("./View.js")),_util=require("./util.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}

},{"./AssertionError.js":9,"./Collection.js":10,"./Disposable.js":12,"./Feature.js":13,"./Geolocation.js":14,"./Image.js":15,"./ImageBase.js":16,"./ImageCanvas.js":17,"./ImageTile.js":19,"./Kinetic.js":20,"./Map.js":21,"./MapBrowserEvent.js":22,"./MapBrowserEventHandler.js":23,"./MapEvent.js":25,"./Object.js":28,"./Observable.js":30,"./Overlay.js":31,"./PluggableMap.js":33,"./Tile.js":34,"./TileCache.js":35,"./TileQueue.js":36,"./TileRange.js":37,"./VectorRenderTile.js":39,"./VectorTile.js":40,"./View.js":41,"./layer/Graticule.js":188,"./util.js":313}],161:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaults=defaults,Object.defineProperty(exports,"DoubleClickZoom",{enumerable:!0,get:function(){return _DoubleClickZoom.default}}),Object.defineProperty(exports,"DragPan",{enumerable:!0,get:function(){return _DragPan.default}}),Object.defineProperty(exports,"DragRotate",{enumerable:!0,get:function(){return _DragRotate.default}}),Object.defineProperty(exports,"DragZoom",{enumerable:!0,get:function(){return _DragZoom.default}}),Object.defineProperty(exports,"KeyboardPan",{enumerable:!0,get:function(){return _KeyboardPan.default}}),Object.defineProperty(exports,"KeyboardZoom",{enumerable:!0,get:function(){return _KeyboardZoom.default}}),Object.defineProperty(exports,"MouseWheelZoom",{enumerable:!0,get:function(){return _MouseWheelZoom.default}}),Object.defineProperty(exports,"PinchRotate",{enumerable:!0,get:function(){return _PinchRotate.default}}),Object.defineProperty(exports,"PinchZoom",{enumerable:!0,get:function(){return _PinchZoom.default}}),Object.defineProperty(exports,"DragAndDrop",{enumerable:!0,get:function(){return _DragAndDrop.default}}),Object.defineProperty(exports,"DragBox",{enumerable:!0,get:function(){return _DragBox.default}}),Object.defineProperty(exports,"DragRotateAndZoom",{enumerable:!0,get:function(){return _DragRotateAndZoom.default}}),Object.defineProperty(exports,"Draw",{enumerable:!0,get:function(){return _Draw.default}}),Object.defineProperty(exports,"Extent",{enumerable:!0,get:function(){return _Extent.default}}),Object.defineProperty(exports,"Interaction",{enumerable:!0,get:function(){return _Interaction.default}}),Object.defineProperty(exports,"Modify",{enumerable:!0,get:function(){return _Modify.default}}),Object.defineProperty(exports,"Pointer",{enumerable:!0,get:function(){return _Pointer.default}}),Object.defineProperty(exports,"Select",{enumerable:!0,get:function(){return _Select.default}}),Object.defineProperty(exports,"Snap",{enumerable:!0,get:function(){return _Snap.default}}),Object.defineProperty(exports,"Translate",{enumerable:!0,get:function(){return _Translate.default}});var _Collection=_interopRequireDefault(require("./Collection.js")),_DoubleClickZoom=_interopRequireDefault(require("./interaction/DoubleClickZoom.js")),_DragPan=_interopRequireDefault(require("./interaction/DragPan.js")),_DragRotate=_interopRequireDefault(require("./interaction/DragRotate.js")),_DragZoom=_interopRequireDefault(require("./interaction/DragZoom.js")),_KeyboardPan=_interopRequireDefault(require("./interaction/KeyboardPan.js")),_KeyboardZoom=_interopRequireDefault(require("./interaction/KeyboardZoom.js")),_Kinetic=_interopRequireDefault(require("./Kinetic.js")),_MouseWheelZoom=_interopRequireDefault(require("./interaction/MouseWheelZoom.js")),_PinchRotate=_interopRequireDefault(require("./interaction/PinchRotate.js")),_PinchZoom=_interopRequireDefault(require("./interaction/PinchZoom.js")),_DragAndDrop=_interopRequireDefault(require("./interaction/DragAndDrop.js")),_DragBox=_interopRequireDefault(require("./interaction/DragBox.js")),_DragRotateAndZoom=_interopRequireDefault(require("./interaction/DragRotateAndZoom.js")),_Draw=_interopRequireDefault(require("./interaction/Draw.js")),_Extent=_interopRequireDefault(require("./interaction/Extent.js")),_Interaction=_interopRequireDefault(require("./interaction/Interaction.js")),_Modify=_interopRequireDefault(require("./interaction/Modify.js")),_Pointer=_interopRequireDefault(require("./interaction/Pointer.js")),_Select=_interopRequireDefault(require("./interaction/Select.js")),_Snap=_interopRequireDefault(require("./interaction/Snap.js")),_Translate=_interopRequireDefault(require("./interaction/Translate.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function defaults(e){var t=e||{},r=new _Collection.default,o=new _Kinetic.default(-.005,.05,100);return(void 0===t.altShiftDragRotate||t.altShiftDragRotate)&&r.push(new _DragRotate.default),(void 0===t.doubleClickZoom||t.doubleClickZoom)&&r.push(new _DoubleClickZoom.default({delta:t.zoomDelta,duration:t.zoomDuration})),(void 0===t.dragPan||t.dragPan)&&r.push(new _DragPan.default({onFocusOnly:t.onFocusOnly,kinetic:o})),(void 0===t.pinchRotate||t.pinchRotate)&&r.push(new _PinchRotate.default),(void 0===t.pinchZoom||t.pinchZoom)&&r.push(new _PinchZoom.default({duration:t.zoomDuration})),(void 0===t.keyboard||t.keyboard)&&(r.push(new _KeyboardPan.default),r.push(new _KeyboardZoom.default({delta:t.zoomDelta,duration:t.zoomDuration}))),(void 0===t.mouseWheelZoom||t.mouseWheelZoom)&&r.push(new _MouseWheelZoom.default({onFocusOnly:t.onFocusOnly,duration:t.zoomDuration})),(void 0===t.shiftDragZoom||t.shiftDragZoom)&&r.push(new _DragZoom.default({duration:t.zoomDuration})),r}

},{"./Collection.js":10,"./Kinetic.js":20,"./interaction/DoubleClickZoom.js":162,"./interaction/DragAndDrop.js":163,"./interaction/DragBox.js":164,"./interaction/DragPan.js":165,"./interaction/DragRotate.js":166,"./interaction/DragRotateAndZoom.js":167,"./interaction/DragZoom.js":168,"./interaction/Draw.js":169,"./interaction/Extent.js":170,"./interaction/Interaction.js":171,"./interaction/KeyboardPan.js":172,"./interaction/KeyboardZoom.js":173,"./interaction/Modify.js":174,"./interaction/MouseWheelZoom.js":175,"./interaction/PinchRotate.js":176,"./interaction/PinchZoom.js":177,"./interaction/Pointer.js":178,"./interaction/Select.js":180,"./interaction/Snap.js":181,"./interaction/Translate.js":182}],162:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Interaction=_interopRequireWildcard(require("./Interaction.js")),_MapBrowserEventType=_interopRequireDefault(require("../MapBrowserEventType.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=o?Object.getOwnPropertyDescriptor(e,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),DoubleClickZoom=function(e){function t(t){var r=e.call(this)||this,o=t||{};return r.delta_=o.delta?o.delta:1,r.duration_=void 0!==o.duration?o.duration:250,r}return __extends(t,e),t.prototype.handleEvent=function(e){var t=!1;if(e.type==_MapBrowserEventType.default.DBLCLICK){var r=e.originalEvent,o=e.map,n=e.coordinate,i=r.shiftKey?-this.delta_:this.delta_,u=o.getView();(0,_Interaction.zoomByDelta)(u,i,n,this.duration_),e.preventDefault(),t=!0}return!t},t}(_Interaction.default),_default=DoubleClickZoom;exports.default=_default;

},{"../MapBrowserEventType.js":24,"./Interaction.js":171}],163:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Event=_interopRequireDefault(require("../events/Event.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_Interaction=_interopRequireDefault(require("./Interaction.js")),_functions=require("../functions.js"),_proj=require("../proj.js"),_events=require("../events.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),DragAndDropEventType={ADD_FEATURES:"addfeatures"},DragAndDropEvent=function(t){function e(e,r,n,s){var o=t.call(this,e)||this;return o.features=n,o.file=r,o.projection=s,o}return __extends(e,t),e}(_Event.default),DragAndDrop=function(t){function e(e){var r=this,n=e||{};return(r=t.call(this,{handleEvent:_functions.TRUE})||this).formatConstructors_=n.formatConstructors?n.formatConstructors:[],r.projection_=n.projection?(0,_proj.get)(n.projection):null,r.dropListenKeys_=null,r.source_=n.source||null,r.target=n.target?n.target:null,r}return __extends(e,t),e.prototype.handleResult_=function(t,e){var r=e.target.result,n=this.getMap(),s=this.projection_;s||(s=n.getView().getProjection());for(var o=this.formatConstructors_,i=0,a=o.length;i<a;++i){var u=new o[i],p=this.tryReadFeatures_(u,r,{featureProjection:s});if(p&&p.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(p)),this.dispatchEvent(new DragAndDropEvent(DragAndDropEventType.ADD_FEATURES,t,p,s));break}}},e.prototype.registerListeners_=function(){var t=this.getMap();if(t){var e=this.target?this.target:t.getViewport();this.dropListenKeys_=[(0,_events.listen)(e,_EventType.default.DROP,this.handleDrop,this),(0,_events.listen)(e,_EventType.default.DRAGENTER,this.handleStop,this),(0,_events.listen)(e,_EventType.default.DRAGOVER,this.handleStop,this),(0,_events.listen)(e,_EventType.default.DROP,this.handleStop,this)]}},e.prototype.setActive=function(e){!this.getActive()&&e&&this.registerListeners_(),this.getActive()&&!e&&this.unregisterListeners_(),t.prototype.setActive.call(this,e)},e.prototype.setMap=function(e){this.unregisterListeners_(),t.prototype.setMap.call(this,e),this.getActive()&&this.registerListeners_()},e.prototype.tryReadFeatures_=function(t,e,r){try{return t.readFeatures(e,r)}catch(t){return null}},e.prototype.unregisterListeners_=function(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(_events.unlistenByKey),this.dropListenKeys_=null)},e.prototype.handleDrop=function(t){for(var e=t.dataTransfer.files,r=0,n=e.length;r<n;++r){var s=e.item(r),o=new FileReader;o.addEventListener(_EventType.default.LOAD,this.handleResult_.bind(this,s)),o.readAsText(s)}},e.prototype.handleStop=function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},e}(_Interaction.default),_default=DragAndDrop;exports.default=_default;

},{"../events.js":64,"../events/Event.js":65,"../events/EventType.js":66,"../functions.js":125,"../proj.js":205,"./Interaction.js":171}],164:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Event=_interopRequireDefault(require("../events/Event.js")),_Pointer=_interopRequireDefault(require("./Pointer.js")),_Box=_interopRequireDefault(require("../render/Box.js")),_condition=require("../events/condition.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),DragBoxEventType={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend"},DragBoxEvent=function(t){function e(e,n,o){var i=t.call(this,e)||this;return i.coordinate=n,i.mapBrowserEvent=o,i}return __extends(e,t),e}(_Event.default),DragBox=function(t){function e(e){var n=t.call(this)||this,o=e||{};return n.box_=new _Box.default(o.className||"ol-dragbox"),n.minArea_=void 0!==o.minArea?o.minArea:64,o.onBoxEnd&&(n.onBoxEnd=o.onBoxEnd),n.startPixel_=null,n.condition_=o.condition?o.condition:_condition.mouseActionButton,n.boxEndCondition_=o.boxEndCondition?o.boxEndCondition:n.defaultBoxEndCondition,n}return __extends(e,t),e.prototype.defaultBoxEndCondition=function(t,e,n){var o=n[0]-e[0],i=n[1]-e[1];return o*o+i*i>=this.minArea_},e.prototype.getGeometry=function(){return this.box_.getGeometry()},e.prototype.handleDragEvent=function(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXDRAG,t.coordinate,t))},e.prototype.handleUpEvent=function(t){return this.box_.setMap(null),this.boxEndCondition_(t,this.startPixel_,t.pixel)&&(this.onBoxEnd(t),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXEND,t.coordinate,t))),!1},e.prototype.handleDownEvent=function(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXSTART,t.coordinate,t)),!0)},e.prototype.onBoxEnd=function(t){},e}(_Pointer.default),_default=DragBox;exports.default=_default;

},{"../events/Event.js":65,"../events/condition.js":69,"../render/Box.js":214,"./Pointer.js":178}],165:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Pointer=_interopRequireWildcard(require("./Pointer.js")),_functions=require("../functions.js"),_condition=require("../events/condition.js"),_easing=require("../easing.js"),_coordinate=require("../coordinate.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return _getRequireWildcardCache=function(){return t},t}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;if(null===t||"object"!==_typeof(t)&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var r=i?Object.getOwnPropertyDescriptor(t,o):null;r&&(r.get||r.set)?Object.defineProperty(n,o,r):n[o]=t[o]}return n.default=t,e&&e.set(t,n),n}var __extends=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),DragPan=function(t){function e(e){var n=t.call(this,{stopDown:_functions.FALSE})||this,i=e||{};n.kinetic_=i.kinetic,n.lastCentroid=null,n.lastPointersCount_,n.panning_=!1;var o=i.condition?i.condition:(0,_condition.all)(_condition.noModifierKeys,_condition.primaryAction);return n.condition_=i.onFocusOnly?(0,_condition.all)(_condition.focusWithTabindex,o):o,n.noKinetic_=!1,n}return __extends(e,t),e.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var e=this.targetPointers,n=(0,_Pointer.centroid)(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){var i=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],o=t.map.getView();(0,_coordinate.scale)(i,o.getResolution()),(0,_coordinate.rotate)(i,o.getRotation()),o.adjustCenterInternal(i)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()},e.prototype.handleUpEvent=function(t){var e=t.map,n=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var i=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),r=n.getCenterInternal(),a=e.getPixelFromCoordinateInternal(r),s=e.getCoordinateFromPixelInternal([a[0]-i*Math.cos(o),a[1]-i*Math.sin(o)]);n.animateInternal({center:n.getConstrainedCenter(s),duration:500,easing:_easing.easeOut})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>0&&this.condition_(t)){var e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1},e}(_Pointer.default),_default=DragPan;exports.default=_default;

},{"../coordinate.js":60,"../easing.js":63,"../events/condition.js":69,"../functions.js":125,"./Pointer.js":178}],166:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Pointer=_interopRequireDefault(require("./Pointer.js")),_functions=require("../functions.js"),_condition=require("../events/condition.js"),_rotationconstraint=require("../rotationconstraint.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(n,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])})(n,o)};return function(n,o){function e(){this.constructor=n}t(n,o),n.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}}(),DragRotate=function(t){function n(n){var o=this,e=n||{};return(o=t.call(this,{stopDown:_functions.FALSE})||this).condition_=e.condition?e.condition:_condition.altShiftKeysOnly,o.lastAngle_=void 0,o.duration_=void 0!==e.duration?e.duration:250,o}return __extends(n,t),n.prototype.handleDragEvent=function(t){if((0,_condition.mouseOnly)(t)){var n=t.map,o=n.getView();if(o.getConstraints().rotation!==_rotationconstraint.disable){var e=n.getSize(),i=t.pixel,r=Math.atan2(e[1]/2-i[1],i[0]-e[0]/2);if(void 0!==this.lastAngle_){var a=r-this.lastAngle_;o.adjustRotationInternal(-a)}this.lastAngle_=r}}},n.prototype.handleUpEvent=function(t){return!(0,_condition.mouseOnly)(t)||(t.map.getView().endInteraction(this.duration_),!1)},n.prototype.handleDownEvent=function(t){return!!(0,_condition.mouseOnly)(t)&&(!(!(0,_condition.mouseActionButton)(t)||!this.condition_(t))&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0))},n}(_Pointer.default),_default=DragRotate;exports.default=_default;

},{"../events/condition.js":69,"../functions.js":125,"../rotationconstraint.js":250,"./Pointer.js":178}],167:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Pointer=_interopRequireDefault(require("./Pointer.js")),_condition=require("../events/condition.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),DragRotateAndZoom=function(t){function e(e){var n=this,i=e||{};return(n=t.call(this,i)||this).condition_=i.condition?i.condition:_condition.shiftKeyOnly,n.lastAngle_=void 0,n.lastMagnitude_=void 0,n.lastScaleDelta_=0,n.duration_=void 0!==i.duration?i.duration:400,n}return __extends(e,t),e.prototype.handleDragEvent=function(t){if((0,_condition.mouseOnly)(t)){var e=t.map,n=e.getSize(),i=t.pixel,o=i[0]-n[0]/2,a=n[1]/2-i[1],r=Math.atan2(a,o),s=Math.sqrt(o*o+a*a),l=e.getView();if(void 0!==this.lastAngle_){var u=this.lastAngle_-r;l.adjustRotationInternal(u)}this.lastAngle_=r,void 0!==this.lastMagnitude_&&l.adjustResolutionInternal(this.lastMagnitude_/s),void 0!==this.lastMagnitude_&&(this.lastScaleDelta_=this.lastMagnitude_/s),this.lastMagnitude_=s}},e.prototype.handleUpEvent=function(t){if(!(0,_condition.mouseOnly)(t))return!0;var e=t.map.getView(),n=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,n),this.lastScaleDelta_=0,!1},e.prototype.handleDownEvent=function(t){return!!(0,_condition.mouseOnly)(t)&&(!!this.condition_(t)&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,this.lastMagnitude_=void 0,!0))},e}(_Pointer.default),_default=DragRotateAndZoom;exports.default=_default;

},{"../events/condition.js":69,"./Pointer.js":178}],168:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _DragBox=_interopRequireDefault(require("./DragBox.js")),_extent=require("../extent.js"),_easing=require("../easing.js"),_condition=require("../events/condition.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),DragZoom=function(t){function e(e){var n=this,o=e||{},r=o.condition?o.condition:_condition.shiftKeyOnly;return(n=t.call(this,{condition:r,className:o.className||"ol-dragzoom",minArea:o.minArea})||this).duration_=void 0!==o.duration?o.duration:200,n.out_=void 0!==o.out&&o.out,n}return __extends(e,t),e.prototype.onBoxEnd=function(t){var e=this.getMap(),n=e.getView(),o=e.getSize(),r=this.getGeometry().getExtent();if(this.out_){var i=n.calculateExtentInternal(o),a=(0,_extent.createOrUpdateFromCoordinates)([e.getPixelFromCoordinateInternal((0,_extent.getBottomLeft)(r)),e.getPixelFromCoordinateInternal((0,_extent.getTopRight)(r))]),u=n.getResolutionForExtentInternal(a,o);(0,_extent.scaleFromCenter)(i,1/u),r=i}var s=n.getConstrainedResolution(n.getResolutionForExtentInternal(r,o)),_=n.getConstrainedCenter((0,_extent.getCenter)(r),s);n.animateInternal({resolution:s,center:_,duration:this.duration_,easing:_easing.easeOut})},e}(_DragBox.default),_default=DragZoom;exports.default=_default;

},{"../easing.js":63,"../events/condition.js":69,"../extent.js":70,"./DragBox.js":164}],169:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createRegularPolygon=createRegularPolygon,exports.createBox=createBox,exports.default=void 0;var _Circle=_interopRequireDefault(require("../geom/Circle.js")),_Event=_interopRequireDefault(require("../events/Event.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_Feature=_interopRequireDefault(require("../Feature.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_Property=_interopRequireDefault(require("./Property.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_MapBrowserEvent=_interopRequireDefault(require("../MapBrowserEvent.js")),_MapBrowserEventType=_interopRequireDefault(require("../MapBrowserEventType.js")),_MultiLineString=_interopRequireDefault(require("../geom/MultiLineString.js")),_MultiPoint=_interopRequireDefault(require("../geom/MultiPoint.js")),_MultiPolygon=_interopRequireDefault(require("../geom/MultiPolygon.js")),_Point=_interopRequireDefault(require("../geom/Point.js")),_Pointer=_interopRequireDefault(require("./Pointer.js")),_Polygon=_interopRequireWildcard(require("../geom/Polygon.js")),_Vector=_interopRequireDefault(require("../layer/Vector.js")),_Vector2=_interopRequireDefault(require("../source/Vector.js")),_functions=require("../functions.js"),_condition=require("../events/condition.js"),_extent=require("../extent.js"),_Style=require("../style/Style.js"),_proj=require("../proj.js"),_Object=require("../Object.js"),_coordinate=require("../coordinate.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=i?Object.getOwnPropertyDescriptor(e,r):null;n&&(n.get||n.set)?Object.defineProperty(o,r,n):o[r]=e[r]}return o.default=e,t&&t.set(e,o),o}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function i(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),Mode={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"},DrawEventType={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"},DrawEvent=function(e){function t(t,o){var i=e.call(this,t)||this;return i.feature=o,i}return __extends(t,e),t}(_Event.default),Draw=function(e){function t(t){var o=this,i=t;i.stopDown||(i.stopDown=_functions.FALSE),(o=e.call(this,i)||this).shouldHandle_=!1,o.downPx_=null,o.downTimeout_,o.lastDragTime_,o.freehand_=!1,o.source_=t.source?t.source:null,o.features_=t.features?t.features:null,o.snapTolerance_=t.snapTolerance?t.snapTolerance:12,o.type_=t.type,o.mode_=getMode(o.type_),o.stopClick_=!!t.stopClick,o.minPoints_=t.minPoints?t.minPoints:o.mode_===Mode.POLYGON?3:2,o.maxPoints_=t.maxPoints?t.maxPoints:1/0,o.finishCondition_=t.finishCondition?t.finishCondition:_functions.TRUE;var r=t.geometryFunction;if(!r)if(o.type_===_GeometryType.default.CIRCLE)r=function(e,t,o){var i=t||new _Circle.default([NaN,NaN]),r=(0,_proj.fromUserCoordinate)(e[0],o),n=(0,_coordinate.squaredDistance)(r,(0,_proj.fromUserCoordinate)(e[1],o));i.setCenterAndRadius(r,Math.sqrt(n));var s=(0,_proj.getUserProjection)();return s&&i.transform(o,s),i};else{var n,s=o.mode_;s===Mode.POINT?n=_Point.default:s===Mode.LINE_STRING?n=_LineString.default:s===Mode.POLYGON&&(n=_Polygon.default),r=function(e,t,o){var i=t;return i?s===Mode.POLYGON?e[0].length?i.setCoordinates([e[0].concat([e[0][0]])]):i.setCoordinates([]):i.setCoordinates(e):i=new n(e),i}}return o.geometryFunction_=r,o.dragVertexDelay_=void 0!==t.dragVertexDelay?t.dragVertexDelay:500,o.finishCoordinate_=null,o.sketchFeature_=null,o.sketchPoint_=null,o.sketchCoords_=null,o.sketchLine_=null,o.sketchLineCoords_=null,o.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,o.overlay_=new _Vector.default({source:new _Vector2.default({useSpatialIndex:!1,wrapX:!!t.wrapX&&t.wrapX}),style:t.style?t.style:getDefaultStyleFunction(),updateWhileInteracting:!0}),o.geometryName_=t.geometryName,o.condition_=t.condition?t.condition:_condition.noModifierKeys,o.freehandCondition_,t.freehand?o.freehandCondition_=_condition.always:o.freehandCondition_=t.freehandCondition?t.freehandCondition:_condition.shiftKeyOnly,o.addEventListener((0,_Object.getChangeEventType)(_Property.default.ACTIVE),o.updateState_),o}return __extends(t,e),t.prototype.setMap=function(t){e.prototype.setMap.call(this,t),this.updateState_()},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleEvent=function(t){t.originalEvent.type===_EventType.default.CONTEXTMENU&&t.preventDefault(),this.freehand_=this.mode_!==Mode.POINT&&this.freehandCondition_(t);var o=t.type===_MapBrowserEventType.default.POINTERMOVE,i=!0;!this.freehand_&&this.lastDragTime_&&t.type===_MapBrowserEventType.default.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,o=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&t.type===_MapBrowserEventType.default.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(t.coordinate),i=!1):this.freehand_&&t.type===_MapBrowserEventType.default.POINTERDOWN?i=!1:o?(i=t.type===_MapBrowserEventType.default.POINTERMOVE)&&this.freehand_?(this.handlePointerMove_(t),this.shouldHandle_&&t.preventDefault()):("mouse"==t.originalEvent.pointerType||t.type===_MapBrowserEventType.default.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(t):t.type===_MapBrowserEventType.default.DBLCLICK&&(i=!1),e.prototype.handleEvent.call(this,t)&&i},t.prototype.handleDownEvent=function(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new _MapBrowserEvent.default(_MapBrowserEventType.default.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)},t.prototype.handleUpEvent=function(e){var t=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);var o=this.mode_===Mode.CIRCLE;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||o?this.finishDrawing():this.atFinish_(e)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate):(this.startDrawing_(e),this.mode_===Mode.POINT&&this.finishDrawing()),t=!1):this.freehand_&&this.abortDrawing(),!t&&this.stopClick_&&e.stopPropagation(),t},t.prototype.handlePointerMove_=function(e){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var t=this.downPx_,o=e.pixel,i=t[0]-o[0],r=t[1]-o[1],n=i*i+r*r;if(this.shouldHandle_=this.freehand_?n>this.squaredClickTolerance_:n<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?this.modifyDrawing_(e):this.createOrUpdateSketchPoint_(e)},t.prototype.atFinish_=function(e){var t=!1;if(this.sketchFeature_){var o=!1,i=[this.finishCoordinate_];if(this.mode_===Mode.LINE_STRING)o=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===Mode.POLYGON){var r=this.sketchCoords_;o=r[0].length>this.minPoints_,i=[r[0][0],r[0][r[0].length-2]]}if(o)for(var n=e.map,s=0,a=i.length;s<a;s++){var h=i[s],_=n.getPixelFromCoordinate(h),u=e.pixel,d=u[0]-_[0],l=u[1]-_[1],c=this.freehand_?1:this.snapTolerance_;if(t=Math.sqrt(d*d+l*l)<=c){this.finishCoordinate_=h;break}}}return t},t.prototype.createOrUpdateSketchPoint_=function(e){var t=e.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new _Feature.default(new _Point.default(t)),this.updateSketchFeatures_())},t.prototype.startDrawing_=function(e){var t=e.coordinate,o=e.map.getView().getProjection();this.finishCoordinate_=t,this.mode_===Mode.POINT?this.sketchCoords_=t.slice():this.mode_===Mode.POLYGON?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new _Feature.default(new _LineString.default(this.sketchLineCoords_)));var i=this.geometryFunction_(this.sketchCoords_,void 0,o);this.sketchFeature_=new _Feature.default,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(i),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))},t.prototype.modifyDrawing_=function(e){var t,o,i,r=e.coordinate,n=this.sketchFeature_.getGeometry(),s=e.map.getView().getProjection();(this.mode_===Mode.POINT?o=this.sketchCoords_:this.mode_===Mode.POLYGON?(o=(t=this.sketchCoords_[0])[t.length-1],this.atFinish_(e)&&(r=this.finishCoordinate_.slice())):o=(t=this.sketchCoords_)[t.length-1],o[0]=r[0],o[1]=r[1],this.geometryFunction_(this.sketchCoords_,n,s),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(r);if(n.getType()==_GeometryType.default.POLYGON&&this.mode_!==Mode.POLYGON){this.sketchLine_||(this.sketchLine_=new _Feature.default);var a=n.getLinearRing(0);(i=this.sketchLine_.getGeometry())?(i.setFlatCoordinates(a.getLayout(),a.getFlatCoordinates()),i.changed()):(i=new _LineString.default(a.getFlatCoordinates(),a.getLayout()),this.sketchLine_.setGeometry(i))}else this.sketchLineCoords_&&(i=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()},t.prototype.addToDrawing_=function(e){var t,o,i=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection();this.mode_===Mode.LINE_STRING?(this.finishCoordinate_=e.slice(),(o=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?o.pop():t=!0),o.push(e.slice()),this.geometryFunction_(o,i,r)):this.mode_===Mode.POLYGON&&((o=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?o.pop():t=!0),o.push(e.slice()),t&&(this.finishCoordinate_=o[0]),this.geometryFunction_(this.sketchCoords_,i,r)),this.updateSketchFeatures_(),t&&this.finishDrawing()},t.prototype.removeLastPoint=function(){if(this.sketchFeature_){var e,t=this.sketchFeature_.getGeometry(),o=this.getMap().getView().getProjection();this.mode_===Mode.LINE_STRING?((e=this.sketchCoords_).splice(-2,1),this.geometryFunction_(e,t,o),e.length>=2&&(this.finishCoordinate_=e[e.length-2].slice())):this.mode_===Mode.POLYGON&&((e=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(e),this.geometryFunction_(this.sketchCoords_,t,o)),0===e.length&&this.abortDrawing(),this.updateSketchFeatures_()}},t.prototype.finishDrawing=function(){var e=this.abortDrawing_();if(e){var t=this.sketchCoords_,o=e.getGeometry(),i=this.getMap().getView().getProjection();this.mode_===Mode.LINE_STRING?(t.pop(),this.geometryFunction_(t,o,i)):this.mode_===Mode.POLYGON&&(t[0].pop(),this.geometryFunction_(t,o,i),t=o.getCoordinates()),this.type_===_GeometryType.default.MULTI_POINT?e.setGeometry(new _MultiPoint.default([t])):this.type_===_GeometryType.default.MULTI_LINE_STRING?e.setGeometry(new _MultiLineString.default([t])):this.type_===_GeometryType.default.MULTI_POLYGON&&e.setGeometry(new _MultiPolygon.default([t])),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e)}},t.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),e},t.prototype.abortDrawing=function(){var e=this.abortDrawing_();e&&this.dispatchEvent(new DrawEvent(DrawEventType.DRAWABORT,e))},t.prototype.appendCoordinates=function(e){var t=this.mode_,o=[];t===Mode.LINE_STRING?o=this.sketchCoords_:t===Mode.POLYGON&&(o=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]);for(var i=o.pop(),r=0;r<e.length;r++)this.addToDrawing_(e[r]);this.addToDrawing_(i)},t.prototype.extend=function(e){var t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();var o=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=o.slice(),this.sketchCoords_.push(o.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))},t.prototype.updateSketchFeatures_=function(){var e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);var t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)},t.prototype.updateState_=function(){var e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing(),this.overlay_.setMap(t?e:null)},t}(_Pointer.default);function getDefaultStyleFunction(){var e=(0,_Style.createEditingStyle)();return function(t,o){return e[t.getGeometry().getType()]}}function createRegularPolygon(e,t){return function(o,i,r){var n=(0,_proj.fromUserCoordinate)(o[0],r),s=(0,_proj.fromUserCoordinate)(o[1],r),a=Math.sqrt((0,_coordinate.squaredDistance)(n,s)),h=i||(0,_Polygon.fromCircle)(new _Circle.default(n),e),_=t;if(!t){var u=s[0]-n[0],d=s[1]-n[1];_=Math.atan(d/u)-(u<0?Math.PI:0)}(0,_Polygon.makeRegular)(h,n,a,_);var l=(0,_proj.getUserProjection)();return l&&h.transform(r,l),h}}function createBox(){return function(e,t,o){var i=(0,_extent.boundingExtent)(e.map(function(e){return(0,_proj.fromUserCoordinate)(e,o)})),r=[[(0,_extent.getBottomLeft)(i),(0,_extent.getBottomRight)(i),(0,_extent.getTopRight)(i),(0,_extent.getTopLeft)(i),(0,_extent.getBottomLeft)(i)]],n=t;n?n.setCoordinates(r):n=new _Polygon.default(r);var s=(0,_proj.getUserProjection)();return s&&n.transform(o,s),n}}function getMode(e){var t;return e===_GeometryType.default.POINT||e===_GeometryType.default.MULTI_POINT?t=Mode.POINT:e===_GeometryType.default.LINE_STRING||e===_GeometryType.default.MULTI_LINE_STRING?t=Mode.LINE_STRING:e===_GeometryType.default.POLYGON||e===_GeometryType.default.MULTI_POLYGON?t=Mode.POLYGON:e===_GeometryType.default.CIRCLE&&(t=Mode.CIRCLE),t}var _default=Draw;exports.default=_default;

},{"../Feature.js":13,"../MapBrowserEvent.js":22,"../MapBrowserEventType.js":24,"../Object.js":28,"../coordinate.js":60,"../events/Event.js":65,"../events/EventType.js":66,"../events/condition.js":69,"../extent.js":70,"../functions.js":125,"../geom/Circle.js":127,"../geom/GeometryType.js":131,"../geom/LineString.js":132,"../geom/MultiLineString.js":134,"../geom/MultiPoint.js":135,"../geom/MultiPolygon.js":136,"../geom/Point.js":137,"../geom/Polygon.js":138,"../layer/Vector.js":196,"../proj.js":205,"../source/Vector.js":277,"../style/Style.js":302,"./Pointer.js":178,"./Property.js":179}],170:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Event=_interopRequireDefault(require("../events/Event.js")),_Feature=_interopRequireDefault(require("../Feature.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_MapBrowserEventType=_interopRequireDefault(require("../MapBrowserEventType.js")),_Point=_interopRequireDefault(require("../geom/Point.js")),_Pointer=_interopRequireDefault(require("./Pointer.js")),_Vector=_interopRequireDefault(require("../layer/Vector.js")),_Vector2=_interopRequireDefault(require("../source/Vector.js")),_condition=require("../events/condition.js"),_extent=require("../extent.js"),_coordinate=require("../coordinate.js"),_Style=require("../style/Style.js"),_Polygon=require("../geom/Polygon.js"),_proj=require("../proj.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ExtentEventType={EXTENTCHANGED:"extentchanged"},ExtentEvent=function(e){function t(t){var n=e.call(this,ExtentEventType.EXTENTCHANGED)||this;return n.extent=t,n}return __extends(t,e),t}(_Event.default),Extent=function(e){function t(t){var n=this,r=t||{};return(n=e.call(this,r)||this).condition_=r.condition?r.condition:_condition.always,n.extent_=null,n.pointerHandler_=null,n.pixelTolerance_=void 0!==r.pixelTolerance?r.pixelTolerance:10,n.snappedToVertex_=!1,n.extentFeature_=null,n.vertexFeature_=null,t||(t={}),n.extentOverlay_=new _Vector.default({source:new _Vector2.default({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.boxStyle?t.boxStyle:getDefaultExtentStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),n.vertexOverlay_=new _Vector.default({source:new _Vector2.default({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.pointerStyle?t.pointerStyle:getDefaultPointerStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),t.extent&&n.setExtent(t.extent),n}return __extends(t,e),t.prototype.snapToVertex_=function(e,t){var n=t.getCoordinateFromPixelInternal(e),r=this.getExtentInternal();if(r){var o=getSegments(r);o.sort(function(e,t){return(0,_coordinate.squaredDistanceToSegment)(n,e)-(0,_coordinate.squaredDistanceToSegment)(n,t)});var i=o[0],a=(0,_coordinate.closestOnSegment)(n,i),u=t.getPixelFromCoordinateInternal(a);if((0,_coordinate.distance)(e,u)<=this.pixelTolerance_){var l=t.getPixelFromCoordinateInternal(i[0]),s=t.getPixelFromCoordinateInternal(i[1]),p=(0,_coordinate.squaredDistance)(u,l),_=(0,_coordinate.squaredDistance)(u,s),d=Math.sqrt(Math.min(p,_));return this.snappedToVertex_=d<=this.pixelTolerance_,this.snappedToVertex_&&(a=p>_?i[1]:i[0]),a}}return null},t.prototype.handlePointerMove_=function(e){var t=e.pixel,n=e.map,r=this.snapToVertex_(t,n);r||(r=n.getCoordinateFromPixelInternal(t)),this.createOrUpdatePointerFeature_(r)},t.prototype.createOrUpdateExtentFeature_=function(e){var t=this.extentFeature_;return t?e?t.setGeometry((0,_Polygon.fromExtent)(e)):t.setGeometry(void 0):(t=e?new _Feature.default((0,_Polygon.fromExtent)(e)):new _Feature.default({}),this.extentFeature_=t,this.extentOverlay_.getSource().addFeature(t)),t},t.prototype.createOrUpdatePointerFeature_=function(e){var t=this.vertexFeature_;t?t.getGeometry().setCoordinates(e):(t=new _Feature.default(new _Point.default(e)),this.vertexFeature_=t,this.vertexOverlay_.getSource().addFeature(t));return t},t.prototype.handleEvent=function(t){return!t.originalEvent||!this.condition_(t)||(t.type!=_MapBrowserEventType.default.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),e.prototype.handleEvent.call(this,t),!1)},t.prototype.handleDownEvent=function(e){var t=e.pixel,n=e.map,r=this.getExtentInternal(),o=this.snapToVertex_(t,n),i=function(e){var t=null,n=null;return e[0]==r[0]?t=r[2]:e[0]==r[2]&&(t=r[0]),e[1]==r[1]?n=r[3]:e[1]==r[3]&&(n=r[1]),null!==t&&null!==n?[t,n]:null};if(o&&r){var a=o[0]==r[0]||o[0]==r[2]?o[0]:null,u=o[1]==r[1]||o[1]==r[3]?o[1]:null;null!==a&&null!==u?this.pointerHandler_=getPointHandler(i(o)):null!==a?this.pointerHandler_=getEdgeHandler(i([a,r[1]]),i([a,r[3]])):null!==u&&(this.pointerHandler_=getEdgeHandler(i([r[0],u]),i([r[2],u])))}else o=n.getCoordinateFromPixelInternal(t),this.setExtent([o[0],o[1],o[0],o[1]]),this.pointerHandler_=getPointHandler(o);return!0},t.prototype.handleDragEvent=function(e){if(this.pointerHandler_){var t=e.coordinate;this.setExtent(this.pointerHandler_(t)),this.createOrUpdatePointerFeature_(t)}},t.prototype.handleUpEvent=function(e){this.pointerHandler_=null;var t=this.getExtentInternal();return t&&0!==(0,_extent.getArea)(t)||this.setExtent(null),!1},t.prototype.setMap=function(t){this.extentOverlay_.setMap(t),this.vertexOverlay_.setMap(t),e.prototype.setMap.call(this,t)},t.prototype.getExtent=function(){return(0,_proj.toUserExtent)(this.getExtentInternal(),this.getMap().getView().getProjection())},t.prototype.getExtentInternal=function(){return this.extent_},t.prototype.setExtent=function(e){this.extent_=e||null,this.createOrUpdateExtentFeature_(e),this.dispatchEvent(new ExtentEvent(this.extent_))},t}(_Pointer.default);function getDefaultExtentStyleFunction(){var e=(0,_Style.createEditingStyle)();return function(t,n){return e[_GeometryType.default.POLYGON]}}function getDefaultPointerStyleFunction(){var e=(0,_Style.createEditingStyle)();return function(t,n){return e[_GeometryType.default.POINT]}}function getPointHandler(e){return function(t){return(0,_extent.boundingExtent)([e,t])}}function getEdgeHandler(e,t){return e[0]==t[0]?function(n){return(0,_extent.boundingExtent)([e,[n[0],t[1]]])}:e[1]==t[1]?function(n){return(0,_extent.boundingExtent)([e,[t[0],n[1]]])}:null}function getSegments(e){return[[[e[0],e[1]],[e[0],e[3]]],[[e[0],e[3]],[e[2],e[3]]],[[e[2],e[3]],[e[2],e[1]]],[[e[2],e[1]],[e[0],e[1]]]]}var _default=Extent;exports.default=_default;

},{"../Feature.js":13,"../MapBrowserEventType.js":24,"../coordinate.js":60,"../events/Event.js":65,"../events/condition.js":69,"../extent.js":70,"../geom/GeometryType.js":131,"../geom/Point.js":137,"../geom/Polygon.js":138,"../layer/Vector.js":196,"../proj.js":205,"../source/Vector.js":277,"../style/Style.js":302,"./Pointer.js":178}],171:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.pan=pan,exports.zoomByDelta=zoomByDelta,exports.default=void 0;var _Object=_interopRequireDefault(require("../Object.js")),_Property=_interopRequireDefault(require("./Property.js")),_easing=require("../easing.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Interaction=function(t){function e(e){var n=t.call(this)||this;return e&&e.handleEvent&&(n.handleEvent=e.handleEvent),n.map_=null,n.setActive(!0),n}return __extends(e,t),e.prototype.getActive=function(){return this.get(_Property.default.ACTIVE)},e.prototype.getMap=function(){return this.map_},e.prototype.handleEvent=function(t){return!0},e.prototype.setActive=function(t){this.set(_Property.default.ACTIVE,t)},e.prototype.setMap=function(t){this.map_=t},e}(_Object.default);function pan(t,e,n){var r=t.getCenterInternal();if(r){var o=[r[0]+e[0],r[1]+e[1]];t.animateInternal({duration:void 0!==n?n:250,easing:_easing.linear,center:t.getConstrainedCenter(o)})}}function zoomByDelta(t,e,n,r){var o=t.getZoom();if(void 0!==o){var a=t.getConstrainedZoom(o+e),i=t.getResolutionForZoom(a);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:i,anchor:n,duration:void 0!==r?r:250,easing:_easing.easeOut})}}var _default=Interaction;exports.default=_default;

},{"../Object.js":28,"../easing.js":63,"./Property.js":179}],172:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_Interaction=_interopRequireWildcard(require("./Interaction.js")),_KeyCode=_interopRequireDefault(require("../events/KeyCode.js")),_condition=require("../events/condition.js"),_coordinate=require("../coordinate.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var i=n?Object.getOwnPropertyDescriptor(e,r):null;i&&(i.get||i.set)?Object.defineProperty(o,r,i):o[r]=e[r]}return o.default=e,t&&t.set(e,o),o}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),KeyboardPan=function(e){function t(t){var o=e.call(this)||this,n=t||{};return o.defaultCondition_=function(e){return(0,_condition.noModifierKeys)(e)&&(0,_condition.targetNotEditable)(e)},o.condition_=void 0!==n.condition?n.condition:o.defaultCondition_,o.duration_=void 0!==n.duration?n.duration:100,o.pixelDelta_=void 0!==n.pixelDelta?n.pixelDelta:128,o}return __extends(t,e),t.prototype.handleEvent=function(e){var t=!1;if(e.type==_EventType.default.KEYDOWN){var o=e.originalEvent.keyCode;if(this.condition_(e)&&(o==_KeyCode.default.DOWN||o==_KeyCode.default.LEFT||o==_KeyCode.default.RIGHT||o==_KeyCode.default.UP)){var n=e.map.getView(),r=n.getResolution()*this.pixelDelta_,i=0,u=0;o==_KeyCode.default.DOWN?u=-r:o==_KeyCode.default.LEFT?i=-r:o==_KeyCode.default.RIGHT?i=r:u=r;var a=[i,u];(0,_coordinate.rotate)(a,n.getRotation()),(0,_Interaction.pan)(n,a,this.duration_),e.preventDefault(),t=!0}}return!t},t}(_Interaction.default),_default=KeyboardPan;exports.default=_default;

},{"../coordinate.js":60,"../events/EventType.js":66,"../events/KeyCode.js":67,"../events/condition.js":69,"./Interaction.js":171}],173:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_Interaction=_interopRequireWildcard(require("./Interaction.js")),_condition=require("../events/condition.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return _getRequireWildcardCache=function(){return t},t}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;if(null===t||"object"!==_typeof(t)&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=o?Object.getOwnPropertyDescriptor(t,n):null;i&&(i.get||i.set)?Object.defineProperty(r,n,i):r[n]=t[n]}return r.default=t,e&&e.set(t,r),r}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),KeyboardZoom=function(t){function e(e){var r=t.call(this)||this,o=e||{};return r.condition_=o.condition?o.condition:_condition.targetNotEditable,r.delta_=o.delta?o.delta:1,r.duration_=void 0!==o.duration?o.duration:100,r}return __extends(e,t),e.prototype.handleEvent=function(t){var e=!1;if(t.type==_EventType.default.KEYDOWN||t.type==_EventType.default.KEYPRESS){var r=t.originalEvent.charCode;if(this.condition_(t)&&(r=="+".charCodeAt(0)||r=="-".charCodeAt(0))){var o=t.map,n=r=="+".charCodeAt(0)?this.delta_:-this.delta_,i=o.getView();(0,_Interaction.zoomByDelta)(i,n,void 0,this.duration_),t.preventDefault(),e=!0}}return!e},e}(_Interaction.default),_default=KeyboardZoom;exports.default=_default;

},{"../events/EventType.js":66,"../events/condition.js":69,"./Interaction.js":171}],174:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.ModifyEvent=void 0;var _Collection=_interopRequireDefault(require("../Collection.js")),_CollectionEventType=_interopRequireDefault(require("../CollectionEventType.js")),_Event=_interopRequireDefault(require("../events/Event.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_Feature=_interopRequireDefault(require("../Feature.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_MapBrowserEventType=_interopRequireDefault(require("../MapBrowserEventType.js")),_Point=_interopRequireDefault(require("../geom/Point.js")),_Pointer=_interopRequireDefault(require("./Pointer.js")),_RBush=_interopRequireDefault(require("../structs/RBush.js")),_VectorEventType=_interopRequireDefault(require("../source/VectorEventType.js")),_Vector=_interopRequireDefault(require("../layer/Vector.js")),_Vector2=_interopRequireDefault(require("../source/Vector.js")),_condition=require("../events/condition.js"),_extent=require("../extent.js"),_coordinate=require("../coordinate.js"),_Style=require("../style/Style.js"),_array=require("../array.js"),_Polygon=require("../geom/Polygon.js"),_proj=require("../proj.js"),_util=require("../util.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),CIRCLE_CENTER_INDEX=0,CIRCLE_CIRCUMFERENCE_INDEX=1,tempExtent=[0,0,0,0],tempSegment=[],ModifyEventType={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"},ModifyEvent=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.features=r,o.mapBrowserEvent=n,o}return __extends(t,e),t}(_Event.default);exports.ModifyEvent=ModifyEvent;var Modify=function(e){function t(t){var r,n=e.call(this,t)||this;if(n.boundHandleFeatureChange_=n.handleFeatureChange_.bind(n),n.condition_=t.condition?t.condition:_condition.primaryAction,n.defaultDeleteCondition_=function(e){return(0,_condition.altKeyOnly)(e)&&(0,_condition.singleClick)(e)},n.deleteCondition_=t.deleteCondition?t.deleteCondition:n.defaultDeleteCondition_,n.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:_condition.always,n.vertexFeature_=null,n.vertexSegments_=null,n.lastPixel_=[0,0],n.ignoreNextSingleClick_=!1,n.modified_=!1,n.rBush_=new _RBush.default,n.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,n.snappedToVertex_=!1,n.changingFeature_=!1,n.dragSegments_=[],n.overlay_=new _Vector.default({source:new _Vector2.default({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:getDefaultStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),n.SEGMENT_WRITERS_={Point:n.writePointGeometry_.bind(n),LineString:n.writeLineStringGeometry_.bind(n),LinearRing:n.writeLineStringGeometry_.bind(n),Polygon:n.writePolygonGeometry_.bind(n),MultiPoint:n.writeMultiPointGeometry_.bind(n),MultiLineString:n.writeMultiLineStringGeometry_.bind(n),MultiPolygon:n.writeMultiPolygonGeometry_.bind(n),Circle:n.writeCircleGeometry_.bind(n),GeometryCollection:n.writeGeometryCollectionGeometry_.bind(n)},n.source_=null,t.source?(n.source_=t.source,r=new _Collection.default(n.source_.getFeatures()),n.source_.addEventListener(_VectorEventType.default.ADDFEATURE,n.handleSourceAdd_.bind(n)),n.source_.addEventListener(_VectorEventType.default.REMOVEFEATURE,n.handleSourceRemove_.bind(n))):r=t.features,!r)throw new Error("The modify interaction requires features or a source");return n.features_=r,n.features_.forEach(n.addFeature_.bind(n)),n.features_.addEventListener(_CollectionEventType.default.ADD,n.handleFeatureAdd_.bind(n)),n.features_.addEventListener(_CollectionEventType.default.REMOVE,n.handleFeatureRemove_.bind(n)),n.lastPointerEvent_=null,n}return __extends(t,e),t.prototype.addFeature_=function(e){var t=e.getGeometry();if(t){var r=this.SEGMENT_WRITERS_[t.getType()];r&&r(e,t)}var n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),e.addEventListener(_EventType.default.CHANGE,this.boundHandleFeatureChange_)},t.prototype.willModifyFeatures_=function(e){this.modified_||(this.modified_=!0,this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYSTART,this.features_,e)))},t.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(_EventType.default.CHANGE,this.boundHandleFeatureChange_)},t.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,r=[];t.forEach(function(t){e===t.feature&&r.push(t)});for(var n=r.length-1;n>=0;--n){for(var o=r[n],i=this.dragSegments_.length-1;i>=0;--i)this.dragSegments_[i][0]===o&&this.dragSegments_.splice(i,1);t.remove(o)}},t.prototype.setActive=function(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.prototype.setActive.call(this,t)},t.prototype.setMap=function(t){this.overlay_.setMap(t),e.prototype.setMap.call(this,t)},t.prototype.getOverlay=function(){return this.overlay_},t.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)},t.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)},t.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)},t.prototype.handleFeatureChange_=function(e){if(!this.changingFeature_){var t=e.target;this.removeFeature_(t),this.addFeature_(t)}},t.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},t.prototype.writePointGeometry_=function(e,t){var r=t.getCoordinates(),n={feature:e,geometry:t,segment:[r,r]};this.rBush_.insert(t.getExtent(),n)},t.prototype.writeMultiPointGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length;n<o;++n){var i=r[n],a={feature:e,geometry:t,depth:[n],index:n,segment:[i,i]};this.rBush_.insert(t.getExtent(),a)}},t.prototype.writeLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length-1;n<o;++n){var i=r.slice(n,n+2),a={feature:e,geometry:t,index:n,segment:i};this.rBush_.insert((0,_extent.boundingExtent)(i),a)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length;n<o;++n)for(var i=r[n],a=0,s=i.length-1;a<s;++a){var u=i.slice(a,a+2),d={feature:e,geometry:t,depth:[n],index:a,segment:u};this.rBush_.insert((0,_extent.boundingExtent)(u),d)}},t.prototype.writePolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length;n<o;++n)for(var i=r[n],a=0,s=i.length-1;a<s;++a){var u=i.slice(a,a+2),d={feature:e,geometry:t,depth:[n],index:a,segment:u};this.rBush_.insert((0,_extent.boundingExtent)(u),d)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length;n<o;++n)for(var i=r[n],a=0,s=i.length;a<s;++a)for(var u=i[a],d=0,_=u.length-1;d<_;++d){var l=u.slice(d,d+2),g={feature:e,geometry:t,depth:[a,n],index:d,segment:l};this.rBush_.insert((0,_extent.boundingExtent)(l),g)}},t.prototype.writeCircleGeometry_=function(e,t){var r=t.getCenter(),n={feature:e,geometry:t,index:CIRCLE_CENTER_INDEX,segment:[r,r]},o={feature:e,geometry:t,index:CIRCLE_CIRCUMFERENCE_INDEX,segment:[r,r]},i=[n,o];n.featureSegments=i,o.featureSegments=i,this.rBush_.insert((0,_extent.createOrUpdateFromCoordinate)(r),n);var a=t,s=(0,_proj.getUserProjection)();if(s&&this.getMap()){var u=this.getMap().getView().getProjection();a=a.clone().transform(s,u),a=(0,_Polygon.fromCircle)(a).transform(u,s)}this.rBush_.insert(a.getExtent(),o)},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),n=0;n<r.length;++n){var o=r[n];(0,this.SEGMENT_WRITERS_[o.getType()])(e,o)}},t.prototype.createOrUpdateVertexFeature_=function(e){var t=this.vertexFeature_;t?t.getGeometry().setCoordinates(e):(t=new _Feature.default(new _Point.default(e)),this.vertexFeature_=t,this.overlay_.getSource().addFeature(t));return t},t.prototype.handleEvent=function(t){return!t.originalEvent||(this.lastPointerEvent_=t,t.map.getView().getInteracting()||t.type!=_MapBrowserEventType.default.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(r=!(t.type!=_MapBrowserEventType.default.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),t.type==_MapBrowserEventType.default.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),e.prototype.handleEvent.call(this,t)&&!r);var r},t.prototype.handleDragEvent=function(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e);for(var t=e.coordinate,r=0,n=this.dragSegments_.length;r<n;++r){for(var o=this.dragSegments_[r],i=o[0],a=i.depth,s=i.geometry,u=void 0,d=i.segment,_=o[1];t.length<s.getStride();)t.push(d[_][t.length]);switch(s.getType()){case _GeometryType.default.POINT:u=t,d[0]=t,d[1]=t;break;case _GeometryType.default.MULTI_POINT:(u=s.getCoordinates())[i.index]=t,d[0]=t,d[1]=t;break;case _GeometryType.default.LINE_STRING:(u=s.getCoordinates())[i.index+_]=t,d[_]=t;break;case _GeometryType.default.MULTI_LINE_STRING:case _GeometryType.default.POLYGON:(u=s.getCoordinates())[a[0]][i.index+_]=t,d[_]=t;break;case _GeometryType.default.MULTI_POLYGON:(u=s.getCoordinates())[a[1]][a[0]][i.index+_]=t,d[_]=t;break;case _GeometryType.default.CIRCLE:if(d[0]=t,d[1]=t,i.index===CIRCLE_CENTER_INDEX)this.changingFeature_=!0,s.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;var l=e.map.getView().getProjection(),g=(0,_coordinate.distance)((0,_proj.fromUserCoordinate)(s.getCenter(),l),(0,_proj.fromUserCoordinate)(t,l)),p=(0,_proj.getUserProjection)();if(p){var h=s.clone().transform(p,l);h.setRadius(g),g=h.transform(l,p).getRadius()}s.setRadius(g),this.changingFeature_=!1}}u&&this.setGeometryCoordinates_(s,u)}this.createOrUpdateVertexFeature_(t)},t.prototype.handleDownEvent=function(e){if(!this.condition_(e))return!1;var t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.modified_=!1;var r=this.vertexFeature_;if(r){var n=e.map.getView().getProjection(),o=[],i=r.getGeometry().getCoordinates(),a=(0,_extent.boundingExtent)([i]),s=this.rBush_.getInExtent(a),u={};s.sort(compareIndexes);for(var d=0,_=s.length;d<_;++d){var l=s[d],g=l.segment,p=(0,_util.getUid)(l.geometry),h=l.depth;if(h&&(p+="-"+h.join("-")),u[p]||(u[p]=new Array(2)),l.geometry.getType()!==_GeometryType.default.CIRCLE||l.index!==CIRCLE_CIRCUMFERENCE_INDEX)if(!(0,_coordinate.equals)(g[0],i)||u[p][0])if(!(0,_coordinate.equals)(g[1],i)||u[p][1])(0,_util.getUid)(g)in this.vertexSegments_&&!u[p][0]&&!u[p][1]&&this.insertVertexCondition_(e)&&o.push([l,i]);else{if((l.geometry.getType()===_GeometryType.default.LINE_STRING||l.geometry.getType()===_GeometryType.default.MULTI_LINE_STRING)&&u[p][0]&&0===u[p][0].index)continue;this.dragSegments_.push([l,1]),u[p][1]=l}else this.dragSegments_.push([l,0]),u[p][0]=l;else{var f=closestOnSegmentData(t,l,n);(0,_coordinate.equals)(f,i)&&!u[p][0]&&(this.dragSegments_.push([l,0]),u[p][0]=l)}}o.length&&this.willModifyFeatures_(e);for(var c=o.length-1;c>=0;--c)this.insertVertex_.apply(this,o[c])}return!!this.vertexFeature_},t.prototype.handleUpEvent=function(e){for(var t=this.dragSegments_.length-1;t>=0;--t){var r=this.dragSegments_[t][0],n=r.geometry;if(n.getType()===_GeometryType.default.CIRCLE){var o=n.getCenter(),i=r.featureSegments[0],a=r.featureSegments[1];i.segment[0]=o,i.segment[1]=o,a.segment[0]=o,a.segment[1]=o,this.rBush_.update((0,_extent.createOrUpdateFromCoordinate)(o),i);var s=n,u=(0,_proj.getUserProjection)();if(u){var d=e.map.getView().getProjection();s=s.clone().transform(u,d),s=(0,_Polygon.fromCircle)(s).transform(d,u)}this.rBush_.update(s.getExtent(),a)}else this.rBush_.update((0,_extent.boundingExtent)(r.segment),r)}return this.modified_&&(this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND,this.features_,e)),this.modified_=!1),!1},t.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)},t.prototype.handlePointerAtPixel_=function(e,t,r){var n=r||t.getCoordinateFromPixel(e),o=t.getView().getProjection(),i=(0,_proj.fromUserExtent)((0,_extent.createOrUpdateFromCoordinate)(n,tempExtent),o),a=t.getView().getResolution()*this.pixelTolerance_,s=(0,_proj.toUserExtent)((0,_extent.buffer)(i,a,tempExtent),o),u=this.rBush_.getInExtent(s);if(u.length>0){u.sort(function(e,t){return projectedDistanceToSegmentDataSquared(n,e,o)-projectedDistanceToSegmentDataSquared(n,t,o)});var d=u[0],_=d.segment,l=closestOnSegmentData(n,d,o),g=t.getPixelFromCoordinate(l),p=(0,_coordinate.distance)(e,g);if(p<=this.pixelTolerance_){var h={};if(d.geometry.getType()===_GeometryType.default.CIRCLE&&d.index===CIRCLE_CIRCUMFERENCE_INDEX)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(l);else{var f=t.getPixelFromCoordinate(_[0]),c=t.getPixelFromCoordinate(_[1]),y=(0,_coordinate.squaredDistance)(g,f),m=(0,_coordinate.squaredDistance)(g,c);p=Math.sqrt(Math.min(y,m)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(l=y>m?_[1]:_[0]),this.createOrUpdateVertexFeature_(l);for(var v=1,E=u.length;v<E;++v){var x=u[v].segment;if(!((0,_coordinate.equals)(_[0],x[0])&&(0,_coordinate.equals)(_[1],x[1])||(0,_coordinate.equals)(_[0],x[1])&&(0,_coordinate.equals)(_[1],x[0])))break;h[(0,_util.getUid)(x)]=!0}}return h[(0,_util.getUid)(_)]=!0,void(this.vertexSegments_=h)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},t.prototype.insertVertex_=function(e,t){for(var r,n=e.segment,o=e.feature,i=e.geometry,a=e.depth,s=e.index;t.length<i.getStride();)t.push(0);switch(i.getType()){case _GeometryType.default.MULTI_LINE_STRING:case _GeometryType.default.POLYGON:(r=i.getCoordinates())[a[0]].splice(s+1,0,t);break;case _GeometryType.default.MULTI_POLYGON:(r=i.getCoordinates())[a[1]][a[0]].splice(s+1,0,t);break;case _GeometryType.default.LINE_STRING:(r=i.getCoordinates()).splice(s+1,0,t);break;default:return}this.setGeometryCoordinates_(i,r);var u=this.rBush_;u.remove(e),this.updateSegmentIndices_(i,s,a,1);var d={segment:[n[0],t],feature:o,geometry:i,depth:a,index:s};u.insert((0,_extent.boundingExtent)(d.segment),d),this.dragSegments_.push([d,1]);var _={segment:[t,n[1]],feature:o,geometry:i,depth:a,index:s+1};u.insert((0,_extent.boundingExtent)(_.segment),_),this.dragSegments_.push([_,0]),this.ignoreNextSingleClick_=!0},t.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=_MapBrowserEventType.default.POINTERDRAG){var e=this.lastPointerEvent_;this.willModifyFeatures_(e);var t=this.removeVertex_();return this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND,this.features_,e)),this.modified_=!1,t}return!1},t.prototype.removeVertex_=function(){var e,t,r,n,o,i,a,s,u,d,_,l=this.dragSegments_,g={},p=!1;for(o=l.length-1;o>=0;--o)d=(r=l[o])[0],_=(0,_util.getUid)(d.feature),d.depth&&(_+="-"+d.depth.join("-")),_ in g||(g[_]={}),0===r[1]?(g[_].right=d,g[_].index=d.index):1==r[1]&&(g[_].left=d,g[_].index=d.index+1);for(_ in g){switch(u=g[_].right,a=g[_].left,(s=(i=g[_].index)-1)<0&&(s=0),e=t=(n=(d=void 0!==a?a:u).geometry).getCoordinates(),p=!1,n.getType()){case _GeometryType.default.MULTI_LINE_STRING:t[d.depth[0]].length>2&&(t[d.depth[0]].splice(i,1),p=!0);break;case _GeometryType.default.LINE_STRING:t.length>2&&(t.splice(i,1),p=!0);break;case _GeometryType.default.MULTI_POLYGON:e=e[d.depth[1]];case _GeometryType.default.POLYGON:(e=e[d.depth[0]]).length>4&&(i==e.length-1&&(i=0),e.splice(i,1),p=!0,0===i&&(e.pop(),e.push(e[0]),s=e.length-1))}if(p){this.setGeometryCoordinates_(n,t);var h=[];if(void 0!==a&&(this.rBush_.remove(a),h.push(a.segment[0])),void 0!==u&&(this.rBush_.remove(u),h.push(u.segment[1])),void 0!==a&&void 0!==u){var f={depth:d.depth,feature:d.feature,geometry:d.geometry,index:s,segment:h};this.rBush_.insert((0,_extent.boundingExtent)(f.segment),f)}this.updateSegmentIndices_(n,i,d.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),l.length=0}}return p},t.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1},t.prototype.updateSegmentIndices_=function(e,t,r,n){this.rBush_.forEachInExtent(e.getExtent(),function(o){o.geometry===e&&(void 0===r||void 0===o.depth||(0,_array.equals)(o.depth,r))&&o.index>t&&(o.index+=n)})},t}(_Pointer.default);function compareIndexes(e,t){return e.index-t.index}function projectedDistanceToSegmentDataSquared(e,t,r){var n=t.geometry;if(n.getType()===_GeometryType.default.CIRCLE){var o=n;if(t.index===CIRCLE_CIRCUMFERENCE_INDEX){var i=(0,_proj.getUserProjection)();i&&(o=o.clone().transform(i,r));var a=(0,_coordinate.squaredDistance)(o.getCenter(),(0,_proj.fromUserCoordinate)(e,r)),s=Math.sqrt(a)-o.getRadius();return s*s}}var u=(0,_proj.fromUserCoordinate)(e,r);return tempSegment[0]=(0,_proj.fromUserCoordinate)(t.segment[0],r),tempSegment[1]=(0,_proj.fromUserCoordinate)(t.segment[1],r),(0,_coordinate.squaredDistanceToSegment)(u,tempSegment)}function closestOnSegmentData(e,t,r){var n=t.geometry;if(n.getType()===_GeometryType.default.CIRCLE&&t.index===CIRCLE_CIRCUMFERENCE_INDEX){var o=n,i=(0,_proj.getUserProjection)();return i&&(o=o.clone().transform(i,r)),(0,_proj.toUserCoordinate)(o.getClosestPoint((0,_proj.fromUserCoordinate)(e,r)),r)}var a=(0,_proj.fromUserCoordinate)(e,r);return tempSegment[0]=(0,_proj.fromUserCoordinate)(t.segment[0],r),tempSegment[1]=(0,_proj.fromUserCoordinate)(t.segment[1],r),(0,_proj.toUserCoordinate)((0,_coordinate.closestOnSegment)(a,tempSegment),r)}function getDefaultStyleFunction(){var e=(0,_Style.createEditingStyle)();return function(t,r){return e[_GeometryType.default.POINT]}}var _default=Modify;exports.default=_default;

},{"../Collection.js":10,"../CollectionEventType.js":11,"../Feature.js":13,"../MapBrowserEventType.js":24,"../array.js":44,"../coordinate.js":60,"../events/Event.js":65,"../events/EventType.js":66,"../events/condition.js":69,"../extent.js":70,"../geom/GeometryType.js":131,"../geom/Point.js":137,"../geom/Polygon.js":138,"../layer/Vector.js":196,"../proj.js":205,"../source/Vector.js":277,"../source/VectorEventType.js":278,"../structs/RBush.js":290,"../style/Style.js":302,"../util.js":313,"./Pointer.js":178}],175:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Mode=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_Interaction=_interopRequireWildcard(require("./Interaction.js")),_has=require("../has.js"),_condition=require("../events/condition.js"),_math=require("../math.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return _getRequireWildcardCache=function(){return t},t}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;if(null===t||"object"!==_typeof(t)&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=i?Object.getOwnPropertyDescriptor(t,n):null;r&&(r.get||r.set)?Object.defineProperty(o,n,r):o[n]=t[n]}return o.default=t,e&&e.set(t,o),o}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),Mode={TRACKPAD:"trackpad",WHEEL:"wheel"};exports.Mode=Mode;var MouseWheelZoom=function(t){function e(e){var o=this,i=e||{};(o=t.call(this,i)||this).totalDelta_=0,o.lastDelta_=0,o.maxDelta_=void 0!==i.maxDelta?i.maxDelta:1,o.duration_=void 0!==i.duration?i.duration:250,o.timeout_=void 0!==i.timeout?i.timeout:80,o.useAnchor_=void 0===i.useAnchor||i.useAnchor,o.constrainResolution_=void 0!==i.constrainResolution&&i.constrainResolution;var n=i.condition?i.condition:_condition.always;return o.condition_=i.onFocusOnly?(0,_condition.all)(_condition.focusWithTabindex,n):n,o.lastAnchor_=null,o.startTime_=void 0,o.timeoutId_,o.mode_=void 0,o.trackpadEventGap_=400,o.trackpadTimeoutId_,o.deltaPerZoom_=300,o}return __extends(e,t),e.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},e.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;if(t.type!==_EventType.default.WHEEL)return!0;t.preventDefault();var e,o=t.map,i=t.originalEvent;if(this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==_EventType.default.WHEEL&&(e=i.deltaY,_has.FIREFOX&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(e/=_has.DEVICE_PIXEL_RATIO),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(e*=40)),0===e)return!1;this.lastDelta_=e;var n=Date.now();void 0===this.startTime_&&(this.startTime_=n),(!this.mode_||n-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(e)<4?Mode.TRACKPAD:Mode.WHEEL);var r=o.getView();if(this.mode_===Mode.TRACKPAD&&!r.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(r.getAnimating()&&r.cancelAnimations(),r.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),r.adjustZoom(-e/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=n,!1;this.totalDelta_+=e;var a=Math.max(this.timeout_-(n-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,o),a),!1},e.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();var o=-(0,_math.clamp)(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(o=o?o>0?1:-1:0),(0,_Interaction.zoomByDelta)(e,o,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},e.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},e}(_Interaction.default),_default=MouseWheelZoom;exports.default=_default;

},{"../events/EventType.js":66,"../events/condition.js":69,"../has.js":159,"../math.js":201,"./Interaction.js":171}],176:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Pointer=_interopRequireWildcard(require("./Pointer.js")),_functions=require("../functions.js"),_rotationconstraint=require("../rotationconstraint.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return _getRequireWildcardCache=function(){return t},t}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;if(null===t||"object"!==_typeof(t)&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var i=r?Object.getOwnPropertyDescriptor(t,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=t[o]}return n.default=t,e&&e.set(t,n),n}var __extends=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),PinchRotate=function(t){function e(e){var n=this,r=e||{},o=r;return o.stopDown||(o.stopDown=_functions.FALSE),(n=t.call(this,o)||this).anchor_=null,n.lastAngle_=void 0,n.rotating_=!1,n.rotationDelta_=0,n.threshold_=void 0!==r.threshold?r.threshold:.3,n.duration_=void 0!==r.duration?r.duration:250,n}return __extends(e,t),e.prototype.handleDragEvent=function(t){var e=0,n=this.targetPointers[0],r=this.targetPointers[1],o=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(void 0!==this.lastAngle_){var i=o-this.lastAngle_;this.rotationDelta_+=i,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=i}this.lastAngle_=o;var a=t.map,s=a.getView();if(s.getConstraints().rotation!==_rotationconstraint.disable){var u=a.getViewport().getBoundingClientRect(),l=(0,_Pointer.centroid)(this.targetPointers);l[0]-=u.left,l[1]-=u.top,this.anchor_=a.getCoordinateFromPixelInternal(l),this.rotating_&&(a.render(),s.adjustRotationInternal(e,this.anchor_))}},e.prototype.handleUpEvent=function(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_),!1)},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},e}(_Pointer.default),_default=PinchRotate;exports.default=_default;

},{"../functions.js":125,"../rotationconstraint.js":250,"./Pointer.js":178}],177:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Pointer=_interopRequireWildcard(require("./Pointer.js")),_functions=require("../functions.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return _getRequireWildcardCache=function(){return t},t}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;if(null===t||"object"!==_typeof(t)&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var i=r?Object.getOwnPropertyDescriptor(t,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=t[o]}return n.default=t,e&&e.set(t,n),n}var __extends=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),PinchZoom=function(t){function e(e){var n=this,r=e||{},o=r;return o.stopDown||(o.stopDown=_functions.FALSE),(n=t.call(this,o)||this).anchor_=null,n.duration_=void 0!==r.duration?r.duration:400,n.lastDistance_=void 0,n.lastScaleDelta_=1,n}return __extends(e,t),e.prototype.handleDragEvent=function(t){var e=1,n=this.targetPointers[0],r=this.targetPointers[1],o=n.clientX-r.clientX,i=n.clientY-r.clientY,a=Math.sqrt(o*o+i*i);void 0!==this.lastDistance_&&(e=this.lastDistance_/a),this.lastDistance_=a;var c=t.map,u=c.getView();1!=e&&(this.lastScaleDelta_=e);var s=c.getViewport().getBoundingClientRect(),l=(0,_Pointer.centroid)(this.targetPointers);l[0]-=s.left,l[1]-=s.top,this.anchor_=c.getCoordinateFromPixelInternal(l),c.render(),u.adjustResolutionInternal(e,this.anchor_)},e.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map.getView(),n=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,n),!1}return!0},e.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1},e}(_Pointer.default),_default=PinchZoom;exports.default=_default;

},{"../functions.js":125,"./Pointer.js":178}],178:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.centroid=centroid,exports.default=void 0;var _Interaction=_interopRequireDefault(require("./Interaction.js")),_MapBrowserEventType=_interopRequireDefault(require("../MapBrowserEventType.js")),_obj=require("../obj.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),PointerInteraction=function(e){function t(t){var n=this,r=t||{};return n=e.call(this,r)||this,r.handleDownEvent&&(n.handleDownEvent=r.handleDownEvent),r.handleDragEvent&&(n.handleDragEvent=r.handleDragEvent),r.handleMoveEvent&&(n.handleMoveEvent=r.handleMoveEvent),r.handleUpEvent&&(n.handleUpEvent=r.handleUpEvent),r.stopDown&&(n.stopDown=r.stopDown),n.handlingDownUpSequence=!1,n.trackedPointers_={},n.targetPointers=[],n}return __extends(t,e),t.prototype.getPointerCount=function(){return this.targetPointers.length},t.prototype.handleDownEvent=function(e){return!1},t.prototype.handleDragEvent=function(e){},t.prototype.handleEvent=function(e){if(!e.originalEvent)return!0;var t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==_MapBrowserEventType.default.POINTERDRAG)this.handleDragEvent(e),e.preventDefault();else if(e.type==_MapBrowserEventType.default.POINTERUP){var n=this.handleUpEvent(e);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(e.type==_MapBrowserEventType.default.POINTERDOWN){var r=this.handleDownEvent(e);this.handlingDownUpSequence=r,t=this.stopDown(r)}else e.type==_MapBrowserEventType.default.POINTERMOVE&&this.handleMoveEvent(e);return!t},t.prototype.handleMoveEvent=function(e){},t.prototype.handleUpEvent=function(e){return!1},t.prototype.stopDown=function(e){return e},t.prototype.updateTrackedPointers_=function(e){if(isPointerDraggingEvent(e)){var t=e.originalEvent,n=t.pointerId.toString();e.type==_MapBrowserEventType.default.POINTERUP?delete this.trackedPointers_[n]:e.type==_MapBrowserEventType.default.POINTERDOWN?this.trackedPointers_[n]=t:n in this.trackedPointers_&&(this.trackedPointers_[n]=t),this.targetPointers=(0,_obj.getValues)(this.trackedPointers_)}},t}(_Interaction.default);function centroid(e){for(var t=e.length,n=0,r=0,o=0;o<t;o++)n+=e[o].clientX,r+=e[o].clientY;return[n/t,r/t]}function isPointerDraggingEvent(e){var t=e.type;return t===_MapBrowserEventType.default.POINTERDOWN||t===_MapBrowserEventType.default.POINTERDRAG||t===_MapBrowserEventType.default.POINTERUP}var _default=PointerInteraction;exports.default=_default;

},{"../MapBrowserEventType.js":24,"../obj.js":203,"./Interaction.js":171}],179:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={ACTIVE:"active"};exports.default=_default;

},{}],180:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Collection=_interopRequireDefault(require("../Collection.js")),_CollectionEventType=_interopRequireDefault(require("../CollectionEventType.js")),_Event=_interopRequireDefault(require("../events/Event.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_Interaction=_interopRequireDefault(require("./Interaction.js")),_functions=require("../functions.js"),_obj=require("../obj.js"),_Style=require("../style/Style.js"),_array=require("../array.js"),_util=require("../util.js"),_condition=require("../events/condition.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),SelectEventType={SELECT:"select"},SelectEvent=function(e){function t(t,i,r,n){var o=e.call(this,t)||this;return o.selected=i,o.deselected=r,o.mapBrowserEvent=n,o}return __extends(t,e),t}(_Event.default),originalFeatureStyles={},Select=function(e){function t(t){var i,r=e.call(this)||this,n=t||{};if(r.boundAddFeature_=r.addFeature_.bind(r),r.boundRemoveFeature_=r.removeFeature_.bind(r),r.condition_=n.condition?n.condition:_condition.singleClick,r.addCondition_=n.addCondition?n.addCondition:_condition.never,r.removeCondition_=n.removeCondition?n.removeCondition:_condition.never,r.toggleCondition_=n.toggleCondition?n.toggleCondition:_condition.shiftKeyOnly,r.multi_=!!n.multi&&n.multi,r.filter_=n.filter?n.filter:_functions.TRUE,r.hitTolerance_=n.hitTolerance?n.hitTolerance:0,r.style_=void 0!==n.style?n.style:getDefaultStyleFunction(),r.features_=n.features||new _Collection.default,n.layers)if("function"==typeof n.layers)i=n.layers;else{var o=n.layers;i=function(e){return(0,_array.includes)(o,e)}}else i=_functions.TRUE;return r.layerFilter_=i,r.featureLayerAssociation_={},r}return __extends(t,e),t.prototype.addFeatureLayerAssociation_=function(e,t){this.featureLayerAssociation_[(0,_util.getUid)(e)]=t},t.prototype.getFeatures=function(){return this.features_},t.prototype.getHitTolerance=function(){return this.hitTolerance_},t.prototype.getLayer=function(e){return this.featureLayerAssociation_[(0,_util.getUid)(e)]},t.prototype.setHitTolerance=function(e){this.hitTolerance_=e},t.prototype.setMap=function(t){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),e.prototype.setMap.call(this,t),t?(this.features_.addEventListener(_CollectionEventType.default.ADD,this.boundAddFeature_),this.features_.addEventListener(_CollectionEventType.default.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(_CollectionEventType.default.ADD,this.boundAddFeature_),this.features_.removeEventListener(_CollectionEventType.default.REMOVE,this.boundRemoveFeature_))},t.prototype.addFeature_=function(e){var t=e.element;this.style_&&this.applySelectedStyle_(t)},t.prototype.removeFeature_=function(e){var t=e.element;this.style_&&this.restorePreviousStyle_(t)},t.prototype.getStyle=function(){return this.style_},t.prototype.applySelectedStyle_=function(e){var t=(0,_util.getUid)(e);t in originalFeatureStyles||(originalFeatureStyles[t]=e.getStyle()),e.setStyle(this.style_)},t.prototype.restorePreviousStyle_=function(e){var i=(0,_util.getUid)(e),r=this.getMap().getInteractions().getArray().filter(function(i){return i instanceof t&&i.getStyle()&&-1!==i.getFeatures().getArray().indexOf(e)});r.length>0?e.setStyle(r[r.length-1].getStyle()):(e.setStyle(originalFeatureStyles[i]),delete originalFeatureStyles[i])},t.prototype.removeFeatureLayerAssociation_=function(e){delete this.featureLayerAssociation_[(0,_util.getUid)(e)]},t.prototype.handleEvent=function(e){if(!this.condition_(e))return!0;var t=this.addCondition_(e),i=this.removeCondition_(e),r=this.toggleCondition_(e),n=!t&&!i&&!r,o=e.map,a=this.getFeatures(),l=[],s=[];if(n){(0,_obj.clear)(this.featureLayerAssociation_),o.forEachFeatureAtPixel(e.pixel,function(e,t){if(this.filter_(e,t))return s.push(e),this.addFeatureLayerAssociation_(e,t),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var u=a.getLength()-1;u>=0;--u){var _=a.item(u),c=s.indexOf(_);c>-1?s.splice(c,1):(a.remove(_),l.push(_))}0!==s.length&&a.extend(s)}else{o.forEachFeatureAtPixel(e.pixel,function(e,n){if(this.filter_(e,n))return!t&&!r||(0,_array.includes)(a.getArray(),e)?(i||r)&&(0,_array.includes)(a.getArray(),e)&&(l.push(e),this.removeFeatureLayerAssociation_(e)):(s.push(e),this.addFeatureLayerAssociation_(e,n)),!this.multi_}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var y=l.length-1;y>=0;--y)a.remove(l[y]);a.extend(s)}return(s.length>0||l.length>0)&&this.dispatchEvent(new SelectEvent(SelectEventType.SELECT,s,l,e)),!0},t}(_Interaction.default);function getDefaultStyleFunction(){var e=(0,_Style.createEditingStyle)();return(0,_array.extend)(e[_GeometryType.default.POLYGON],e[_GeometryType.default.LINE_STRING]),(0,_array.extend)(e[_GeometryType.default.GEOMETRY_COLLECTION],e[_GeometryType.default.LINE_STRING]),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}}var _default=Select;exports.default=_default;

},{"../Collection.js":10,"../CollectionEventType.js":11,"../array.js":44,"../events/Event.js":65,"../events/condition.js":69,"../functions.js":125,"../geom/GeometryType.js":131,"../obj.js":203,"../style/Style.js":302,"../util.js":313,"./Interaction.js":171}],181:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _CollectionEventType=_interopRequireDefault(require("../CollectionEventType.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_Pointer=_interopRequireDefault(require("./Pointer.js")),_RBush=_interopRequireDefault(require("../structs/RBush.js")),_VectorEventType=_interopRequireDefault(require("../source/VectorEventType.js")),_functions=require("../functions.js"),_extent=require("../extent.js"),_coordinate=require("../coordinate.js"),_Polygon=require("../geom/Polygon.js"),_proj=require("../proj.js"),_util=require("../util.js"),_obj=require("../obj.js"),_events=require("../events.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function getFeatureFromEvent(e){return e.feature?e.feature:e.element?e.element:void 0}var tempSegment=[],Snap=function(e){function t(t){var r=this,n=t||{},o=n;return o.handleDownEvent||(o.handleDownEvent=_functions.TRUE),o.stopDown||(o.stopDown=_functions.FALSE),(r=e.call(this,o)||this).source_=n.source?n.source:null,r.vertex_=void 0===n.vertex||n.vertex,r.edge_=void 0===n.edge||n.edge,r.features_=n.features?n.features:null,r.featuresListenerKeys_=[],r.featureChangeListenerKeys_={},r.indexedFeaturesExtents_={},r.pendingFeatures_={},r.pixelTolerance_=void 0!==n.pixelTolerance?n.pixelTolerance:10,r.rBush_=new _RBush.default,r.SEGMENT_WRITERS_={Point:r.writePointGeometry_.bind(r),LineString:r.writeLineStringGeometry_.bind(r),LinearRing:r.writeLineStringGeometry_.bind(r),Polygon:r.writePolygonGeometry_.bind(r),MultiPoint:r.writeMultiPointGeometry_.bind(r),MultiLineString:r.writeMultiLineStringGeometry_.bind(r),MultiPolygon:r.writeMultiPolygonGeometry_.bind(r),GeometryCollection:r.writeGeometryCollectionGeometry_.bind(r),Circle:r.writeCircleGeometry_.bind(r)},r}return __extends(t,e),t.prototype.addFeature=function(e,t){var r=void 0===t||t,n=(0,_util.getUid)(e),o=e.getGeometry();if(o){var i=this.SEGMENT_WRITERS_[o.getType()];i&&(this.indexedFeaturesExtents_[n]=o.getExtent((0,_extent.createEmpty)()),i(e,o))}r&&(this.featureChangeListenerKeys_[n]=(0,_events.listen)(e,_EventType.default.CHANGE,this.handleFeatureChange_,this))},t.prototype.forEachFeatureAdd_=function(e){this.addFeature(e)},t.prototype.forEachFeatureRemove_=function(e){this.removeFeature(e)},t.prototype.getFeatures_=function(){var e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e},t.prototype.handleEvent=function(t){var r=this.snapTo(t.pixel,t.coordinate,t.map);return r.snapped&&(t.coordinate=r.vertex.slice(0,2),t.pixel=r.vertexPixel),e.prototype.handleEvent.call(this,t)},t.prototype.handleFeatureAdd_=function(e){var t=getFeatureFromEvent(e);this.addFeature(t)},t.prototype.handleFeatureRemove_=function(e){var t=getFeatureFromEvent(e);this.removeFeature(t)},t.prototype.handleFeatureChange_=function(e){var t=e.target;if(this.handlingDownUpSequence){var r=(0,_util.getUid)(t);r in this.pendingFeatures_||(this.pendingFeatures_[r]=t)}else this.updateFeature_(t)},t.prototype.handleUpEvent=function(e){var t=(0,_obj.getValues)(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},t.prototype.removeFeature=function(e,t){var r=void 0===t||t,n=(0,_util.getUid)(e),o=this.indexedFeaturesExtents_[n];if(o){var i=this.rBush_,s=[];i.forEachInExtent(o,function(t){e===t.feature&&s.push(t)});for(var a=s.length-1;a>=0;--a)i.remove(s[a])}r&&((0,_events.unlistenByKey)(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])},t.prototype.setMap=function(t){var r=this.getMap(),n=this.featuresListenerKeys_,o=this.getFeatures_();r&&(n.forEach(_events.unlistenByKey),n.length=0,o.forEach(this.forEachFeatureRemove_.bind(this))),e.prototype.setMap.call(this,t),t&&(this.features_?n.push((0,_events.listen)(this.features_,_CollectionEventType.default.ADD,this.handleFeatureAdd_,this),(0,_events.listen)(this.features_,_CollectionEventType.default.REMOVE,this.handleFeatureRemove_,this)):this.source_&&n.push((0,_events.listen)(this.source_,_VectorEventType.default.ADDFEATURE,this.handleFeatureAdd_,this),(0,_events.listen)(this.source_,_VectorEventType.default.REMOVEFEATURE,this.handleFeatureRemove_,this)),o.forEach(this.forEachFeatureAdd_.bind(this)))},t.prototype.snapTo=function(e,t,r){var n=r.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),o=r.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),i=(0,_extent.boundingExtent)([n,o]),s=this.rBush_.getInExtent(i);this.vertex_&&!this.edge_&&(s=s.filter(function(e){return e.feature.getGeometry().getType()!==_GeometryType.default.CIRCLE}));var a=!1,u=null,_=null;if(0===s.length)return{snapped:a,vertex:u,vertexPixel:_};for(var l,p=r.getView().getProjection(),d=(0,_proj.fromUserCoordinate)(t,p),h=1/0,f=0;f<s.length;++f){var c=s[f];tempSegment[0]=(0,_proj.fromUserCoordinate)(c.segment[0],p),tempSegment[1]=(0,_proj.fromUserCoordinate)(c.segment[1],p);var g=(0,_coordinate.squaredDistanceToSegment)(d,tempSegment);g<h&&(l=c,h=g)}var v=l.segment;if(this.vertex_&&!this.edge_){var y=r.getPixelFromCoordinate(v[0]),m=r.getPixelFromCoordinate(v[1]),x=(0,_coordinate.squaredDistance)(e,y),E=(0,_coordinate.squaredDistance)(e,m);Math.sqrt(Math.min(x,E))<=this.pixelTolerance_&&(a=!0,u=x>E?v[1]:v[0],_=r.getPixelFromCoordinate(u))}else if(this.edge_){var F=l.feature.getGeometry().getType()===_GeometryType.default.CIRCLE;if(F){var C=l.feature.getGeometry(),T=(0,_proj.getUserProjection)();T&&(C=C.clone().transform(T,p)),u=(0,_proj.toUserCoordinate)((0,_coordinate.closestOnCircle)(d,C),p)}else tempSegment[0]=(0,_proj.fromUserCoordinate)(v[0],p),tempSegment[1]=(0,_proj.fromUserCoordinate)(v[1],p),u=(0,_proj.toUserCoordinate)((0,_coordinate.closestOnSegment)(d,tempSegment),p);if(_=r.getPixelFromCoordinate(u),(0,_coordinate.distance)(e,_)<=this.pixelTolerance_&&(a=!0,this.vertex_&&!F)){y=r.getPixelFromCoordinate(v[0]),m=r.getPixelFromCoordinate(v[1]),x=(0,_coordinate.squaredDistance)(_,y),E=(0,_coordinate.squaredDistance)(_,m);Math.sqrt(Math.min(x,E))<=this.pixelTolerance_&&(u=x>E?v[1]:v[0],_=r.getPixelFromCoordinate(u))}}return a&&(_=[Math.round(_[0]),Math.round(_[1])]),{snapped:a,vertex:u,vertexPixel:_}},t.prototype.updateFeature_=function(e){this.removeFeature(e,!1),this.addFeature(e,!1)},t.prototype.writeCircleGeometry_=function(e,t){var r=this.getMap().getView().getProjection(),n=t,o=(0,_proj.getUserProjection)();o&&(n=n.clone().transform(o,r));var i=(0,_Polygon.fromCircle)(n);o&&i.transform(r,o);for(var s=i.getCoordinates()[0],a=0,u=s.length-1;a<u;++a){var _=s.slice(a,a+2),l={feature:e,segment:_};this.rBush_.insert((0,_extent.boundingExtent)(_),l)}},t.prototype.writeGeometryCollectionGeometry_=function(e,t){for(var r=t.getGeometriesArray(),n=0;n<r.length;++n){var o=this.SEGMENT_WRITERS_[r[n].getType()];o&&o(e,r[n])}},t.prototype.writeLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length-1;n<o;++n){var i=r.slice(n,n+2),s={feature:e,segment:i};this.rBush_.insert((0,_extent.boundingExtent)(i),s)}},t.prototype.writeMultiLineStringGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length;n<o;++n)for(var i=r[n],s=0,a=i.length-1;s<a;++s){var u=i.slice(s,s+2),_={feature:e,segment:u};this.rBush_.insert((0,_extent.boundingExtent)(u),_)}},t.prototype.writeMultiPointGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length;n<o;++n){var i=r[n],s={feature:e,segment:[i,i]};this.rBush_.insert(t.getExtent(),s)}},t.prototype.writeMultiPolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length;n<o;++n)for(var i=r[n],s=0,a=i.length;s<a;++s)for(var u=i[s],_=0,l=u.length-1;_<l;++_){var p=u.slice(_,_+2),d={feature:e,segment:p};this.rBush_.insert((0,_extent.boundingExtent)(p),d)}},t.prototype.writePointGeometry_=function(e,t){var r=t.getCoordinates(),n={feature:e,segment:[r,r]};this.rBush_.insert(t.getExtent(),n)},t.prototype.writePolygonGeometry_=function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length;n<o;++n)for(var i=r[n],s=0,a=i.length-1;s<a;++s){var u=i.slice(s,s+2),_={feature:e,segment:u};this.rBush_.insert((0,_extent.boundingExtent)(u),_)}},t}(_Pointer.default),_default=Snap;exports.default=_default;

},{"../CollectionEventType.js":11,"../coordinate.js":60,"../events.js":64,"../events/EventType.js":66,"../extent.js":70,"../functions.js":125,"../geom/GeometryType.js":131,"../geom/Polygon.js":138,"../obj.js":203,"../proj.js":205,"../source/VectorEventType.js":278,"../structs/RBush.js":290,"../util.js":313,"./Pointer.js":178}],182:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.TranslateEvent=void 0;var _Collection=_interopRequireDefault(require("../Collection.js")),_Event=_interopRequireDefault(require("../events/Event.js")),_Property=_interopRequireDefault(require("./Property.js")),_Pointer=_interopRequireDefault(require("./Pointer.js")),_functions=require("../functions.js"),_Object=require("../Object.js"),_array=require("../array.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function a(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),TranslateEventType={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"},TranslateEvent=function(t){function e(e,r,a,n,i){var o=t.call(this,e)||this;return o.features=r,o.coordinate=a,o.startCoordinate=n,o.mapBrowserEvent=i,o}return __extends(e,t),e}(_Event.default);exports.TranslateEvent=TranslateEvent;var Translate=function(t){function e(e){var r,a=this,n=e||{};if((a=t.call(this,n)||this).lastCoordinate_=null,a.startCoordinate_=null,a.features_=void 0!==n.features?n.features:null,n.layers)if("function"==typeof n.layers)r=n.layers;else{var i=n.layers;r=function(t){return(0,_array.includes)(i,t)}}else r=_functions.TRUE;return a.layerFilter_=r,a.filter_=n.filter?n.filter:_functions.TRUE,a.hitTolerance_=n.hitTolerance?n.hitTolerance:0,a.lastFeature_=null,a.addEventListener((0,_Object.getChangeEventType)(_Property.default.ACTIVE),a.handleActiveChanged_),a}return __extends(e,t),e.prototype.handleDownEvent=function(t){if(this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=t.coordinate,this.lastCoordinate_=t.coordinate,this.handleMoveEvent(t);var e=this.features_||new _Collection.default([this.lastFeature_]);return this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATESTART,e,t.coordinate,this.startCoordinate_,t)),!0}return!1},e.prototype.handleUpEvent=function(t){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(t);var e=this.features_||new _Collection.default([this.lastFeature_]);return this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATEEND,e,t.coordinate,this.startCoordinate_,t)),this.startCoordinate_=null,!0}return!1},e.prototype.handleDragEvent=function(t){if(this.lastCoordinate_){var e=t.coordinate,r=e[0]-this.lastCoordinate_[0],a=e[1]-this.lastCoordinate_[1],n=this.features_||new _Collection.default([this.lastFeature_]);n.forEach(function(t){var e=t.getGeometry();e.translate(r,a),t.setGeometry(e)}),this.lastCoordinate_=e,this.dispatchEvent(new TranslateEvent(TranslateEventType.TRANSLATING,n,e,this.startCoordinate_,t))}},e.prototype.handleMoveEvent=function(t){var e=t.map.getViewport();this.featuresAtPixel_(t.pixel,t.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")},e.prototype.featuresAtPixel_=function(t,e){return e.forEachFeatureAtPixel(t,function(t,e){if(this.filter_(t,e)&&(!this.features_||(0,_array.includes)(this.features_.getArray(),t)))return t}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})},e.prototype.getHitTolerance=function(){return this.hitTolerance_},e.prototype.setHitTolerance=function(t){this.hitTolerance_=t},e.prototype.setMap=function(e){var r=this.getMap();t.prototype.setMap.call(this,e),this.updateState_(r)},e.prototype.handleActiveChanged_=function(){this.updateState_(null)},e.prototype.updateState_=function(t){var e=this.getMap(),r=this.getActive();e&&r||(e=e||t)&&e.getViewport().classList.remove("ol-grab","ol-grabbing")},e}(_Pointer.default),_default=Translate;exports.default=_default;

},{"../Collection.js":10,"../Object.js":28,"../array.js":44,"../events/Event.js":65,"../functions.js":125,"./Pointer.js":178,"./Property.js":179}],183:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Group",{enumerable:!0,get:function(){return _Group.default}}),Object.defineProperty(exports,"Heatmap",{enumerable:!0,get:function(){return _Heatmap.default}}),Object.defineProperty(exports,"Image",{enumerable:!0,get:function(){return _Image.default}}),Object.defineProperty(exports,"Layer",{enumerable:!0,get:function(){return _Layer.default}}),Object.defineProperty(exports,"Tile",{enumerable:!0,get:function(){return _Tile.default}}),Object.defineProperty(exports,"Vector",{enumerable:!0,get:function(){return _Vector.default}}),Object.defineProperty(exports,"VectorImage",{enumerable:!0,get:function(){return _VectorImage.default}}),Object.defineProperty(exports,"VectorTile",{enumerable:!0,get:function(){return _VectorTile.default}});var _Group=_interopRequireDefault(require("./layer/Group.js")),_Heatmap=_interopRequireDefault(require("./layer/Heatmap.js")),_Image=_interopRequireDefault(require("./layer/Image.js")),_Layer=_interopRequireDefault(require("./layer/Layer.js")),_Tile=_interopRequireDefault(require("./layer/Tile.js")),_Vector=_interopRequireDefault(require("./layer/Vector.js")),_VectorImage=_interopRequireDefault(require("./layer/VectorImage.js")),_VectorTile=_interopRequireDefault(require("./layer/VectorTile.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}

},{"./layer/Group.js":189,"./layer/Heatmap.js":190,"./layer/Image.js":191,"./layer/Layer.js":192,"./layer/Tile.js":194,"./layer/Vector.js":196,"./layer/VectorImage.js":197,"./layer/VectorTile.js":198}],184:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Object=_interopRequireDefault(require("../Object.js")),_Property=_interopRequireDefault(require("./Property.js")),_util=require("../util.js"),_asserts=require("../asserts.js"),_obj=require("../obj.js"),_math=require("../math.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),BaseLayer=function(t){function e(e){var o=t.call(this)||this,r=(0,_obj.assign)({},e);return r[_Property.default.OPACITY]=void 0!==e.opacity?e.opacity:1,(0,_asserts.assert)("number"==typeof r[_Property.default.OPACITY],64),r[_Property.default.VISIBLE]=void 0===e.visible||e.visible,r[_Property.default.Z_INDEX]=e.zIndex,r[_Property.default.MAX_RESOLUTION]=void 0!==e.maxResolution?e.maxResolution:1/0,r[_Property.default.MIN_RESOLUTION]=void 0!==e.minResolution?e.minResolution:0,r[_Property.default.MIN_ZOOM]=void 0!==e.minZoom?e.minZoom:-1/0,r[_Property.default.MAX_ZOOM]=void 0!==e.maxZoom?e.maxZoom:1/0,o.className_=void 0!==r.className?e.className:"ol-layer",delete r.className,o.setProperties(r),o.state_=null,o}return __extends(e,t),e.prototype.getClassName=function(){return this.className_},e.prototype.getLayerState=function(t){var e=this.state_||{layer:this,managed:void 0===t||t},o=this.getZIndex();return e.opacity=(0,_math.clamp)(Math.round(100*this.getOpacity())/100,0,1),e.sourceState=this.getSourceState(),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==o?o:!1===e.managed?1/0:0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e},e.prototype.getLayersArray=function(t){return(0,_util.abstract)()},e.prototype.getLayerStatesArray=function(t){return(0,_util.abstract)()},e.prototype.getExtent=function(){return this.get(_Property.default.EXTENT)},e.prototype.getMaxResolution=function(){return this.get(_Property.default.MAX_RESOLUTION)},e.prototype.getMinResolution=function(){return this.get(_Property.default.MIN_RESOLUTION)},e.prototype.getMinZoom=function(){return this.get(_Property.default.MIN_ZOOM)},e.prototype.getMaxZoom=function(){return this.get(_Property.default.MAX_ZOOM)},e.prototype.getOpacity=function(){return this.get(_Property.default.OPACITY)},e.prototype.getSourceState=function(){return(0,_util.abstract)()},e.prototype.getVisible=function(){return this.get(_Property.default.VISIBLE)},e.prototype.getZIndex=function(){return this.get(_Property.default.Z_INDEX)},e.prototype.setExtent=function(t){this.set(_Property.default.EXTENT,t)},e.prototype.setMaxResolution=function(t){this.set(_Property.default.MAX_RESOLUTION,t)},e.prototype.setMinResolution=function(t){this.set(_Property.default.MIN_RESOLUTION,t)},e.prototype.setMaxZoom=function(t){this.set(_Property.default.MAX_ZOOM,t)},e.prototype.setMinZoom=function(t){this.set(_Property.default.MIN_ZOOM,t)},e.prototype.setOpacity=function(t){(0,_asserts.assert)("number"==typeof t,64),this.set(_Property.default.OPACITY,t)},e.prototype.setVisible=function(t){this.set(_Property.default.VISIBLE,t)},e.prototype.setZIndex=function(t){this.set(_Property.default.Z_INDEX,t)},e.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),t.prototype.disposeInternal.call(this)},e}(_Object.default),_default=BaseLayer;exports.default=_default;

},{"../Object.js":28,"../asserts.js":45,"../math.js":201,"../obj.js":203,"../util.js":313,"./Property.js":193}],185:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Layer=_interopRequireDefault(require("./Layer.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),BaseImageLayer=function(e){function t(t){var r=t||{};return e.call(this,r)||this}return __extends(t,e),t}(_Layer.default),_default=BaseImageLayer;exports.default=_default;

},{"./Layer.js":192}],186:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Layer=_interopRequireDefault(require("./Layer.js")),_TileProperty=_interopRequireDefault(require("./TileProperty.js")),_obj=require("../obj.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),BaseTileLayer=function(e){function t(t){var r=this,o=t||{},n=(0,_obj.assign)({},o);return delete n.preload,delete n.useInterimTilesOnError,(r=e.call(this,n)||this).setPreload(void 0!==o.preload?o.preload:0),r.setUseInterimTilesOnError(void 0===o.useInterimTilesOnError||o.useInterimTilesOnError),r}return __extends(t,e),t.prototype.getPreload=function(){return this.get(_TileProperty.default.PRELOAD)},t.prototype.setPreload=function(e){this.set(_TileProperty.default.PRELOAD,e)},t.prototype.getUseInterimTilesOnError=function(){return this.get(_TileProperty.default.USE_INTERIM_TILES_ON_ERROR)},t.prototype.setUseInterimTilesOnError=function(e){this.set(_TileProperty.default.USE_INTERIM_TILES_ON_ERROR,e)},t}(_Layer.default),_default=BaseTileLayer;exports.default=_default;

},{"../obj.js":203,"./Layer.js":192,"./TileProperty.js":195}],187:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Layer=_interopRequireDefault(require("./Layer.js")),_obj=require("../obj.js"),_Style=require("../style/Style.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Property={RENDER_ORDER:"renderOrder"},BaseVectorLayer=function(e){function t(t){var r=this,n=t||{},i=(0,_obj.assign)({},n);return delete i.style,delete i.renderBuffer,delete i.updateWhileAnimating,delete i.updateWhileInteracting,(r=e.call(this,i)||this).declutter_=void 0!==n.declutter&&n.declutter,r.renderBuffer_=void 0!==n.renderBuffer?n.renderBuffer:100,r.style_=null,r.styleFunction_=void 0,r.setStyle(n.style),r.updateWhileAnimating_=void 0!==n.updateWhileAnimating&&n.updateWhileAnimating,r.updateWhileInteracting_=void 0!==n.updateWhileInteracting&&n.updateWhileInteracting,r}return __extends(t,e),t.prototype.getDeclutter=function(){return this.declutter_},t.prototype.getFeatures=function(t){return e.prototype.getFeatures.call(this,t)},t.prototype.getRenderBuffer=function(){return this.renderBuffer_},t.prototype.getRenderOrder=function(){return this.get(Property.RENDER_ORDER)},t.prototype.getStyle=function(){return this.style_},t.prototype.getStyleFunction=function(){return this.styleFunction_},t.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},t.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},t.prototype.setRenderOrder=function(e){this.set(Property.RENDER_ORDER,e)},t.prototype.setStyle=function(e){this.style_=void 0!==e?e:_Style.createDefaultStyle,this.styleFunction_=null===e?void 0:(0,_Style.toFunction)(this.style_),this.changed()},t}(_Layer.default),_default=BaseVectorLayer;exports.default=_default;

},{"../obj.js":203,"../style/Style.js":302,"./Layer.js":192}],188:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Collection=_interopRequireDefault(require("../Collection.js")),_EventType=_interopRequireDefault(require("../render/EventType.js")),_Feature=_interopRequireDefault(require("../Feature.js")),_Fill=_interopRequireDefault(require("../style/Fill.js")),_GeometryLayout=_interopRequireDefault(require("../geom/GeometryLayout.js")),_LineString=_interopRequireDefault(require("../geom/LineString.js")),_Point=_interopRequireDefault(require("../geom/Point.js")),_Stroke=_interopRequireDefault(require("../style/Stroke.js")),_Style=_interopRequireDefault(require("../style/Style.js")),_Text=_interopRequireDefault(require("../style/Text.js")),_Vector=_interopRequireDefault(require("./Vector.js")),_Vector2=_interopRequireDefault(require("../source/Vector.js")),_extent=require("../extent.js"),_obj=require("../obj.js"),_math=require("../math.js"),_coordinate=require("../coordinate.js"),_proj=require("../proj.js"),_render=require("../render.js"),_geodesic=require("../geom/flat/geodesic.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function i(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}(),DEFAULT_STROKE_STYLE=new _Stroke.default({color:"rgba(0,0,0,0.2)"}),INTERVALS=[90,45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],Graticule=function(t){function e(e){var a=this,i=e||{},r=(0,_obj.assign)({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},i);return delete r.maxLines,delete r.strokeStyle,delete r.targetSize,delete r.showLabels,delete r.lonLabelFormatter,delete r.latLabelFormatter,delete r.lonLabelPosition,delete r.latLabelPosition,delete r.lonLabelStyle,delete r.latLabelStyle,delete r.intervals,(a=t.call(this,r)||this).projection_=null,a.maxLat_=1/0,a.maxLon_=1/0,a.minLat_=-1/0,a.minLon_=-1/0,a.maxX_=1/0,a.maxY_=1/0,a.minX_=-1/0,a.minY_=-1/0,a.targetSize_=void 0!==i.targetSize?i.targetSize:100,a.maxLines_=void 0!==i.maxLines?i.maxLines:100,a.meridians_=[],a.parallels_=[],a.strokeStyle_=void 0!==i.strokeStyle?i.strokeStyle:DEFAULT_STROKE_STYLE,a.fromLonLatTransform_=void 0,a.toLonLatTransform_=void 0,a.projectionCenterLonLat_=null,a.bottomLeft_=null,a.bottomRight_=null,a.topLeft_=null,a.topRight_=null,a.meridiansLabels_=null,a.parallelsLabels_=null,i.showLabels&&(a.lonLabelFormatter_=null==i.lonLabelFormatter?_coordinate.degreesToStringHDMS.bind(a,"EW"):i.lonLabelFormatter,a.latLabelFormatter_=null==i.latLabelFormatter?_coordinate.degreesToStringHDMS.bind(a,"NS"):i.latLabelFormatter,a.lonLabelPosition_=null==i.lonLabelPosition?0:i.lonLabelPosition,a.latLabelPosition_=null==i.latLabelPosition?1:i.latLabelPosition,a.lonLabelStyleBase_=new _Style.default({text:void 0!==i.lonLabelStyle?i.lonLabelStyle.clone():new _Text.default({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new _Fill.default({color:"rgba(0,0,0,1)"}),stroke:new _Stroke.default({color:"rgba(255,255,255,1)",width:3})})}),a.lonLabelStyle_=function(t){var e=t.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(e),this.lonLabelStyleBase_}.bind(a),a.latLabelStyleBase_=new _Style.default({text:void 0!==i.latLabelStyle?i.latLabelStyle.clone():new _Text.default({font:"12px Calibri,sans-serif",textAlign:"right",fill:new _Fill.default({color:"rgba(0,0,0,1)"}),stroke:new _Stroke.default({color:"rgba(255,255,255,1)",width:3})})}),a.latLabelStyle_=function(t){var e=t.get("graticule_label");return this.latLabelStyleBase_.getText().setText(e),this.latLabelStyleBase_}.bind(a),a.meridiansLabels_=[],a.parallelsLabels_=[],a.addEventListener(_EventType.default.POSTRENDER,a.drawLabels_.bind(a))),a.intervals_=void 0!==i.intervals?i.intervals:INTERVALS,a.setSource(new _Vector2.default({loader:a.loaderFunction.bind(a),strategy:a.strategyFunction.bind(a),features:new _Collection.default,overlaps:!1,useSpatialIndex:!1,wrapX:i.wrapX})),a.featurePool_=[],a.lineStyle_=new _Style.default({stroke:a.strokeStyle_}),a.loadedExtent_=null,a.renderedExtent_=null,a.setRenderOrder(null),a}return __extends(e,t),e.prototype.strategyFunction=function(t,e){var a=t.slice();return this.projection_&&this.getSource().getWrapX()&&(0,_extent.wrapX)(a,this.projection_),this.loadedExtent_&&((0,_extent.approximatelyEquals)(this.loadedExtent_,a,e)?a=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[a]},e.prototype.loaderFunction=function(t,e,a){this.loadedExtent_=t;var i=this.getSource(),r=this.getExtent()||[-1/0,-1/0,1/0,1/0],n=(0,_extent.getIntersection)(r,t);if(!(this.renderedExtent_&&(0,_extent.equals)(this.renderedExtent_,n)||(this.renderedExtent_=n,(0,_extent.isEmpty)(n)))){var o=(0,_extent.getCenter)(n),l=e*e/4;(!this.projection_||!(0,_proj.equivalent)(this.projection_,a))&&this.updateProjectionInfo_(a),this.createGraticule_(n,o,e,l);var s,_=this.meridians_.length+this.parallels_.length;for(this.meridiansLabels_&&(_+=this.meridians_.length),this.parallelsLabels_&&(_+=this.parallels_.length);_>this.featurePool_.length;)s=new _Feature.default,this.featurePool_.push(s);var h=i.getFeaturesCollection();h.clear();var m,L,d=0;for(m=0,L=this.meridians_.length;m<L;++m)(s=this.featurePool_[d++]).setGeometry(this.meridians_[m]),s.setStyle(this.lineStyle_),h.push(s);for(m=0,L=this.parallels_.length;m<L;++m)(s=this.featurePool_[d++]).setGeometry(this.parallels_[m]),s.setStyle(this.lineStyle_),h.push(s)}},e.prototype.addMeridian_=function(t,e,a,i,r,n){var o=this.getMeridian_(t,e,a,i,n);if((0,_extent.intersects)(o.getExtent(),r)){if(this.meridiansLabels_){var l=this.lonLabelFormatter_(t);n in this.meridiansLabels_?this.meridiansLabels_[n].text=l:this.meridiansLabels_[n]={geom:new _Point.default([]),text:l}}this.meridians_[n++]=o}return n},e.prototype.addParallel_=function(t,e,a,i,r,n){var o=this.getParallel_(t,e,a,i,n);if((0,_extent.intersects)(o.getExtent(),r)){if(this.parallelsLabels_){var l=this.latLabelFormatter_(t);n in this.parallelsLabels_?this.parallelsLabels_[n].text=l:this.parallelsLabels_[n]={geom:new _Point.default([]),text:l}}this.parallels_[n++]=o}return n},e.prototype.drawLabels_=function(t){var e=t.frameState.viewState.rotation,a=t.frameState.extent,i=(0,_extent.getCenter)(a),r=a;if(e){var n=(0,_extent.getWidth)(a),o=(0,_extent.getHeight)(a),l=Math.abs(Math.cos(e)),s=Math.abs(Math.sin(e)),_=(s*o-l*n)/(s*s-l*l),h=(s*n-l*o)/(s*s-l*l);r=[i[0]-_/2,i[1]-h/2,i[0]+_/2,i[1]+h/2]}var m=0,L=0,d=this.latLabelPosition_<.5,u=this.projection_.getExtent(),p=(0,_extent.getWidth)(u);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!(0,_extent.containsExtent)(u,a)&&(m=Math.floor((a[0]-u[0])/p),L=Math.ceil((a[2]-u[2])/p),d=d!==Math.abs(e)>Math.PI/2);for(var f=(0,_render.getVectorContext)(t),c=m;c<=L;++c){var x=this.meridians_.length+this.parallels_.length,g=void 0,b=void 0,y=void 0,v=void 0;if(this.meridiansLabels_)for(b=0,y=this.meridiansLabels_.length;b<y;++b){var S=this.meridians_[b];if(e||0!==c)(j=S.clone()).translate(c*p,0),j.rotate(-e,i),(v=this.getMeridianPoint_(j,r,b)).rotate(e,i);else v=this.getMeridianPoint_(S,a,b);(g=this.featurePool_[x++]).setGeometry(v),g.set("graticule_label",this.meridiansLabels_[b].text),f.drawFeature(g,this.lonLabelStyle_(g))}if(this.parallelsLabels_&&(c===m&&d||c===L&&!d))for(b=0,y=this.parallels_.length;b<y;++b){var j;S=this.parallels_[b];if(e||0!==c)(j=S.clone()).translate(c*p,0),j.rotate(-e,i),(v=this.getParallelPoint_(j,r,b)).rotate(e,i);else v=this.getParallelPoint_(S,a,b);(g=this.featurePool_[x++]).setGeometry(v),g.set("graticule_label",this.parallelsLabels_[b].text),f.drawFeature(g,this.latLabelStyle_(g))}}},e.prototype.createGraticule_=function(t,e,a,i){var r=this.getInterval_(a);if(-1==r)return this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),void(this.parallelsLabels_&&(this.parallelsLabels_.length=0));var n=!1,o=this.projection_.getExtent(),l=(0,_extent.getWidth)(o);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!(0,_extent.containsExtent)(o,t)&&((0,_extent.getWidth)(t)>=l?(t[0]=o[0],t[2]=o[2]):n=!0);var s=[(0,_math.clamp)(e[0],this.minX_,this.maxX_),(0,_math.clamp)(e[1],this.minY_,this.maxY_)],_=this.toLonLatTransform_(s);isNaN(_[1])&&(_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);var h,m,L,d,u=(0,_math.clamp)(_[0],this.minLon_,this.maxLon_),p=(0,_math.clamp)(_[1],this.minLat_,this.maxLat_),f=this.maxLines_,c=t;n||(c=[(0,_math.clamp)(t[0],this.minX_,this.maxX_),(0,_math.clamp)(t[1],this.minY_,this.maxY_),(0,_math.clamp)(t[2],this.minX_,this.maxX_),(0,_math.clamp)(t[3],this.minY_,this.maxY_)]);var x=(0,_extent.applyTransform)(c,this.toLonLatTransform_,void 0,8),g=x[3],b=x[2],y=x[1],v=x[0];if(n||((0,_extent.containsCoordinate)(c,this.bottomLeft_)&&(v=this.minLon_,y=this.minLat_),(0,_extent.containsCoordinate)(c,this.bottomRight_)&&(b=this.maxLon_,y=this.minLat_),(0,_extent.containsCoordinate)(c,this.topLeft_)&&(v=this.minLon_,g=this.maxLat_),(0,_extent.containsCoordinate)(c,this.topRight_)&&(b=this.maxLon_,g=this.maxLat_),g=(0,_math.clamp)(g,p,this.maxLat_),b=(0,_math.clamp)(b,u,this.maxLon_),y=(0,_math.clamp)(y,this.minLat_,p),v=(0,_math.clamp)(v,this.minLon_,u)),u=Math.floor(u/r)*r,d=(0,_math.clamp)(u,this.minLon_,this.maxLon_),m=this.addMeridian_(d,y,g,i,t,0),h=0,n)for(;(d-=r)>=v&&h++<f;)m=this.addMeridian_(d,y,g,i,t,m);else for(;d!=this.minLon_&&h++<f;)d=Math.max(d-r,this.minLon_),m=this.addMeridian_(d,y,g,i,t,m);if(d=(0,_math.clamp)(u,this.minLon_,this.maxLon_),h=0,n)for(;(d+=r)<=b&&h++<f;)m=this.addMeridian_(d,y,g,i,t,m);else for(;d!=this.maxLon_&&h++<f;)d=Math.min(d+r,this.maxLon_),m=this.addMeridian_(d,y,g,i,t,m);for(this.meridians_.length=m,this.meridiansLabels_&&(this.meridiansLabels_.length=m),p=Math.floor(p/r)*r,L=(0,_math.clamp)(p,this.minLat_,this.maxLat_),m=this.addParallel_(L,v,b,i,t,0),h=0;L!=this.minLat_&&h++<f;)L=Math.max(L-r,this.minLat_),m=this.addParallel_(L,v,b,i,t,m);for(L=(0,_math.clamp)(p,this.minLat_,this.maxLat_),h=0;L!=this.maxLat_&&h++<f;)L=Math.min(L+r,this.maxLat_),m=this.addParallel_(L,v,b,i,t,m);this.parallels_.length=m,this.parallelsLabels_&&(this.parallelsLabels_.length=m)},e.prototype.getInterval_=function(t){for(var e=this.projectionCenterLonLat_[0],a=this.projectionCenterLonLat_[1],i=-1,r=Math.pow(this.targetSize_*t,2),n=[],o=[],l=0,s=this.intervals_.length;l<s;++l){var _=(0,_math.clamp)(this.intervals_[l]/2,0,90),h=(0,_math.clamp)(a,-90+_,90-_);if(n[0]=e-_,n[1]=h-_,o[0]=e+_,o[1]=h+_,this.fromLonLatTransform_(n,n),this.fromLonLatTransform_(o,o),Math.pow(o[0]-n[0],2)+Math.pow(o[1]-n[1],2)<=r)break;i=this.intervals_[l]}return i},e.prototype.getMeridian_=function(t,e,a,i,r){var n=(0,_geodesic.meridian)(t,e,a,this.projection_,i),o=this.meridians_[r];return o?(o.setFlatCoordinates(_GeometryLayout.default.XY,n),o.changed()):(o=new _LineString.default(n,_GeometryLayout.default.XY),this.meridians_[r]=o),o},e.prototype.getMeridianPoint_=function(t,e,a){var i=t.getFlatCoordinates(),r=1,n=i.length-1;i[r]>i[n]&&(r=n,n=1);var o=Math.max(e[1],i[r]),l=Math.min(e[3],i[n]),s=(0,_math.clamp)(e[1]+Math.abs(e[1]-e[3])*this.lonLabelPosition_,o,l),_=[i[r-1]+(i[n-1]-i[r-1])*(s-i[r])/(i[n]-i[r]),s],h=this.meridiansLabels_[a].geom;return h.setCoordinates(_),h},e.prototype.getMeridians=function(){return this.meridians_},e.prototype.getParallel_=function(t,e,a,i,r){var n=(0,_geodesic.parallel)(t,e,a,this.projection_,i),o=this.parallels_[r];return o?(o.setFlatCoordinates(_GeometryLayout.default.XY,n),o.changed()):o=new _LineString.default(n,_GeometryLayout.default.XY),o},e.prototype.getParallelPoint_=function(t,e,a){var i=t.getFlatCoordinates(),r=0,n=i.length-2;i[r]>i[n]&&(r=n,n=0);var o=Math.max(e[0],i[r]),l=Math.min(e[2],i[n]),s=(0,_math.clamp)(e[0]+Math.abs(e[0]-e[2])*this.latLabelPosition_,o,l),_=[s,i[r+1]+(i[n+1]-i[r+1])*(s-i[r])/(i[n]-i[r])],h=this.parallelsLabels_[a].geom;return h.setCoordinates(_),h},e.prototype.getParallels=function(){return this.parallels_},e.prototype.updateProjectionInfo_=function(t){var e=(0,_proj.get)("EPSG:4326"),a=t.getWorldExtent();this.maxLat_=a[3],this.maxLon_=a[2],this.minLat_=a[1],this.minLon_=a[0];var i=(0,_proj.getTransform)(t,e);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{var r=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(t,e,a){for(var n=a||2,o=i(t,e,n),l=0,s=o.length;l<s;l+=n)o[l]<r&&(o[l]+=360);return o}}this.fromLonLatTransform_=(0,_proj.getTransform)(e,t);var n=(0,_extent.applyTransform)([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=n[0],this.maxX_=n[2],this.minY_=n[1],this.maxY_=n[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_((0,_extent.getCenter)(t.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=t},e}(_Vector.default),_default=Graticule;exports.default=_default;

},{"../Collection.js":10,"../Feature.js":13,"../coordinate.js":60,"../extent.js":70,"../geom/GeometryLayout.js":130,"../geom/LineString.js":132,"../geom/Point.js":137,"../geom/flat/geodesic.js":146,"../math.js":201,"../obj.js":203,"../proj.js":205,"../render.js":213,"../render/EventType.js":216,"../source/Vector.js":277,"../style/Fill.js":293,"../style/Stroke.js":301,"../style/Style.js":302,"../style/Text.js":303,"./Vector.js":196}],189:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Base=_interopRequireDefault(require("./Base.js")),_Collection=_interopRequireDefault(require("../Collection.js")),_CollectionEventType=_interopRequireDefault(require("../CollectionEventType.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_ObjectEventType=_interopRequireDefault(require("../ObjectEventType.js")),_State=_interopRequireDefault(require("../source/State.js")),_asserts=require("../asserts.js"),_obj=require("../obj.js"),_Object=require("../Object.js"),_extent=require("../extent.js"),_util=require("../util.js"),_events=require("../events.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Property={LAYERS:"layers"},LayerGroup=function(e){function t(t){var n=this,r=t||{},s=(0,_obj.assign)({},r);delete s.layers;var i=r.layers;return(n=e.call(this,s)||this).layersListenerKeys_=[],n.listenerKeys_={},n.addEventListener((0,_Object.getChangeEventType)(Property.LAYERS),n.handleLayersChanged_),i?Array.isArray(i)?i=new _Collection.default(i.slice(),{unique:!0}):(0,_asserts.assert)("function"==typeof i.getArray,43):i=new _Collection.default(void 0,{unique:!0}),n.setLayers(i),n}return __extends(t,e),t.prototype.handleLayerChange_=function(){this.changed()},t.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(_events.unlistenByKey),this.layersListenerKeys_.length=0;var e=this.getLayers();for(var t in this.layersListenerKeys_.push((0,_events.listen)(e,_CollectionEventType.default.ADD,this.handleLayersAdd_,this),(0,_events.listen)(e,_CollectionEventType.default.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[t].forEach(_events.unlistenByKey);(0,_obj.clear)(this.listenerKeys_);for(var n=e.getArray(),r=0,s=n.length;r<s;r++){var i=n[r];this.listenerKeys_[(0,_util.getUid)(i)]=[(0,_events.listen)(i,_ObjectEventType.default.PROPERTYCHANGE,this.handleLayerChange_,this),(0,_events.listen)(i,_EventType.default.CHANGE,this.handleLayerChange_,this)]}this.changed()},t.prototype.handleLayersAdd_=function(e){var t=e.element;this.listenerKeys_[(0,_util.getUid)(t)]=[(0,_events.listen)(t,_ObjectEventType.default.PROPERTYCHANGE,this.handleLayerChange_,this),(0,_events.listen)(t,_EventType.default.CHANGE,this.handleLayerChange_,this)],this.changed()},t.prototype.handleLayersRemove_=function(e){var t=e.element,n=(0,_util.getUid)(t);this.listenerKeys_[n].forEach(_events.unlistenByKey),delete this.listenerKeys_[n],this.changed()},t.prototype.getLayers=function(){return this.get(Property.LAYERS)},t.prototype.setLayers=function(e){this.set(Property.LAYERS,e)},t.prototype.getLayersArray=function(e){var t=void 0!==e?e:[];return this.getLayers().forEach(function(e){e.getLayersArray(t)}),t},t.prototype.getLayerStatesArray=function(e){var t=void 0!==e?e:[],n=t.length;this.getLayers().forEach(function(e){e.getLayerStatesArray(t)});for(var r=this.getLayerState(),s=n,i=t.length;s<i;s++){var a=t[s];a.opacity*=r.opacity,a.visible=a.visible&&r.visible,a.maxResolution=Math.min(a.maxResolution,r.maxResolution),a.minResolution=Math.max(a.minResolution,r.minResolution),a.minZoom=Math.max(a.minZoom,r.minZoom),a.maxZoom=Math.min(a.maxZoom,r.maxZoom),void 0!==r.extent&&(void 0!==a.extent?a.extent=(0,_extent.getIntersection)(a.extent,r.extent):a.extent=r.extent)}return t},t.prototype.getSourceState=function(){return _State.default.READY},t}(_Base.default),_default=LayerGroup;exports.default=_default;

},{"../Collection.js":10,"../CollectionEventType.js":11,"../Object.js":28,"../ObjectEventType.js":29,"../asserts.js":45,"../events.js":64,"../events/EventType.js":66,"../extent.js":70,"../obj.js":203,"../source/State.js":267,"../util.js":313,"./Base.js":184}],190:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Vector=_interopRequireDefault(require("./Vector.js")),_PointsLayer=_interopRequireDefault(require("../renderer/webgl/PointsLayer.js")),_obj=require("../obj.js"),_math=require("../math.js"),_dom=require("../dom.js"),_Object=require("../Object.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Property={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},DEFAULT_GRADIENT=["#00f","#0ff","#0f0","#ff0","#f00"],Heatmap=function(t){function e(e){var r=this,n=e||{},o=(0,_obj.assign)({},n);delete o.gradient,delete o.radius,delete o.blur,delete o.weight,(r=t.call(this,o)||this).gradient_=null,r.addEventListener((0,_Object.getChangeEventType)(Property.GRADIENT),r.handleGradientChanged_),r.setGradient(n.gradient?n.gradient:DEFAULT_GRADIENT),r.setBlur(void 0!==n.blur?n.blur:15),r.setRadius(void 0!==n.radius?n.radius:8);var i=n.weight?n.weight:"weight";return r.weightFunction_="string"==typeof i?function(t){return t.get(i)}:i,r.setRenderOrder(null),r}return __extends(e,t),e.prototype.getBlur=function(){return this.get(Property.BLUR)},e.prototype.getGradient=function(){return this.get(Property.GRADIENT)},e.prototype.getRadius=function(){return this.get(Property.RADIUS)},e.prototype.handleGradientChanged_=function(){this.gradient_=createGradient(this.getGradient())},e.prototype.setBlur=function(t){this.set(Property.BLUR,t)},e.prototype.setGradient=function(t){this.set(Property.GRADIENT,t)},e.prototype.setRadius=function(t){this.set(Property.RADIUS,t)},e.prototype.createRenderer=function(){return new _PointsLayer.default(this,{attributes:[{name:"weight",callback:function(t){var e=this.weightFunction_(t);return void 0!==e?(0,_math.clamp)(e,0,1):1}.bind(this)}],vertexShader:"\n        precision mediump float;\n        uniform mat4 u_projectionMatrix;\n        uniform mat4 u_offsetScaleMatrix;\n        uniform float u_size;\n        attribute vec2 a_position;\n        attribute float a_index;\n        attribute float a_weight;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n\n        void main(void) {\n          mat4 offsetMatrix = u_offsetScaleMatrix;\n          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;\n          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;\n          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\n          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;\n          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;\n          v_texCoord = vec2(u, v);\n          v_weight = a_weight;\n        }",fragmentShader:"\n        precision mediump float;\n        uniform float u_blurSlope;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n\n        void main(void) {\n          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);\n          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;\n          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;\n          float alpha = smoothstep(0.0, 1.0, value) * v_weight;\n          gl_FragColor = vec4(alpha, alpha, alpha, alpha);\n        }",hitVertexShader:"\n        precision mediump float;\n        uniform mat4 u_projectionMatrix;\n        uniform mat4 u_offsetScaleMatrix;\n        uniform float u_size;\n        attribute vec2 a_position;\n        attribute float a_index;\n        attribute float a_weight;\n        attribute vec4 a_hitColor;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n        varying vec4 v_hitColor;\n\n        void main(void) {\n          mat4 offsetMatrix = u_offsetScaleMatrix;\n          float offsetX = a_index == 0.0 || a_index == 3.0 ? -u_size / 2.0 : u_size / 2.0;\n          float offsetY = a_index == 0.0 || a_index == 1.0 ? -u_size / 2.0 : u_size / 2.0;\n          vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\n          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n          float u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;\n          float v = a_index == 0.0 || a_index == 1.0 ? 0.0 : 1.0;\n          v_texCoord = vec2(u, v);\n          v_hitColor = a_hitColor;\n          v_weight = a_weight;\n        }",hitFragmentShader:"\n        precision mediump float;\n        uniform float u_blurSlope;\n\n        varying vec2 v_texCoord;\n        varying float v_weight;\n        varying vec4 v_hitColor;\n\n        void main(void) {\n          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);\n          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;\n          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;\n          float alpha = smoothstep(0.0, 1.0, value) * v_weight;\n          if (alpha < 0.05) {\n            discard;\n          }\n\n          gl_FragColor = v_hitColor;\n        }",uniforms:{u_size:function(){return 2*(this.get(Property.RADIUS)+this.get(Property.BLUR))}.bind(this),u_blurSlope:function(){return this.get(Property.RADIUS)/Math.max(1,this.get(Property.BLUR))}.bind(this)},postProcesses:[{fragmentShader:"\n            precision mediump float;\n\n            uniform sampler2D u_image;\n            uniform sampler2D u_gradientTexture;\n\n            varying vec2 v_texCoord;\n\n            void main() {\n              vec4 color = texture2D(u_image, v_texCoord);\n              gl_FragColor.a = color.a;\n              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;\n              gl_FragColor.rgb *= gl_FragColor.a;\n            }",uniforms:{u_gradientTexture:function(){return this.gradient_}.bind(this)}}]})},e}(_Vector.default);function createGradient(t){for(var e=(0,_dom.createCanvasContext2D)(1,256),r=e.createLinearGradient(0,0,1,256),n=1/(t.length-1),o=0,i=t.length;o<i;++o)r.addColorStop(o*n,t[o]);return e.fillStyle=r,e.fillRect(0,0,1,256),e.canvas}var _default=Heatmap;exports.default=_default;

},{"../Object.js":28,"../dom.js":62,"../math.js":201,"../obj.js":203,"../renderer/webgl/PointsLayer.js":243,"./Vector.js":196}],191:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _BaseImage=_interopRequireDefault(require("./BaseImage.js")),_ImageLayer=_interopRequireDefault(require("../renderer/canvas/ImageLayer.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ImageLayer=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.createRenderer=function(){return new _ImageLayer.default(this)},t}(_BaseImage.default),_default=ImageLayer;exports.default=_default;

},{"../renderer/canvas/ImageLayer.js":235,"./BaseImage.js":185}],192:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.inView=inView,exports.default=void 0;var _Base=_interopRequireDefault(require("./Base.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_Property=_interopRequireDefault(require("./Property.js")),_EventType2=_interopRequireDefault(require("../render/EventType.js")),_State=_interopRequireDefault(require("../source/State.js")),_asserts=require("../asserts.js"),_obj=require("../obj.js"),_Object=require("../Object.js"),_events=require("../events.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Layer=function(e){function t(t){var r=this,n=(0,_obj.assign)({},t);delete n.source,(r=e.call(this,n)||this).mapPrecomposeKey_=null,r.mapRenderKey_=null,r.sourceChangeKey_=null,r.renderer_=null,t.render&&(r.render=t.render),t.map&&r.setMap(t.map),r.addEventListener((0,_Object.getChangeEventType)(_Property.default.SOURCE),r.handleSourcePropertyChange_);var o=t.source?t.source:null;return r.setSource(o),r}return __extends(t,e),t.prototype.getLayersArray=function(e){var t=e||[];return t.push(this),t},t.prototype.getLayerStatesArray=function(e){var t=e||[];return t.push(this.getLayerState()),t},t.prototype.getSource=function(){return this.get(_Property.default.SOURCE)||null},t.prototype.getSourceState=function(){var e=this.getSource();return e?e.getState():_State.default.UNDEFINED},t.prototype.handleSourceChange_=function(){this.changed()},t.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&((0,_events.unlistenByKey)(this.sourceChangeKey_),this.sourceChangeKey_=null);var e=this.getSource();e&&(this.sourceChangeKey_=(0,_events.listen)(e,_EventType.default.CHANGE,this.handleSourceChange_,this)),this.changed()},t.prototype.getFeatures=function(e){return this.renderer_.getFeatures(e)},t.prototype.render=function(e,t){var r=this.getRenderer();if(r.prepareFrame(e))return r.renderFrame(e,t)},t.prototype.setMap=function(e){this.mapPrecomposeKey_&&((0,_events.unlistenByKey)(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&((0,_events.unlistenByKey)(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=(0,_events.listen)(e,_EventType2.default.PRECOMPOSE,function(e){var t=e.frameState.layerStatesArray,r=this.getLayerState(!1);(0,_asserts.assert)(!t.some(function(e){return e.layer===r.layer}),67),t.push(r)},this),this.mapRenderKey_=(0,_events.listen)(this,_EventType.default.CHANGE,e.render,e),this.changed())},t.prototype.setSource=function(e){this.set(_Property.default.SOURCE,e)},t.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},t.prototype.hasRenderer=function(){return!!this.renderer_},t.prototype.createRenderer=function(){return null},t.prototype.disposeInternal=function(){this.setSource(null),e.prototype.disposeInternal.call(this)},t}(_Base.default);function inView(e,t){if(!e.visible)return!1;var r=t.resolution;if(r<e.minResolution||r>=e.maxResolution)return!1;var n=t.zoom;return n>e.minZoom&&n<=e.maxZoom}var _default=Layer;exports.default=_default;

},{"../Object.js":28,"../asserts.js":45,"../events.js":64,"../events/EventType.js":66,"../obj.js":203,"../render/EventType.js":216,"../source/State.js":267,"./Base.js":184,"./Property.js":193}],193:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source"};exports.default=_default;

},{}],194:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _BaseTile=_interopRequireDefault(require("./BaseTile.js")),_TileLayer=_interopRequireDefault(require("../renderer/canvas/TileLayer.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),TileLayer=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.createRenderer=function(){return new _TileLayer.default(this)},t}(_BaseTile.default),_default=TileLayer;exports.default=_default;

},{"../renderer/canvas/TileLayer.js":237,"./BaseTile.js":186}],195:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};exports.default=_default;

},{}],196:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _BaseVector=_interopRequireDefault(require("./BaseVector.js")),_VectorLayer=_interopRequireDefault(require("../renderer/canvas/VectorLayer.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),VectorLayer=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.createRenderer=function(){return new _VectorLayer.default(this)},t}(_BaseVector.default),_default=VectorLayer;exports.default=_default;

},{"../renderer/canvas/VectorLayer.js":239,"./BaseVector.js":187}],197:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _BaseVector=_interopRequireDefault(require("./BaseVector.js")),_VectorImageLayer=_interopRequireDefault(require("../renderer/canvas/VectorImageLayer.js")),_obj=require("../obj.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),VectorImageLayer=function(e){function t(t){var r=this,o=t||{},a=(0,_obj.assign)({},o);return delete a.imageRatio,(r=e.call(this,a)||this).imageRatio_=void 0!==o.imageRatio?o.imageRatio:1,r}return __extends(t,e),t.prototype.getImageRatio=function(){return this.imageRatio_},t.prototype.createRenderer=function(){return new _VectorImageLayer.default(this)},t}(_BaseVector.default),_default=VectorImageLayer;exports.default=_default;

},{"../obj.js":203,"../renderer/canvas/VectorImageLayer.js":238,"./BaseVector.js":187}],198:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _BaseVector=_interopRequireDefault(require("./BaseVector.js")),_VectorTileLayer=_interopRequireDefault(require("../renderer/canvas/VectorTileLayer.js")),_TileProperty=_interopRequireDefault(require("./TileProperty.js")),_VectorTileRenderType=_interopRequireDefault(require("./VectorTileRenderType.js")),_asserts=require("../asserts.js"),_obj=require("../obj.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function o(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),VectorTileLayer=function(e){function r(r){var t=this,o=r||{},n=(0,_obj.assign)({},o);delete n.preload,delete n.useInterimTilesOnError,t=e.call(this,n)||this;var i=o.renderMode||_VectorTileRenderType.default.HYBRID;return(0,_asserts.assert)(null==i||i==_VectorTileRenderType.default.IMAGE||i==_VectorTileRenderType.default.HYBRID||i==_VectorTileRenderType.default.VECTOR,28),t.renderMode_=i,t.setPreload(o.preload?o.preload:0),t.setUseInterimTilesOnError(void 0===o.useInterimTilesOnError||o.useInterimTilesOnError),t}return __extends(r,e),r.prototype.createRenderer=function(){return new _VectorTileLayer.default(this)},r.prototype.getFeatures=function(r){return e.prototype.getFeatures.call(this,r)},r.prototype.getRenderMode=function(){return this.renderMode_},r.prototype.getPreload=function(){return this.get(_TileProperty.default.PRELOAD)},r.prototype.getUseInterimTilesOnError=function(){return this.get(_TileProperty.default.USE_INTERIM_TILES_ON_ERROR)},r.prototype.setPreload=function(e){this.set(_TileProperty.default.PRELOAD,e)},r.prototype.setUseInterimTilesOnError=function(e){this.set(_TileProperty.default.USE_INTERIM_TILES_ON_ERROR,e)},r}(_BaseVector.default),_default=VectorTileLayer;exports.default=_default;

},{"../asserts.js":45,"../obj.js":203,"../renderer/canvas/VectorTileLayer.js":240,"./BaseVector.js":187,"./TileProperty.js":195,"./VectorTileRenderType.js":199}],199:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={IMAGE:"image",HYBRID:"hybrid",VECTOR:"vector"};exports.default=_default;

},{}],200:[function(require,module,exports){
"use strict";function all(e,t){return[[-1/0,-1/0,1/0,1/0]]}function bbox(e,t){return[e]}function tile(e){return function(t,o){var r=e.getZForResolution(o),n=e.getTileRangeForExtentAndZ(t,r),i=[],l=[r,0,0];for(l[1]=n.minX;l[1]<=n.maxX;++l[1])for(l[2]=n.minY;l[2]<=n.maxY;++l[2])i.push(e.getTileCoordExtent(l));return i}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.all=all,exports.bbox=bbox,exports.tile=tile;

},{}],201:[function(require,module,exports){
"use strict";function clamp(r,e,t){return Math.min(Math.max(r,e),t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.clamp=clamp,exports.squaredSegmentDistance=squaredSegmentDistance,exports.squaredDistance=squaredDistance,exports.solveLinearSystem=solveLinearSystem,exports.toDegrees=toDegrees,exports.toRadians=toRadians,exports.modulo=modulo,exports.lerp=lerp,exports.log2=exports.cosh=void 0;var cosh="cosh"in Math?Math.cosh:function(r){var e=Math.exp(r);return(e+1/e)/2};exports.cosh=cosh;var log2="log2"in Math?Math.log2:function(r){return Math.log(r)*Math.LOG2E};function squaredSegmentDistance(r,e,t,o,a,n){var s=a-t,u=n-o;if(0!==s||0!==u){var i=((r-t)*s+(e-o)*u)/(s*s+u*u);i>1?(t=a,o=n):i>0&&(t+=s*i,o+=u*i)}return squaredDistance(r,e,t,o)}function squaredDistance(r,e,t,o){var a=t-r,n=o-e;return a*a+n*n}function solveLinearSystem(r){for(var e=r.length,t=0;t<e;t++){for(var o=t,a=Math.abs(r[t][t]),n=t+1;n<e;n++){var s=Math.abs(r[n][t]);s>a&&(a=s,o=n)}if(0===a)return null;var u=r[o];r[o]=r[t],r[t]=u;for(var i=t+1;i<e;i++)for(var c=-r[i][t]/r[t][t],l=t;l<e+1;l++)t==l?r[i][l]=0:r[i][l]+=c*r[t][l]}for(var p=new Array(e),h=e-1;h>=0;h--){p[h]=r[h][e]/r[h][h];for(var v=h-1;v>=0;v--)r[v][e]-=r[v][h]*p[h]}return p}function toDegrees(r){return 180*r/Math.PI}function toRadians(r){return r*Math.PI/180}function modulo(r,e){var t=r%e;return t*e<0?t+e:t}function lerp(r,e,t){return r+t*(e-r)}exports.log2=log2;

},{}],202:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.jsonp=jsonp;var _util=require("./util.js");function jsonp(e,t,n,o){var i=document.createElement("script"),c="olc_"+(0,_util.getUid)(t);function r(){delete window[c],i.parentNode.removeChild(i)}i.async=!0,i.src=e+(-1==e.indexOf("?")?"?":"&")+(o||"callback")+"="+c;var u=setTimeout(function(){r(),n&&n()},1e4);window[c]=function(e){clearTimeout(u),r(),t(e)},document.getElementsByTagName("head")[0].appendChild(i)}

},{"./util.js":313}],203:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clear=clear,exports.isEmpty=isEmpty,exports.getValues=exports.assign=void 0;var assign="function"==typeof Object.assign?Object.assign:function(e,r){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1,s=arguments.length;n<s;++n){var o=arguments[n];if(null!=o)for(var a in o)o.hasOwnProperty(a)&&(t[a]=o[a])}return t};function clear(e){for(var r in e)delete e[r]}exports.assign=assign;var getValues="function"==typeof Object.values?Object.values:function(e){var r=[];for(var t in e)r.push(e[t]);return r};function isEmpty(e){var r;for(r in e)return!1;return!r}exports.getValues=getValues;

},{}],204:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};exports.default=_default;

},{}],205:[function(require,module,exports){
"use strict";function _typeof(r){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.cloneTransform=cloneTransform,exports.identityTransform=identityTransform,exports.addProjection=addProjection,exports.addProjections=addProjections,exports.get=get,exports.getPointResolution=getPointResolution,exports.addEquivalentProjections=addEquivalentProjections,exports.addEquivalentTransforms=addEquivalentTransforms,exports.clearAllProjections=clearAllProjections,exports.createProjection=createProjection,exports.createTransformFromCoordinateTransform=createTransformFromCoordinateTransform,exports.addCoordinateTransforms=addCoordinateTransforms,exports.fromLonLat=fromLonLat,exports.toLonLat=toLonLat,exports.equivalent=equivalent,exports.getTransformFromProjections=getTransformFromProjections,exports.getTransform=getTransform,exports.transform=transform,exports.transformExtent=transformExtent,exports.transformWithProjections=transformWithProjections,exports.setUserProjection=setUserProjection,exports.clearUserProjection=clearUserProjection,exports.getUserProjection=getUserProjection,exports.useGeographic=useGeographic,exports.toUserCoordinate=toUserCoordinate,exports.fromUserCoordinate=fromUserCoordinate,exports.toUserExtent=toUserExtent,exports.fromUserExtent=fromUserExtent,exports.createSafeCoordinateTransform=createSafeCoordinateTransform,exports.addCommon=addCommon,Object.defineProperty(exports,"Projection",{enumerable:!0,get:function(){return _Projection.default}}),Object.defineProperty(exports,"METERS_PER_UNIT",{enumerable:!0,get:function(){return _Units.METERS_PER_UNIT}});var _Projection=_interopRequireDefault(require("./proj/Projection.js")),_Units=_interopRequireWildcard(require("./proj/Units.js")),_epsg=require("./proj/epsg3857.js"),_epsg2=require("./proj/epsg4326.js"),_projections=require("./proj/projections.js"),_transforms=require("./proj/transforms.js"),_extent=require("./extent.js"),_math=require("./math.js"),_sphere=require("./sphere.js"),_coordinate=require("./coordinate.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var r=new WeakMap;return _getRequireWildcardCache=function(){return r},r}function _interopRequireWildcard(r){if(r&&r.__esModule)return r;if(null===r||"object"!==_typeof(r)&&"function"!=typeof r)return{default:r};var e=_getRequireWildcardCache();if(e&&e.has(r))return e.get(r);var t={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var s=o?Object.getOwnPropertyDescriptor(r,n):null;s&&(s.get||s.set)?Object.defineProperty(t,n,s):t[n]=r[n]}return t.default=r,e&&e.set(r,t),t}function _interopRequireDefault(r){return r&&r.__esModule?r:{default:r}}function cloneTransform(r,e,t){var o;if(void 0!==e){for(var n=0,s=r.length;n<s;++n)e[n]=r[n];o=e}else o=r.slice();return o}function identityTransform(r,e,t){if(void 0!==e&&r!==e){for(var o=0,n=r.length;o<n;++o)e[o]=r[o];r=e}return r}function addProjection(r){(0,_projections.add)(r.getCode(),r),(0,_transforms.add)(r,r,cloneTransform)}function addProjections(r){r.forEach(addProjection)}function get(r){return"string"==typeof r?(0,_projections.get)(r):r||null}function getPointResolution(r,e,t,o){var n,s=(r=get(r)).getPointResolutionFunc();if(s)n=s(e,t),o&&o!==r.getUnits()&&(i=r.getMetersPerUnit())&&(n=n*i/_Units.METERS_PER_UNIT[o]);else if(r.getUnits()==_Units.default.DEGREES&&!o||o==_Units.default.DEGREES)n=e;else{var i,a=getTransformFromProjections(r,get("EPSG:4326")),c=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];c=a(c,c,2),n=((0,_sphere.getDistance)(c.slice(0,2),c.slice(2,4))+(0,_sphere.getDistance)(c.slice(4,6),c.slice(6,8)))/2,void 0!==(i=o?_Units.METERS_PER_UNIT[o]:r.getMetersPerUnit())&&(n/=i)}return n}function addEquivalentProjections(r){addProjections(r),r.forEach(function(e){r.forEach(function(r){e!==r&&(0,_transforms.add)(e,r,cloneTransform)})})}function addEquivalentTransforms(r,e,t,o){r.forEach(function(r){e.forEach(function(e){(0,_transforms.add)(r,e,t),(0,_transforms.add)(e,r,o)})})}function clearAllProjections(){(0,_projections.clear)(),(0,_transforms.clear)()}function createProjection(r,e){return r?"string"==typeof r?get(r):r:get(e)}function createTransformFromCoordinateTransform(r){return function(e,t,o){for(var n=e.length,s=void 0!==o?o:2,i=void 0!==t?t:new Array(n),a=0;a<n;a+=s){var c=r([e[a],e[a+1]]);i[a]=c[0],i[a+1]=c[1];for(var f=s-1;f>=2;--f)i[a+f]=e[a+f]}return i}}function addCoordinateTransforms(r,e,t,o){var n=get(r),s=get(e);(0,_transforms.add)(n,s,createTransformFromCoordinateTransform(t)),(0,_transforms.add)(s,n,createTransformFromCoordinateTransform(o))}function fromLonLat(r,e){return transform(r,"EPSG:4326",void 0!==e?e:"EPSG:3857")}function toLonLat(r,e){var t=transform(r,void 0!==e?e:"EPSG:3857","EPSG:4326"),o=t[0];return(o<-180||o>180)&&(t[0]=(0,_math.modulo)(o+180,360)-180),t}function equivalent(r,e){if(r===e)return!0;var t=r.getUnits()===e.getUnits();return r.getCode()===e.getCode()?t:getTransformFromProjections(r,e)===cloneTransform&&t}function getTransformFromProjections(r,e){var t=r.getCode(),o=e.getCode(),n=(0,_transforms.get)(t,o);return n||(n=identityTransform),n}function getTransform(r,e){return getTransformFromProjections(get(r),get(e))}function transform(r,e,t){return getTransform(e,t)(r,void 0,r.length)}function transformExtent(r,e,t,o){var n=getTransform(e,t);return(0,_extent.applyTransform)(r,n,void 0,o)}function transformWithProjections(r,e,t){return getTransformFromProjections(e,t)(r)}var userProjection=null;function setUserProjection(r){userProjection=get(r)}function clearUserProjection(){userProjection=null}function getUserProjection(){return userProjection}function useGeographic(){setUserProjection("EPSG:4326")}function toUserCoordinate(r,e){return userProjection?transform(r,e,userProjection):r}function fromUserCoordinate(r,e){return userProjection?transform(r,userProjection,e):r}function toUserExtent(r,e){return userProjection?transformExtent(r,e,userProjection):r}function fromUserExtent(r,e){return userProjection?transformExtent(r,userProjection,e):r}function createSafeCoordinateTransform(r,e,t){return function(o){var n,s,i=o[0],a=o[1];if(r.canWrapX()){var c=r.getExtent(),f=(0,_extent.getWidth)(c);(s=(0,_coordinate.getWorldsAway)(o,r,f))&&(i-=s*f),i=(0,_math.clamp)(i,c[0],c[2]),a=(0,_math.clamp)(a,c[1],c[3]),n=t([i,a])}else n=t(o);return s&&e.canWrapX()&&(n[0]+=s*(0,_extent.getWidth)(e.getExtent())),n}}function addCommon(){addEquivalentProjections(_epsg.PROJECTIONS),addEquivalentProjections(_epsg2.PROJECTIONS),addEquivalentTransforms(_epsg2.PROJECTIONS,_epsg.PROJECTIONS,_epsg.fromEPSG4326,_epsg.toEPSG4326)}addCommon();

},{"./coordinate.js":60,"./extent.js":70,"./math.js":201,"./proj/Projection.js":206,"./proj/Units.js":207,"./proj/epsg3857.js":208,"./proj/epsg4326.js":209,"./proj/projections.js":211,"./proj/transforms.js":212,"./sphere.js":286}],206:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Units=require("./Units.js"),Projection=function(){function t(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}return t.prototype.canWrapX=function(){return this.canWrapX_},t.prototype.getCode=function(){return this.code_},t.prototype.getExtent=function(){return this.extent_},t.prototype.getUnits=function(){return this.units_},t.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||_Units.METERS_PER_UNIT[this.units_]},t.prototype.getWorldExtent=function(){return this.worldExtent_},t.prototype.getAxisOrientation=function(){return this.axisOrientation_},t.prototype.isGlobal=function(){return this.global_},t.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)},t.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},t.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},t.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)},t.prototype.setWorldExtent=function(t){this.worldExtent_=t},t.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},t.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},t}(),_default=Projection;exports.default=_default;

},{"./Units.js":207}],207:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.METERS_PER_UNIT=void 0;var Units={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},METERS_PER_UNIT={};exports.METERS_PER_UNIT=METERS_PER_UNIT,METERS_PER_UNIT[Units.DEGREES]=2*Math.PI*6370997/360,METERS_PER_UNIT[Units.FEET]=.3048,METERS_PER_UNIT[Units.METERS]=1,METERS_PER_UNIT[Units.USFEET]=1200/3937;var _default=Units;exports.default=_default;

},{}],208:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromEPSG4326=fromEPSG4326,exports.toEPSG4326=toEPSG4326,exports.PROJECTIONS=exports.WORLD_EXTENT=exports.EXTENT=exports.HALF_SIZE=exports.RADIUS=void 0;var _Projection=_interopRequireDefault(require("./Projection.js")),_Units=_interopRequireDefault(require("./Units.js")),_math=require("../math.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),RADIUS=6378137;exports.RADIUS=RADIUS;var HALF_SIZE=Math.PI*RADIUS;exports.HALF_SIZE=HALF_SIZE;var EXTENT=[-HALF_SIZE,-HALF_SIZE,HALF_SIZE,HALF_SIZE];exports.EXTENT=EXTENT;var WORLD_EXTENT=[-180,-85,180,85];exports.WORLD_EXTENT=WORLD_EXTENT;var EPSG3857Projection=function(t){function e(e){return t.call(this,{code:e,units:_Units.default.METERS,extent:EXTENT,global:!0,worldExtent:WORLD_EXTENT,getPointResolution:function(t,e){return t/(0,_math.cosh)(e[1]/RADIUS)}})||this}return __extends(e,t),e}(_Projection.default),PROJECTIONS=[new EPSG3857Projection("EPSG:3857"),new EPSG3857Projection("EPSG:102100"),new EPSG3857Projection("EPSG:102113"),new EPSG3857Projection("EPSG:900913"),new EPSG3857Projection("urn:ogc:def:crs:EPSG:6.18:3:3857"),new EPSG3857Projection("urn:ogc:def:crs:EPSG::3857"),new EPSG3857Projection("http://www.opengis.net/gml/srs/epsg.xml#3857")];function fromEPSG4326(t,e,r){var o=t.length,n=r>1?r:2,E=e;void 0===E&&(E=n>2?t.slice():new Array(o));for(var i=HALF_SIZE,s=0;s<o;s+=n){E[s]=i*t[s]/180;var S=RADIUS*Math.log(Math.tan(Math.PI*(+t[s+1]+90)/360));S>i?S=i:S<-i&&(S=-i),E[s+1]=S}return E}function toEPSG4326(t,e,r){var o=t.length,n=r>1?r:2,E=e;void 0===E&&(E=n>2?t.slice():new Array(o));for(var i=0;i<o;i+=n)E[i]=180*t[i]/HALF_SIZE,E[i+1]=360*Math.atan(Math.exp(t[i+1]/RADIUS))/Math.PI-90;return E}exports.PROJECTIONS=PROJECTIONS;

},{"../math.js":201,"./Projection.js":206,"./Units.js":207}],209:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PROJECTIONS=exports.METERS_PER_UNIT=exports.EXTENT=exports.RADIUS=void 0;var _Projection=_interopRequireDefault(require("./Projection.js")),_Units=_interopRequireDefault(require("./Units.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),RADIUS=6378137;exports.RADIUS=RADIUS;var EXTENT=[-180,-90,180,90];exports.EXTENT=EXTENT;var METERS_PER_UNIT=Math.PI*RADIUS/180;exports.METERS_PER_UNIT=METERS_PER_UNIT;var EPSG4326Projection=function(e){function t(t,r){return e.call(this,{code:t,units:_Units.default.DEGREES,extent:EXTENT,axisOrientation:r,global:!0,metersPerUnit:METERS_PER_UNIT,worldExtent:EXTENT})||this}return __extends(t,e),t}(_Projection.default),PROJECTIONS=[new EPSG4326Projection("CRS:84"),new EPSG4326Projection("EPSG:4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:EPSG::4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:OGC:1.3:CRS84"),new EPSG4326Projection("urn:ogc:def:crs:OGC:2:84"),new EPSG4326Projection("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new EPSG4326Projection("urn:x-ogc:def:crs:EPSG:4326","neu")];exports.PROJECTIONS=PROJECTIONS;

},{"./Projection.js":206,"./Units.js":207}],210:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.register=register;var _Projection=_interopRequireDefault(require("./Projection.js")),_proj=require("../proj.js"),_obj=require("../obj.js"),_transforms=require("./transforms.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function register(e){var r,o,t=Object.keys(e.defs),s=t.length;for(r=0;r<s;++r){var i=t[r];if(!(0,_proj.get)(i)){var a=e.defs(i);(0,_proj.addProjection)(new _Projection.default({code:i,axisOrientation:a.axis,metersPerUnit:a.to_meter,units:a.units}))}}for(r=0;r<s;++r){var n=t[r],f=(0,_proj.get)(n);for(o=0;o<s;++o){var j=t[o],_=(0,_proj.get)(j);if(!(0,_transforms.get)(n,j)){var d=e.defs(n),u=e.defs(j);if(d===u)(0,_proj.addEquivalentProjections)([f,_]);else{var p=e((0,_obj.assign)({},d,{axis:void 0}),(0,_obj.assign)({},u,{axis:void 0}));(0,_proj.addCoordinateTransforms)(f,_,(0,_proj.createSafeCoordinateTransform)(f,_,p.forward),(0,_proj.createSafeCoordinateTransform)(_,f,p.inverse))}}}}}

},{"../obj.js":203,"../proj.js":205,"./Projection.js":206,"./transforms.js":212}],211:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clear=clear,exports.get=get,exports.add=add;var cache={};function clear(){cache={}}function get(e){return cache[e]||null}function add(e,c){cache[e]=c}

},{}],212:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.clear=clear,exports.add=add,exports.remove=remove,exports.get=get;var _obj=require("../obj.js"),transforms={};function clear(){transforms={}}function add(r,e,t){var s=r.getCode(),o=e.getCode();s in transforms||(transforms[s]={}),transforms[s][o]=t}function remove(r,e){var t=r.getCode(),s=e.getCode(),o=transforms[t][s];return delete transforms[t][s],(0,_obj.isEmpty)(transforms[t])&&delete transforms[t],o}function get(r,e){var t;return r in transforms&&e in transforms[r]&&(t=transforms[r][e]),t}

},{"../obj.js":203}],213:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.toContext=toContext,exports.getVectorContext=getVectorContext,exports.getRenderPixel=getRenderPixel,exports.renderDeclutterItems=renderDeclutterItems;var _Immediate=_interopRequireDefault(require("./render/canvas/Immediate.js")),_has=require("./has.js"),_transform=require("./transform.js"),_vector=require("./renderer/vector.js"),_proj=require("./proj.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function toContext(e,t){var r=e.canvas,o=t||{},n=o.pixelRatio||_has.DEVICE_PIXEL_RATIO,i=o.size;i&&(r.width=i[0]*n,r.height=i[1]*n,r.style.width=i[0]+"px",r.style.height=i[1]+"px");var a=[0,0,r.width,r.height],s=(0,_transform.scale)((0,_transform.create)(),n,n);return new _Immediate.default(e,n,a,s,0)}function getVectorContext(e){var t,r=e.frameState,o=(0,_transform.multiply)(e.inversePixelTransform.slice(),r.coordinateToPixelTransform),n=(0,_vector.getSquaredTolerance)(r.viewState.resolution,r.pixelRatio),i=(0,_proj.getUserProjection)();return i&&(t=(0,_proj.getTransformFromProjections)(i,r.viewState.projection)),new _Immediate.default(e.context,r.pixelRatio,r.extent,o,r.viewState.rotation,n,t)}function getRenderPixel(e,t){var r=t.slice(0);return(0,_transform.apply)(e.inversePixelTransform.slice(),r),r}function renderDeclutterItems(e,t){t&&t.clear();for(var r=e.declutterItems,o=r.length-1;o>=0;--o)for(var n=r[o],i=n.items,a=0,s=i.length;a<s;a+=3)t=i[a].renderDeclutter(i[a+1],i[a+2],n.opacity,t);return r.length=0,t}

},{"./has.js":159,"./proj.js":205,"./render/canvas/Immediate.js":226,"./renderer/vector.js":241,"./transform.js":311}],214:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Disposable=_interopRequireDefault(require("../Disposable.js")),_Polygon=_interopRequireDefault(require("../geom/Polygon.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),RenderBox=function(e){function t(t){var n=e.call(this)||this;return n.geometry_=null,n.element_=document.createElement("div"),n.element_.style.position="absolute",n.element_.style.pointerEvents="auto",n.element_.className="ol-box "+t,n.map_=null,n.startPixel_=null,n.endPixel_=null,n}return __extends(t,e),t.prototype.disposeInternal=function(){this.setMap(null)},t.prototype.render_=function(){var e=this.startPixel_,t=this.endPixel_,n=this.element_.style;n.left=Math.min(e[0],t[0])+"px",n.top=Math.min(e[1],t[1])+"px",n.width=Math.abs(t[0]-e[0])+"px",n.height=Math.abs(t[1]-e[1])+"px"},t.prototype.setMap=function(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},t.prototype.setPixels=function(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()},t.prototype.createOrUpdateGeometry=function(){var e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new _Polygon.default([n])},t.prototype.getGeometry=function(){return this.geometry_},t}(_Disposable.default),_default=RenderBox;exports.default=_default;

},{"../Disposable.js":12,"../geom/Polygon.js":138}],215:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Event=_interopRequireDefault(require("../events/Event.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),RenderEvent=function(e){function t(t,r,n,o){var u=e.call(this,t)||this;return u.inversePixelTransform=r,u.frameState=n,u.context=o,u}return __extends(t,e),t}(_Event.default),_default=RenderEvent;exports.default=_default;

},{"../events/Event.js":65}],216:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};exports.default=_default;

},{}],217:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_transform=require("../transform.js"),_extent=require("../extent.js"),_array=require("../array.js"),_interiorpoint=require("../geom/flat/interiorpoint.js"),_proj=require("../proj.js"),_interpolate=require("../geom/flat/interpolate.js"),_center=require("../geom/flat/center.js"),_transform2=require("../geom/flat/transform.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var tmpTransform=(0,_transform.create)(),RenderFeature=function(){function t(t,e,r,o,i){this.extent_,this.id_=i,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=r,this.properties_=o}return t.prototype.get=function(t){return this.properties_[t]},t.prototype.getExtent=function(){return this.extent_||(this.extent_=this.type_===_GeometryType.default.POINT?(0,_extent.createOrUpdateFromCoordinate)(this.flatCoordinates_):(0,_extent.createOrUpdateFromFlatCoordinates)(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_},t.prototype.getFlatInteriorPoint=function(){if(!this.flatInteriorPoints_){var t=(0,_extent.getCenter)(this.getExtent());this.flatInteriorPoints_=(0,_interiorpoint.getInteriorPointOfArray)(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_},t.prototype.getFlatInteriorPoints=function(){if(!this.flatInteriorPoints_){var t=(0,_center.linearRingss)(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=(0,_interiorpoint.getInteriorPointsOfMultiArray)(this.flatCoordinates_,0,this.ends_,2,t)}return this.flatInteriorPoints_},t.prototype.getFlatMidpoint=function(){return this.flatMidpoints_||(this.flatMidpoints_=(0,_interpolate.interpolatePoint)(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_},t.prototype.getFlatMidpoints=function(){if(!this.flatMidpoints_){this.flatMidpoints_=[];for(var t=this.flatCoordinates_,e=0,r=this.ends_,o=0,i=r.length;o<i;++o){var n=r[o],s=(0,_interpolate.interpolatePoint)(t,e,n,2,.5);(0,_array.extend)(this.flatMidpoints_,s),e=n}}return this.flatMidpoints_},t.prototype.getId=function(){return this.id_},t.prototype.getOrientedFlatCoordinates=function(){return this.flatCoordinates_},t.prototype.getGeometry=function(){return this},t.prototype.getSimplifiedGeometry=function(t){return this},t.prototype.simplifyTransformed=function(t,e){return this},t.prototype.getProperties=function(){return this.properties_},t.prototype.getStride=function(){return 2},t.prototype.getStyleFunction=function(){},t.prototype.getType=function(){return this.type_},t.prototype.transform=function(t,e){var r=(t=(0,_proj.get)(t)).getExtent(),o=t.getWorldExtent(),i=(0,_extent.getHeight)(o)/(0,_extent.getHeight)(r);(0,_transform.compose)(tmpTransform,o[0],o[3],i,-i,0,0,0),(0,_transform2.transform2D)(this.flatCoordinates_,0,this.flatCoordinates_.length,2,tmpTransform,this.flatCoordinates_)},t.prototype.getEnds=function(){return this.ends_},t}();RenderFeature.prototype.getEndss=RenderFeature.prototype.getEnds,RenderFeature.prototype.getFlatCoordinates=RenderFeature.prototype.getOrientedFlatCoordinates;var _default=RenderFeature;exports.default=_default;

},{"../array.js":44,"../extent.js":70,"../geom/GeometryType.js":131,"../geom/flat/center.js":141,"../geom/flat/interiorpoint.js":148,"../geom/flat/interpolate.js":149,"../geom/flat/transform.js":158,"../proj.js":205,"../transform.js":311}],218:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var VectorContext=function(){function t(){}return t.prototype.drawCustom=function(t,o,e){},t.prototype.drawGeometry=function(t){},t.prototype.setStyle=function(t){},t.prototype.drawCircle=function(t,o){},t.prototype.drawFeature=function(t,o){},t.prototype.drawGeometryCollection=function(t,o){},t.prototype.drawLineString=function(t,o){},t.prototype.drawMultiLineString=function(t,o){},t.prototype.drawMultiPoint=function(t,o){},t.prototype.drawMultiPolygon=function(t,o){},t.prototype.drawPoint=function(t,o){},t.prototype.drawPolygon=function(t,o){},t.prototype.drawText=function(t,o){},t.prototype.setFillStrokeStyle=function(t,o){},t.prototype.setImageStyle=function(t,o){},t.prototype.setTextStyle=function(t,o){},t}(),_default=VectorContext;exports.default=_default;

},{}],219:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.measureTextWidth=measureTextWidth,exports.measureAndCacheTextWidth=measureAndCacheTextWidth,exports.measureTextWidths=measureTextWidths,exports.rotateAtOffset=rotateAtOffset,exports.drawImageOrLabel=drawImageOrLabel,exports.createTransformString=createTransformString,exports.measureTextHeight=exports.registerFont=exports.textHeights=exports.labelCache=exports.checkedFonts=exports.defaultLineWidth=exports.defaultPadding=exports.defaultTextBaseline=exports.defaultTextAlign=exports.defaultStrokeStyle=exports.defaultMiterLimit=exports.defaultLineJoin=exports.defaultLineDashOffset=exports.defaultLineDash=exports.defaultLineCap=exports.defaultFillStyle=exports.defaultFont=void 0;var _Object=_interopRequireDefault(require("../Object.js")),_Target=_interopRequireDefault(require("../events/Target.js")),_has=require("../has.js"),_obj=require("../obj.js"),_dom=require("../dom.js"),_css=require("../css.js"),_transform=require("../transform.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var defaultFont="10px sans-serif";exports.defaultFont=defaultFont;var defaultFillStyle="#000";exports.defaultFillStyle=defaultFillStyle;var defaultLineCap="round";exports.defaultLineCap=defaultLineCap;var defaultLineDash=[];exports.defaultLineDash=defaultLineDash;var defaultLineDashOffset=0;exports.defaultLineDashOffset=defaultLineDashOffset;var defaultLineJoin="round";exports.defaultLineJoin=defaultLineJoin;var defaultMiterLimit=10;exports.defaultMiterLimit=defaultMiterLimit;var defaultStrokeStyle="#000";exports.defaultStrokeStyle=defaultStrokeStyle;var defaultTextAlign="center";exports.defaultTextAlign=defaultTextAlign;var defaultTextBaseline="middle";exports.defaultTextBaseline=defaultTextBaseline;var defaultPadding=[0,0,0,0];exports.defaultPadding=defaultPadding;var defaultLineWidth=1;exports.defaultLineWidth=defaultLineWidth;var checkedFonts=new _Object.default;exports.checkedFonts=checkedFonts;var labelCache=new _Target.default;exports.labelCache=labelCache,labelCache.setSize=function(){console.warn("labelCache is deprecated.")};var measureFont,measureContext=null,textHeights={};exports.textHeights=textHeights;var registerFont=function(){var e,t,r=100,a="32px ",s=["monospace","serif"],n=s.length,o="wmytzilWMYTZIL@#/&?$%10";function i(e,r,i){for(var l=!0,u=0;u<n;++u){var d=s[u];if(t=measureTextWidth(e+" "+r+" "+a+d,o),i!=d){var f=measureTextWidth(e+" "+r+" "+a+i+","+d,o);l=l&&f!=t}}return!!l}function l(){for(var t=!0,a=checkedFonts.getKeys(),s=0,n=a.length;s<n;++s){var o=a[s];checkedFonts.get(o)<r&&(i.apply(this,o.split("\n"))?((0,_obj.clear)(textHeights),measureContext=null,measureFont=void 0,checkedFonts.set(o,r)):(checkedFonts.set(o,checkedFonts.get(o)+1,!0),t=!1))}t&&(clearInterval(e),e=void 0)}return function(t){var a=(0,_css.getFontParameters)(t);if(a)for(var s=a.families,n=0,o=s.length;n<o;++n){var u=s[n],d=a.style+"\n"+a.weight+"\n"+u;void 0===checkedFonts.get(d)&&(checkedFonts.set(d,r,!0),i(a.style,a.weight,u)||(checkedFonts.set(d,0,!0),void 0===e&&(e=setInterval(l,32))))}}}();exports.registerFont=registerFont;var measureTextHeight=function(){var e,t=textHeights;return function(r){var a=t[r];if(null==a)if(_has.WORKER_OFFSCREEN_CANVAS){var s=(0,_css.getFontParameters)(r),n=measureText(r,"Žg"),o=isNaN(Number(s.lineHeight))?1.2:Number(s.lineHeight);textHeights[r]=o*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else e||((e=document.createElement("div")).innerHTML="M",e.style.margin="0 !important",e.style.padding="0 !important",e.style.position="absolute !important",e.style.left="-99999px !important"),e.style.font=r,document.body.appendChild(e),a=e.offsetHeight,t[r]=a,document.body.removeChild(e);return a}}();function measureText(e,t){return measureContext||(measureContext=(0,_dom.createCanvasContext2D)(1,1)),e!=measureFont&&(measureContext.font=e,measureFont=measureContext.font),measureContext.measureText(t)}function measureTextWidth(e,t){return measureText(e,t).width}function measureAndCacheTextWidth(e,t,r){if(t in r)return r[t];var a=measureTextWidth(e,t);return r[t]=a,a}function measureTextWidths(e,t,r){for(var a=t.length,s=0,n=0;n<a;++n){var o=measureTextWidth(e,t[n]);s=Math.max(s,o),r.push(o)}return s}function rotateAtOffset(e,t,r,a){0!==t&&(e.translate(r,a),e.rotate(t),e.translate(-r,-a))}function drawImageOrLabel(e,t,r,a,s,n,o,i,l,u,d){e.save(),1!==r&&(e.globalAlpha*=r),t&&e.setTransform.apply(e,t),a.contextInstructions?(e.translate(l,u),e.scale(d[0],d[1]),executeLabelInstructions(a,e)):d[0]<0||d[1]<0?(e.translate(l,u),e.scale(d[0],d[1]),e.drawImage(a,s,n,o,i,0,0,o,i)):e.drawImage(a,s,n,o,i,l,u,o*d[0],i*d[1]),e.restore()}function executeLabelInstructions(e,t){for(var r=e.contextInstructions,a=0,s=r.length;a<s;a+=2)Array.isArray(r[a+1])?t[r[a]].apply(t,r[a+1]):t[r[a]]=r[a+1]}exports.measureTextHeight=measureTextHeight;var createTransformStringCanvas=null;function createTransformString(e){return _has.WORKER_OFFSCREEN_CANVAS?(0,_transform.toString)(e):(createTransformStringCanvas||(createTransformStringCanvas=(0,_dom.createCanvasContext2D)(1,1).canvas),createTransformStringCanvas.style.transform=(0,_transform.toString)(e),createTransformStringCanvas.style.transform)}

},{"../Object.js":28,"../css.js":61,"../dom.js":62,"../events/Target.js":68,"../has.js":159,"../obj.js":203,"../transform.js":311}],220:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Instruction=_interopRequireDefault(require("./Instruction.js")),_GeometryType=_interopRequireDefault(require("../../geom/GeometryType.js")),_Relationship=_interopRequireDefault(require("../../extent/Relationship.js")),_VectorContext=_interopRequireDefault(require("../VectorContext.js")),_colorlike=require("../../colorlike.js"),_extent=require("../../extent.js"),_canvas=require("../canvas.js"),_array=require("../../array.js"),_inflate=require("../../geom/flat/inflate.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),CanvasBuilder=function(t){function e(e,i,n,r){var o=t.call(this)||this;return o.tolerance=e,o.maxExtent=i,o.pixelRatio=r,o.maxLineWidth=0,o.resolution=n,o.beginGeometryInstruction1_=null,o.beginGeometryInstruction2_=null,o.bufferedMaxExtent_=null,o.instructions=[],o.coordinates=[],o.tmpCoordinate_=[],o.hitDetectionInstructions=[],o.state={},o}return __extends(e,t),e.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})},e.prototype.appendFlatCoordinates=function(t,e,i,n,r,o){var s=this.coordinates.length,a=this.getBufferedMaxExtent();o&&(e+=n);var u,l,c,h=t[e],f=t[e+1],d=this.tmpCoordinate_,p=!0;for(u=e+n;u<i;u+=n)d[0]=t[u],d[1]=t[u+1],(c=(0,_extent.coordinateRelationship)(a,d))!==l?(p&&(this.coordinates[s++]=h,this.coordinates[s++]=f),this.coordinates[s++]=d[0],this.coordinates[s++]=d[1],p=!1):c===_Relationship.default.INTERSECTING?(this.coordinates[s++]=d[0],this.coordinates[s++]=d[1],p=!1):p=!0,h=d[0],f=d[1],l=c;return(r&&p||u===e+n)&&(this.coordinates[s++]=h,this.coordinates[s++]=f),s},e.prototype.drawCustomCoordinates_=function(t,e,i,n,r){for(var o=0,s=i.length;o<s;++o){var a=i[o],u=this.appendFlatCoordinates(t,e,a,n,!1,!1);r.push(u),e=a}return e},e.prototype.drawCustom=function(t,e,i){this.beginGeometry(t,e);var n,r,o,s,a,u=t.getType(),l=t.getStride(),c=this.coordinates.length;if(u==_GeometryType.default.MULTI_POLYGON){n=t.getOrientedFlatCoordinates(),s=[];var h=t.getEndss();a=0;for(var f=0,d=h.length;f<d;++f){var p=[];a=this.drawCustomCoordinates_(n,a,h[f],l,p),s.push(p)}this.instructions.push([_Instruction.default.CUSTOM,c,s,t,i,_inflate.inflateMultiCoordinatesArray])}else u==_GeometryType.default.POLYGON||u==_GeometryType.default.MULTI_LINE_STRING?(o=[],n=u==_GeometryType.default.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),a=this.drawCustomCoordinates_(n,0,t.getEnds(),l,o),this.instructions.push([_Instruction.default.CUSTOM,c,o,t,i,_inflate.inflateCoordinatesArray])):u==_GeometryType.default.LINE_STRING||u==_GeometryType.default.MULTI_POINT?(n=t.getFlatCoordinates(),r=this.appendFlatCoordinates(n,0,n.length,l,!1,!1),this.instructions.push([_Instruction.default.CUSTOM,c,r,t,i,_inflate.inflateCoordinates])):u==_GeometryType.default.POINT&&(n=t.getFlatCoordinates(),this.coordinates.push(n[0],n[1]),r=this.coordinates.length,this.instructions.push([_Instruction.default.CUSTOM,c,r,t,i]));this.endGeometry(e)},e.prototype.beginGeometry=function(t,e){var i=t.getExtent();this.beginGeometryInstruction1_=[_Instruction.default.BEGIN_GEOMETRY,e,0,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[_Instruction.default.BEGIN_GEOMETRY,e,0,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},e.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},e.prototype.reverseHitDetectionInstructions=function(){var t,e=this.hitDetectionInstructions;e.reverse();var i,n,r=e.length,o=-1;for(t=0;t<r;++t)(n=(i=e[t])[0])==_Instruction.default.END_GEOMETRY?o=t:n==_Instruction.default.BEGIN_GEOMETRY&&(i[2]=t,(0,_array.reverseSubArray)(this.hitDetectionInstructions,o,t),o=-1)},e.prototype.setFillStrokeStyle=function(t,e){var i=this.state;if(t){var n=t.getColor();i.fillStyle=(0,_colorlike.asColorLike)(n||_canvas.defaultFillStyle)}else i.fillStyle=void 0;if(e){var r=e.getColor();i.strokeStyle=(0,_colorlike.asColorLike)(r||_canvas.defaultStrokeStyle);var o=e.getLineCap();i.lineCap=void 0!==o?o:_canvas.defaultLineCap;var s=e.getLineDash();i.lineDash=s?s.slice():_canvas.defaultLineDash;var a=e.getLineDashOffset();i.lineDashOffset=a||_canvas.defaultLineDashOffset;var u=e.getLineJoin();i.lineJoin=void 0!==u?u:_canvas.defaultLineJoin;var l=e.getWidth();i.lineWidth=void 0!==l?l:_canvas.defaultLineWidth;var c=e.getMiterLimit();i.miterLimit=void 0!==c?c:_canvas.defaultMiterLimit,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0},e.prototype.createFill=function(t){var e=t.fillStyle,i=[_Instruction.default.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(!0),i},e.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},e.prototype.createStroke=function(t){return[_Instruction.default.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},e.prototype.updateFillStyle=function(t,e){var i=t.fillStyle;"string"==typeof i&&t.currentFillStyle==i||(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)},e.prototype.updateStrokeStyle=function(t,e){var i=t.strokeStyle,n=t.lineCap,r=t.lineDash,o=t.lineDashOffset,s=t.lineJoin,a=t.lineWidth,u=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||r!=t.currentLineDash&&!(0,_array.equals)(t.currentLineDash,r)||t.currentLineDashOffset!=o||t.currentLineJoin!=s||t.currentLineWidth!=a||t.currentMiterLimit!=u)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=r,t.currentLineDashOffset=o,t.currentLineJoin=s,t.currentLineWidth=a,t.currentMiterLimit=u)},e.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[_Instruction.default.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},e.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=(0,_extent.clone)(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;(0,_extent.buffer)(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},e}(_VectorContext.default),_default=CanvasBuilder;exports.default=_default;

},{"../../array.js":44,"../../colorlike.js":48,"../../extent.js":70,"../../extent/Relationship.js":72,"../../geom/GeometryType.js":131,"../../geom/flat/inflate.js":147,"../VectorContext.js":218,"../canvas.js":219,"./Instruction.js":227}],221:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Builder=_interopRequireDefault(require("./Builder.js")),_ImageBuilder=_interopRequireDefault(require("./ImageBuilder.js")),_LineStringBuilder=_interopRequireDefault(require("./LineStringBuilder.js")),_PolygonBuilder=_interopRequireDefault(require("./PolygonBuilder.js")),_TextBuilder=_interopRequireDefault(require("./TextBuilder.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var BATCH_CONSTRUCTORS={Circle:_PolygonBuilder.default,Default:_Builder.default,Image:_ImageBuilder.default,LineString:_LineStringBuilder.default,Polygon:_PolygonBuilder.default,Text:_TextBuilder.default},BuilderGroup=function(){function e(e,t,r,i,u){this.declutter_=u,this.declutterGroups_=null,this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=i,this.resolution_=r,this.buildersByZIndex_={}}return e.prototype.addDeclutter=function(e){var t=null;return this.declutter_&&(e?(t=this.declutterGroups_)[0][0]++:(t=[[1]],this.declutterGroups_=t)),t},e.prototype.finish=function(){var e={};for(var t in this.buildersByZIndex_){e[t]=e[t]||{};var r=this.buildersByZIndex_[t];for(var i in r){var u=r[i].finish();e[t][i]=u}}return e},e.prototype.getBuilder=function(e,t){var r=void 0!==e?e.toString():"0",i=this.buildersByZIndex_[r];void 0===i&&(i={},this.buildersByZIndex_[r]=i);var u=i[t];void 0===u&&(u=new(0,BATCH_CONSTRUCTORS[t])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[t]=u);return u},e}(),_default=BuilderGroup;exports.default=_default;

},{"./Builder.js":220,"./ImageBuilder.js":225,"./LineStringBuilder.js":228,"./PolygonBuilder.js":229,"./TextBuilder.js":230}],222:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};exports.default=_default;

},{}],223:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Instruction=_interopRequireDefault(require("./Instruction.js")),_rbush=_interopRequireDefault(require("rbush/rbush.js")),_TextBuilder=require("./TextBuilder.js"),_has=require("../../has.js"),_transform=require("../../transform.js"),_extent=require("../../extent.js"),_canvas=require("../canvas.js"),_textpath=require("../../geom/flat/textpath.js"),_array=require("../../array.js"),_length=require("../../geom/flat/length.js"),_transform2=require("../../geom/flat/transform.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var tmpExtent=(0,_extent.createEmpty)(),tmpTransform=(0,_transform.create)(),p1=[],p2=[],p3=[],p4=[],Executor=function(){function t(t,e,i,a,r){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.declutterItems=[],this.instructions=a.instructions,this.coordinates=a.coordinates,this.coordinateCache_={},this.renderBuffer_=r,this.renderedTransform_=(0,_transform.create)(),this.hitDetectionInstructions=a.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=a.fillStates||{},this.strokeStates=a.strokeStates||{},this.textStates=a.textStates||{},this.widths_={},this.labels_={}}return t.prototype.createLabel=function(t,e,i,a){var r=t+e+i+a;if(this.labels_[r])return this.labels_[r];var s=a?this.strokeStates[a]:null,n=i?this.fillStates[i]:null,l=this.textStates[e],o=this.pixelRatio,h=[l.scale[0]*o,l.scale[1]*o],u=_TextBuilder.TEXT_ALIGN[l.textAlign||_canvas.defaultTextAlign],p=a&&s.lineWidth?s.lineWidth:0,_=t.split("\n"),f=_.length,c=[],d=(0,_canvas.measureTextWidths)(l.font,_,c),v=(0,_canvas.measureTextHeight)(l.font),x=d+p,m=[],g=(x+2)*h[0],T=(v*f+p)*h[1],y={width:g<0?Math.floor(g):Math.ceil(g),height:T<0?Math.floor(T):Math.ceil(T),contextInstructions:m};(1==h[0]&&1==h[1]||m.push("scale",h),m.push("font",l.font),a)&&(m.push("strokeStyle",s.strokeStyle),m.push("lineWidth",p),m.push("lineCap",s.lineCap),m.push("lineJoin",s.lineJoin),m.push("miterLimit",s.miterLimit),(_has.WORKER_OFFSCREEN_CANVAS?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D).prototype.setLineDash&&(m.push("setLineDash",[s.lineDash]),m.push("lineDashOffset",s.lineDashOffset)));i&&m.push("fillStyle",n.fillStyle),m.push("textBaseline","middle"),m.push("textAlign","center");var b,I=.5-u,E=u*x+I*p;if(a)for(b=0;b<f;++b)m.push("strokeText",[_[b],E+I*c[b],.5*(p+v)+b*v]);if(i)for(b=0;b<f;++b)m.push("fillText",[_[b],E+I*c[b],.5*(p+v)+b*v]);return this.labels_[r]=y,y},t.prototype.replayTextBackground_=function(t,e,i,a,r,s,n,l){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,a),t.lineTo.apply(t,r),t.lineTo.apply(t,e),s&&(this.alignFill_=s[2],l&&(t.fillStyle=s[1]),this.fill_(t)),n&&(this.setStrokeStyle_(t,n),t.stroke())},t.prototype.replayImageOrLabel_=function(t,e,i,a,r,s,n,l,o,h,u,p,_,f,c,d,v,x,m){var g=x||m;i-=s*=f[0],a-=n*=f[1];var T=d+u>r.width?r.width-u:d,y=o+p>r.height?r.height-p:o,b=v[3]+T*f[0]+v[1],I=v[0]+y*f[1]+v[2],E=i-v[3],S=a-v[0];(g||0!==_)&&(p1[0]=E,p4[0]=E,p1[1]=S,p2[1]=S,p2[0]=E+b,p3[0]=p2[0],p3[1]=S+I,p4[1]=p3[1]);var k=null;if(0!==_){var L=i+s,R=a+n;k=(0,_transform.compose)(tmpTransform,L,R,1,1,_,-L,-R),(0,_transform.apply)(tmpTransform,p1),(0,_transform.apply)(tmpTransform,p2),(0,_transform.apply)(tmpTransform,p3),(0,_transform.apply)(tmpTransform,p4),(0,_extent.createOrUpdate)(Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1]),tmpExtent)}else(0,_extent.createOrUpdate)(E,S,E+b,S+I,tmpExtent);this.renderBuffer_[0]=Math.max(this.renderBuffer_[0],(0,_extent.getWidth)(tmpExtent)),this.renderBuffer_[1]=Math.max(this.renderBuffer_[1],(0,_extent.getHeight)(tmpExtent));var M=t.canvas,w=m?m[2]*f[0]/2:0,O=this.renderBuffer_,A=tmpExtent[0]-w<=(M.width+O[0])/e&&tmpExtent[2]+w>=-O[0]/e&&tmpExtent[1]-w<=(M.height+O[1])/e&&tmpExtent[3]+w>=-O[1]/e;if(c&&(i=Math.round(i),a=Math.round(a)),l){if(!A&&1==l[0])return!1;var C=A?[t,k?k.slice(0):null,h,r,u,p,T,y,i,a,f,tmpExtent.slice()]:null;C&&(g&&C.push(x,m,p1.slice(0),p2.slice(0),p3.slice(0),p4.slice(0)),l.push(C))}else A&&(g&&this.replayTextBackground_(t,p1,p2,p3,p4,x,m,!1),(0,_canvas.drawImageOrLabel)(t,k,h,r,u,p,T,y,i,a,f));return!0},t.prototype.fill_=function(t){if(this.alignFill_){var e=(0,_transform.apply)(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()},t.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.setLineDash&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))},t.prototype.renderDeclutter=function(t,e,i,a){for(var r=[],s=1,n=t.length;s<n;++s){var l=(p=t[s])[11];r.push({minX:l[0],minY:l[1],maxX:l[2],maxY:l[3],value:e})}a||(a=new _rbush.default(9));var o=!1;for(s=0,n=r.length;s<n;++s)if(a.collides(r[s])){o=!0;break}if(!o){a.load(r);for(var h=1,u=t.length;h<u;++h){var p,_=(p=t[h])[0],f=_.globalAlpha;f!==i&&(_.globalAlpha=i),p.length>12&&this.replayTextBackground_(p[0],p[14],p[15],p[16],p[17],p[12],p[13],!0),_canvas.drawImageOrLabel.apply(void 0,p),f!==i&&(_.globalAlpha=f)}}return t.length=1,a},t.prototype.drawLabelWithPointPlacement_=function(t,e,i,a){var r=this.textStates[e],s=this.createLabel(t,e,a,i),n=this.strokeStates[i],l=this.pixelRatio,o=_TextBuilder.TEXT_ALIGN[r.textAlign||_canvas.defaultTextAlign],h=_TextBuilder.TEXT_ALIGN[r.textBaseline||_canvas.defaultTextBaseline],u=n&&n.lineWidth?n.lineWidth:0;return{label:s,anchorX:o*(s.width/l-2*r.scale[0])+2*(.5-o)*u,anchorY:h*s.height/l+2*(.5-h)*u}},t.prototype.execute_=function(t,e,i,a,r,s,n){var l;this.declutterItems.length=0,this.pixelCoordinates_&&(0,_array.equals)(i,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=(0,_transform2.transform2D)(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),(0,_transform.setFromArray)(this.renderedTransform_,i));for(var o,h,u,p,_,f,c,d,v,x,m,g,T,y,b,I,E,S=0,k=a.length,L=0,R=0,M=0,w=null,O=null,A=this.coordinateCache_,C=this.viewRotation_,D=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,B={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:C},q=this.instructions!=a||this.overlaps?0:200;S<k;){var P=a[S];switch(P[0]){case _Instruction.default.BEGIN_GEOMETRY:(b=P[1]).getGeometry()?void 0===n||(0,_extent.intersects)(n,P[3])?++S:S=P[2]+1:S=P[2];break;case _Instruction.default.BEGIN_PATH:R>q&&(this.fill_(t),R=0),M>q&&(t.stroke(),M=0),R||M||(t.beginPath(),p=NaN,_=NaN),++S;break;case _Instruction.default.CIRCLE:var W=l[L=P[1]],N=l[L+1],j=l[L+2]-W,F=l[L+3]-N,G=Math.sqrt(j*j+F*F);t.moveTo(W+G,N),t.arc(W,N,G,0,2*Math.PI,!0),++S;break;case _Instruction.default.CLOSE_PATH:t.closePath(),++S;break;case _Instruction.default.CUSTOM:L=P[1],o=P[2];var X=P[3],Y=P[4],H=6==P.length?P[5]:void 0;B.geometry=X,B.feature=b,S in A||(A[S]=[]);var J=A[S];H?H(l,L,o,2,J):(J[0]=l[L],J[1]=l[L+1],J.length=2),Y(J,B),++S;break;case _Instruction.default.DRAW_IMAGE:L=P[1],o=P[2],x=P[3],h=P[4],u=P[5],v=s?null:P[6];var K=P[7],U=P[8],V=P[9],z=P[10],Q=P[11],Z=P[12],$=P[13],tt=P[14];if(!x&&P.length>=19){m=P[18],g=P[19],T=P[20],y=P[21];var et=this.drawLabelWithPointPlacement_(m,g,T,y);x=et.label,P[3]=x;var it=P[22];h=(et.anchorX-it)*this.pixelRatio,P[4]=h;var at=P[23];u=(et.anchorY-at)*this.pixelRatio,P[5]=u,K=x.height,P[7]=K,tt=x.width,P[14]=tt}var rt=void 0;P.length>24&&(rt=P[24]);var st=void 0,nt=void 0,lt=void 0;P.length>16?(st=P[15],nt=P[16],lt=P[17]):(st=_canvas.defaultPadding,nt=!1,lt=!1),Q&&D?Z+=C:Q||D||(Z-=C);for(var ot=0,ht=0;L<o;L+=2)if(!(rt&&rt[ot++]<tt/this.pixelRatio)){if(v){var ut=Math.floor(ht);d=v.length<ut+1?[v[0][0]]:v[ut]}(Mt=this.replayImageOrLabel_(t,e,l[L],l[L+1],x,h,u,d,K,U,V,z,Z,$,r,tt,st,nt?w:null,lt?O:null))&&d&&v[v.length-1]!==d&&v.push(d),d&&(d.length-1===d[0]&&this.declutterItems.push(this,d,b),ht+=1/d[0])}++S;break;case _Instruction.default.DRAW_CHARS:var pt=P[1],_t=P[2],ft=P[3];d=s?null:P[4];var ct=P[5];y=P[6];var dt=P[7],vt=P[8],xt=P[9];T=P[10];var mt=P[11];m=P[12],g=P[13];var gt=[P[14],P[14]],Tt=this.textStates[g],yt=Tt.font,bt=[Tt.scale[0]*vt,Tt.scale[1]*vt],It=void 0;yt in this.widths_?It=this.widths_[yt]:(It={},this.widths_[yt]=It);var Et=(0,_length.lineStringLength)(l,pt,_t,2),St=Math.abs(bt[0])*(0,_canvas.measureAndCacheTextWidth)(yt,m,It);if(ct||St<=Et){var kt=this.textStates[g].textAlign,Lt=(Et-St)*_TextBuilder.TEXT_ALIGN[kt],Rt=(0,_textpath.drawTextOnPath)(l,pt,_t,2,m,Lt,dt,Math.abs(bt[0]),_canvas.measureAndCacheTextWidth,yt,It,D?0:this.viewRotation_);if(Rt){var Mt=!1,wt=void 0,Ot=void 0,At=void 0,Ct=void 0,Dt=void 0;if(T)for(wt=0,Ot=Rt.length;wt<Ot;++wt)At=(Dt=Rt[wt])[4],Ct=this.createLabel(At,g,"",T),h=Dt[2]+mt,u=ft*Ct.height+2*(.5-ft)*mt*bt[1]/bt[0]-xt,Mt=this.replayImageOrLabel_(t,e,Dt[0],Dt[1],Ct,h,u,d,Ct.height,1,0,0,Dt[3],gt,!1,Ct.width,_canvas.defaultPadding,null,null)||Mt;if(y)for(wt=0,Ot=Rt.length;wt<Ot;++wt)At=(Dt=Rt[wt])[4],Ct=this.createLabel(At,g,y,""),h=Dt[2],u=ft*Ct.height-xt,Mt=this.replayImageOrLabel_(t,e,Dt[0],Dt[1],Ct,h,u,d,Ct.height,1,0,0,Dt[3],gt,!1,Ct.width,_canvas.defaultPadding,null,null)||Mt;Mt&&this.declutterItems.push(this,d,b)}}++S;break;case _Instruction.default.END_GEOMETRY:if(void 0!==s){var Bt=s(b=P[1]);if(Bt)return Bt}++S;break;case _Instruction.default.FILL:q?R++:this.fill_(t),++S;break;case _Instruction.default.MOVE_TO_LINE_TO:for(L=P[1],o=P[2],I=l[L],c=(E=l[L+1])+.5|0,(f=I+.5|0)===p&&c===_||(t.moveTo(I,E),p=f,_=c),L+=2;L<o;L+=2)f=(I=l[L])+.5|0,c=(E=l[L+1])+.5|0,L!=o-2&&f===p&&c===_||(t.lineTo(I,E),p=f,_=c);++S;break;case _Instruction.default.SET_FILL_STYLE:w=P,this.alignFill_=P[2],R&&(this.fill_(t),R=0,M&&(t.stroke(),M=0)),t.fillStyle=P[1],++S;break;case _Instruction.default.SET_STROKE_STYLE:O=P,M&&(t.stroke(),M=0),this.setStrokeStyle_(t,P),++S;break;case _Instruction.default.STROKE:q?M++:t.stroke(),++S;break;default:++S}}R&&this.fill_(t),M&&t.stroke()},t.prototype.execute=function(t,e,i,a,r){this.viewRotation_=a,this.execute_(t,e,i,this.instructions,r,void 0,void 0)},t.prototype.executeHitDetection=function(t,e,i,a,r){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,a,r)},t}(),_default=Executor;exports.default=_default;

},{"../../array.js":44,"../../extent.js":70,"../../geom/flat/length.js":151,"../../geom/flat/textpath.js":157,"../../geom/flat/transform.js":158,"../../has.js":159,"../../transform.js":311,"../canvas.js":219,"./Instruction.js":227,"./TextBuilder.js":230,"rbush/rbush.js":324}],224:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCircleArray=getCircleArray,exports.replayDeclutter=replayDeclutter,exports.default=void 0;var _BuilderType=_interopRequireDefault(require("./BuilderType.js")),_Executor=_interopRequireDefault(require("./Executor.js")),_extent=require("../../extent.js"),_transform=require("../../transform.js"),_dom=require("../../dom.js"),_obj=require("../../obj.js"),_array=require("../../array.js"),_transform2=require("../../geom/flat/transform.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var ORDER=[_BuilderType.default.POLYGON,_BuilderType.default.CIRCLE,_BuilderType.default.LINE_STRING,_BuilderType.default.IMAGE,_BuilderType.default.TEXT,_BuilderType.default.DEFAULT],ExecutorGroup=function(){function e(e,r,t,i,o,a){this.maxExtent_=e,this.overlaps_=i,this.pixelRatio_=t,this.resolution_=r,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=(0,_transform.create)(),this.createExecutors_(o)}return e.prototype.clip=function(e,r){var t=this.getClipCoords(r);e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(t[2],t[3]),e.lineTo(t[4],t[5]),e.lineTo(t[6],t[7]),e.clip()},e.prototype.createExecutors_=function(e){for(var r in e){var t=this.executorsByZIndex_[r];void 0===t&&(t={},this.executorsByZIndex_[r]=t);var i=e[r],o=[this.renderBuffer_||0,this.renderBuffer_||0];for(var a in i){var n=i[a];t[a]=new _Executor.default(this.resolution_,this.pixelRatio_,this.overlaps_,n,o)}}},e.prototype.hasExecutors=function(e){for(var r in this.executorsByZIndex_)for(var t=this.executorsByZIndex_[r],i=0,o=e.length;i<o;++i)if(e[i]in t)return!0;return!1},e.prototype.forEachFeatureAtCoordinate=function(e,r,t,i,o,a){var n=2*(i=Math.round(i))+1,u=(0,_transform.compose)(this.hitDetectionTransform_,i+.5,i+.5,1/r,-1/r,-t,-e[0],-e[1]);this.hitDetectionContext_||(this.hitDetectionContext_=(0,_dom.createCanvasContext2D)(n,n));var l,s=this.hitDetectionContext_;s.canvas.width!==n||s.canvas.height!==n?(s.canvas.width=n,s.canvas.height=n):s.clearRect(0,0,n,n),void 0!==this.renderBuffer_&&(l=(0,_extent.createEmpty)(),(0,_extent.extendCoordinate)(l,e),(0,_extent.buffer)(l,r*(this.renderBuffer_+i),l));var c,f=getCircleArray(i);function d(e){for(var r=s.getImageData(0,0,n,n).data,t=0;t<n;t++)for(var i=0;i<n;i++)if(f[t][i]&&r[4*(i*n+t)+3]>0){var u=void 0;return(!a||c!=_BuilderType.default.IMAGE&&c!=_BuilderType.default.TEXT||-1!==a.indexOf(e))&&(u=o(e)),u||void s.clearRect(0,0,n,n)}}var _,h,y,p,x,v=Object.keys(this.executorsByZIndex_).map(Number);for(v.sort(_array.numberSafeCompareFunction),_=v.length-1;_>=0;--_){var m=v[_].toString();for(y=this.executorsByZIndex_[m],h=ORDER.length-1;h>=0;--h)if(void 0!==(p=y[c=ORDER[h]])&&(x=p.executeHitDetection(s,u,t,d,l)))return x}},e.prototype.getClipCoords=function(e){var r=this.maxExtent_;if(!r)return null;var t=r[0],i=r[1],o=r[2],a=r[3],n=[t,i,t,a,o,a,o,i];return(0,_transform2.transform2D)(n,0,8,2,e,n),n},e.prototype.isEmpty=function(){return(0,_obj.isEmpty)(this.executorsByZIndex_)},e.prototype.execute=function(e,r,t,i,o,a,n){var u=Object.keys(this.executorsByZIndex_).map(Number);u.sort(_array.numberSafeCompareFunction),this.maxExtent_&&(e.save(),this.clip(e,t));var l,s,c,f,d,_,h=a||ORDER;for(l=0,s=u.length;l<s;++l){var y=u[l].toString();for(d=this.executorsByZIndex_[y],c=0,f=h.length;c<f;++c){var p=h[c];if(void 0!==(_=d[p]))if(!n||p!=_BuilderType.default.IMAGE&&p!=_BuilderType.default.TEXT)_.execute(e,r,t,i,o);else{var x=n[y];x?x.push(_,t.slice(0)):n[y]=[_,t.slice(0)]}}}this.maxExtent_&&e.restore()},e}(),circleArrayCache={0:[[!0]]};function fillCircleArrayRowToMiddle(e,r,t){var i,o=Math.floor(e.length/2);if(r>=o)for(i=o;i<r;i++)e[i][t]=!0;else if(r<o)for(i=r+1;i<o;i++)e[i][t]=!0}function getCircleArray(e){if(void 0!==circleArrayCache[e])return circleArrayCache[e];for(var r=2*e+1,t=new Array(r),i=0;i<r;i++)t[i]=new Array(r);for(var o=e,a=0,n=0;o>=a;)fillCircleArrayRowToMiddle(t,e+o,e+a),fillCircleArrayRowToMiddle(t,e+a,e+o),fillCircleArrayRowToMiddle(t,e-a,e+o),fillCircleArrayRowToMiddle(t,e-o,e+a),fillCircleArrayRowToMiddle(t,e-o,e-a),fillCircleArrayRowToMiddle(t,e-a,e-o),fillCircleArrayRowToMiddle(t,e+a,e-o),fillCircleArrayRowToMiddle(t,e+o,e-a),2*((n+=1+2*++a)-o)+1>0&&(n+=1-2*(o-=1));return circleArrayCache[e]=t,t}function replayDeclutter(e,r,t,i,o,a){for(var n=Object.keys(e).map(Number).sort(_array.numberSafeCompareFunction),u=0,l=n.length;u<l;++u)for(var s=e[n[u].toString()],c=void 0,f=0,d=s.length;f<d;){var _=s[f++],h=s[f++];_.execute(r,1,h,t,o),_!==c&&_.declutterItems.length>0&&(c=_,a.push({items:_.declutterItems,opacity:i}))}}var _default=ExecutorGroup;exports.default=_default;

},{"../../array.js":44,"../../dom.js":62,"../../extent.js":70,"../../geom/flat/transform.js":158,"../../obj.js":203,"../../transform.js":311,"./BuilderType.js":222,"./Executor.js":223}],225:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Builder=_interopRequireDefault(require("./Builder.js")),_Instruction=_interopRequireDefault(require("./Instruction.js"));function _interopRequireDefault(i){return i&&i.__esModule?i:{default:i}}var __extends=function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,t){i.__proto__=t}||function(i,t){for(var e in t)t.hasOwnProperty(e)&&(i[e]=t[e])})(t,e)};return function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),CanvasImageBuilder=function(i){function t(t,e,o,h){var s=i.call(this,t,e,o,h)||this;return s.declutterGroups_=null,s.hitDetectionImage_=null,s.image_=null,s.imagePixelRatio_=void 0,s.anchorX_=void 0,s.anchorY_=void 0,s.height_=void 0,s.opacity_=void 0,s.originX_=void 0,s.originY_=void 0,s.rotateWithView_=void 0,s.rotation_=void 0,s.scale_=void 0,s.width_=void 0,s}return __extends(t,i),t.prototype.drawCoordinates_=function(i,t,e,o){return this.appendFlatCoordinates(i,t,e,o,!1,!1)},t.prototype.drawPoint=function(i,t){if(this.image_){this.beginGeometry(i,t);var e=i.getFlatCoordinates(),o=i.getStride(),h=this.coordinates.length,s=this.drawCoordinates_(e,0,e.length,o);this.instructions.push([_Instruction.default.DRAW_IMAGE,h,s,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,this.declutterGroups_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_)]),this.hitDetectionInstructions.push([_Instruction.default.DRAW_IMAGE,h,s,this.hitDetectionImage_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,this.declutterGroups_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_)]),this.endGeometry(t)}},t.prototype.drawMultiPoint=function(i,t){if(this.image_){this.beginGeometry(i,t);var e=i.getFlatCoordinates(),o=i.getStride(),h=this.coordinates.length,s=this.drawCoordinates_(e,0,e.length,o);this.instructions.push([_Instruction.default.DRAW_IMAGE,h,s,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,this.declutterGroups_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_)]),this.hitDetectionInstructions.push([_Instruction.default.DRAW_IMAGE,h,s,this.hitDetectionImage_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,this.declutterGroups_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_)]),this.endGeometry(t)}},t.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,i.prototype.finish.call(this)},t.prototype.setImageStyle=function(i,t){var e=i.getAnchor(),o=i.getSize(),h=i.getHitDetectionImage(this.pixelRatio),s=i.getImage(this.pixelRatio),a=i.getOrigin();this.imagePixelRatio_=i.getPixelRatio(this.pixelRatio),this.anchorX_=e[0],this.anchorY_=e[1],this.declutterGroups_=t,this.hitDetectionImage_=h,this.image_=s,this.height_=o[1],this.opacity_=i.getOpacity(),this.originX_=a[0],this.originY_=a[1],this.rotateWithView_=i.getRotateWithView(),this.rotation_=i.getRotation(),this.scale_=i.getScaleArray(),this.width_=o[0]},t}(_Builder.default),_default=CanvasImageBuilder;exports.default=_default;

},{"./Builder.js":220,"./Instruction.js":227}],226:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _GeometryType=_interopRequireDefault(require("../../geom/GeometryType.js")),_VectorContext=_interopRequireDefault(require("../VectorContext.js")),_colorlike=require("../../colorlike.js"),_transform=require("../../transform.js"),_canvas=require("../canvas.js"),_array=require("../../array.js"),_extent=require("../../extent.js"),_transform2=require("../../geom/flat/transform.js"),_SimpleGeometry=require("../../geom/SimpleGeometry.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),CanvasImmediateRenderer=function(t){function e(e,i,a,s,r,o,n){var l=t.call(this)||this;return l.context_=e,l.pixelRatio_=i,l.extent_=a,l.transform_=s,l.viewRotation_=r,l.squaredTolerance_=o,l.userTransform_=n,l.contextFillState_=null,l.contextStrokeState_=null,l.contextTextState_=null,l.fillState_=null,l.strokeState_=null,l.image_=null,l.imageAnchorX_=0,l.imageAnchorY_=0,l.imageHeight_=0,l.imageOpacity_=0,l.imageOriginX_=0,l.imageOriginY_=0,l.imageRotateWithView_=!1,l.imageRotation_=0,l.imageScale_=[0,0],l.imageWidth_=0,l.text_="",l.textOffsetX_=0,l.textOffsetY_=0,l.textRotateWithView_=!1,l.textRotation_=0,l.textScale_=[0,0],l.textFillState_=null,l.textStrokeState_=null,l.textState_=null,l.pixelCoordinates_=[],l.tmpLocalTransform_=(0,_transform.create)(),l}return __extends(e,t),e.prototype.drawImages_=function(t,e,i,a){if(this.image_){var s=(0,_transform2.transform2D)(t,e,i,2,this.transform_,this.pixelCoordinates_),r=this.context_,o=this.tmpLocalTransform_,n=r.globalAlpha;1!=this.imageOpacity_&&(r.globalAlpha=n*this.imageOpacity_);var l=this.imageRotation_;this.imageRotateWithView_&&(l+=this.viewRotation_);for(var _=0,h=s.length;_<h;_+=2){var f=s[_]-this.imageAnchorX_,g=s[_+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_[0]||1!=this.imageScale_[1]){var m=f+this.imageAnchorX_,x=g+this.imageAnchorY_;(0,_transform.compose)(o,m,x,1,1,l,-m,-x),r.setTransform.apply(r,o),r.translate(m,x),r.scale(this.imageScale_[0],this.imageScale_[1]),r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),r.setTransform(1,0,0,1,0,0)}else r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,g,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(r.globalAlpha=n)}},e.prototype.drawText_=function(t,e,i,a){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var s=(0,_transform2.transform2D)(t,e,i,a,this.transform_,this.pixelCoordinates_),r=this.context_,o=this.textRotation_;for(this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=a){var n=s[e]+this.textOffsetX_,l=s[e+1]+this.textOffsetY_;if(0!==o||1!=this.textScale_[0]||1!=this.textScale_[1]){var _=(0,_transform.compose)(this.tmpLocalTransform_,n,l,1,1,o,-n,-l);r.setTransform.apply(r,_),r.translate(n,l),r.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&r.strokeText(this.text_,0,0),this.textFillState_&&r.fillText(this.text_,0,0),r.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&r.strokeText(this.text_,n,l),this.textFillState_&&r.fillText(this.text_,n,l)}}},e.prototype.moveToLineTo_=function(t,e,i,a,s){var r=this.context_,o=(0,_transform2.transform2D)(t,e,i,a,this.transform_,this.pixelCoordinates_);r.moveTo(o[0],o[1]);var n=o.length;s&&(n-=2);for(var l=2;l<n;l+=2)r.lineTo(o[l],o[l+1]);return s&&r.closePath(),i},e.prototype.drawRings_=function(t,e,i,a){for(var s=0,r=i.length;s<r;++s)e=this.moveToLineTo_(t,e,i[s],a,!0);return e},e.prototype.drawCircle=function(t){if((0,_extent.intersects)(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=(0,_SimpleGeometry.transformGeom2D)(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],a=e[3]-e[1],s=Math.sqrt(i*i+a*a),r=this.context_;r.beginPath(),r.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}},e.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},e.prototype.setTransform=function(t){this.transform_=t},e.prototype.drawGeometry=function(t){switch(t.getType()){case _GeometryType.default.POINT:this.drawPoint(t);break;case _GeometryType.default.LINE_STRING:this.drawLineString(t);break;case _GeometryType.default.POLYGON:this.drawPolygon(t);break;case _GeometryType.default.MULTI_POINT:this.drawMultiPoint(t);break;case _GeometryType.default.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case _GeometryType.default.MULTI_POLYGON:this.drawMultiPolygon(t);break;case _GeometryType.default.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case _GeometryType.default.CIRCLE:this.drawCircle(t)}},e.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);i&&(0,_extent.intersects)(this.extent_,i.getExtent())&&(this.setStyle(e),this.drawGeometry(i))},e.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),i=0,a=e.length;i<a;++i)this.drawGeometry(e[i])},e.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)},e.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),""!==this.text_&&this.drawText_(e,0,e.length,i)},e.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,_extent.intersects)(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){var a=t.getFlatMidpoint();this.drawText_(a,0,2,2)}}},e.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if((0,_extent.intersects)(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,a=t.getFlatCoordinates(),s=0,r=t.getEnds(),o=t.getStride();i.beginPath();for(var n=0,l=r.length;n<l;++n)s=this.moveToLineTo_(a,s,r[n],o,!1);i.stroke()}if(""!==this.text_){var _=t.getFlatMidpoints();this.drawText_(_,0,_.length,2)}}},e.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,_extent.intersects)(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}},e.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,_extent.intersects)(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getOrientedFlatCoordinates(),a=0,s=t.getEndss(),r=t.getStride();e.beginPath();for(var o=0,n=s.length;o<n;++o){var l=s[o];a=this.drawRings_(i,a,l,r)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var _=t.getFlatInteriorPoints();this.drawText_(_,0,_.length,2)}}},e.prototype.setContextFillState_=function(t){var e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},e.prototype.setContextStrokeState_=function(t){var e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&((0,_array.equals)(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},e.prototype.setContextTextState_=function(t){var e=this.context_,i=this.contextTextState_,a=t.textAlign?t.textAlign:_canvas.defaultTextAlign;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=a&&(i.textAlign=a,e.textAlign=a),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=a,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:a,textBaseline:t.textBaseline})},e.prototype.setFillStrokeStyle=function(t,e){if(t){var i=t.getColor();this.fillState_={fillStyle:(0,_colorlike.asColorLike)(i||_canvas.defaultFillStyle)}}else this.fillState_=null;if(e){var a=e.getColor(),s=e.getLineCap(),r=e.getLineDash(),o=e.getLineDashOffset(),n=e.getLineJoin(),l=e.getWidth(),_=e.getMiterLimit();this.strokeState_={lineCap:void 0!==s?s:_canvas.defaultLineCap,lineDash:r||_canvas.defaultLineDash,lineDashOffset:o||_canvas.defaultLineDashOffset,lineJoin:void 0!==n?n:_canvas.defaultLineJoin,lineWidth:this.pixelRatio_*(void 0!==l?l:_canvas.defaultLineWidth),miterLimit:void 0!==_?_:_canvas.defaultMiterLimit,strokeStyle:(0,_colorlike.asColorLike)(a||_canvas.defaultStrokeStyle)}}else this.strokeState_=null},e.prototype.setImageStyle=function(t){if(t){var e=t.getSize();if(e){var i=t.getAnchor(),a=t.getImage(1),s=t.getOrigin(),r=t.getScaleArray();this.imageAnchorX_=i[0],this.imageAnchorY_=i[1],this.imageHeight_=e[1],this.image_=a,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=[this.pixelRatio_*r[0],this.pixelRatio_*r[1]],this.imageWidth_=e[0]}else this.image_=null}else this.image_=null},e.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var i=e.getColor();this.textFillState_={fillStyle:(0,_colorlike.asColorLike)(i||_canvas.defaultFillStyle)}}else this.textFillState_=null;var a=t.getStroke();if(a){var s=a.getColor(),r=a.getLineCap(),o=a.getLineDash(),n=a.getLineDashOffset(),l=a.getLineJoin(),_=a.getWidth(),h=a.getMiterLimit();this.textStrokeState_={lineCap:void 0!==r?r:_canvas.defaultLineCap,lineDash:o||_canvas.defaultLineDash,lineDashOffset:n||_canvas.defaultLineDashOffset,lineJoin:void 0!==l?l:_canvas.defaultLineJoin,lineWidth:void 0!==_?_:_canvas.defaultLineWidth,miterLimit:void 0!==h?h:_canvas.defaultMiterLimit,strokeStyle:(0,_colorlike.asColorLike)(s||_canvas.defaultStrokeStyle)}}else this.textStrokeState_=null;var f=t.getFont(),g=t.getOffsetX(),m=t.getOffsetY(),x=t.getRotateWithView(),c=t.getRotation(),S=t.getScaleArray(),d=t.getText(),u=t.getTextAlign(),p=t.getTextBaseline();this.textState_={font:void 0!==f?f:_canvas.defaultFont,textAlign:void 0!==u?u:_canvas.defaultTextAlign,textBaseline:void 0!==p?p:_canvas.defaultTextBaseline},this.text_=void 0!==d?d:"",this.textOffsetX_=void 0!==g?this.pixelRatio_*g:0,this.textOffsetY_=void 0!==m?this.pixelRatio_*m:0,this.textRotateWithView_=void 0!==x&&x,this.textRotation_=void 0!==c?c:0,this.textScale_=[this.pixelRatio_*S[0],this.pixelRatio_*S[1]]}else this.text_=""},e}(_VectorContext.default),_default=CanvasImmediateRenderer;exports.default=_default;

},{"../../array.js":44,"../../colorlike.js":48,"../../extent.js":70,"../../geom/GeometryType.js":131,"../../geom/SimpleGeometry.js":139,"../../geom/flat/transform.js":158,"../../transform.js":311,"../VectorContext.js":218,"../canvas.js":219}],227:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.closePathInstruction=exports.beginPathInstruction=exports.strokeInstruction=exports.fillInstruction=void 0;var Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},fillInstruction=[Instruction.FILL];exports.fillInstruction=fillInstruction;var strokeInstruction=[Instruction.STROKE];exports.strokeInstruction=strokeInstruction;var beginPathInstruction=[Instruction.BEGIN_PATH];exports.beginPathInstruction=beginPathInstruction;var closePathInstruction=[Instruction.CLOSE_PATH];exports.closePathInstruction=closePathInstruction;var _default=Instruction;exports.default=_default;

},{}],228:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Builder=_interopRequireDefault(require("./Builder.js")),_Instruction=_interopRequireWildcard(require("./Instruction.js"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return _getRequireWildcardCache=function(){return t},t}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;if(null===t||"object"!==_typeof(t)&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var o=i?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=t[r]}return n.default=t,e&&e.set(t,n),n}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),CanvasLineStringBuilder=function(t){function e(e,n,i,r){return t.call(this,e,n,i,r)||this}return __extends(e,t),e.prototype.drawFlatCoordinates_=function(t,e,n,i){var r=this.coordinates.length,o=this.appendFlatCoordinates(t,e,n,i,!1,!1),s=[_Instruction.default.MOVE_TO_LINE_TO,r,o];return this.instructions.push(s),this.hitDetectionInstructions.push(s),n},e.prototype.drawLineString=function(t,e){var n=this.state,i=n.strokeStyle,r=n.lineWidth;if(void 0!==i&&void 0!==r){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([_Instruction.default.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],_Instruction.beginPathInstruction);var o=t.getFlatCoordinates(),s=t.getStride();this.drawFlatCoordinates_(o,0,o.length,s),this.hitDetectionInstructions.push(_Instruction.strokeInstruction),this.endGeometry(e)}},e.prototype.drawMultiLineString=function(t,e){var n=this.state,i=n.strokeStyle,r=n.lineWidth;if(void 0!==i&&void 0!==r){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([_Instruction.default.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],_Instruction.beginPathInstruction);for(var o=t.getEnds(),s=t.getFlatCoordinates(),u=t.getStride(),a=0,l=0,c=o.length;l<c;++l)a=this.drawFlatCoordinates_(s,a,o[l],u);this.hitDetectionInstructions.push(_Instruction.strokeInstruction),this.endGeometry(e)}},e.prototype.finish=function(){var e=this.state;return null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&this.instructions.push(_Instruction.strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null,t.prototype.finish.call(this)},e.prototype.applyStroke=function(e){null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(_Instruction.strokeInstruction),e.lastStroke=this.coordinates.length),e.lastStroke=0,t.prototype.applyStroke.call(this,e),this.instructions.push(_Instruction.beginPathInstruction)},e}(_Builder.default),_default=CanvasLineStringBuilder;exports.default=_default;

},{"./Builder.js":220,"./Instruction.js":227}],229:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Builder=_interopRequireDefault(require("./Builder.js")),_Instruction=_interopRequireWildcard(require("./Instruction.js")),_canvas=require("../canvas.js"),_simplify=require("../../geom/flat/simplify.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return _getRequireWildcardCache=function(){return t},t}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;if(null===t||"object"!==_typeof(t)&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var s=n?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=t[o]}return i.default=t,e&&e.set(t,i),i}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),CanvasPolygonBuilder=function(t){function e(e,i,n,o){return t.call(this,e,i,n,o)||this}return __extends(e,t),e.prototype.drawFlatCoordinatess_=function(t,e,i,n){var o=this.state,s=void 0!==o.fillStyle,r=void 0!==o.strokeStyle,u=i.length;this.instructions.push(_Instruction.beginPathInstruction),this.hitDetectionInstructions.push(_Instruction.beginPathInstruction);for(var l=0;l<u;++l){var c=i[l],a=this.coordinates.length,h=this.appendFlatCoordinates(t,e,c,n,!0,!r),f=[_Instruction.default.MOVE_TO_LINE_TO,a,h];this.instructions.push(f),this.hitDetectionInstructions.push(f),r&&(this.instructions.push(_Instruction.closePathInstruction),this.hitDetectionInstructions.push(_Instruction.closePathInstruction)),e=c}return s&&(this.instructions.push(_Instruction.fillInstruction),this.hitDetectionInstructions.push(_Instruction.fillInstruction)),r&&(this.instructions.push(_Instruction.strokeInstruction),this.hitDetectionInstructions.push(_Instruction.strokeInstruction)),e},e.prototype.drawCircle=function(t,e){var i=this.state,n=i.fillStyle,o=i.strokeStyle;if(void 0!==n||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([_Instruction.default.SET_FILL_STYLE,_canvas.defaultFillStyle]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([_Instruction.default.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var s=t.getFlatCoordinates(),r=t.getStride(),u=this.coordinates.length;this.appendFlatCoordinates(s,0,s.length,r,!1,!1);var l=[_Instruction.default.CIRCLE,u];this.instructions.push(_Instruction.beginPathInstruction,l),this.hitDetectionInstructions.push(_Instruction.beginPathInstruction,l),void 0!==i.fillStyle&&(this.instructions.push(_Instruction.fillInstruction),this.hitDetectionInstructions.push(_Instruction.fillInstruction)),void 0!==i.strokeStyle&&(this.instructions.push(_Instruction.strokeInstruction),this.hitDetectionInstructions.push(_Instruction.strokeInstruction)),this.endGeometry(e)}},e.prototype.drawPolygon=function(t,e){var i=this.state,n=i.fillStyle,o=i.strokeStyle;if(void 0!==n||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([_Instruction.default.SET_FILL_STYLE,_canvas.defaultFillStyle]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([_Instruction.default.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var s=t.getEnds(),r=t.getOrientedFlatCoordinates(),u=t.getStride();this.drawFlatCoordinatess_(r,0,s,u),this.endGeometry(e)}},e.prototype.drawMultiPolygon=function(t,e){var i=this.state,n=i.fillStyle,o=i.strokeStyle;if(void 0!==n||void 0!==o){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([_Instruction.default.SET_FILL_STYLE,_canvas.defaultFillStyle]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([_Instruction.default.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);for(var s=t.getEndss(),r=t.getOrientedFlatCoordinates(),u=t.getStride(),l=0,c=0,a=s.length;c<a;++c)l=this.drawFlatCoordinatess_(r,l,s[c],u);this.endGeometry(e)}},e.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var e=this.tolerance;if(0!==e)for(var i=this.coordinates,n=0,o=i.length;n<o;++n)i[n]=(0,_simplify.snap)(i[n],e);return t.prototype.finish.call(this)},e.prototype.setFillStrokeStyles_=function(){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)},e}(_Builder.default),_default=CanvasPolygonBuilder;exports.default=_default;

},{"../../geom/flat/simplify.js":155,"../canvas.js":219,"./Builder.js":220,"./Instruction.js":227}],230:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.TEXT_ALIGN=void 0;var _Builder=_interopRequireDefault(require("./Builder.js")),_Instruction=_interopRequireDefault(require("./Instruction.js")),_GeometryType=_interopRequireDefault(require("../../geom/GeometryType.js")),_TextPlacement=_interopRequireDefault(require("../../style/TextPlacement.js")),_colorlike=require("../../colorlike.js"),_canvas=require("../canvas.js"),_util=require("../../util.js"),_extent=require("../../extent.js"),_straightchunk=require("../../geom/flat/straightchunk.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),TEXT_ALIGN={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};exports.TEXT_ALIGN=TEXT_ALIGN;var CanvasTextBuilder=function(t){function e(e,i,s,a){var l=t.call(this,e,i,s,a)||this;return l.declutterGroups_,l.labels_=null,l.text_="",l.textOffsetX_=0,l.textOffsetY_=0,l.textRotateWithView_=void 0,l.textRotation_=0,l.textFillState_=null,l.fillStates={},l.textStrokeState_=null,l.strokeStates={},l.textState_={},l.textStates={},l.textKey_="",l.fillKey_="",l.strokeKey_="",l}return __extends(e,t),e.prototype.finish=function(){var e=t.prototype.finish.call(this);return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e},e.prototype.drawText=function(t,e){var i=this.textFillState_,s=this.textStrokeState_,a=this.textState_;if(""!==this.text_&&a&&(i||s)){var l,r,n=this.coordinates.length,o=t.getType(),h=null,u=2,_=2;if(a.placement===_TextPlacement.default.LINE){if(!(0,_extent.intersects)(this.getBufferedMaxExtent(),t.getExtent()))return;var f=void 0;if(h=t.getFlatCoordinates(),_=t.getStride(),o==_GeometryType.default.LINE_STRING)f=[h.length];else if(o==_GeometryType.default.MULTI_LINE_STRING)f=t.getEnds();else if(o==_GeometryType.default.POLYGON)f=t.getEnds().slice(0,1);else if(o==_GeometryType.default.MULTI_POLYGON){var d=t.getEndss();for(f=[],l=0,r=d.length;l<r;++l)f.push(d[l][0])}this.beginGeometry(t,e);for(var c=a.textAlign,g=0,x=void 0,p=0,y=f.length;p<y;++p){if(null==c){var S=(0,_straightchunk.matchingChunk)(a.maxAngle,h,g,f[p],_);g=S[0],x=S[1]}else x=f[p];for(l=g;l<x;l+=_)this.coordinates.push(h[l],h[l+1]);u=this.coordinates.length,g=f[p];var v=this.declutterGroups_?0===p?this.declutterGroups_[0]:[].concat(this.declutterGroups_[0]):null;this.drawChars_(n,u,v),n=u}this.endGeometry(e)}else{var k=null;switch(a.overflow||(k=[]),o){case _GeometryType.default.POINT:case _GeometryType.default.MULTI_POINT:u=(h=t.getFlatCoordinates()).length;break;case _GeometryType.default.LINE_STRING:h=t.getFlatMidpoint();break;case _GeometryType.default.CIRCLE:h=t.getCenter();break;case _GeometryType.default.MULTI_LINE_STRING:u=(h=t.getFlatMidpoints()).length;break;case _GeometryType.default.POLYGON:h=t.getFlatInteriorPoint(),a.overflow||k.push(h[2]/this.resolution),_=3;break;case _GeometryType.default.MULTI_POLYGON:var T=t.getFlatInteriorPoints();for(h=[],l=0,r=T.length;l<r;l+=3)a.overflow||k.push(T[l+2]/this.resolution),h.push(T[l],T[l+1]);if(0==(u=h.length))return}u=this.appendFlatCoordinates(h,0,u,_,!1,!1),this.saveTextStates_(),(a.backgroundFill||a.backgroundStroke)&&(this.setFillStrokeStyle(a.backgroundFill,a.backgroundStroke),a.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),a.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var m=a.padding;if(m!=_canvas.defaultPadding&&(a.scale[0]<0||a.scale[1]<0)){var G=a.padding[0],L=a.padding[1],I=a.padding[2],N=a.padding[3];a.scale[0]<0&&(L=-L,N=-N),a.scale[1]<0&&(G=-G,I=-I),m=[G,L,I,N]}var O=this.pixelRatio;this.instructions.push([_Instruction.default.DRAW_IMAGE,n,u,null,NaN,NaN,this.declutterGroups_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,m==_canvas.defaultPadding?_canvas.defaultPadding:m.map(function(t){return t*O}),!!a.backgroundFill,!!a.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,k]);var F=1/O;this.hitDetectionInstructions.push([_Instruction.default.DRAW_IMAGE,n,u,null,NaN,NaN,this.declutterGroups_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[F,F],NaN,m,!!a.backgroundFill,!!a.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,k]),this.endGeometry(e)}}},e.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var a=this.textKey_;a in this.textStates||(this.textStates[a]={font:e.font,textAlign:e.textAlign||_canvas.defaultTextAlign,textBaseline:e.textBaseline||_canvas.defaultTextBaseline,scale:e.scale});var l=this.fillKey_;i&&(l in this.fillStates||(this.fillStates[l]={fillStyle:i.fillStyle}))},e.prototype.drawChars_=function(t,e,i){var s=this.textStrokeState_,a=this.textState_,l=this.strokeKey_,r=this.textKey_,n=this.fillKey_;this.saveTextStates_();var o=this.pixelRatio,h=TEXT_ALIGN[a.textBaseline],u=this.textOffsetY_*o,_=this.text_,f=s?s.lineWidth*Math.abs(a.scale[0])/2:0;this.instructions.push([_Instruction.default.DRAW_CHARS,t,e,h,i,a.overflow,n,a.maxAngle,o,u,l,f*o,_,r,1]),this.hitDetectionInstructions.push([_Instruction.default.DRAW_CHARS,t,e,h,i,a.overflow,n,a.maxAngle,1,u,l,f,_,r,1/o])},e.prototype.setTextStyle=function(t,e){var i,s,a;if(t){this.declutterGroups_=e;var l=t.getFill();l?((s=this.textFillState_)||(s={},this.textFillState_=s),s.fillStyle=(0,_colorlike.asColorLike)(l.getColor()||_canvas.defaultFillStyle)):(s=null,this.textFillState_=s);var r=t.getStroke();if(r){(a=this.textStrokeState_)||(a={},this.textStrokeState_=a);var n=r.getLineDash(),o=r.getLineDashOffset(),h=r.getWidth(),u=r.getMiterLimit();a.lineCap=r.getLineCap()||_canvas.defaultLineCap,a.lineDash=n?n.slice():_canvas.defaultLineDash,a.lineDashOffset=void 0===o?_canvas.defaultLineDashOffset:o,a.lineJoin=r.getLineJoin()||_canvas.defaultLineJoin,a.lineWidth=void 0===h?_canvas.defaultLineWidth:h,a.miterLimit=void 0===u?_canvas.defaultMiterLimit:u,a.strokeStyle=(0,_colorlike.asColorLike)(r.getColor()||_canvas.defaultStrokeStyle)}else a=null,this.textStrokeState_=a;i=this.textState_;var _=t.getFont()||_canvas.defaultFont;(0,_canvas.registerFont)(_);var f=t.getScaleArray();i.overflow=t.getOverflow(),i.font=_,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.textBaseline=t.getTextBaseline()||_canvas.defaultTextBaseline,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||_canvas.defaultPadding,i.scale=void 0===f?[1,1]:f;var d=t.getOffsetX(),c=t.getOffsetY(),g=t.getRotateWithView(),x=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===d?0:d,this.textOffsetY_=void 0===c?0:c,this.textRotateWithView_=void 0!==g&&g,this.textRotation_=void 0===x?0:x,this.strokeKey_=a?("string"==typeof a.strokeStyle?a.strokeStyle:(0,_util.getUid)(a.strokeStyle))+a.lineCap+a.lineDashOffset+"|"+a.lineWidth+a.lineJoin+a.miterLimit+"["+a.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.textBaseline||"?"),this.fillKey_=s?"string"==typeof s.fillStyle?s.fillStyle:"|"+(0,_util.getUid)(s.fillStyle):""}else this.text_=""},e}(_Builder.default),_default=CanvasTextBuilder;exports.default=_default;

},{"../../colorlike.js":48,"../../extent.js":70,"../../geom/GeometryType.js":131,"../../geom/flat/straightchunk.js":156,"../../style/TextPlacement.js":304,"../../util.js":313,"../canvas.js":219,"./Builder.js":220,"./Instruction.js":227}],231:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createHitDetectionImageData=createHitDetectionImageData,exports.hitDetect=hitDetect;var _Immediate=_interopRequireDefault(require("./Immediate.js")),_GeometryType=_interopRequireDefault(require("../../geom/GeometryType.js")),_IconAnchorUnits=_interopRequireDefault(require("../../style/IconAnchorUnits.js")),_style=require("../../style.js"),_dom=require("../../dom.js"),_extent=require("../../extent.js"),_array=require("../../array.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function createHitDetectionImageData(e,t,r,a,i,o,n){var l=e[0]/2,c=e[1]/2,s=(0,_dom.createCanvasContext2D)(l,c);s.imageSmoothingEnabled=!1;for(var u=s.canvas,g=new _Immediate.default(s,.5,i,null,n),h=r.length,m=Math.floor(16777215/h),d={},f=1;f<=h;++f){var y=r[f-1],v=y.getStyleFunction()||a;if(a){var _=v(y,o);if(_){Array.isArray(_)||(_=[_]);for(var p="#"+("000000"+(f*m).toString(16)).slice(-6),I=0,D=_.length;I<D;++I){var S=_[I],x=S.clone(),q=x.getFill();q&&q.setColor(p);var w=x.getStroke();w&&w.setColor(p),x.setText(void 0);var T=S.getImage();if(T){var C=T.getImageSize();if(!C)continue;var G=document.createElement("canvas");G.width=C[0],G.height=C[1];var j=G.getContext("2d",{alpha:!1});j.fillStyle=p;var R=j.canvas;j.fillRect(0,0,R.width,R.height);var A=C?C[0]:R.width,E=C?C[1]:R.height;(0,_dom.createCanvasContext2D)(A,E).drawImage(R,0,0),x.setImage(new _style.Icon({img:R,imgSize:C,anchor:T.getAnchor(),anchorXUnits:_IconAnchorUnits.default.PIXELS,anchorYUnits:_IconAnchorUnits.default.PIXELS,offset:T.getOrigin(),size:T.getSize(),opacity:T.getOpacity(),scale:T.getScale(),rotation:T.getRotation(),rotateWithView:T.getRotateWithView()}))}var M=Number(x.getZIndex());(U=d[M])||(U={},d[M]=U,U[_GeometryType.default.POLYGON]=[],U[_GeometryType.default.CIRCLE]=[],U[_GeometryType.default.LINE_STRING]=[],U[_GeometryType.default.POINT]=[]);var O=x.getGeometryFunction()(y);O&&(0,_extent.intersects)(i,O.getExtent())&&U[O.getType().replace("Multi","")].push(O,x)}}}}for(var b=Object.keys(d).map(Number).sort(_array.numberSafeCompareFunction),N=(f=0,b.length);f<N;++f){var U=d[b[f]];for(var L in U){var P=U[L];for(I=0,D=P.length;I<D;I+=2){g.setStyle(P[I+1]);for(var z=0,F=t.length;z<F;++z)g.setTransform(t[z]),g.drawGeometry(P[I])}}}return s.getImageData(0,0,u.width,u.height)}function hitDetect(e,t,r){var a=[];if(r){var i=4*(Math.round(e[0]/2)+Math.round(e[1]/2)*r.width),o=r.data[i],n=r.data[i+1],l=r.data[i+2]+256*(n+256*o),c=Math.floor(16777215/t.length);l&&l%c==0&&a.push(t[l/c-1])}return a}

},{"../../array.js":44,"../../dom.js":62,"../../extent.js":70,"../../geom/GeometryType.js":131,"../../style.js":291,"../../style/IconAnchorUnits.js":295,"./Immediate.js":226}],232:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Map=_interopRequireDefault(require("./Map.js")),_ObjectEventType=_interopRequireDefault(require("../ObjectEventType.js")),_Event=_interopRequireDefault(require("../render/Event.js")),_EventType=_interopRequireDefault(require("../render/EventType.js")),_State=_interopRequireDefault(require("../source/State.js")),_css=require("../css.js"),_canvas=require("../render/canvas.js"),_Layer=require("../layer/Layer.js"),_events=require("../events.js"),_dom=require("../dom.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),CompositeMapRenderer=function(e){function t(t){var r=e.call(this,t)||this;r.fontChangeListenerKey_=(0,_events.listen)(_canvas.checkedFonts,_ObjectEventType.default.PROPERTYCHANGE,t.redrawText.bind(t)),r.element_=document.createElement("div");var n=r.element_.style;n.position="absolute",n.width="100%",n.height="100%",n.zIndex="0",r.element_.className=_css.CLASS_UNSELECTABLE+" ol-layers";var i=t.getViewport();return i.insertBefore(r.element_,i.firstChild||null),r.children_=[],r.renderedVisible_=!0,r}return __extends(t,e),t.prototype.dispatchRenderEvent=function(e,t){var r=this.getMap();if(r.hasListener(e)){var n=new _Event.default(e,void 0,t);r.dispatchEvent(n)}},t.prototype.disposeInternal=function(){(0,_events.unlistenByKey)(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),e.prototype.disposeInternal.call(this)},t.prototype.renderFrame=function(t){if(t){this.calculateMatrices2D(t),this.dispatchRenderEvent(_EventType.default.PRECOMPOSE,t);var r=t.layerStatesArray.sort(function(e,t){return e.zIndex-t.zIndex}),n=t.viewState;this.children_.length=0;for(var i=null,a=0,s=r.length;a<s;++a){var o=r[a];if(t.layerIndex=a,(0,_Layer.inView)(o,n)&&(o.sourceState==_State.default.READY||o.sourceState==_State.default.UNDEFINED)){var l=o.layer.render(t,i);l&&l!==i&&(this.children_.push(l),i=l)}}e.prototype.renderFrame.call(this,t),(0,_dom.replaceChildren)(this.element_,this.children_),this.dispatchRenderEvent(_EventType.default.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}else this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1)},t.prototype.forEachLayerAtPixel=function(e,t,r,n,i){for(var a=t.viewState,s=t.layerStatesArray,o=s.length-1;o>=0;--o){var l=s[o],d=l.layer;if(d.hasRenderer()&&(0,_Layer.inView)(l,a)&&i(d)){var u=d.getRenderer().getDataAtPixel(e,t,r);if(u){var _=n(d,u);if(_)return _}}}},t}(_Map.default),_default=CompositeMapRenderer;exports.default=_default;

},{"../ObjectEventType.js":29,"../css.js":61,"../dom.js":62,"../events.js":64,"../layer/Layer.js":192,"../render/Event.js":215,"../render/EventType.js":216,"../render/canvas.js":219,"../source/State.js":267,"./Map.js":234}],233:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_ImageState=_interopRequireDefault(require("../ImageState.js")),_Observable=_interopRequireDefault(require("../Observable.js")),_State=_interopRequireDefault(require("../source/State.js")),_util=require("../util.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),LayerRenderer=function(e){function t(t){var r=e.call(this)||this;return r.boundHandleImageChange_=r.handleImageChange_.bind(r),r.layer_=t,r}return __extends(t,e),t.prototype.getFeatures=function(e){return(0,_util.abstract)()},t.prototype.prepareFrame=function(e){return(0,_util.abstract)()},t.prototype.renderFrame=function(e,t){return(0,_util.abstract)()},t.prototype.loadedTileCallback=function(e,t,r){e[t]||(e[t]={}),e[t][r.tileCoord.toString()]=r},t.prototype.createLoadedTileFinder=function(e,t,r){return function(a,n){var o=this.loadedTileCallback.bind(this,r,a);return e.forEachLoadedTile(t,a,n,o)}.bind(this)},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,a,n){},t.prototype.getDataAtPixel=function(e,t,r){return(0,_util.abstract)()},t.prototype.getLayer=function(){return this.layer_},t.prototype.handleFontsChanged=function(){},t.prototype.handleImageChange_=function(e){e.target.getState()===_ImageState.default.LOADED&&this.renderIfReadyAndVisible()},t.prototype.loadImage=function(e){var t=e.getState();return t!=_ImageState.default.LOADED&&t!=_ImageState.default.ERROR&&e.addEventListener(_EventType.default.CHANGE,this.boundHandleImageChange_),t==_ImageState.default.IDLE&&(e.load(),t=e.getState()),t==_ImageState.default.LOADED},t.prototype.renderIfReadyAndVisible=function(){var e=this.getLayer();e.getVisible()&&e.getSourceState()==_State.default.READY&&e.changed()},t}(_Observable.default),_default=LayerRenderer;exports.default=_default;

},{"../ImageState.js":18,"../Observable.js":30,"../events/EventType.js":66,"../source/State.js":267,"../util.js":313}],234:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Disposable=_interopRequireDefault(require("../Disposable.js")),_functions=require("../functions.js"),_util=require("../util.js"),_transform=require("../transform.js"),_extent=require("../extent.js"),_IconImageCache=require("../style/IconImageCache.js"),_Layer=require("../layer/Layer.js"),_render=require("../render.js"),_coordinate=require("../coordinate.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(r,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(r,t)};return function(r,t){function n(){this.constructor=r}e(r,t),r.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),MapRenderer=function(e){function r(r){var t=e.call(this)||this;return t.map_=r,t.declutterTree_=null,t}return __extends(r,e),r.prototype.dispatchRenderEvent=function(e,r){(0,_util.abstract)()},r.prototype.calculateMatrices2D=function(e){var r=e.viewState,t=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;(0,_transform.compose)(t,e.size[0]/2,e.size[1]/2,1/r.resolution,-1/r.resolution,-r.rotation,-r.center[0],-r.center[1]),(0,_transform.makeInverse)(n,t)},r.prototype.forEachFeatureAtCoordinate=function(e,r,t,n,o,a,i,u){var c,s=r.viewState;function l(e,r,t){return o.call(a,r,e?t:null)}var p=s.projection,f=(0,_coordinate.wrapX)(e.slice(),p),_=[[0,0]];if(p.canWrapX()&&n){var d=p.getExtent(),h=(0,_extent.getWidth)(d);_.push([-h,0],[h,0])}var v,y=r.layerStatesArray,m=y.length;this.declutterTree_&&(v=this.declutterTree_.all().map(function(e){return e.value}));for(var x=[],g=0;g<_.length;g++)for(var j=m-1;j>=0;--j){var C=y[j],I=C.layer;if(I.hasRenderer()&&(0,_Layer.inView)(C,s)&&i.call(u,I)){var q=I.getRenderer(),T=I.getSource();if(q&&T){var b=T.getWrapX()?f:e,E=l.bind(null,C.managed);x[0]=b[0]+_[g][0],x[1]=b[1]+_[g][1],c=q.forEachFeatureAtCoordinate(x,r,t,E,v)}if(c)return c}}},r.prototype.forEachLayerAtPixel=function(e,r,t,n,o){return(0,_util.abstract)()},r.prototype.hasFeatureAtCoordinate=function(e,r,t,n,o,a){return void 0!==this.forEachFeatureAtCoordinate(e,r,t,n,_functions.TRUE,this,o,a)},r.prototype.getMap=function(){return this.map_},r.prototype.renderFrame=function(e){this.declutterTree_=(0,_render.renderDeclutterItems)(e,this.declutterTree_)},r.prototype.scheduleExpireIconCache=function(e){_IconImageCache.shared.canExpireCache()&&e.postRenderFunctions.push(expireIconCache)},r}(_Disposable.default);function expireIconCache(e,r){_IconImageCache.shared.expire()}var _default=MapRenderer;exports.default=_default;

},{"../Disposable.js":12,"../coordinate.js":60,"../extent.js":70,"../functions.js":125,"../layer/Layer.js":192,"../render.js":213,"../style/IconImageCache.js":297,"../transform.js":311,"../util.js":313}],235:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Layer=_interopRequireDefault(require("./Layer.js")),_ViewHint=_interopRequireDefault(require("../../ViewHint.js")),_common=require("../../reproj/common.js"),_obj=require("../../obj.js"),_transform=require("../../transform.js"),_extent=require("../../extent.js"),_canvas=require("../../render/canvas.js"),_proj=require("../../proj.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),CanvasImageLayerRenderer=function(e){function t(t){var r=e.call(this,t)||this;return r.image_=null,r}return __extends(t,e),t.prototype.getImage=function(){return this.image_?this.image_.getImage():null},t.prototype.prepareFrame=function(e){var t=e.layerStatesArray[e.layerIndex],r=e.pixelRatio,n=e.viewState,i=n.resolution,o=this.getLayer().getSource(),a=e.viewHints,s=e.extent;if(void 0!==t.extent&&(s=(0,_extent.getIntersection)(s,(0,_proj.fromUserExtent)(t.extent,n.projection))),!a[_ViewHint.default.ANIMATING]&&!a[_ViewHint.default.INTERACTING]&&!(0,_extent.isEmpty)(s))if(o){var u=n.projection;if(!_common.ENABLE_RASTER_REPROJECTION){var l=o.getProjection();l&&(u=l)}var c=o.getImage(s,i,r,u);c&&this.loadImage(c)&&(this.image_=c)}else this.image_=null;return!!this.image_},t.prototype.renderFrame=function(e,t){var r=this.image_,n=r.getExtent(),i=r.getResolution(),o=r.getPixelRatio(),a=e.layerStatesArray[e.layerIndex],s=e.pixelRatio,u=e.viewState,l=u.center,c=u.resolution,h=e.size,_=s*i/(c*o),p=Math.round(h[0]*s),f=Math.round(h[1]*s),m=u.rotation;if(m){var d=Math.round(Math.sqrt(p*p+f*f));p=d,f=d}(0,_transform.compose)(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/s,1/s,m,-p/2,-f/2),(0,_transform.makeInverse)(this.inversePixelTransform,this.pixelTransform);var g=(0,_canvas.createTransformString)(this.pixelTransform);this.useContainer(t,g,a.opacity);var x=this.context,v=x.canvas;v.width!=p||v.height!=f?(v.width=p,v.height=f):this.containerReused||x.clearRect(0,0,p,f);var y=!1;if(a.extent){var j=(0,_proj.fromUserExtent)(a.extent,u.projection);(y=!(0,_extent.containsExtent)(j,e.extent)&&(0,_extent.intersects)(j,e.extent))&&this.clipUnrotated(x,e,j)}var R=r.getImage(),I=(0,_transform.compose)(this.tempTransform,p/2,f/2,_,_,0,o*(n[0]-l[0])/i,o*(l[1]-n[3])/i);this.renderedResolution=i*s/o;var w=I[4],q=I[5],A=R.width*I[0],E=R.height*I[3];if((0,_obj.assign)(x,this.getLayer().getSource().getContextOptions()),this.preRender(x,e),A>=.5&&E>=.5){var M=a.opacity,T=void 0;1!==M&&(T=this.context.globalAlpha,this.context.globalAlpha=M),this.context.drawImage(R,0,0,+R.width,+R.height,Math.round(w),Math.round(q),Math.round(A),Math.round(E)),1!==M&&(this.context.globalAlpha=T)}return this.postRender(x,e),y&&x.restore(),g!==v.style.transform&&(v.style.transform=g),this.container},t}(_Layer.default),_default=CanvasImageLayerRenderer;exports.default=_default;

},{"../../ViewHint.js":42,"../../extent.js":70,"../../obj.js":203,"../../proj.js":205,"../../render/canvas.js":219,"../../reproj/common.js":248,"../../transform.js":311,"./Layer.js":236}],236:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Layer=_interopRequireDefault(require("../Layer.js")),_Event=_interopRequireDefault(require("../../render/Event.js")),_EventType=_interopRequireDefault(require("../../render/EventType.js")),_transform=require("../../transform.js"),_dom=require("../../dom.js"),_extent=require("../../extent.js"),_canvas=require("../../render/canvas.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),CanvasLayerRenderer=function(e){function t(t){var r=e.call(this,t)||this;return r.container=null,r.renderedResolution,r.tempTransform=(0,_transform.create)(),r.pixelTransform=(0,_transform.create)(),r.inversePixelTransform=(0,_transform.create)(),r.context=null,r.containerReused=!1,r}return __extends(t,e),t.prototype.useContainer=function(e,t,r){var n,o,a=this.getLayer().getClassName();e&&""===e.style.opacity&&e.className===a&&((s=e.firstElementChild)instanceof HTMLCanvasElement&&(o=s.getContext("2d")));if(!o||0!==o.canvas.width&&o.canvas.style.transform!==t?this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1):(this.container=e,this.context=o,this.containerReused=!0),!this.container){(n=document.createElement("div")).className=a;var i=n.style;i.position="absolute",i.width="100%",i.height="100%";var s=(o=(0,_dom.createCanvasContext2D)()).canvas;n.appendChild(s),(i=s.style).position="absolute",i.left="0",i.transformOrigin="top left",this.container=n,this.context=o}},t.prototype.clip=function(e,t,r){var n=t.pixelRatio,o=t.size[0]*n/2,a=t.size[1]*n/2,i=t.viewState.rotation,s=(0,_extent.getTopLeft)(r),p=(0,_extent.getTopRight)(r),l=(0,_extent.getBottomRight)(r),f=(0,_extent.getBottomLeft)(r);(0,_transform.apply)(t.coordinateToPixelTransform,s),(0,_transform.apply)(t.coordinateToPixelTransform,p),(0,_transform.apply)(t.coordinateToPixelTransform,l),(0,_transform.apply)(t.coordinateToPixelTransform,f),e.save(),(0,_canvas.rotateAtOffset)(e,-i,o,a),e.beginPath(),e.moveTo(s[0]*n,s[1]*n),e.lineTo(p[0]*n,p[1]*n),e.lineTo(l[0]*n,l[1]*n),e.lineTo(f[0]*n,f[1]*n),e.clip(),(0,_canvas.rotateAtOffset)(e,i,o,a)},t.prototype.clipUnrotated=function(e,t,r){var n=(0,_extent.getTopLeft)(r),o=(0,_extent.getTopRight)(r),a=(0,_extent.getBottomRight)(r),i=(0,_extent.getBottomLeft)(r);(0,_transform.apply)(t.coordinateToPixelTransform,n),(0,_transform.apply)(t.coordinateToPixelTransform,o),(0,_transform.apply)(t.coordinateToPixelTransform,a),(0,_transform.apply)(t.coordinateToPixelTransform,i);var s=this.inversePixelTransform;(0,_transform.apply)(s,n),(0,_transform.apply)(s,o),(0,_transform.apply)(s,a),(0,_transform.apply)(s,i),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.lineTo(Math.round(i[0]),Math.round(i[1])),e.clip()},t.prototype.dispatchRenderEvent_=function(e,t,r){var n=this.getLayer();if(n.hasListener(e)){var o=new _Event.default(e,this.inversePixelTransform,r,t);n.dispatchEvent(o)}},t.prototype.preRender=function(e,t){this.dispatchRenderEvent_(_EventType.default.PRERENDER,e,t)},t.prototype.postRender=function(e,t){this.dispatchRenderEvent_(_EventType.default.POSTRENDER,e,t)},t.prototype.getRenderTransform=function(e,t,r,n,o,a,i){var s=o/2,p=a/2,l=n/t,f=-l,c=-e[0]+i,u=-e[1];return(0,_transform.compose)(this.tempTransform,s,p,l,f,-r,c,u)},t.prototype.getDataAtPixel=function(e,t,r){var n,o=(0,_transform.apply)(this.inversePixelTransform,e.slice()),a=this.context;try{var i=Math.round(o[0]),s=Math.round(o[1]),p=document.createElement("canvas"),l=p.getContext("2d");p.width=1,p.height=1,l.clearRect(0,0,1,1),l.drawImage(a.canvas,i,s,1,1,0,0,1,1),n=l.getImageData(0,0,1,1).data}catch(e){return"SecurityError"===e.name?new Uint8Array:n}return 0===n[3]?null:n},t}(_Layer.default),_default=CanvasLayerRenderer;exports.default=_default;

},{"../../dom.js":62,"../../extent.js":70,"../../render/Event.js":215,"../../render/EventType.js":216,"../../render/canvas.js":219,"../../transform.js":311,"../Layer.js":233}],237:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Layer=_interopRequireDefault(require("./Layer.js")),_TileRange=_interopRequireDefault(require("../../TileRange.js")),_TileState=_interopRequireDefault(require("../../TileState.js")),_transform=require("../../transform.js"),_obj=require("../../obj.js"),_extent=require("../../extent.js"),_canvas=require("../../render/canvas.js"),_proj=require("../../proj.js"),_util=require("../../util.js"),_array=require("../../array.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),CanvasTileLayerRenderer=function(e){function t(t){var r=e.call(this,t)||this;return r.extentChanged=!0,r.renderedExtent_=null,r.renderedPixelRatio,r.renderedProjection=null,r.renderedRevision,r.renderedTiles=[],r.newTiles_=!1,r.tmpExtent=(0,_extent.createEmpty)(),r.tmpTileRange_=new _TileRange.default(0,0,0,0),r}return __extends(t,e),t.prototype.isDrawableTile=function(e){var t=this.getLayer(),r=e.getState(),i=t.getUseInterimTilesOnError();return r==_TileState.default.LOADED||r==_TileState.default.EMPTY||r==_TileState.default.ERROR&&!i},t.prototype.getTile=function(e,t,r,i){var n=i.pixelRatio,a=i.viewState.projection,o=this.getLayer(),s=o.getSource().getTile(e,t,r,n,a);return s.getState()==_TileState.default.ERROR&&(o.getUseInterimTilesOnError()?o.getPreload()>0&&(this.newTiles_=!0):s.setState(_TileState.default.LOADED)),this.isDrawableTile(s)||(s=s.getInterimTile()),s},t.prototype.loadedTileCallback=function(t,r,i){return!!this.isDrawableTile(i)&&e.prototype.loadedTileCallback.call(this,t,r,i)},t.prototype.prepareFrame=function(e){return!!this.getLayer().getSource()},t.prototype.renderFrame=function(e,t){var r=e.layerStatesArray[e.layerIndex],i=e.viewState,n=i.projection,a=i.resolution,o=i.center,s=i.rotation,l=e.pixelRatio,u=this.getLayer(),d=u.getSource(),h=d.getRevision(),p=d.getTileGridForProjection(n),c=p.getZForResolution(a,d.zDirection),g=p.getResolution(c),T=e.extent,f=r.extent&&(0,_proj.fromUserExtent)(r.extent,n);f&&(T=(0,_extent.getIntersection)(T,(0,_proj.fromUserExtent)(r.extent,n)));var _=d.getTilePixelRatio(l),m=Math.round(e.size[0]*_),v=Math.round(e.size[1]*_);if(s){var x=Math.round(Math.sqrt(m*m+v*v));m=x,v=x}var y=g*m/2/_,R=g*v/2/_,j=[o[0]-y,o[1]-R,o[0]+y,o[1]+R],C=p.getTileRangeForExtentAndZ(T,c),S={};S[c]={};var w=this.createLoadedTileFinder(d,n,S),E=this.tmpExtent,b=this.tmpTileRange_;this.newTiles_=!1;for(var P=C.minX;P<=C.maxX;++P)for(var q=C.minY;q<=C.maxY;++q){var L=this.getTile(c,P,q,e);if(this.isDrawableTile(L)){var D=(0,_util.getUid)(this);if(L.getState()==_TileState.default.LOADED){S[c][L.tileCoord.toString()]=L;var O=L.inTransition(D);this.newTiles_||!O&&-1!==this.renderedTiles.indexOf(L)||(this.newTiles_=!0)}if(1===L.getAlpha(D,e.time))continue}var I=p.getTileCoordChildTileRange(L.tileCoord,b,E),A=!1;I&&(A=w(c+1,I)),A||p.forEachTileCoordParentTileRange(L.tileCoord,w,b,E)}var U=g/a;(0,_transform.compose)(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/_,1/_,s,-m/2,-v/2);var M=(0,_canvas.createTransformString)(this.pixelTransform);this.useContainer(t,M,r.opacity);var F=this.context,z=F.canvas;(0,_transform.makeInverse)(this.inversePixelTransform,this.pixelTransform),(0,_transform.compose)(this.tempTransform,m/2,v/2,U,U,0,-m/2,-v/2),z.width!=m||z.height!=v?(z.width=m,z.height=v):this.containerReused||F.clearRect(0,0,m,v),f&&this.clipUnrotated(F,e,f),(0,_obj.assign)(F,d.getContextOptions()),this.preRender(F,e),this.renderedTiles.length=0;var Y,Z,k,K=Object.keys(S).map(Number);K.sort(_array.numberSafeCompareFunction),1!==r.opacity||this.containerReused&&!d.getOpaque(e.viewState.projection)?(Y=[],Z=[]):K=K.reverse();for(var X=K.length-1;X>=0;--X){var G=K[X],Q=d.getTilePixelSize(G,l,n),N=p.getResolution(G)/g,B=Q[0]*N*U,H=Q[1]*N*U,J=p.getTileCoordForCoordAndZ((0,_extent.getTopLeft)(j),G),V=p.getTileCoordExtent(J),W=(0,_transform.apply)(this.tempTransform,[_*(V[0]-j[0])/g,_*(j[3]-V[3])/g]),$=_*d.getGutterForProjection(n),ee=S[G];for(var te in ee){var re=(L=ee[te]).tileCoord,ie=W[0]-(J[1]-re[1])*B,ne=Math.round(ie+B),ae=W[1]-(J[2]-re[2])*H,oe=Math.round(ae+H),se=ne-(P=Math.round(ie)),le=oe-(q=Math.round(ae)),ue=c===G;if(!(O=ue&&1!==L.getAlpha((0,_util.getUid)(this),e.time)))if(Y){F.save(),k=[P,q,P+se,q,P+se,q+le,P,q+le];for(var de=0,he=Y.length;de<he;++de)if(c!==G&&G<Z[de]){var pe=Y[de];F.beginPath(),F.moveTo(k[0],k[1]),F.lineTo(k[2],k[3]),F.lineTo(k[4],k[5]),F.lineTo(k[6],k[7]),F.moveTo(pe[6],pe[7]),F.lineTo(pe[4],pe[5]),F.lineTo(pe[2],pe[3]),F.lineTo(pe[0],pe[1]),F.clip()}Y.push(k),Z.push(G)}else F.clearRect(P,q,se,le);this.drawTileImage(L,e,P,q,se,le,$,ue,r.opacity),Y&&!O&&F.restore(),this.renderedTiles.push(L),this.updateUsedTiles(e.usedTiles,d,L)}}return this.renderedRevision=h,this.renderedResolution=g,this.extentChanged=!this.renderedExtent_||!(0,_extent.equals)(this.renderedExtent_,j),this.renderedExtent_=j,this.renderedPixelRatio=l,this.renderedProjection=n,this.manageTilePyramid(e,d,p,l,n,T,c,u.getPreload()),this.scheduleExpireCache(e,d),this.postRender(F,e),r.extent&&F.restore(),M!==z.style.transform&&(z.style.transform=M),this.container},t.prototype.drawTileImage=function(e,t,r,i,n,a,o,s,l){var u=this.getTileImage(e);if(u){var d=(0,_util.getUid)(this),h=s?e.getAlpha(d,t.time):1,p=l*h,c=p!==this.context.globalAlpha;c&&(this.context.save(),this.context.globalAlpha=p),this.context.drawImage(u,o,o,u.width-2*o,u.height-2*o,r,i,n,a),c&&this.context.restore(),1!==h?t.animate=!0:s&&e.endTransition(d)}},t.prototype.getImage=function(){var e=this.context;return e?e.canvas:null},t.prototype.getTileImage=function(e){return e.getImage()},t.prototype.scheduleExpireCache=function(e,t){if(t.canExpireCache()){var r=function(e,t,r){var i=(0,_util.getUid)(e);i in r.usedTiles&&e.expireCache(r.viewState.projection,r.usedTiles[i])}.bind(null,t);e.postRenderFunctions.push(r)}},t.prototype.updateUsedTiles=function(e,t,r){var i=(0,_util.getUid)(t);i in e||(e[i]={}),e[i][r.getKey()]=!0},t.prototype.manageTilePyramid=function(e,t,r,i,n,a,o,s,l){var u=(0,_util.getUid)(t);u in e.wantedTiles||(e.wantedTiles[u]={});var d,h,p,c,g,T,f=e.wantedTiles[u],_=e.tileQueue,m=0;for(T=r.getMinZoom();T<=o;++T)for(h=r.getTileRangeForExtentAndZ(a,T,h),p=r.getResolution(T),c=h.minX;c<=h.maxX;++c)for(g=h.minY;g<=h.maxY;++g)o-T<=s?(++m,(d=t.getTile(T,c,g,i,n)).getState()==_TileState.default.IDLE&&(f[d.getKey()]=!0,_.isKeyQueued(d.getKey())||_.enqueue([d,u,r.getTileCoordCenter(d.tileCoord),p])),void 0!==l&&l(d)):t.useTile(T,c,g,n);t.updateCacheSize(m,n)},t}(_Layer.default);CanvasTileLayerRenderer.prototype.getLayer;var _default=CanvasTileLayerRenderer;exports.default=_default;

},{"../../TileRange.js":37,"../../TileState.js":38,"../../array.js":44,"../../extent.js":70,"../../obj.js":203,"../../proj.js":205,"../../render/canvas.js":219,"../../transform.js":311,"../../util.js":313,"./Layer.js":236}],238:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ImageLayer=_interopRequireDefault(require("./ImageLayer.js")),_VectorLayer=_interopRequireDefault(require("./VectorLayer.js")),_EventType=_interopRequireDefault(require("../../events/EventType.js")),_ImageCanvas=_interopRequireDefault(require("../../ImageCanvas.js")),_ImageState=_interopRequireDefault(require("../../ImageState.js")),_ViewHint=_interopRequireDefault(require("../../ViewHint.js")),_transform=require("../../transform.js"),_obj=require("../../obj.js"),_extent=require("../../extent.js"),_render=require("../../render.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),CanvasVectorImageLayerRenderer=function(e){function t(t){var r=e.call(this,t)||this;return r.vectorRenderer_=new _VectorLayer.default(t),r.layerImageRatio_=t.getImageRatio(),r.coordinateToVectorPixelTransform_=(0,_transform.create)(),r.renderedPixelToCoordinateTransform_=null,r}return __extends(t,e),t.prototype.disposeInternal=function(){this.vectorRenderer_.dispose(),e.prototype.disposeInternal.call(this)},t.prototype.getFeatures=function(e){if(this.vectorRenderer_){var t=(0,_transform.apply)(this.coordinateToVectorPixelTransform_,(0,_transform.apply)(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}return new Promise(function(e,t){e([])})},t.prototype.handleFontsChanged=function(){this.vectorRenderer_.handleFontsChanged()},t.prototype.prepareFrame=function(e){var t=e.pixelRatio,r=e.viewState,n=r.resolution,o=e.viewHints,a=this.vectorRenderer_,i=e.extent;1!==this.layerImageRatio_&&(i=i.slice(0),(0,_extent.scaleFromCenter)(i,this.layerImageRatio_));var s=(0,_extent.getWidth)(i)/n,u=(0,_extent.getHeight)(i)/n;if(!o[_ViewHint.default.ANIMATING]&&!o[_ViewHint.default.INTERACTING]&&!(0,_extent.isEmpty)(i)){a.useContainer(null,null,1);var _=a.context,l=(0,_obj.assign)({},e,{coordinateToPixelTransform:(0,_transform.create)(),declutterItems:[],extent:i,size:[s,u],viewState:(0,_obj.assign)({},e.viewState,{rotation:0})}),d=new _ImageCanvas.default(i,n,t,_.canvas,function(e){a.prepareFrame(l)&&a.replayGroupChanged&&(a.renderFrame(l,null),(0,_render.renderDeclutterItems)(l,null),e())});d.addEventListener(_EventType.default.CHANGE,function(){if(d.getState()===_ImageState.default.LOADED){this.image_=d;var e=d.getResolution(),n=d.getPixelRatio(),o=e*t/n;this.renderedResolution=o,this.coordinateToVectorPixelTransform_=(0,_transform.compose)(this.coordinateToVectorPixelTransform_,s/2,u/2,1/o,-1/o,0,-r.center[0],-r.center[1])}}.bind(this)),d.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image_},t.prototype.preRender=function(){},t.prototype.postRender=function(){},t.prototype.forEachFeatureAtCoordinate=function(t,r,n,o,a){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,r,n,o,a):e.prototype.forEachFeatureAtCoordinate.call(this,t,r,n,o,a)},t}(_ImageLayer.default),_default=CanvasVectorImageLayerRenderer;exports.default=_default;

},{"../../ImageCanvas.js":17,"../../ImageState.js":18,"../../ViewHint.js":42,"../../events/EventType.js":66,"../../extent.js":70,"../../obj.js":203,"../../render.js":213,"../../transform.js":311,"./ImageLayer.js":235,"./VectorLayer.js":239}],239:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _BuilderGroup=_interopRequireDefault(require("../../render/canvas/BuilderGroup.js")),_Layer=_interopRequireDefault(require("./Layer.js")),_ExecutorGroup=_interopRequireWildcard(require("../../render/canvas/ExecutorGroup.js")),_ViewHint=_interopRequireDefault(require("../../ViewHint.js")),_transform=require("../../transform.js"),_extent=require("../../extent.js"),_hitdetect=require("../../render/canvas/hitdetect.js"),_vector=require("../vector.js"),_proj=require("../../proj.js"),_util=require("../../util.js"),_coordinate=require("../../coordinate.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),CanvasVectorLayerRenderer=function(e){function t(t){var r=e.call(this,t)||this;return r.boundHandleStyleImageChange_=r.handleStyleImageChange_.bind(r),r.animatingOrInteracting_,r.dirty_=!1,r.hitDetectionImageData_=null,r.renderedFeatures_=null,r.renderedRevision_=-1,r.renderedResolution_=NaN,r.renderedExtent_=(0,_extent.createEmpty)(),r.renderedRotation_,r.renderedCenter_=null,r.renderedProjection_=null,r.renderedRenderOrder_=null,r.replayGroup_=null,r.replayGroupChanged=!0,r}return __extends(t,e),t.prototype.useContainer=function(t,r,n){n<1&&(t=null),e.prototype.useContainer.call(this,t,r,n)},t.prototype.renderFrame=function(e,t){var r=e.pixelRatio,n=e.layerStatesArray[e.layerIndex];(0,_transform.makeScale)(this.pixelTransform,1/r,1/r),(0,_transform.makeInverse)(this.inversePixelTransform,this.pixelTransform);var i=(0,_transform.toString)(this.pixelTransform);this.useContainer(t,i,n.opacity);var o=this.context,a=o.canvas,s=this.replayGroup_;if(!s||s.isEmpty())return!this.containerReused&&a.width>0&&(a.width=0),this.container;var u=Math.round(e.size[0]*r),d=Math.round(e.size[1]*r);a.width!=u||a.height!=d?(a.width=u,a.height=d,a.style.transform!==i&&(a.style.transform=i)):this.containerReused||o.clearRect(0,0,u,d),this.preRender(o,e);var c=e.extent,l=e.viewState,h=l.center,_=l.resolution,p=l.projection,f=l.rotation,g=p.getExtent(),y=this.getLayer().getSource(),v=!1;if(n.extent){var x=(0,_proj.fromUserExtent)(n.extent,p);(v=!(0,_extent.containsExtent)(x,e.extent)&&(0,_extent.intersects)(x,e.extent))&&this.clipUnrotated(o,e,x)}var m=e.viewHints,R=!(m[_ViewHint.default.ANIMATING]||m[_ViewHint.default.INTERACTING]),j=this.getRenderTransform(h,_,f,r,u,d,0),I=this.getLayer().getDeclutter()?{}:null;if(s.execute(o,1,j,f,R,void 0,I),y.getWrapX()&&p.canWrapX()&&!(0,_extent.containsExtent)(g,c)){for(var w=c[0],E=(0,_extent.getWidth)(g),b=0,C=void 0;w<g[0];){C=E*--b;var D=this.getRenderTransform(h,_,f,r,u,d,C);s.execute(o,1,D,f,R,void 0,I),w+=E}for(b=0,w=c[2];w>g[2];){C=E*++b;var S=this.getRenderTransform(h,_,f,r,u,d,C);s.execute(o,1,S,f,R,void 0,I),w-=E}}if(I){var G=e.viewHints,O=!(G[_ViewHint.default.ANIMATING]||G[_ViewHint.default.INTERACTING]);(0,_ExecutorGroup.replayDeclutter)(I,o,f,1,O,e.declutterItems)}v&&o.restore(),this.postRender(o,e);var T=n.opacity,F=this.container;return T!==parseFloat(F.style.opacity)&&(F.style.opacity=1===T?"":String(T)),this.renderedRotation_!==l.rotation&&(this.renderedRotation_=l.rotation,this.hitDetectionImageData_=null),this.container},t.prototype.getFeatures=function(e){return new Promise(function(t,r){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var n=[this.context.canvas.width,this.context.canvas.height];(0,_transform.apply)(this.pixelTransform,n);var i=this.renderedCenter_,o=this.renderedResolution_,a=this.renderedRotation_,s=this.renderedProjection_,u=this.renderedExtent_,d=this.getLayer(),c=[],l=n[0]/2,h=n[1]/2;c.push(this.getRenderTransform(i,o,a,.5,l,h,0).slice());var _=d.getSource(),p=s.getExtent();if(_.getWrapX()&&s.canWrapX()&&!(0,_extent.containsExtent)(p,u)){for(var f=u[0],g=(0,_extent.getWidth)(p),y=0,v=void 0;f<p[0];)v=g*--y,c.push(this.getRenderTransform(i,o,a,.5,l,h,v).slice()),f+=g;for(y=0,f=u[2];f>p[2];)v=g*++y,c.push(this.getRenderTransform(i,o,a,.5,l,h,v).slice()),f-=g}this.hitDetectionImageData_=(0,_hitdetect.createHitDetectionImageData)(n,c,this.renderedFeatures_,d.getStyleFunction(),u,o,a)}t((0,_hitdetect.hitDetect)(e,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,n,i){if(this.replayGroup_){var o=t.viewState.resolution,a=t.viewState.rotation,s=this.getLayer(),u={};return this.replayGroup_.forEachFeatureAtCoordinate(e,o,a,r,function(e){var t=(0,_util.getUid)(e);if(!(t in u))return u[t]=!0,n(e,s)},s.getDeclutter()?i:null)}},t.prototype.handleFontsChanged=function(){var e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()},t.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()},t.prototype.prepareFrame=function(e){var t=this.getLayer(),r=t.getSource();if(!r)return!1;var n=e.viewHints[_ViewHint.default.ANIMATING],i=e.viewHints[_ViewHint.default.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(!this.dirty_&&!o&&n||!a&&i)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var s=e.extent,u=e.viewState,d=u.projection,c=u.resolution,l=e.pixelRatio,h=t.getRevision(),_=t.getRenderBuffer(),p=t.getRenderOrder();void 0===p&&(p=_vector.defaultOrder);var f=u.center.slice(),g=(0,_extent.buffer)(s,_*c),y=[g.slice()],v=d.getExtent();if(r.getWrapX()&&d.canWrapX()&&!(0,_extent.containsExtent)(v,e.extent)){var x=(0,_extent.getWidth)(v),m=Math.max((0,_extent.getWidth)(g)/2,x);g[0]=v[0]-m,g[2]=v[2]+m,(0,_coordinate.wrapX)(f,d);var R=(0,_extent.wrapX)(y[0],d);R[0]<v[0]&&R[2]<v[2]?y.push([R[0]+x,R[1],R[2]+x,R[3]]):R[0]>v[0]&&R[2]>v[2]&&y.push([R[0]-x,R[1],R[2]-x,R[3]])}if(!this.dirty_&&this.renderedResolution_==c&&this.renderedRevision_==h&&this.renderedRenderOrder_==p&&(0,_extent.containsExtent)(this.renderedExtent_,g))return this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var j,I=new _BuilderGroup.default((0,_vector.getTolerance)(c,l),g,c,l,t.getDeclutter()),w=(0,_proj.getUserProjection)();if(w){for(var E=0,b=y.length;E<b;++E)r.loadFeatures((0,_proj.toUserExtent)(y[E],d),c,w);j=(0,_proj.getTransformFromProjections)(w,d)}else for(E=0,b=y.length;E<b;++E)r.loadFeatures(y[E],c,d);var C=(0,_vector.getSquaredTolerance)(c,l),D=function(e){var r,n=e.getStyleFunction()||t.getStyleFunction();if(n&&(r=n(e,c)),r){var i=this.renderFeature(e,C,r,I,j);this.dirty_=this.dirty_||i}}.bind(this),S=(0,_proj.toUserExtent)(g,d),G=r.getFeaturesInExtent(S);p&&G.sort(p);for(E=0,b=G.length;E<b;++E)D(G[E]);this.renderedFeatures_=G;var O=I.finish(),T=new _ExecutorGroup.default(g,c,l,r.getOverlaps(),O,t.getRenderBuffer());return this.renderedResolution_=c,this.renderedRevision_=h,this.renderedRenderOrder_=p,this.renderedExtent_=g,this.renderedCenter_=f,this.renderedProjection_=d,this.replayGroup_=T,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},t.prototype.renderFeature=function(e,t,r,n,i){if(!r)return!1;var o=!1;if(Array.isArray(r))for(var a=0,s=r.length;a<s;++a)o=(0,_vector.renderFeature)(n,e,r[a],t,this.boundHandleStyleImageChange_,i)||o;else o=(0,_vector.renderFeature)(n,e,r,t,this.boundHandleStyleImageChange_,i);return o},t}(_Layer.default),_default=CanvasVectorLayerRenderer;exports.default=_default;

},{"../../ViewHint.js":42,"../../coordinate.js":60,"../../extent.js":70,"../../proj.js":205,"../../render/canvas/BuilderGroup.js":221,"../../render/canvas/ExecutorGroup.js":224,"../../render/canvas/hitdetect.js":231,"../../transform.js":311,"../../util.js":313,"../vector.js":241,"./Layer.js":236}],240:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _BuilderGroup=_interopRequireDefault(require("../../render/canvas/BuilderGroup.js")),_ExecutorGroup=_interopRequireWildcard(require("../../render/canvas/ExecutorGroup.js")),_TileLayer=_interopRequireDefault(require("./TileLayer.js")),_EventType=_interopRequireDefault(require("../../events/EventType.js")),_BuilderType=_interopRequireDefault(require("../../render/canvas/BuilderType.js")),_TileState=_interopRequireDefault(require("../../TileState.js")),_VectorTileRenderType=_interopRequireDefault(require("../../layer/VectorTileRenderType.js")),_ViewHint=_interopRequireDefault(require("../../ViewHint.js")),_transform=require("../../transform.js"),_extent=require("../../extent.js"),_obj=require("../../obj.js"),_hitdetect=require("../../render/canvas/hitdetect.js"),_vector=require("../vector.js"),_util=require("../../util.js"),_events=require("../../events.js"),_size=require("../../size.js"),_coordinate=require("../../coordinate.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),IMAGE_REPLAYS={image:[_BuilderType.default.POLYGON,_BuilderType.default.CIRCLE,_BuilderType.default.LINE_STRING,_BuilderType.default.IMAGE,_BuilderType.default.TEXT],hybrid:[_BuilderType.default.POLYGON,_BuilderType.default.LINE_STRING],vector:[]},VECTOR_REPLAYS={image:[_BuilderType.default.DEFAULT],hybrid:[_BuilderType.default.IMAGE,_BuilderType.default.TEXT,_BuilderType.default.DEFAULT],vector:[_BuilderType.default.POLYGON,_BuilderType.default.CIRCLE,_BuilderType.default.LINE_STRING,_BuilderType.default.IMAGE,_BuilderType.default.TEXT,_BuilderType.default.DEFAULT]},CanvasVectorTileLayerRenderer=function(e){function t(t){var r=e.call(this,t)||this;return r.boundHandleStyleImageChange_=r.handleStyleImageChange_.bind(r),r.dirty_=!1,r.renderedLayerRevision_,r.renderedPixelToCoordinateTransform_=null,r.renderedRotation_,r.renderTileImageQueue_={},r.tileListenerKeys_={},r.tmpTransform_=(0,_transform.create)(),r}return __extends(t,e),t.prototype.prepareTile=function(e,t,r,i){var n,o=(0,_util.getUid)(e),a=e.getState();return(a===_TileState.default.LOADED&&e.hifi||a===_TileState.default.ERROR)&&o in this.tileListenerKeys_&&((0,_events.unlistenByKey)(this.tileListenerKeys_[o]),delete this.tileListenerKeys_[o]),a!==_TileState.default.LOADED&&a!==_TileState.default.ERROR||(this.updateExecutorGroup_(e,t,r),this.tileImageNeedsRender_(e,t,r)&&(n=!0,i&&(this.renderTileImageQueue_[o]=e))),n},t.prototype.getTile=function(t,r,i,n){var o=n.pixelRatio,a=n.viewState,l=a.resolution,d=a.projection,u=this.getLayer(),s=u.getSource().getTile(t,r,i,o,d);if(s.getState()<_TileState.default.LOADED){s.wantedResolution=l;var p=(0,_util.getUid)(s);if(!(p in this.tileListenerKeys_)){var c=(0,_events.listen)(s,_EventType.default.CHANGE,this.prepareTile.bind(this,s,o,d,!0));this.tileListenerKeys_[p]=c}}else{var f=n.viewHints;!!(f[_ViewHint.default.ANIMATING]||f[_ViewHint.default.INTERACTING])&&s.wantedResolution||(s.wantedResolution=l),this.prepareTile(s,o,d,!1)&&u.getRenderMode()!==_VectorTileRenderType.default.VECTOR&&this.renderTileImage_(s,n)}return e.prototype.getTile.call(this,t,r,i,n)},t.prototype.isDrawableTile=function(t){var r=this.getLayer();return e.prototype.isDrawableTile.call(this,t)&&(r.getRenderMode()===_VectorTileRenderType.default.VECTOR?(0,_util.getUid)(r)in t.executorGroups:t.hasContext(r))},t.prototype.getTileImage=function(e){return e.getImage(this.getLayer())},t.prototype.prepareFrame=function(t){var r=this.getLayer().getRevision();return this.renderedLayerRevision_!=r&&(this.renderedTiles.length=0),this.renderedLayerRevision_=r,e.prototype.prepareFrame.call(this,t)},t.prototype.updateExecutorGroup_=function(e,t,r){var i=this.getLayer(),n=i.getRevision(),o=i.getRenderOrder()||null,a=e.wantedResolution,l=e.getReplayState(i);if(l.dirty||l.renderedResolution!==a||l.renderedRevision!=n||l.renderedRenderOrder!=o||l.renderedZ!==e.sourceZ){var d=i.getSource(),u=d.getTileGrid(),s=d.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),p=d.getSourceTiles(t,r,e),c=(0,_util.getUid)(i);delete e.hitDetectionImageData[c],e.executorGroups[c]=[];for(var f=function(r,n){var f=p[r];if(f.getState()!=_TileState.default.LOADED)return"continue";var g=f.tileCoord,T=u.getTileCoordExtent(g),y=(0,_extent.getIntersection)(s,T),h=(0,_extent.equals)(T,y)?null:(0,_extent.buffer)(y,i.getRenderBuffer()*a,_.tmpExtent);l.dirty=!1;var v=new _BuilderGroup.default(0,y,a,t,i.getDeclutter()),R=(0,_vector.getSquaredTolerance)(a,t),m=function(e){var t,r=e.getStyleFunction()||i.getStyleFunction();if(r&&(t=r(e,a)),t){var n=this.renderFeature(e,R,t,v);this.dirty_=this.dirty_||n,l.dirty=l.dirty||n}},E=f.getFeatures();o&&o!==l.renderedRenderOrder&&E.sort(o);for(var S=0,x=E.length;S<x;++S){var C=E[S];h&&!(0,_extent.intersects)(h,C.getGeometry().getExtent())||m.call(_,C)}var I=v.finish(),L=i.getRenderMode()!==_VectorTileRenderType.default.VECTOR&&i.getDeclutter()&&1===p.length?null:y,w=new _ExecutorGroup.default(L,a,t,d.getOverlaps(),I,i.getRenderBuffer());e.executorGroups[c].push(w)},_=this,g=0,T=p.length;g<T;++g)f(g);l.renderedRevision=n,l.renderedZ=e.sourceZ,l.renderedRenderOrder=o,l.renderedResolution=a}},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,i,n){var o=t.viewState.resolution,a=t.viewState.rotation;r=null==r?0:r;var l,d,u,s=this.getLayer(),p=s.getDeclutter(),c=s.getSource().getTileGridForProjection(t.viewState.projection),f={},_=this.renderedTiles,g=function(){var t=_[d],u=c.getTileCoordExtent(t.wrappedTileCoord),g=(0,_extent.containsCoordinate)(u,e);if(!p&&!g)return"continue";for(var T=t.executorGroups[(0,_util.getUid)(s)],y=0,h=T.length;y<h;++y){var v=T[y];l=l||v.forEachFeatureAtCoordinate(e,o,a,r,function(e){if(g||n&&-1!==n.indexOf(e)){var t=e.getId();if(void 0===t&&(t=(0,_util.getUid)(e)),!(t in f))return f[t]=!0,i(e,s)}},s.getDeclutter()?n:null)}};for(d=0,u=_.length;d<u;++d)g();return l},t.prototype.getFeatures=function(e){return new Promise(function(t,r){for(var i,n=this.getLayer(),o=(0,_util.getUid)(n),a=n.getSource(),l=this.renderedProjection,d=l.getExtent(),u=this.renderedResolution,s=a.getTileGridForProjection(l),p=(0,_transform.apply)(this.renderedPixelToCoordinateTransform_,e.slice()),c=s.getTileCoordForCoordAndResolution(p,u),f=0,_=this.renderedTiles.length;f<_;++f)if(c.toString()===this.renderedTiles[f].tileCoord.toString()){if((i=this.renderedTiles[f]).getState()===_TileState.default.LOADED&&i.hifi){var g=s.getTileCoordExtent(i.tileCoord);a.getWrapX()&&l.canWrapX()&&!(0,_extent.containsExtent)(d,g)&&(0,_coordinate.wrapX)(p,l);break}i=void 0}if(!i||i.loadingSourceTiles>0)t([]);else{var T=s.getTileCoordExtent(i.wrappedTileCoord),y=(0,_extent.getTopLeft)(T),h=[(p[0]-y[0])/u,(y[1]-p[1])/u],v=i.getSourceTiles().reduce(function(e,t){return e.concat(t.getFeatures())},[]),R=i.hitDetectionImageData[o];if(!R&&!this.animatingOrInteracting_){var m=(0,_size.toSize)(s.getTileSize(s.getZForResolution(u))),E=[m[0]/2,m[1]/2],S=this.renderedRotation_,x=[this.getRenderTransform(s.getTileCoordCenter(i.wrappedTileCoord),u,0,.5,E[0],E[1],0)];R=(0,_hitdetect.createHitDetectionImageData)(m,x,v,n.getStyleFunction(),s.getTileCoordExtent(i.wrappedTileCoord),i.getReplayState(n).renderedResolution,S),i.hitDetectionImageData[o]=R}t((0,_hitdetect.hitDetect)(h,v,R))}}.bind(this))},t.prototype.handleFontsChanged=function(){(0,_obj.clear)(this.renderTileImageQueue_);var e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()},t.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()},t.prototype.renderFrame=function(t,r){var i=t.viewHints,n=!(i[_ViewHint.default.ANIMATING]||i[_ViewHint.default.INTERACTING]);this.renderQueuedTileImages_(n,t),e.prototype.renderFrame.call(this,t,r),this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;var o=this.getLayer(),a=o.getRenderMode();if(a===_VectorTileRenderType.default.IMAGE)return this.container;var l=o.getSource(),d=t.usedTiles[(0,_util.getUid)(l)];for(var u in this.renderTileImageQueue_)d&&u in d||delete this.renderTileImageQueue_[u];for(var s=this.context,p=o.getDeclutter()?{}:null,c=VECTOR_REPLAYS[a],f=t.pixelRatio,_=t.viewState,g=_.center,T=_.resolution,y=_.rotation,h=t.size,v=Math.round(h[0]*f),R=Math.round(h[1]*f),m=this.renderedTiles,E=l.getTileGridForProjection(t.viewState.projection),S=[],x=[],C=m.length-1;C>=0;--C)for(var I=m[C],L=I.tileCoord,w=E.getTileCoordExtent(I.wrappedTileCoord),D=E.getTileCoordExtent(L,this.tmpExtent)[0]-w[0],j=(0,_transform.multiply)((0,_transform.scale)(this.inversePixelTransform.slice(),1/f,1/f),this.getRenderTransform(g,T,y,f,v,R,D)),G=I.executorGroups[(0,_util.getUid)(o)],O=!1,b=0,A=G.length;b<A;++b){var q=G[b];if(q.hasExecutors(c)){var P=I.tileCoord[0],F=void 0;if(!p&&!O){F=q.getClipCoords(j),s.save();for(var B=0,M=S.length;B<M;++B){var V=S[B];P<x[B]&&(s.beginPath(),s.moveTo(F[0],F[1]),s.lineTo(F[2],F[3]),s.lineTo(F[4],F[5]),s.lineTo(F[6],F[7]),s.moveTo(V[6],V[7]),s.lineTo(V[4],V[5]),s.lineTo(V[2],V[3]),s.lineTo(V[0],V[1]),s.clip())}}q.execute(s,1,j,y,n,c,p),p||O||(s.restore(),S.push(F),x.push(P),O=!0)}}if(p){var N=t.layerStatesArray[t.layerIndex];(0,_ExecutorGroup.replayDeclutter)(p,s,y,N.opacity,n,t.declutterItems)}return this.container},t.prototype.renderQueuedTileImages_=function(e,t){for(var r in this.renderTileImageQueue_){if(!e&&Date.now()-t.time>8){t.animate=!0;break}var i=this.renderTileImageQueue_[r];delete this.renderTileImageQueue_[r],this.renderTileImage_(i,t)}},t.prototype.renderFeature=function(e,t,r,i){if(!r)return!1;var n=!1;if(Array.isArray(r))for(var o=0,a=r.length;o<a;++o)n=(0,_vector.renderFeature)(i,e,r[o],t,this.boundHandleStyleImageChange_)||n;else n=(0,_vector.renderFeature)(i,e,r,t,this.boundHandleStyleImageChange_);return n},t.prototype.tileImageNeedsRender_=function(e,t,r){var i=this.getLayer(),n=e.getReplayState(i),o=i.getRevision(),a=e.sourceZ,l=e.wantedResolution;return n.renderedTileResolution!==l||n.renderedTileRevision!==o||n.renderedTileZ!==a},t.prototype.renderTileImage_=function(e,t){var r=this.getLayer(),i=e.getReplayState(r),n=r.getRevision(),o=e.executorGroups[(0,_util.getUid)(r)];i.renderedTileRevision=n,i.renderedTileZ=e.sourceZ;var a=e.wrappedTileCoord,l=a[0],d=r.getSource(),u=t.pixelRatio,s=t.viewState.projection,p=d.getTileGridForProjection(s),c=p.getResolution(e.tileCoord[0]),f=t.pixelRatio/e.wantedResolution*c,_=p.getResolution(l),g=e.getContext(r);u=Math.max(u,f/u);var T=d.getTilePixelSize(l,u,s);g.canvas.width=T[0],g.canvas.height=T[1];var y=u/f;if(1!==y){var h=(0,_transform.reset)(this.tmpTransform_);(0,_transform.scale)(h,y,y),g.setTransform.apply(g,h)}var v=p.getTileCoordExtent(a,this.tmpExtent),R=f/_,m=(0,_transform.reset)(this.tmpTransform_);(0,_transform.scale)(m,R,-R),(0,_transform.translate)(m,-v[0],-v[3]);for(var E=0,S=o.length;E<S;++E){o[E].execute(g,y,m,0,!0,IMAGE_REPLAYS[r.getRenderMode()])}i.renderedTileResolution=e.wantedResolution},t}(_TileLayer.default),_default=CanvasVectorTileLayerRenderer;exports.default=_default;

},{"../../TileState.js":38,"../../ViewHint.js":42,"../../coordinate.js":60,"../../events.js":64,"../../events/EventType.js":66,"../../extent.js":70,"../../layer/VectorTileRenderType.js":199,"../../obj.js":203,"../../render/canvas/BuilderGroup.js":221,"../../render/canvas/BuilderType.js":222,"../../render/canvas/ExecutorGroup.js":224,"../../render/canvas/hitdetect.js":231,"../../size.js":251,"../../transform.js":311,"../../util.js":313,"../vector.js":241,"./TileLayer.js":237}],241:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultOrder=defaultOrder,exports.getSquaredTolerance=getSquaredTolerance,exports.getTolerance=getTolerance,exports.renderFeature=renderFeature;var _BuilderType=_interopRequireDefault(require("../render/canvas/BuilderType.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_ImageState=_interopRequireDefault(require("../ImageState.js")),_util=require("../util.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var SIMPLIFY_TOLERANCE=.5,GEOMETRY_RENDERERS={Point:renderPointGeometry,LineString:renderLineStringGeometry,Polygon:renderPolygonGeometry,MultiPoint:renderMultiPointGeometry,MultiLineString:renderMultiLineStringGeometry,MultiPolygon:renderMultiPolygonGeometry,GeometryCollection:renderGeometryCollectionGeometry,Circle:renderCircleGeometry};function defaultOrder(e,t){return parseInt((0,_util.getUid)(e),10)-parseInt((0,_util.getUid)(t),10)}function getSquaredTolerance(e,t){var r=getTolerance(e,t);return r*r}function getTolerance(e,t){return SIMPLIFY_TOLERANCE*e/t}function renderCircleGeometry(e,t,r,l){var a=r.getFill(),d=r.getStroke();if(a||d){var i=e.getBuilder(r.getZIndex(),_BuilderType.default.CIRCLE);i.setFillStrokeStyle(a,d),i.drawCircle(t,l)}var n=r.getText();if(n){var u=e.getBuilder(r.getZIndex(),_BuilderType.default.TEXT);u.setTextStyle(n,e.addDeclutter(!1)),u.drawText(t,l)}}function renderFeature(e,t,r,l,a,d){var i=!1,n=r.getImage();if(n){var u=n.getImageState();u==_ImageState.default.LOADED||u==_ImageState.default.ERROR?n.unlistenImageChange(a):(u==_ImageState.default.IDLE&&n.load(),u=n.getImageState(),n.listenImageChange(a),i=!0)}return renderFeatureInternal(e,t,r,l,d),i}function renderFeatureInternal(e,t,r,l,a){var d=r.getGeometryFunction()(t);if(d){var i=d.simplifyTransformed(l,a);if(r.getRenderer())renderGeometry(e,i,r,t);else(0,GEOMETRY_RENDERERS[i.getType()])(e,i,r,t)}}function renderGeometry(e,t,r,l){if(t.getType()!=_GeometryType.default.GEOMETRY_COLLECTION)e.getBuilder(r.getZIndex(),_BuilderType.default.DEFAULT).drawCustom(t,l,r.getRenderer());else for(var a=t.getGeometries(),d=0,i=a.length;d<i;++d)renderGeometry(e,a[d],r,l)}function renderGeometryCollectionGeometry(e,t,r,l){var a,d,i=t.getGeometriesArray();for(a=0,d=i.length;a<d;++a){(0,GEOMETRY_RENDERERS[i[a].getType()])(e,i[a],r,l)}}function renderLineStringGeometry(e,t,r,l){var a=r.getStroke();if(a){var d=e.getBuilder(r.getZIndex(),_BuilderType.default.LINE_STRING);d.setFillStrokeStyle(null,a),d.drawLineString(t,l)}var i=r.getText();if(i){var n=e.getBuilder(r.getZIndex(),_BuilderType.default.TEXT);n.setTextStyle(i,e.addDeclutter(!1)),n.drawText(t,l)}}function renderMultiLineStringGeometry(e,t,r,l){var a=r.getStroke();if(a){var d=e.getBuilder(r.getZIndex(),_BuilderType.default.LINE_STRING);d.setFillStrokeStyle(null,a),d.drawMultiLineString(t,l)}var i=r.getText();if(i){var n=e.getBuilder(r.getZIndex(),_BuilderType.default.TEXT);n.setTextStyle(i,e.addDeclutter(!1)),n.drawText(t,l)}}function renderMultiPolygonGeometry(e,t,r,l){var a=r.getFill(),d=r.getStroke();if(d||a){var i=e.getBuilder(r.getZIndex(),_BuilderType.default.POLYGON);i.setFillStrokeStyle(a,d),i.drawMultiPolygon(t,l)}var n=r.getText();if(n){var u=e.getBuilder(r.getZIndex(),_BuilderType.default.TEXT);u.setTextStyle(n,e.addDeclutter(!1)),u.drawText(t,l)}}function renderPointGeometry(e,t,r,l){var a=r.getImage();if(a){if(a.getImageState()!=_ImageState.default.LOADED)return;var d=e.getBuilder(r.getZIndex(),_BuilderType.default.IMAGE);d.setImageStyle(a,e.addDeclutter(!1)),d.drawPoint(t,l)}var i=r.getText();if(i){var n=e.getBuilder(r.getZIndex(),_BuilderType.default.TEXT);n.setTextStyle(i,e.addDeclutter(!!a)),n.drawText(t,l)}}function renderMultiPointGeometry(e,t,r,l){var a=r.getImage();if(a){if(a.getImageState()!=_ImageState.default.LOADED)return;var d=e.getBuilder(r.getZIndex(),_BuilderType.default.IMAGE);d.setImageStyle(a,e.addDeclutter(!1)),d.drawMultiPoint(t,l)}var i=r.getText();if(i){var n=e.getBuilder(r.getZIndex(),_BuilderType.default.TEXT);n.setTextStyle(i,e.addDeclutter(!!a)),n.drawText(t,l)}}function renderPolygonGeometry(e,t,r,l){var a=r.getFill(),d=r.getStroke();if(a||d){var i=e.getBuilder(r.getZIndex(),_BuilderType.default.POLYGON);i.setFillStrokeStyle(a,d),i.drawPolygon(t,l)}var n=r.getText();if(n){var u=e.getBuilder(r.getZIndex(),_BuilderType.default.TEXT);u.setTextStyle(n,e.addDeclutter(!1)),u.drawText(t,l)}}

},{"../ImageState.js":18,"../geom/GeometryType.js":131,"../render/canvas/BuilderType.js":222,"../util.js":313}],242:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.writePointFeatureToBuffers=writePointFeatureToBuffers,exports.getBlankImageData=getBlankImageData,exports.colorEncodeId=colorEncodeId,exports.colorDecodeId=colorDecodeId,exports.default=exports.WebGLWorkerMessageType=void 0;var _Layer=_interopRequireDefault(require("../Layer.js")),_Helper=_interopRequireDefault(require("../../webgl/Helper.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),WebGLWorkerMessageType={GENERATE_BUFFERS:"GENERATE_BUFFERS"};exports.WebGLWorkerMessageType=WebGLWorkerMessageType;var WebGLLayerRenderer=function(e){function t(t,r){var o=e.call(this,t)||this,n=r||{};return o.helper=new _Helper.default({postProcesses:n.postProcesses,uniforms:n.uniforms}),o}return __extends(t,e),t.prototype.disposeInternal=function(){this.helper.dispose(),e.prototype.disposeInternal.call(this)},t.prototype.getShaderCompileErrors=function(){return this.helper.getShaderCompileErrors()},t}(_Layer.default),tmpArray_=[],bufferPositions_={vertexPosition:0,indexPosition:0};function writePointVertex(e,t,r,o,n){e[t+0]=r,e[t+1]=o,e[t+2]=n}function writePointFeatureToBuffers(e,t,r,o,n,a){var i=3+n,s=e[t+0],u=e[t+1],f=tmpArray_;f.length=n;for(var l=0;l<f.length;l++)f[l]=e[t+2+l];var p=a?a.vertexPosition:0,d=a?a.indexPosition:0,c=p/i;return writePointVertex(r,p,s,u,0),f.length&&r.set(f,p+3),writePointVertex(r,p+=i,s,u,1),f.length&&r.set(f,p+3),writePointVertex(r,p+=i,s,u,2),f.length&&r.set(f,p+3),writePointVertex(r,p+=i,s,u,3),f.length&&r.set(f,p+3),p+=i,o[d++]=c,o[d++]=c+1,o[d++]=c+3,o[d++]=c+1,o[d++]=c+2,o[d++]=c+3,bufferPositions_.vertexPosition=p,bufferPositions_.indexPosition=d,bufferPositions_}function getBlankImageData(){var e=document.createElement("canvas").getContext("2d").createImageData(1,1);return e.data[0]=255,e.data[1]=255,e.data[2]=255,e.data[3]=255,e}function colorEncodeId(e,t){var r=t||[];return r[0]=Math.floor(e/256/256/256)/255,r[1]=Math.floor(e/256/256)%256/255,r[2]=Math.floor(e/256)%256/255,r[3]=e%256/255,r}function colorDecodeId(e){var t=0;return t+=Math.round(256*e[0]*256*256*255),t+=Math.round(256*e[1]*256*255),t+=Math.round(256*e[2]*255),t+=Math.round(255*e[3])}var _default=WebGLLayerRenderer;exports.default=_default;

},{"../../webgl/Helper.js":318,"../Layer.js":233}],243:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _BaseVector=_interopRequireDefault(require("../../layer/BaseVector.js")),_GeometryType=_interopRequireDefault(require("../../geom/GeometryType.js")),_VectorEventType=_interopRequireDefault(require("../../source/VectorEventType.js")),_ViewHint=_interopRequireDefault(require("../../ViewHint.js")),_Buffer=_interopRequireDefault(require("../../webgl/Buffer.js")),_Layer=_interopRequireWildcard(require("./Layer.js")),_RenderTarget=_interopRequireDefault(require("../../webgl/RenderTarget.js")),_webgl=require("../../webgl.js"),_Helper=require("../../webgl/Helper.js"),_transform=require("../../transform.js"),_asserts=require("../../asserts.js"),_extent=require("../../extent.js"),_webgl2=require("../../worker/webgl.js"),_util=require("../../util.js"),_events=require("../../events.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var s=i?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(r,n,s):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),WebGLPointsLayerRenderer=function(e){function t(t,r){var i=this,n=r.uniforms||{},s=(0,_transform.create)();n[_Helper.DefaultUniform.PROJECTION_MATRIX]=s,(i=e.call(this,t,{uniforms:n,postProcesses:r.postProcesses})||this).sourceRevision_=-1,i.verticesBuffer_=new _Buffer.default(_webgl.ARRAY_BUFFER,_webgl.DYNAMIC_DRAW),i.hitVerticesBuffer_=new _Buffer.default(_webgl.ARRAY_BUFFER,_webgl.DYNAMIC_DRAW),i.indicesBuffer_=new _Buffer.default(_webgl.ELEMENT_ARRAY_BUFFER,_webgl.DYNAMIC_DRAW),i.program_=i.helper.getProgram(r.fragmentShader,r.vertexShader),i.hitDetectionEnabled_=!(!r.hitFragmentShader||!r.hitVertexShader),i.hitProgram_=i.hitDetectionEnabled_&&i.helper.getProgram(r.hitFragmentShader,r.hitVertexShader);var o=r.attributes?r.attributes.map(function(e){return{name:"a_"+e.name,size:1,type:_Helper.AttributeType.FLOAT}}):[];i.attributes=[{name:"a_position",size:2,type:_Helper.AttributeType.FLOAT},{name:"a_index",size:1,type:_Helper.AttributeType.FLOAT}].concat(o),i.hitDetectionAttributes=[{name:"a_position",size:2,type:_Helper.AttributeType.FLOAT},{name:"a_index",size:1,type:_Helper.AttributeType.FLOAT},{name:"a_hitColor",size:4,type:_Helper.AttributeType.FLOAT},{name:"a_featureUid",size:1,type:_Helper.AttributeType.FLOAT}].concat(o),i.customAttributes=r.attributes?r.attributes:[],i.previousExtent_=(0,_extent.createEmpty)(),i.currentTransform_=s,i.renderTransform_=(0,_transform.create)(),i.invertRenderTransform_=(0,_transform.create)(),i.renderInstructions_=new Float32Array(0),i.hitRenderInstructions_=new Float32Array(0),i.hitRenderTarget_=i.hitDetectionEnabled_&&new _RenderTarget.default(i.helper),i.worker_=(0,_webgl2.create)(),i.worker_.addEventListener("message",function(e){var t=e.data;if(t.type===_Layer.WebGLWorkerMessageType.GENERATE_BUFFERS){var r=t.projectionTransform;t.hitDetection?(this.hitVerticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.hitVerticesBuffer_)):(this.verticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_)),this.indicesBuffer_.fromArrayBuffer(t.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=r,(0,_transform.makeInverse)(this.invertRenderTransform_,this.renderTransform_),t.hitDetection?this.hitRenderInstructions_=new Float32Array(e.data.renderInstructions):this.renderInstructions_=new Float32Array(e.data.renderInstructions),this.getLayer().changed()}}.bind(i)),i.featureCache_={},i.featureCount_=0;var a=i.getLayer().getSource();return i.sourceListenKeys_=[(0,_events.listen)(a,_VectorEventType.default.ADDFEATURE,i.handleSourceFeatureAdded_,i),(0,_events.listen)(a,_VectorEventType.default.CHANGEFEATURE,i.handleSourceFeatureChanged_,i),(0,_events.listen)(a,_VectorEventType.default.REMOVEFEATURE,i.handleSourceFeatureDelete_,i),(0,_events.listen)(a,_VectorEventType.default.CLEAR,i.handleSourceFeatureClear_,i)],a.forEachFeature(function(e){this.featureCache_[(0,_util.getUid)(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}.bind(i)),i}return __extends(t,e),t.prototype.handleSourceFeatureAdded_=function(e){var t=e.feature;this.featureCache_[(0,_util.getUid)(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++},t.prototype.handleSourceFeatureChanged_=function(e){var t=e.feature;this.featureCache_[(0,_util.getUid)(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}},t.prototype.handleSourceFeatureDelete_=function(e){var t=e.feature;delete this.featureCache_[(0,_util.getUid)(t)],this.featureCount_--},t.prototype.handleSourceFeatureClear_=function(){this.featureCache_={},this.featureCount_=0},t.prototype.renderFrame=function(e){var t=this.indicesBuffer_.getSize();this.helper.drawElements(0,t),this.helper.finalizeDraw(e);var r=this.helper.getCanvas(),i=e.layerStatesArray[e.layerIndex].opacity;return i!==parseFloat(r.style.opacity)&&(r.style.opacity=String(i)),this.hitDetectionEnabled_&&(this.renderHitDetection(e),this.hitRenderTarget_.clearCachedData()),r},t.prototype.prepareFrame=function(e){var t=this.getLayer(),r=t.getSource(),i=e.viewState,n=!e.viewHints[_ViewHint.default.ANIMATING]&&!e.viewHints[_ViewHint.default.INTERACTING],s=!(0,_extent.equals)(this.previousExtent_,e.extent),o=this.sourceRevision_<r.getRevision();if(o&&(this.sourceRevision_=r.getRevision()),n&&(s||o)){var a=i.projection,u=i.resolution,f=t instanceof _BaseVector.default?t.getRenderBuffer():0,h=(0,_extent.buffer)(e.extent,f*u);r.loadFeatures(h,u,a),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.makeProjectionTransform(e,this.currentTransform_),(0,_transform.multiply)(this.currentTransform_,this.invertRenderTransform_),this.helper.useProgram(this.program_),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0},t.prototype.rebuildBuffers_=function(e){var t=(0,_transform.create)();this.helper.makeProjectionTransform(e,t);var r,i,n=(2+this.customAttributes.length)*this.featureCount_;if(this.renderInstructions_&&this.renderInstructions_.length===n||(this.renderInstructions_=new Float32Array(n)),this.hitDetectionEnabled_){var s=(7+this.customAttributes.length)*this.featureCount_;this.hitRenderInstructions_&&this.hitRenderInstructions_.length===s||(this.hitRenderInstructions_=new Float32Array(s))}var o,a=[],u=[],f=0,h=0;for(var _ in this.featureCache_)if((i=(r=this.featureCache_[_]).geometry)&&i.getType()===_GeometryType.default.POINT){a[0]=i.getFlatCoordinates()[0],a[1]=i.getFlatCoordinates()[1],(0,_transform.apply)(t,a),o=(0,_Layer.colorEncodeId)(h+6,u),this.renderInstructions_[f++]=a[0],this.renderInstructions_[f++]=a[1],this.hitDetectionEnabled_&&(this.hitRenderInstructions_[h++]=a[0],this.hitRenderInstructions_[h++]=a[1],this.hitRenderInstructions_[h++]=o[0],this.hitRenderInstructions_[h++]=o[1],this.hitRenderInstructions_[h++]=o[2],this.hitRenderInstructions_[h++]=o[3],this.hitRenderInstructions_[h++]=Number(_));for(var c=void 0,l=0;l<this.customAttributes.length;l++)c=this.customAttributes[l].callback(r.feature,r.properties),this.renderInstructions_[f++]=c,this.hitDetectionEnabled_&&(this.hitRenderInstructions_[h++]=c)}var p={type:_Layer.WebGLWorkerMessageType.GENERATE_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesCount:this.customAttributes.length};if(p.projectionTransform=t,this.worker_.postMessage(p,[this.renderInstructions_.buffer]),this.renderInstructions_=null,this.hitDetectionEnabled_){var d={type:_Layer.WebGLWorkerMessageType.GENERATE_BUFFERS,renderInstructions:this.hitRenderInstructions_.buffer,customAttributesCount:5+this.customAttributes.length};d.projectionTransform=t,d.hitDetection=!0,this.worker_.postMessage(d,[this.hitRenderInstructions_.buffer]),this.hitRenderInstructions_=null}},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,i,n){if((0,_asserts.assert)(this.hitDetectionEnabled_,66),this.hitRenderInstructions_){var s=(0,_transform.apply)(t.coordinateToPixelTransform,e.slice()),o=this.hitRenderTarget_.readPixel(s[0]/2,s[1]/2),a=[o[0]/255,o[1]/255,o[2]/255,o[3]/255],u=(0,_Layer.colorDecodeId)(a),f=this.hitRenderInstructions_[u],h=Math.floor(f).toString(),_=this.getLayer().getSource().getFeatureByUid(h);return _?i(_,this.getLayer()):void 0}},t.prototype.renderHitDetection=function(e){if(this.hitVerticesBuffer_.getSize()){this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.useProgram(this.hitProgram_),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0),this.helper.bindBuffer(this.hitVerticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.hitDetectionAttributes);var t=this.indicesBuffer_.getSize();this.helper.drawElements(0,t)}},t.prototype.disposeInternal=function(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(e){(0,_events.unlistenByKey)(e)}),this.sourceListenKeys_=null,e.prototype.disposeInternal.call(this)},t}(_Layer.default),_default=WebGLPointsLayerRenderer;exports.default=_default;

},{"../../ViewHint.js":42,"../../asserts.js":45,"../../events.js":64,"../../extent.js":70,"../../geom/GeometryType.js":131,"../../layer/BaseVector.js":187,"../../source/VectorEventType.js":278,"../../transform.js":311,"../../util.js":313,"../../webgl.js":315,"../../webgl/Buffer.js":316,"../../webgl/Helper.js":318,"../../webgl/RenderTarget.js":320,"../../worker/webgl.js":321,"./Layer.js":242}],244:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.calculateSourceResolution=calculateSourceResolution,exports.calculateSourceExtentResolution=calculateSourceExtentResolution,exports.render=render;var brokenDiagonalRendering_,_common=require("./source/common.js"),_obj=require("./obj.js"),_extent=require("./extent.js"),_dom=require("./dom.js"),_proj=require("./proj.js"),_math=require("./math.js");function drawTestTriangle(e,t,n,r,o){e.beginPath(),e.moveTo(0,0),e.lineTo(t,n),e.lineTo(r,o),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,r)+1,Math.max(n,o)),e.restore()}function verifyBrokenDiagonalRendering(e,t){return Math.abs(e[4*t]-210)>2||Math.abs(e[4*t+3]-191.25)>2}function isBrokenDiagonalRendering(){if(void 0===brokenDiagonalRendering_){var e=document.createElement("canvas").getContext("2d");e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",drawTestTriangle(e,4,5,4,0),drawTestTriangle(e,4,5,0,5);var t=e.getImageData(0,0,3,3).data;brokenDiagonalRendering_=verifyBrokenDiagonalRendering(t,0)||verifyBrokenDiagonalRendering(t,4)||verifyBrokenDiagonalRendering(t,8)}return brokenDiagonalRendering_}function calculateSourceResolution(e,t,n,r){var o=(0,_proj.transform)(n,t,e),a=(0,_proj.getPointResolution)(t,r,n),i=t.getMetersPerUnit();void 0!==i&&(a*=i);var l=e.getMetersPerUnit();void 0!==l&&(a/=l);var s=e.getExtent();if(!s||(0,_extent.containsCoordinate)(s,o)){var c=(0,_proj.getPointResolution)(e,a,o)/a;isFinite(c)&&c>0&&(a/=c)}return a}function calculateSourceExtentResolution(e,t,n,r){var o=(0,_extent.getCenter)(n),a=calculateSourceResolution(e,t,o,r);return(!isFinite(a)||a<=0)&&(0,_extent.forEachCorner)(n,function(n){return a=calculateSourceResolution(e,t,n,r),isFinite(a)&&a>0}),a}function render(e,t,n,r,o,a,i,l,s,c,g,u){var d=(0,_dom.createCanvasContext2D)(Math.round(n*e),Math.round(n*t));if((0,_obj.assign)(d,u),0===s.length)return d.canvas;function v(e){return Math.round(e*n)/n}d.scale(n,n),d.globalCompositeOperation="lighter";var h=(0,_extent.createEmpty)();s.forEach(function(e,t,n){(0,_extent.extend)(h,e.extent)});var m=(0,_extent.getWidth)(h),f=(0,_extent.getHeight)(h),_=(0,_dom.createCanvasContext2D)(Math.round(n*m/r),Math.round(n*f/r));(0,_obj.assign)(_,u);var x=n/r;s.forEach(function(e,t,n){var r=e.extent[0]-h[0],o=-(e.extent[3]-h[3]),a=(0,_extent.getWidth)(e.extent),i=(0,_extent.getHeight)(e.extent);e.image.width>0&&e.image.height>0&&_.drawImage(e.image,c,c,e.image.width-2*c,e.image.height-2*c,r*x,o*x,a*x,i*x)});var T=(0,_extent.getTopLeft)(i);return l.getTriangles().forEach(function(e,t,o){var i=e.source,l=e.target,s=i[0][0],c=i[0][1],g=i[1][0],m=i[1][1],f=i[2][0],x=i[2][1],R=v((l[0][0]-T[0])/a),p=v(-(l[0][1]-T[1])/a),b=v((l[1][0]-T[0])/a),j=v(-(l[1][1]-T[1])/a),D=v((l[2][0]-T[0])/a),M=v(-(l[2][1]-T[1])/a),k=s,E=c;s=0,c=0;var S=[[g-=k,m-=E,0,0,b-R],[f-=k,x-=E,0,0,D-R],[0,0,g,m,j-p],[0,0,f,x,M-p]],C=(0,_math.solveLinearSystem)(S);if(C){if(d.save(),d.beginPath(),isBrokenDiagonalRendering()||u===_common.IMAGE_SMOOTHING_DISABLED){d.moveTo(b,j);for(var P=R-b,y=p-j,w=0;w<4;w++)d.lineTo(b+v((w+1)*P/4),j+v(w*y/3)),3!=w&&d.lineTo(b+v((w+1)*P/4),j+v((w+1)*y/3));d.lineTo(D,M)}else d.moveTo(b,j),d.lineTo(R,p),d.lineTo(D,M);d.clip(),d.transform(C[0],C[2],C[1],C[3],R,p),d.translate(h[0]-k,h[3]-E),d.scale(r/n,-r/n),d.drawImage(_.canvas,0,0),d.restore()}}),g&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,l.getTriangles().forEach(function(e,t,n){var r=e.target,o=(r[0][0]-T[0])/a,i=-(r[0][1]-T[1])/a,l=(r[1][0]-T[0])/a,s=-(r[1][1]-T[1])/a,c=(r[2][0]-T[0])/a,g=-(r[2][1]-T[1])/a;d.beginPath(),d.moveTo(l,s),d.lineTo(o,i),d.lineTo(c,g),d.closePath(),d.stroke()}),d.restore()),d.canvas}

},{"./dom.js":62,"./extent.js":70,"./math.js":201,"./obj.js":203,"./proj.js":205,"./source/common.js":285}],245:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _common=require("./common.js"),_EventType=_interopRequireDefault(require("../events/EventType.js")),_ImageBase=_interopRequireDefault(require("../ImageBase.js")),_ImageState=_interopRequireDefault(require("../ImageState.js")),_Triangulation=_interopRequireDefault(require("./Triangulation.js")),_reproj=require("../reproj.js"),_extent=require("../extent.js"),_events=require("../events.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ReprojImage=function(e){function t(t,r,n,a,o,i,s){var u=this,_=t.getExtent(),c=r.getExtent(),l=c?(0,_extent.getIntersection)(n,c):n,g=(0,_extent.getCenter)(l),p=(0,_reproj.calculateSourceResolution)(t,r,g,a),f=_common.ERROR_THRESHOLD,h=new _Triangulation.default(t,r,l,_,p*f,a),m=i(h.calculateSourceExtent(),p,o),I=m?_ImageState.default.IDLE:_ImageState.default.EMPTY,d=m?m.getPixelRatio():1;return(u=e.call(this,n,a,d,I)||this).targetProj_=r,u.maxSourceExtent_=_,u.triangulation_=h,u.targetResolution_=a,u.targetExtent_=n,u.sourceImage_=m,u.sourcePixelRatio_=d,u.contextOptions_=s,u.canvas_=null,u.sourceListenerKey_=null,u}return __extends(t,e),t.prototype.disposeInternal=function(){this.state==_ImageState.default.LOADING&&this.unlistenSource_(),e.prototype.disposeInternal.call(this)},t.prototype.getImage=function(){return this.canvas_},t.prototype.getProjection=function(){return this.targetProj_},t.prototype.reproject_=function(){var e=this.sourceImage_.getState();if(e==_ImageState.default.LOADED){var t=(0,_extent.getWidth)(this.targetExtent_)/this.targetResolution_,r=(0,_extent.getHeight)(this.targetExtent_)/this.targetResolution_;this.canvas_=(0,_reproj.render)(t,r,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.contextOptions_)}this.state=e,this.changed()},t.prototype.load=function(){if(this.state==_ImageState.default.IDLE){this.state=_ImageState.default.LOADING,this.changed();var e=this.sourceImage_.getState();e==_ImageState.default.LOADED||e==_ImageState.default.ERROR?this.reproject_():(this.sourceListenerKey_=(0,_events.listen)(this.sourceImage_,_EventType.default.CHANGE,function(e){var t=this.sourceImage_.getState();t!=_ImageState.default.LOADED&&t!=_ImageState.default.ERROR||(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}},t.prototype.unlistenSource_=function(){(0,_events.unlistenByKey)(this.sourceListenerKey_),this.sourceListenerKey_=null},t}(_ImageBase.default),_default=ReprojImage;exports.default=_default;

},{"../ImageBase.js":16,"../ImageState.js":18,"../events.js":64,"../events/EventType.js":66,"../extent.js":70,"../reproj.js":244,"./Triangulation.js":247,"./common.js":248}],246:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _common=require("./common.js"),_EventType=_interopRequireDefault(require("../events/EventType.js")),_Tile=_interopRequireDefault(require("../Tile.js")),_TileState=_interopRequireDefault(require("../TileState.js")),_Triangulation=_interopRequireDefault(require("./Triangulation.js")),_reproj=require("../reproj.js"),_math=require("../math.js"),_extent=require("../extent.js"),_events=require("../events.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ReprojTile=function(e){function t(t,i,r,n,o,s,a,u,l,_,c,d){var f=e.call(this,o,_TileState.default.IDLE)||this;f.renderEdges_=void 0!==c&&c,f.contextOptions_=d,f.pixelRatio_=a,f.gutter_=u,f.canvas_=null,f.sourceTileGrid_=i,f.targetTileGrid_=n,f.wrappedTileCoord_=s||o,f.sourceTiles_=[],f.sourcesListenerKeys_=null,f.sourceZ_=0;var T=n.getTileCoordExtent(f.wrappedTileCoord_),p=f.targetTileGrid_.getExtent(),h=f.sourceTileGrid_.getExtent(),g=p?(0,_extent.getIntersection)(T,p):T;if(0===(0,_extent.getArea)(g))return f.state=_TileState.default.EMPTY,f;var E=t.getExtent();E&&(h=h?(0,_extent.getIntersection)(h,E):E);var v=n.getResolution(f.wrappedTileCoord_[0]),x=(0,_reproj.calculateSourceExtentResolution)(t,r,g,v);if(!isFinite(x)||x<=0)return f.state=_TileState.default.EMPTY,f;var S=void 0!==_?_:_common.ERROR_THRESHOLD;if(f.triangulation_=new _Triangulation.default(t,r,g,h,x*S,v),0===f.triangulation_.getTriangles().length)return f.state=_TileState.default.EMPTY,f;f.sourceZ_=i.getZForResolution(x);var y=f.triangulation_.calculateSourceExtent();if(h&&(t.canWrapX()?(y[1]=(0,_math.clamp)(y[1],h[1],h[3]),y[3]=(0,_math.clamp)(y[3],h[1],h[3])):y=(0,_extent.getIntersection)(y,h)),(0,_extent.getArea)(y)){for(var R=i.getTileRangeForExtentAndZ(y,f.sourceZ_),m=R.minX;m<=R.maxX;m++)for(var j=R.minY;j<=R.maxY;j++){var D=l(f.sourceZ_,m,j,a);D&&f.sourceTiles_.push(D)}0===f.sourceTiles_.length&&(f.state=_TileState.default.EMPTY)}else f.state=_TileState.default.EMPTY;return f}return __extends(t,e),t.prototype.getImage=function(){return this.canvas_},t.prototype.reproject_=function(){var e=[];if(this.sourceTiles_.forEach(function(t,i,r){t&&t.getState()==_TileState.default.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===e.length)this.state=_TileState.default.ERROR;else{var t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),r="number"==typeof i?i:i[0],n="number"==typeof i?i:i[1],o=this.targetTileGrid_.getResolution(t),s=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=(0,_reproj.render)(r,n,this.pixelRatio_,s,this.sourceTileGrid_.getExtent(),o,a,this.triangulation_,e,this.gutter_,this.renderEdges_,this.contextOptions_),this.state=_TileState.default.LOADED}this.changed()},t.prototype.load=function(){if(this.state==_TileState.default.IDLE){this.state=_TileState.default.LOADING,this.changed();var e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(t,i,r){var n=t.getState();if(n==_TileState.default.IDLE||n==_TileState.default.LOADING){e++;var o=(0,_events.listen)(t,_EventType.default.CHANGE,function(i){var r=t.getState();r!=_TileState.default.LOADED&&r!=_TileState.default.ERROR&&r!=_TileState.default.EMPTY||((0,_events.unlistenByKey)(o),0===--e&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}.bind(this)),this.sourceTiles_.forEach(function(e,t,i){e.getState()==_TileState.default.IDLE&&e.load()}),0===e&&setTimeout(this.reproject_.bind(this),0)}},t.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(_events.unlistenByKey),this.sourcesListenerKeys_=null},t}(_Tile.default),_default=ReprojTile;exports.default=_default;

},{"../Tile.js":34,"../TileState.js":38,"../events.js":64,"../events/EventType.js":66,"../extent.js":70,"../math.js":201,"../reproj.js":244,"./Triangulation.js":247,"./common.js":248}],247:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extent=require("../extent.js"),_proj=require("../proj.js"),_math=require("../math.js"),MAX_SUBDIVISION=10,MAX_TRIANGLE_WIDTH=.25,Triangulation=function(){function t(t,e,i,r,s,o){this.sourceProj_=t,this.targetProj_=e;var n={},a=(0,_proj.getTransform)(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];return n[e]||(n[e]=a(t)),n[e]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&(0,_extent.getWidth)(r)==(0,_extent.getWidth)(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?(0,_extent.getWidth)(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?(0,_extent.getWidth)(this.targetProj_.getExtent()):null;var h=(0,_extent.getTopLeft)(i),_=(0,_extent.getTopRight)(i),u=(0,_extent.getBottomRight)(i),d=(0,_extent.getBottomLeft)(i),c=this.transformInv_(h),l=this.transformInv_(_),g=this.transformInv_(u),f=this.transformInv_(d),x=MAX_SUBDIVISION+(o?Math.max(0,Math.ceil((0,_math.log2)((0,_extent.getArea)(i)/(o*o*256*256)))):0);if(this.addQuad_(h,_,u,d,c,l,g,f,x),this.wrapsXInSource_){var W=1/0;this.triangles_.forEach(function(t,e,i){W=Math.min(W,t.source[0][0],t.source[1][0],t.source[2][0])}),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-W>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-W>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_),e[1][0]-W>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_),e[2][0]-W>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var i=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-i<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}n={}}return t.prototype.addTriangle_=function(t,e,i,r,s,o){this.triangles_.push({source:[r,s,o],target:[t,e,i]})},t.prototype.addQuad_=function(t,e,i,r,s,o,n,a,h){var _=(0,_extent.boundingExtent)([s,o,n,a]),u=this.sourceWorldWidth_?(0,_extent.getWidth)(_)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,c=this.sourceProj_.canWrapX()&&u>.5&&u<1,l=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var g=(0,_extent.boundingExtent)([t,e,i,r]);l=(0,_extent.getWidth)(g)/this.targetWorldWidth_>MAX_TRIANGLE_WIDTH||l}!c&&this.sourceProj_.isGlobal()&&u&&(l=u>MAX_TRIANGLE_WIDTH||l)}if(!(!l&&this.maxSourceExtent_&&isFinite(_[0])&&isFinite(_[1])&&isFinite(_[2])&&isFinite(_[3]))||(0,_extent.intersects)(_,this.maxSourceExtent_)){var f=0;if(!(l||isFinite(s[0])&&isFinite(s[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(n[0])&&isFinite(n[1])&&isFinite(a[0])&&isFinite(a[1])))if(h>0)l=!0;else if(1!=(f=(isFinite(s[0])&&isFinite(s[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(n[0])&&isFinite(n[1])?0:2)+(isFinite(a[0])&&isFinite(a[1])?0:1))&&2!=f&&4!=f&&8!=f)return;if(h>0){if(!l){var x=[(t[0]+i[0])/2,(t[1]+i[1])/2],W=this.transformInv_(x),m=void 0;if(c)m=((0,_math.modulo)(s[0],d)+(0,_math.modulo)(n[0],d))/2-(0,_math.modulo)(W[0],d);else m=(s[0]+n[0])/2-W[0];var v=(s[1]+n[1])/2-W[1];l=m*m+v*v>this.errorThresholdSquared_}if(l){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){var I=[(e[0]+i[0])/2,(e[1]+i[1])/2],p=this.transformInv_(I),j=[(r[0]+t[0])/2,(r[1]+t[1])/2],F=this.transformInv_(j);this.addQuad_(t,e,I,j,s,o,p,F,h-1),this.addQuad_(j,I,i,r,F,p,n,a,h-1)}else{var E=[(t[0]+e[0])/2,(t[1]+e[1])/2],T=this.transformInv_(E),P=[(i[0]+r[0])/2,(i[1]+r[1])/2],S=this.transformInv_(P);this.addQuad_(t,E,P,r,s,T,S,a,h-1),this.addQuad_(E,e,i,P,T,o,n,S,h-1)}return}}if(c){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&f)&&this.addTriangle_(t,i,r,s,n,a),0==(14&f)&&this.addTriangle_(t,i,e,s,n,o),f&&(0==(13&f)&&this.addTriangle_(e,r,t,o,a,s),0==(7&f)&&this.addTriangle_(e,r,i,o,a,n))}},t.prototype.calculateSourceExtent=function(){var t=(0,_extent.createEmpty)();return this.triangles_.forEach(function(e,i,r){var s=e.source;(0,_extent.extendCoordinate)(t,s[0]),(0,_extent.extendCoordinate)(t,s[1]),(0,_extent.extendCoordinate)(t,s[2])}),t},t.prototype.getTriangles=function(){return this.triangles_},t}(),_default=Triangulation;exports.default=_default;

},{"../extent.js":70,"../math.js":201,"../proj.js":205}],248:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ENABLE_RASTER_REPROJECTION=exports.ERROR_THRESHOLD=void 0;var ERROR_THRESHOLD=.5;exports.ERROR_THRESHOLD=ERROR_THRESHOLD;var ENABLE_RASTER_REPROJECTION=!0;exports.ENABLE_RASTER_REPROJECTION=ENABLE_RASTER_REPROJECTION;

},{}],249:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createSnapToResolutions=createSnapToResolutions,exports.createSnapToPower=createSnapToPower,exports.createMinMaxResolution=createMinMaxResolution;var _math=require("./math.js"),_extent=require("./extent.js"),_array=require("./array.js");function getViewportClampedResolution(t,e,a,o){var r=(0,_extent.getWidth)(e)/a[0],n=(0,_extent.getHeight)(e)/a[1];return o?Math.min(t,Math.max(r,n)):Math.min(t,Math.min(r,n))}function getSmoothClampedResolution(t,e,a){var o=Math.min(t,e);return o*=Math.log(1+50*Math.max(0,t/e-1))/50+1,a&&(o=Math.max(o,a),o/=Math.log(1+50*Math.max(0,a/t-1))/50+1),(0,_math.clamp)(o,a/2,2*e)}function createSnapToResolutions(t,e,a,o){return function(r,n,i,l){if(void 0!==r){var u=t[0],h=t[t.length-1],m=a?getViewportClampedResolution(u,a,i,o):u;if(l)return void 0===e||e?getSmoothClampedResolution(r,m,h):(0,_math.clamp)(r,h,m);var p=Math.min(m,r),s=Math.floor((0,_array.linearFindNearest)(t,p,n));return t[s]>m&&s<t.length-1?t[s+1]:t[s]}}}function createSnapToPower(t,e,a,o,r,n){return function(i,l,u,h){if(void 0!==i){var m=r?getViewportClampedResolution(e,r,u,n):e,p=void 0!==a?a:0;if(h)return void 0===o||o?getSmoothClampedResolution(i,m,p):(0,_math.clamp)(i,p,m);var s=Math.ceil(Math.log(e/m)/Math.log(t)-1e-9),M=-l*(.5-1e-9)+.5,c=Math.min(m,i),d=Math.floor(Math.log(e/c)/Math.log(t)+M),g=Math.max(s,d),f=e/Math.pow(t,g);return(0,_math.clamp)(f,p,m)}}}function createMinMaxResolution(t,e,a,o,r){return function(n,i,l,u){if(void 0!==n){var h=o?getViewportClampedResolution(t,o,l,r):t;return(void 0===a||a)&&u?getSmoothClampedResolution(n,h,e):(0,_math.clamp)(n,e,h)}}}

},{"./array.js":44,"./extent.js":70,"./math.js":201}],250:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.disable=disable,exports.none=none,exports.createSnapToN=createSnapToN,exports.createSnapToZero=createSnapToZero;var _math=require("./math.js");function disable(e){return void 0!==e?0:void 0}function none(e){return void 0!==e?e:void 0}function createSnapToN(e){var o=2*Math.PI/e;return function(e,r){return r?e:void 0!==e?e=Math.floor(e/o+.5)*o:void 0}}function createSnapToZero(e){var o=e||(0,_math.toRadians)(5);return function(e,r){return r?e:void 0!==e?Math.abs(e)<=o?0:e:void 0}}

},{"./math.js":201}],251:[function(require,module,exports){
"use strict";function buffer(e,r,t){return void 0===t&&(t=[0,0]),t[0]=e[0]+2*r,t[1]=e[1]+2*r,t}function hasArea(e){return e[0]>0&&e[1]>0}function scale(e,r,t){return void 0===t&&(t=[0,0]),t[0]=e[0]*r+.5|0,t[1]=e[1]*r+.5|0,t}function toSize(e,r){return Array.isArray(e)?e:(void 0===r?r=[e,e]:(r[0]=e,r[1]=e),r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.buffer=buffer,exports.hasArea=hasArea,exports.scale=scale,exports.toSize=toSize;

},{}],252:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"BingMaps",{enumerable:!0,get:function(){return _BingMaps.default}}),Object.defineProperty(exports,"CartoDB",{enumerable:!0,get:function(){return _CartoDB.default}}),Object.defineProperty(exports,"Cluster",{enumerable:!0,get:function(){return _Cluster.default}}),Object.defineProperty(exports,"IIIF",{enumerable:!0,get:function(){return _IIIF.default}}),Object.defineProperty(exports,"Image",{enumerable:!0,get:function(){return _Image.default}}),Object.defineProperty(exports,"ImageArcGISRest",{enumerable:!0,get:function(){return _ImageArcGISRest.default}}),Object.defineProperty(exports,"ImageCanvas",{enumerable:!0,get:function(){return _ImageCanvas.default}}),Object.defineProperty(exports,"ImageMapGuide",{enumerable:!0,get:function(){return _ImageMapGuide.default}}),Object.defineProperty(exports,"ImageStatic",{enumerable:!0,get:function(){return _ImageStatic.default}}),Object.defineProperty(exports,"ImageWMS",{enumerable:!0,get:function(){return _ImageWMS.default}}),Object.defineProperty(exports,"OSM",{enumerable:!0,get:function(){return _OSM.default}}),Object.defineProperty(exports,"Raster",{enumerable:!0,get:function(){return _Raster.default}}),Object.defineProperty(exports,"Source",{enumerable:!0,get:function(){return _Source.default}}),Object.defineProperty(exports,"Stamen",{enumerable:!0,get:function(){return _Stamen.default}}),Object.defineProperty(exports,"Tile",{enumerable:!0,get:function(){return _Tile.default}}),Object.defineProperty(exports,"TileArcGISRest",{enumerable:!0,get:function(){return _TileArcGISRest.default}}),Object.defineProperty(exports,"TileDebug",{enumerable:!0,get:function(){return _TileDebug.default}}),Object.defineProperty(exports,"TileImage",{enumerable:!0,get:function(){return _TileImage.default}}),Object.defineProperty(exports,"TileJSON",{enumerable:!0,get:function(){return _TileJSON.default}}),Object.defineProperty(exports,"TileWMS",{enumerable:!0,get:function(){return _TileWMS.default}}),Object.defineProperty(exports,"UrlTile",{enumerable:!0,get:function(){return _UrlTile.default}}),Object.defineProperty(exports,"UTFGrid",{enumerable:!0,get:function(){return _UTFGrid.default}}),Object.defineProperty(exports,"Vector",{enumerable:!0,get:function(){return _Vector.default}}),Object.defineProperty(exports,"VectorTile",{enumerable:!0,get:function(){return _VectorTile.default}}),Object.defineProperty(exports,"WMTS",{enumerable:!0,get:function(){return _WMTS.default}}),Object.defineProperty(exports,"XYZ",{enumerable:!0,get:function(){return _XYZ.default}}),Object.defineProperty(exports,"Zoomify",{enumerable:!0,get:function(){return _Zoomify.default}});var _BingMaps=_interopRequireDefault(require("./source/BingMaps.js")),_CartoDB=_interopRequireDefault(require("./source/CartoDB.js")),_Cluster=_interopRequireDefault(require("./source/Cluster.js")),_IIIF=_interopRequireDefault(require("./source/IIIF.js")),_Image=_interopRequireDefault(require("./source/Image.js")),_ImageArcGISRest=_interopRequireDefault(require("./source/ImageArcGISRest.js")),_ImageCanvas=_interopRequireDefault(require("./source/ImageCanvas.js")),_ImageMapGuide=_interopRequireDefault(require("./source/ImageMapGuide.js")),_ImageStatic=_interopRequireDefault(require("./source/ImageStatic.js")),_ImageWMS=_interopRequireDefault(require("./source/ImageWMS.js")),_OSM=_interopRequireDefault(require("./source/OSM.js")),_Raster=_interopRequireDefault(require("./source/Raster.js")),_Source=_interopRequireDefault(require("./source/Source.js")),_Stamen=_interopRequireDefault(require("./source/Stamen.js")),_Tile=_interopRequireDefault(require("./source/Tile.js")),_TileArcGISRest=_interopRequireDefault(require("./source/TileArcGISRest.js")),_TileDebug=_interopRequireDefault(require("./source/TileDebug.js")),_TileImage=_interopRequireDefault(require("./source/TileImage.js")),_TileJSON=_interopRequireDefault(require("./source/TileJSON.js")),_TileWMS=_interopRequireDefault(require("./source/TileWMS.js")),_UrlTile=_interopRequireDefault(require("./source/UrlTile.js")),_UTFGrid=_interopRequireDefault(require("./source/UTFGrid.js")),_Vector=_interopRequireDefault(require("./source/Vector.js")),_VectorTile=_interopRequireDefault(require("./source/VectorTile.js")),_WMTS=_interopRequireDefault(require("./source/WMTS.js")),_XYZ=_interopRequireDefault(require("./source/XYZ.js")),_Zoomify=_interopRequireDefault(require("./source/Zoomify.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}

},{"./source/BingMaps.js":253,"./source/CartoDB.js":254,"./source/Cluster.js":255,"./source/IIIF.js":256,"./source/Image.js":257,"./source/ImageArcGISRest.js":258,"./source/ImageCanvas.js":259,"./source/ImageMapGuide.js":260,"./source/ImageStatic.js":261,"./source/ImageWMS.js":262,"./source/OSM.js":263,"./source/Raster.js":264,"./source/Source.js":265,"./source/Stamen.js":266,"./source/Tile.js":268,"./source/TileArcGISRest.js":269,"./source/TileDebug.js":270,"./source/TileImage.js":272,"./source/TileJSON.js":273,"./source/TileWMS.js":274,"./source/UTFGrid.js":275,"./source/UrlTile.js":276,"./source/Vector.js":277,"./source/VectorTile.js":279,"./source/WMTS.js":281,"./source/XYZ.js":283,"./source/Zoomify.js":284}],253:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.quadKey=quadKey,exports.default=void 0;var _State=_interopRequireDefault(require("./State.js")),_TileImage=_interopRequireDefault(require("./TileImage.js")),_extent=require("../extent.js"),_tileurlfunction=require("../tileurlfunction.js"),_tilecoord=require("../tilecoord.js"),_tilegrid=require("../tilegrid.js"),_proj=require("../proj.js"),_net=require("../net.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();function quadKey(e){var t,r,i=e[0],o=new Array(i),a=1<<i-1;for(t=0;t<i;++t)r=48,e[1]&a&&(r+=1),e[2]&a&&(r+=2),o[t]=String.fromCharCode(r),a>>=1;return o.join("")}var TOS_ATTRIBUTION='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>',BingMaps=function(e){function t(t){var r=this,i=void 0!==t.hidpi&&t.hidpi;(r=e.call(this,{cacheSize:t.cacheSize,crossOrigin:"anonymous",imageSmoothing:t.imageSmoothing,opaque:!0,projection:(0,_proj.get)("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:_State.default.LOADING,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:i?2:1,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition})||this).hidpi_=i,r.culture_=void 0!==t.culture?t.culture:"en-us",r.maxZoom_=void 0!==t.maxZoom?t.maxZoom:-1,r.apiKey_=t.key,r.imagerySet_=t.imagerySet;var o="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+r.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+r.apiKey_+"&c="+r.culture_;return(0,_net.jsonp)(o,r.handleImageryMetadataResponse.bind(r),void 0,"jsonp"),r}return __extends(t,e),t.prototype.getApiKey=function(){return this.apiKey_},t.prototype.getImagerySet=function(){return this.imagerySet_},t.prototype.handleImageryMetadataResponse=function(e){if(200==e.statusCode&&"OK"==e.statusDescription&&"ValidCredentials"==e.authenticationResultCode&&1==e.resourceSets.length&&1==e.resourceSets[0].resources.length){var t=e.resourceSets[0].resources[0],r=-1==this.maxZoom_?t.zoomMax:this.maxZoom_,i=this.getProjection(),o=(0,_tilegrid.extentFromProjection)(i),a=this.hidpi_?2:1,n=t.imageWidth==t.imageHeight?t.imageWidth/a:[t.imageWidth/a,t.imageHeight/a],s=(0,_tilegrid.createXYZ)({extent:o,minZoom:t.zoomMin,maxZoom:r,tileSize:n});this.tileGrid=s;var u=this.culture_,c=this.hidpi_;if(this.tileUrlFunction=(0,_tileurlfunction.createFromTileUrlFunctions)(t.imageUrlSubdomains.map(function(e){var r=[0,0,0],i=t.imageUrl.replace("{subdomain}",e).replace("{culture}",u);return function(e,t,o){if(e){(0,_tilecoord.createOrUpdate)(e[0],e[1],e[2],r);var a=i;return c&&(a+="&dpi=d1&device=mobile"),a.replace("{quadkey}",quadKey(r))}}})),t.imageryProviders){var l=(0,_proj.getTransformFromProjections)((0,_proj.get)("EPSG:4326"),this.getProjection());this.setAttributions(function(e){var r=[],i=e.viewState,o=this.getTileGrid(),a=o.getZForResolution(i.resolution,this.zDirection),n=o.getTileCoordForCoordAndZ(i.center,a)[0];return t.imageryProviders.map(function(t){for(var i=!1,o=t.coverageAreas,a=0,s=o.length;a<s;++a){var u=o[a];if(n>=u.zoomMin&&n<=u.zoomMax){var c=u.bbox,d=[c[1],c[0],c[3],c[2]],p=(0,_extent.applyTransform)(d,l);if((0,_extent.intersects)(p,e.extent)){i=!0;break}}}i&&r.push(t.attribution)}),r.push(TOS_ATTRIBUTION),r}.bind(this))}this.setState(_State.default.READY)}else this.setState(_State.default.ERROR)},t}(_TileImage.default),_default=BingMaps;exports.default=_default;

},{"../extent.js":70,"../net.js":202,"../proj.js":205,"../tilecoord.js":305,"../tilegrid.js":306,"../tileurlfunction.js":310,"./State.js":267,"./TileImage.js":272}],254:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _State=_interopRequireDefault(require("./State.js")),_XYZ=_interopRequireDefault(require("./XYZ.js")),_obj=require("../obj.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),CartoDB=function(t){function e(e){var i=t.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:void 0!==e.maxZoom?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,wrapX:e.wrapX})||this;return i.account_=e.account,i.mapId_=e.map||"",i.config_=e.config||{},i.templateCache_={},i.initializeMap_(),i}return __extends(e,t),e.prototype.getConfig=function(){return this.config_},e.prototype.updateConfig=function(t){(0,_obj.assign)(this.config_,t),this.initializeMap_()},e.prototype.setConfig=function(t){this.config_=t||{},this.initializeMap_()},e.prototype.initializeMap_=function(){var t=JSON.stringify(this.config_);if(this.templateCache_[t])this.applyTemplate_(this.templateCache_[t]);else{var e="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(e+="/named/"+this.mapId_);var i=new XMLHttpRequest;i.addEventListener("load",this.handleInitResponse_.bind(this,t)),i.addEventListener("error",this.handleInitError_.bind(this)),i.open("POST",e),i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify(this.config_))}},e.prototype.handleInitResponse_=function(t,e){var i=e.target;if(!i.status||i.status>=200&&i.status<300){var o=void 0;try{o=JSON.parse(i.responseText)}catch(t){return void this.setState(_State.default.ERROR)}this.applyTemplate_(o),this.templateCache_[t]=o,this.setState(_State.default.READY)}else this.setState(_State.default.ERROR)},e.prototype.handleInitError_=function(t){this.setState(_State.default.ERROR)},e.prototype.applyTemplate_=function(t){var e="https://"+t.cdn_url.https+"/"+this.account_+"/api/v1/map/"+t.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(e)},e}(_XYZ.default),_default=CartoDB;exports.default=_default;

},{"../obj.js":203,"./State.js":267,"./XYZ.js":283}],255:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_Feature=_interopRequireDefault(require("../Feature.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_Point=_interopRequireDefault(require("../geom/Point.js")),_Vector=_interopRequireDefault(require("./Vector.js")),_coordinate=require("../coordinate.js"),_asserts=require("../asserts.js"),_extent=require("../extent.js"),_util=require("../util.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Cluster=function(e){function t(t){var r=e.call(this,{attributions:t.attributions,wrapX:t.wrapX})||this;return r.resolution=void 0,r.distance=void 0!==t.distance?t.distance:20,r.features=[],r.geometryFunction=t.geometryFunction||function(e){var t=e.getGeometry();return(0,_asserts.assert)(t.getType()==_GeometryType.default.POINT,10),t},r.boundRefresh_=r.refresh.bind(r),r.setSource(t.source||null),r}return __extends(t,e),t.prototype.clear=function(t){this.features.length=0,e.prototype.clear.call(this,t)},t.prototype.getDistance=function(){return this.distance},t.prototype.getSource=function(){return this.source},t.prototype.loadFeatures=function(e,t,r){this.source.loadFeatures(e,t,r),t!==this.resolution&&(this.clear(),this.resolution=t,this.cluster(),this.addFeatures(this.features))},t.prototype.setDistance=function(e){this.distance=e,this.refresh()},t.prototype.setSource=function(e){this.source&&this.source.removeEventListener(_EventType.default.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(_EventType.default.CHANGE,this.boundRefresh_),this.refresh()},t.prototype.refresh=function(){this.clear(),this.cluster(),this.addFeatures(this.features)},t.prototype.cluster=function(){if(void 0!==this.resolution&&this.source)for(var e=(0,_extent.createEmpty)(),t=this.distance*this.resolution,r=this.source.getFeatures(),o={},i=0,s=r.length;i<s;i++){var n=r[i];if(!((0,_util.getUid)(n)in o)){var u=this.geometryFunction(n);if(u){var a=u.getCoordinates();(0,_extent.createOrUpdateFromCoordinate)(a,e),(0,_extent.buffer)(e,t,e);var c=this.source.getFeaturesInExtent(e);c=c.filter(function(e){var t=(0,_util.getUid)(e);return!(t in o)&&(o[t]=!0,!0)}),this.features.push(this.createCluster(c))}}}},t.prototype.createCluster=function(e){for(var t=[0,0],r=e.length-1;r>=0;--r){var o=this.geometryFunction(e[r]);o?(0,_coordinate.add)(t,o.getCoordinates()):e.splice(r,1)}(0,_coordinate.scale)(t,1/e.length);var i=new _Feature.default(new _Point.default(t));return i.set("features",e),i},t}(_Vector.default),_default=Cluster;exports.default=_default;

},{"../Feature.js":13,"../asserts.js":45,"../coordinate.js":60,"../events/EventType.js":66,"../extent.js":70,"../geom/GeometryType.js":131,"../geom/Point.js":137,"../util.js":313,"./Vector.js":277}],256:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _TileGrid=_interopRequireDefault(require("../tilegrid/TileGrid.js")),_TileImage=_interopRequireDefault(require("./TileImage.js")),_Zoomify=require("./Zoomify.js"),_common=require("../tilegrid/common.js"),_IIIFInfo=require("../format/IIIFInfo.js"),_asserts=require("../asserts.js"),_extent=require("../extent.js"),_size=require("../size.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();function formatPercentage(e){return e.toLocaleString("en",{maximumFractionDigits:10})}var IIIF=function(e){function t(t){var r=this,i=t||{},n=i.url||"";n+=n.lastIndexOf("/")===n.length-1||""===n?"":"/";var o=i.version||_IIIFInfo.Versions.VERSION2,s=i.sizes||[],l=i.size;(0,_asserts.assert)(null!=l&&Array.isArray(l)&&2==l.length&&!isNaN(l[0])&&l[0]>0&&!isNaN(l[1])&&l[1]>0,60);var a,u,c,f=l[0],I=l[1],h=i.tileSize,g=i.tilePixelRatio||1,_=i.format||"jpg",d=i.quality||(i.version==_IIIFInfo.Versions.VERSION1?"native":"default"),m=i.resolutions||[],p=i.supports||[],y=i.extent||[0,-I,f,0],v=null!=s&&Array.isArray(s)&&s.length>0,x=void 0!==h&&("number"==typeof h&&Number.isInteger(h)&&h>0||Array.isArray(h)&&h.length>0),z=null!=p&&Array.isArray(p)&&(p.includes("regionByPx")||p.includes("regionByPct"))&&(p.includes("sizeByWh")||p.includes("sizeByH")||p.includes("sizeByW")||p.includes("sizeByPct"));if(m.sort(function(e,t){return t-e}),x||z)if(null!=h&&("number"==typeof h&&Number.isInteger(h)&&h>0?(a=h,u=h):Array.isArray(h)&&h.length>0&&((1==h.length||null==h[1]&&Number.isInteger(h[0]))&&(a=h[0],u=h[0]),2==h.length&&(Number.isInteger(h[0])&&Number.isInteger(h[1])?(a=h[0],u=h[1]):null==h[0]&&Number.isInteger(h[1])&&(a=h[1],u=h[1])))),void 0!==a&&void 0!==u||(a=_common.DEFAULT_TILE_SIZE,u=_common.DEFAULT_TILE_SIZE),0==m.length)for(var M=c=Math.max(Math.ceil(Math.log(f/a)/Math.LN2),Math.ceil(Math.log(I/u)/Math.LN2));M>=0;M--)m.push(Math.pow(2,M));else{var b=Math.max.apply(Math,m);c=Math.round(Math.log(b)/Math.LN2)}else if(a=f,u=I,m=[],v){s.sort(function(e,t){return e[0]-t[0]}),c=-1;var N=[];for(M=0;M<s.length;M++){var P=f/s[M][0];m.length>0&&m[m.length-1]==P?N.push(M):(m.push(P),c++)}if(N.length>0)for(M=0;M<N.length;M++)s.splice(N[M]-M,1)}else m.push(1),s.push([f,I]),c=0;var j=new _TileGrid.default({tileSize:[a,u],extent:y,origin:(0,_extent.getTopLeft)(y),resolutions:m}),S=_Zoomify.CustomTile.bind(null,(0,_size.toSize)(h||256).map(function(e){return e*g}));return(r=e.call(this,{attributions:i.attributions,attributionsCollapsible:i.attributionsCollapsible,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,imageSmoothing:i.imageSmoothing,projection:i.projection,reprojectionErrorThreshold:i.reprojectionErrorThreshold,state:i.state,tileClass:S,tileGrid:j,tilePixelRatio:i.tilePixelRatio,tileUrlFunction:function(e,t,r){var i,l,h=e[0];if(!(h>c)){var g=e[1],y=e[2],M=m[h];if(!(void 0===g||void 0===y||void 0===M||g<0||Math.ceil(f/M/a)<=g||y<0||Math.ceil(I/M/u)<=y)){if(z||x){var b=g*a*M,N=y*u*M,P=a*M,j=u*M,S=a,T=u;b+P>f&&(P=f-b),N+j>I&&(j=I-N),b+a*M>f&&(S=Math.floor((f-b+M-1)/M)),N+u*M>I&&(T=Math.floor((I-N+M-1)/M)),0==b&&P==f&&0==N&&j==I?i="full":!z||p.includes("regionByPx")?i=b+","+N+","+P+","+j:p.includes("regionByPct")&&(i="pct:"+formatPercentage(b/f*100)+","+formatPercentage(N/I*100)+","+formatPercentage(P/f*100)+","+formatPercentage(j/I*100)),o!=_IIIFInfo.Versions.VERSION3||z&&!p.includes("sizeByWh")?!z||p.includes("sizeByW")?l=S+",":p.includes("sizeByH")?l=","+T:p.includes("sizeByWh")?l=S+","+T:p.includes("sizeByPct")&&(l="pct:"+formatPercentage(100/M)):l=S+","+T}else if(i="full",v){var A=s[h][0],B=s[h][1];l=o==_IIIFInfo.Versions.VERSION3?A==f&&B==I?"max":A+","+B:A==f?"full":A+","}else l=o==_IIIFInfo.Versions.VERSION3?"max":"full";return n+i+"/"+l+"/0/"+d+"."+_}}},transition:i.transition})||this).zDirection=i.zDirection,r}return __extends(t,e),t}(_TileImage.default),_default=IIIF;exports.default=_default;

},{"../asserts.js":45,"../extent.js":70,"../format/IIIFInfo.js":85,"../size.js":251,"../tilegrid/TileGrid.js":307,"../tilegrid/common.js":309,"./TileImage.js":272,"./Zoomify.js":284}],257:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultImageLoadFunction=defaultImageLoadFunction,exports.default=exports.ImageSourceEvent=exports.ImageSourceEventType=void 0;var _Event=_interopRequireDefault(require("../events/Event.js")),_ImageState=_interopRequireDefault(require("../ImageState.js")),_Image=_interopRequireDefault(require("../reproj/Image.js")),_Source=_interopRequireDefault(require("./Source.js")),_common=require("../reproj/common.js"),_common2=require("./common.js"),_util=require("../util.js"),_extent=require("../extent.js"),_proj=require("../proj.js"),_array=require("../array.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),ImageSourceEventType={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};exports.ImageSourceEventType=ImageSourceEventType;var ImageSourceEvent=function(e){function t(t,r){var o=e.call(this,t)||this;return o.image=r,o}return __extends(t,e),t}(_Event.default);exports.ImageSourceEvent=ImageSourceEvent;var ImageSource=function(e){function t(t){var r=e.call(this,{attributions:t.attributions,projection:t.projection,state:t.state})||this;return r.resolutions_=void 0!==t.resolutions?t.resolutions:null,r.reprojectedImage_=null,r.reprojectedRevision_=0,r.contextOptions_=!1===t.imageSmoothing?_common2.IMAGE_SMOOTHING_DISABLED:void 0,r}return __extends(t,e),t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getContextOptions=function(){return this.contextOptions_},t.prototype.findNearestResolution=function(e){if(this.resolutions_){var t=(0,_array.linearFindNearest)(this.resolutions_,e,0);e=this.resolutions_[t]}return e},t.prototype.getImage=function(e,t,r,o){var n=this.getProjection();if(_common.ENABLE_RASTER_REPROJECTION&&n&&o&&!(0,_proj.equivalent)(n,o)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&(0,_proj.equivalent)(this.reprojectedImage_.getProjection(),o)&&this.reprojectedImage_.getResolution()==t&&(0,_extent.equals)(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new _Image.default(n,o,e,t,r,function(e,t,r){return this.getImageInternal(e,t,r,n)}.bind(this),this.contextOptions_),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}return n&&(o=n),this.getImageInternal(e,t,r,o)},t.prototype.getImageInternal=function(e,t,r,o){return(0,_util.abstract)()},t.prototype.handleImageChange=function(e){var t=e.target;switch(t.getState()){case _ImageState.default.LOADING:this.loading=!0,this.dispatchEvent(new ImageSourceEvent(ImageSourceEventType.IMAGELOADSTART,t));break;case _ImageState.default.LOADED:this.loading=!1,this.dispatchEvent(new ImageSourceEvent(ImageSourceEventType.IMAGELOADEND,t));break;case _ImageState.default.ERROR:this.loading=!1,this.dispatchEvent(new ImageSourceEvent(ImageSourceEventType.IMAGELOADERROR,t))}},t}(_Source.default);function defaultImageLoadFunction(e,t){e.getImage().src=t}var _default=ImageSource;exports.default=_default;

},{"../ImageState.js":18,"../array.js":44,"../events/Event.js":65,"../extent.js":70,"../proj.js":205,"../reproj/Image.js":245,"../reproj/common.js":248,"../util.js":313,"./Source.js":265,"./common.js":285}],258:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_Image=_interopRequireWildcard(require("./Image.js")),_Image2=_interopRequireDefault(require("../Image.js")),_uri=require("../uri.js"),_asserts=require("../asserts.js"),_obj=require("../obj.js"),_extent=require("../extent.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=r?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ImageArcGISRest=function(e){function t(t){var i=this,r=t||{};return(i=e.call(this,{attributions:r.attributions,imageSmoothing:r.imageSmoothing,projection:r.projection,resolutions:r.resolutions})||this).crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null,i.hidpi_=void 0===r.hidpi||r.hidpi,i.url_=r.url,i.imageLoadFunction_=void 0!==r.imageLoadFunction?r.imageLoadFunction:_Image.defaultImageLoadFunction,i.params_=r.params||{},i.image_=null,i.imageSize_=[0,0],i.renderedRevision_=0,i.ratio_=void 0!==r.ratio?r.ratio:1.5,i}return __extends(t,e),t.prototype.getParams=function(){return this.params_},t.prototype.getImageInternal=function(e,t,i,r){if(void 0===this.url_)return null;t=this.findNearestResolution(t),i=this.hidpi_?i:1;var n=this.image_;if(n&&this.renderedRevision_==this.getRevision()&&n.getResolution()==t&&n.getPixelRatio()==i&&(0,_extent.containsExtent)(n.getExtent(),e))return n;var o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};(0,_obj.assign)(o,this.params_);var a=((e=e.slice())[0]+e[2])/2,s=(e[1]+e[3])/2;if(1!=this.ratio_){var u=this.ratio_*(0,_extent.getWidth)(e)/2,_=this.ratio_*(0,_extent.getHeight)(e)/2;e[0]=a-u,e[1]=s-_,e[2]=a+u,e[3]=s+_}var p=t/i,c=Math.ceil((0,_extent.getWidth)(e)/p),l=Math.ceil((0,_extent.getHeight)(e)/p);e[0]=a-p*c/2,e[2]=a+p*c/2,e[1]=s-p*l/2,e[3]=s+p*l/2,this.imageSize_[0]=c,this.imageSize_[1]=l;var g=this.getRequestUrl_(e,this.imageSize_,i,r,o);return this.image_=new _Image2.default(e,t,i,g,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(_EventType.default.CHANGE,this.handleImageChange.bind(this)),this.image_},t.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},t.prototype.getRequestUrl_=function(e,t,i,r,n){var o=r.getCode().split(":").pop();n.SIZE=t[0]+","+t[1],n.BBOX=e.join(","),n.BBOXSR=o,n.IMAGESR=o,n.DPI=Math.round(90*i);var a=this.url_,s=a.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return s==a&&(0,_asserts.assert)(!1,50),(0,_uri.appendParams)(s,n)},t.prototype.getUrl=function(){return this.url_},t.prototype.setImageLoadFunction=function(e){this.image_=null,this.imageLoadFunction_=e,this.changed()},t.prototype.setUrl=function(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())},t.prototype.updateParams=function(e){(0,_obj.assign)(this.params_,e),this.image_=null,this.changed()},t}(_Image.default),_default=ImageArcGISRest;exports.default=_default;

},{"../Image.js":15,"../asserts.js":45,"../events/EventType.js":66,"../extent.js":70,"../obj.js":203,"../uri.js":312,"./Image.js":257}],259:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ImageCanvas=_interopRequireDefault(require("../ImageCanvas.js")),_Image=_interopRequireDefault(require("./Image.js")),_extent=require("../extent.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ImageCanvasSource=function(e){function t(t){var n=this,i=t||{};return(n=e.call(this,{attributions:i.attributions,imageSmoothing:i.imageSmoothing,projection:i.projection,resolutions:i.resolutions,state:i.state})||this).canvasFunction_=i.canvasFunction,n.canvas_=null,n.renderedRevision_=0,n.ratio_=void 0!==i.ratio?i.ratio:1.5,n}return __extends(t,e),t.prototype.getImageInternal=function(e,t,n,i){t=this.findNearestResolution(t);var r=this.canvas_;if(r&&this.renderedRevision_==this.getRevision()&&r.getResolution()==t&&r.getPixelRatio()==n&&(0,_extent.containsExtent)(r.getExtent(),e))return r;e=e.slice(),(0,_extent.scaleFromCenter)(e,this.ratio_);var o=[(0,_extent.getWidth)(e)/t*n,(0,_extent.getHeight)(e)/t*n],a=this.canvasFunction_.call(this,e,t,n,o,i);return a&&(r=new _ImageCanvas.default(e,t,n,a)),this.canvas_=r,this.renderedRevision_=this.getRevision(),r},t}(_Image.default),_default=ImageCanvasSource;exports.default=_default;

},{"../ImageCanvas.js":17,"../extent.js":70,"./Image.js":257}],260:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_Image=_interopRequireWildcard(require("./Image.js")),_Image2=_interopRequireDefault(require("../Image.js")),_uri=require("../uri.js"),_obj=require("../obj.js"),_extent=require("../extent.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=r?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=e[n]}return i.default=e,t&&t.set(e,i),i}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ImageMapGuide=function(e){function t(t){var i=e.call(this,{imageSmoothing:t.imageSmoothing,projection:t.projection,resolutions:t.resolutions})||this;return i.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null,i.displayDpi_=void 0!==t.displayDpi?t.displayDpi:96,i.params_=t.params||{},i.url_=t.url,i.imageLoadFunction_=void 0!==t.imageLoadFunction?t.imageLoadFunction:_Image.defaultImageLoadFunction,i.hidpi_=void 0===t.hidpi||t.hidpi,i.metersPerUnit_=void 0!==t.metersPerUnit?t.metersPerUnit:1,i.ratio_=void 0!==t.ratio?t.ratio:1,i.useOverlay_=void 0!==t.useOverlay&&t.useOverlay,i.image_=null,i.renderedRevision_=0,i}return __extends(t,e),t.prototype.getParams=function(){return this.params_},t.prototype.getImageInternal=function(e,t,i,r){t=this.findNearestResolution(t),i=this.hidpi_?i:1;var n=this.image_;if(n&&this.renderedRevision_==this.getRevision()&&n.getResolution()==t&&n.getPixelRatio()==i&&(0,_extent.containsExtent)(n.getExtent(),e))return n;1!=this.ratio_&&(e=e.slice(),(0,_extent.scaleFromCenter)(e,this.ratio_));var o=[(0,_extent.getWidth)(e)/t*i,(0,_extent.getHeight)(e)/t*i];if(void 0!==this.url_){var a=this.getUrl(this.url_,this.params_,e,o,r);(n=new _Image2.default(e,t,i,a,this.crossOrigin_,this.imageLoadFunction_)).addEventListener(_EventType.default.CHANGE,this.handleImageChange.bind(this))}else n=null;return this.image_=n,this.renderedRevision_=this.getRevision(),n},t.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},t.prototype.updateParams=function(e){(0,_obj.assign)(this.params_,e),this.changed()},t.prototype.getUrl=function(e,t,i,r,n){var o=getScale(i,r,this.metersPerUnit_,this.displayDpi_),a=(0,_extent.getCenter)(i),u={OPERATION:this.useOverlay_?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:this.displayDpi_,SETDISPLAYWIDTH:Math.round(r[0]),SETDISPLAYHEIGHT:Math.round(r[1]),SETVIEWSCALE:o,SETVIEWCENTERX:a[0],SETVIEWCENTERY:a[1]};return(0,_obj.assign)(u,t),(0,_uri.appendParams)(e,u)},t.prototype.setImageLoadFunction=function(e){this.image_=null,this.imageLoadFunction_=e,this.changed()},t}(_Image.default);function getScale(e,t,i,r){var n=(0,_extent.getWidth)(e),o=(0,_extent.getHeight)(e),a=t[0],u=t[1],s=.0254/r;return u*n>a*o?n*i/(a*s):o*i/(u*s)}var _default=ImageMapGuide;exports.default=_default;

},{"../Image.js":15,"../events/EventType.js":66,"../extent.js":70,"../obj.js":203,"../uri.js":312,"./Image.js":257}],261:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_Image=_interopRequireWildcard(require("./Image.js")),_ImageState=_interopRequireDefault(require("../ImageState.js")),_Image2=_interopRequireDefault(require("../Image.js")),_dom=require("../dom.js"),_extent=require("../extent.js"),_proj=require("../proj.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),Static=function(e){function t(t){var r=this,i=void 0!==t.crossOrigin?t.crossOrigin:null,n=void 0!==t.imageLoadFunction?t.imageLoadFunction:_Image.defaultImageLoadFunction;return(r=e.call(this,{attributions:t.attributions,imageSmoothing:t.imageSmoothing,projection:(0,_proj.get)(t.projection)})||this).url_=t.url,r.imageExtent_=t.imageExtent,r.image_=new _Image2.default(r.imageExtent_,void 0,1,r.url_,i,n),r.imageSize_=t.imageSize?t.imageSize:null,r.image_.addEventListener(_EventType.default.CHANGE,r.handleImageChange.bind(r)),r}return __extends(t,e),t.prototype.getImageExtent=function(){return this.imageExtent_},t.prototype.getImageInternal=function(e,t,r,i){return(0,_extent.intersects)(e,this.image_.getExtent())?this.image_:null},t.prototype.getUrl=function(){return this.url_},t.prototype.handleImageChange=function(t){if(this.image_.getState()==_ImageState.default.LOADED){var r=this.image_.getExtent(),i=this.image_.getImage(),n=void 0,o=void 0;this.imageSize_?(n=this.imageSize_[0],o=this.imageSize_[1]):(n=i.width,o=i.height);var a=(0,_extent.getHeight)(r)/o,u=Math.ceil((0,_extent.getWidth)(r)/a);if(u!=n){var g=(0,_dom.createCanvasContext2D)(u,o),_=g.canvas;g.drawImage(i,0,0,n,o,0,0,_.width,_.height),this.image_.setImage(_)}}e.prototype.handleImageChange.call(this,t)},t}(_Image.default),_default=Static;exports.default=_default;

},{"../Image.js":15,"../ImageState.js":18,"../dom.js":62,"../events/EventType.js":66,"../extent.js":70,"../proj.js":205,"./Image.js":257}],262:[function(require,module,exports){
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _common=require("./common.js"),_EventType=_interopRequireDefault(require("../events/EventType.js")),_Image=_interopRequireWildcard(require("./Image.js")),_Image2=_interopRequireDefault(require("../Image.js")),_WMSServerType=_interopRequireDefault(require("./WMSServerType.js")),_uri=require("../uri.js"),_asserts=require("../asserts.js"),_obj=require("../obj.js"),_reproj=require("../reproj.js"),_string=require("../string.js"),_extent=require("../extent.js"),_proj=require("../proj.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=e[n]}return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),GETFEATUREINFO_IMAGE_SIZE=[101,101],ImageWMS=function(e){function t(t){var r=this,i=t||{};return(r=e.call(this,{attributions:i.attributions,imageSmoothing:i.imageSmoothing,projection:i.projection,resolutions:i.resolutions})||this).crossOrigin_=void 0!==i.crossOrigin?i.crossOrigin:null,r.url_=i.url,r.imageLoadFunction_=void 0!==i.imageLoadFunction?i.imageLoadFunction:_Image.defaultImageLoadFunction,r.params_=i.params||{},r.v13_=!0,r.updateV13_(),r.serverType_=i.serverType,r.hidpi_=void 0===i.hidpi||i.hidpi,r.image_=null,r.imageSize_=[0,0],r.renderedRevision_=0,r.ratio_=void 0!==i.ratio?i.ratio:1.5,r}return __extends(t,e),t.prototype.getFeatureInfoUrl=function(e,t,r,i){if(void 0!==this.url_){var n=(0,_proj.get)(r),o=this.getProjection();o&&o!==n&&(t=(0,_reproj.calculateSourceResolution)(o,n,e,t),e=(0,_proj.transform)(e,n,o));var a=(0,_extent.getForViewAndSize)(e,t,0,GETFEATUREINFO_IMAGE_SIZE),s={SERVICE:"WMS",VERSION:_common.DEFAULT_WMS_VERSION,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};(0,_obj.assign)(s,this.params_,i);var _=Math.floor((e[0]-a[0])/t),u=Math.floor((a[3]-e[1])/t);return s[this.v13_?"I":"X"]=_,s[this.v13_?"J":"Y"]=u,this.getRequestUrl_(a,GETFEATUREINFO_IMAGE_SIZE,1,o||n,s)}},t.prototype.getLegendUrl=function(e,t){if(void 0!==this.url_){var r={SERVICE:"WMS",VERSION:_common.DEFAULT_WMS_VERSION,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===t||void 0===t.LAYER){var i=this.params_.LAYERS;if(!(!Array.isArray(i)||1===i.length))return;r.LAYER=i}if(void 0!==e){var n=this.getProjection()?this.getProjection().getMetersPerUnit():1;r.SCALE=e*n*39.37*(25.4/.28)}return(0,_obj.assign)(r,t),(0,_uri.appendParams)(this.url_,r)}},t.prototype.getParams=function(){return this.params_},t.prototype.getImageInternal=function(e,t,r,i){if(void 0===this.url_)return null;t=this.findNearestResolution(t),1==r||this.hidpi_&&void 0!==this.serverType_||(r=1);var n=t/r,o=(0,_extent.getCenter)(e),a=Math.ceil((0,_extent.getWidth)(e)/n),s=Math.ceil((0,_extent.getHeight)(e)/n),_=(0,_extent.getForViewAndSize)(o,n,0,[a,s]),u=Math.ceil(this.ratio_*(0,_extent.getWidth)(e)/n),p=Math.ceil(this.ratio_*(0,_extent.getHeight)(e)/n),g=(0,_extent.getForViewAndSize)(o,n,0,[u,p]),c=this.image_;if(c&&this.renderedRevision_==this.getRevision()&&c.getResolution()==t&&c.getPixelRatio()==r&&(0,_extent.containsExtent)(c.getExtent(),_))return c;var h={SERVICE:"WMS",VERSION:_common.DEFAULT_WMS_VERSION,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};(0,_obj.assign)(h,this.params_),this.imageSize_[0]=Math.round((0,_extent.getWidth)(g)/n),this.imageSize_[1]=Math.round((0,_extent.getHeight)(g)/n);var l=this.getRequestUrl_(g,this.imageSize_,r,i,h);return this.image_=new _Image2.default(g,t,r,l,this.crossOrigin_,this.imageLoadFunction_),this.renderedRevision_=this.getRevision(),this.image_.addEventListener(_EventType.default.CHANGE,this.handleImageChange.bind(this)),this.image_},t.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_},t.prototype.getRequestUrl_=function(e,t,r,i,n){if((0,_asserts.assert)(void 0!==this.url_,9),n[this.v13_?"CRS":"SRS"]=i.getCode(),"STYLES"in this.params_||(n.STYLES=""),1!=r)switch(this.serverType_){case _WMSServerType.default.GEOSERVER:var o=90*r+.5|0;"FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+=";dpi:"+o:n.FORMAT_OPTIONS="dpi:"+o;break;case _WMSServerType.default.MAPSERVER:n.MAP_RESOLUTION=90*r;break;case _WMSServerType.default.CARMENTA_SERVER:case _WMSServerType.default.QGIS:n.DPI=90*r;break;default:(0,_asserts.assert)(!1,8)}n.WIDTH=t[0],n.HEIGHT=t[1];var a,s=i.getAxisOrientation();return a=this.v13_&&"ne"==s.substr(0,2)?[e[1],e[0],e[3],e[2]]:e,n.BBOX=a.join(","),(0,_uri.appendParams)(this.url_,n)},t.prototype.getUrl=function(){return this.url_},t.prototype.setImageLoadFunction=function(e){this.image_=null,this.imageLoadFunction_=e,this.changed()},t.prototype.setUrl=function(e){e!=this.url_&&(this.url_=e,this.image_=null,this.changed())},t.prototype.updateParams=function(e){(0,_obj.assign)(this.params_,e),this.updateV13_(),this.image_=null,this.changed()},t.prototype.updateV13_=function(){var e=this.params_.VERSION||_common.DEFAULT_WMS_VERSION;this.v13_=(0,_string.compareVersions)(e,"1.3")>=0},t}(_Image.default),_default=ImageWMS;exports.default=_default;

},{"../Image.js":15,"../asserts.js":45,"../events/EventType.js":66,"../extent.js":70,"../obj.js":203,"../proj.js":205,"../reproj.js":244,"../string.js":287,"../uri.js":312,"./Image.js":257,"./WMSServerType.js":280,"./common.js":285}],263:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.ATTRIBUTION=void 0;var _XYZ=_interopRequireDefault(require("./XYZ.js"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function r(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),ATTRIBUTION='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';exports.ATTRIBUTION=ATTRIBUTION;var OSM=function(t){function o(o){var e,r=o||{};e=void 0!==r.attributions?r.attributions:[ATTRIBUTION];var n=void 0!==r.crossOrigin?r.crossOrigin:"anonymous",i=void 0!==r.url?r.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";return t.call(this,{attributions:e,cacheSize:r.cacheSize,crossOrigin:n,imageSmoothing:r.imageSmoothing,opaque:void 0===r.opaque||r.opaque,maxZoom:void 0!==r.maxZoom?r.maxZoom:19,reprojectionErrorThreshold:r.reprojectionErrorThreshold,tileLoadFunction:r.tileLoadFunction,url:i,wrapX:r.wrapX,attributionsCollapsible:!1})||this}return __extends(o,t),o}(_XYZ.default),_default=OSM;exports.default=_default;

},{"./XYZ.js":283}],264:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.newImageData=newImageData,exports.default=exports.RasterSourceEvent=exports.Processor=void 0;var _Disposable=_interopRequireDefault(require("../Disposable.js")),_Event=_interopRequireDefault(require("../events/Event.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_ImageCanvas=_interopRequireDefault(require("../ImageCanvas.js")),_Image=_interopRequireDefault(require("../layer/Image.js")),_Image2=_interopRequireDefault(require("./Image.js")),_Source=_interopRequireDefault(require("./Source.js")),_State=_interopRequireDefault(require("./State.js")),_Tile=_interopRequireDefault(require("../layer/Tile.js")),_TileQueue=_interopRequireDefault(require("../TileQueue.js")),_Tile2=_interopRequireDefault(require("./Tile.js")),_obj=require("../obj.js"),_dom=require("../dom.js"),_transform=require("../transform.js"),_extent=require("../extent.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),hasImageData=!0;try{new ImageData(10,10)}catch(e){hasImageData=!1}var context=document.createElement("canvas").getContext("2d");function newImageData(e,t,r){if(hasImageData)return new ImageData(e,t,r);var a=context.createImageData(t,r);return a.data.set(e),a}function createMinion(e){var t=!0;try{new ImageData(10,10)}catch(e){t=!1}function r(e,r,a){return t?new ImageData(e,r,a):{data:e,width:r,height:a}}return function(t){var a,n,i=t.buffers,s=t.meta,o=t.imageOps,u=t.width,l=t.height,p=i.length,_=i[0].byteLength;if(o){var d=new Array(p);for(n=0;n<p;++n)d[n]=r(new Uint8ClampedArray(i[n]),u,l);a=e(d,s).data}else{a=new Uint8ClampedArray(_);var h=new Array(p),c=new Array(p);for(n=0;n<p;++n)h[n]=new Uint8ClampedArray(i[n]),c[n]=[0,0,0,0];for(var f=0;f<_;f+=4){for(var g=0;g<p;++g){var v=h[g];c[g][0]=v[f],c[g][1]=v[f+1],c[g][2]=v[f+2],c[g][3]=v[f+3]}var m=e(c,s);a[f]=m[0],a[f+1]=m[1],a[f+2]=m[2],a[f+3]=m[3]}}return a.buffer}}function createWorker(e,t){var r=Object.keys(e.lib||{}).map(function(t){return"var "+t+" = "+e.lib[t].toString()+";"}).concat(["var __minion__ = ("+createMinion.toString()+")(",e.operation.toString(),");",'self.addEventListener("message", function(event) {',"  var buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),a=new Blob(r,{type:"text/javascript"}),n=URL.createObjectURL(a),i=new Worker(n);return i.addEventListener("message",t),i}function createFauxWorker(e,t){var r=createMinion(e.operation),a=!1;return{postMessage:function(e){setTimeout(function(){a||t({data:{buffer:r(e),meta:e.meta}})},0)},terminate:function(){a=!0}}}var Processor=function(e){function t(t){var r,a=e.call(this)||this;a._imageOps=!!t.imageOps;var n=[];if(r=0===t.threads?0:a._imageOps?1:t.threads||1)for(var i=0;i<r;++i)n[i]=createWorker(t,a._onWorkerMessage.bind(a,i));else n[0]=createFauxWorker(t,a._onWorkerMessage.bind(a,0));return a._workers=n,a._queue=[],a._maxQueueLength=t.queue||1/0,a._running=0,a._dataLookup={},a._job=null,a}return __extends(t,e),t.prototype.process=function(e,t,r){this._enqueue({inputs:e,meta:t,callback:r}),this._dispatch()},t.prototype._enqueue=function(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)},t.prototype._dispatch=function(){if(0===this._running&&this._queue.length>0){var e=this._queue.shift();this._job=e;var t=e.inputs[0].width,r=e.inputs[0].height,a=e.inputs.map(function(e){return e.data.buffer}),n=this._workers.length;if(this._running=n,1===n)this._workers[0].postMessage({buffers:a,meta:e.meta,imageOps:this._imageOps,width:t,height:r},a);else for(var i=e.inputs[0].data.length,s=4*Math.ceil(i/4/n),o=0;o<n;++o){for(var u=o*s,l=[],p=0,_=a.length;p<_;++p)l.push(a[o].slice(u,u+s));this._workers[o].postMessage({buffers:l,meta:e.meta,imageOps:this._imageOps,width:t,height:r},l)}}},t.prototype._onWorkerMessage=function(e,t){this.disposed||(this._dataLookup[e]=t.data,--this._running,0===this._running&&this._resolveJob())},t.prototype._resolveJob=function(){var e,t,r=this._job,a=this._workers.length;if(1===a)e=new Uint8ClampedArray(this._dataLookup[0].buffer),t=this._dataLookup[0].meta;else{var n=r.inputs[0].data.length;e=new Uint8ClampedArray(n),t=new Array(n);for(var i=4*Math.ceil(n/4/a),s=0;s<a;++s){var o=this._dataLookup[s].buffer,u=s*i;e.set(new Uint8ClampedArray(o),u),t[s]=this._dataLookup[s].meta}}this._job=null,this._dataLookup={},r.callback(null,newImageData(e,r.inputs[0].width,r.inputs[0].height),t),this._dispatch()},t.prototype.disposeInternal=function(){for(var e=0;e<this._workers.length;++e)this._workers[e].terminate();this._workers.length=0},t}(_Disposable.default);exports.Processor=Processor;var RasterEventType={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"},RasterOperationType={PIXEL:"pixel",IMAGE:"image"},RasterSourceEvent=function(e){function t(t,r,a){var n=e.call(this,t)||this;return n.extent=r.extent,n.resolution=r.viewState.resolution/r.pixelRatio,n.data=a,n}return __extends(t,e),t}(_Event.default);exports.RasterSourceEvent=RasterSourceEvent;var RasterSource=function(e){function t(t){var r=e.call(this,{projection:null})||this;r.processor_=null,r.operationType_=void 0!==t.operationType?t.operationType:RasterOperationType.PIXEL,r.threads_=void 0!==t.threads?t.threads:1,r.layers_=createLayers(t.sources);for(var a=r.changed.bind(r),n=0,i=r.layers_.length;n<i;++n)r.layers_[n].addEventListener(_EventType.default.CHANGE,a);return r.tileQueue_=new _TileQueue.default(function(){return 1},r.changed.bind(r)),r.requestedFrameState_,r.renderedImageCanvas_=null,r.renderedRevision_,r.frameState_={animate:!1,coordinateToPixelTransform:(0,_transform.create)(),extent:null,index:0,layerIndex:0,layerStatesArray:getLayerStatesArray(r.layers_),pixelRatio:1,pixelToCoordinateTransform:(0,_transform.create)(),postRenderFunctions:[],size:[0,0],tileQueue:r.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},declutterItems:[]},r.setAttributions(function(e){for(var r=[],a=0,n=t.sources.length;a<n;++a){var i=t.sources[a],s=(i instanceof _Source.default?i:i.getSource()).getAttributions();if("function"==typeof s){var o=s(e);r.push.apply(r,o)}}return 0!==r.length?r:null}),void 0!==t.operation&&r.setOperation(t.operation,t.lib),r}return __extends(t,e),t.prototype.setOperation=function(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new Processor({operation:e,imageOps:this.operationType_===RasterOperationType.IMAGE,queue:1,lib:t,threads:this.threads_}),this.changed()},t.prototype.updateFrameState_=function(e,t,r){var a=(0,_obj.assign)({},this.frameState_);a.viewState=(0,_obj.assign)({},a.viewState);var n=(0,_extent.getCenter)(e);a.extent=e.slice(),a.size[0]=Math.round((0,_extent.getWidth)(e)/t),a.size[1]=Math.round((0,_extent.getHeight)(e)/t),a.time=1/0;var i=a.viewState;return i.center=n,i.projection=r,i.resolution=t,a},t.prototype.allSourcesReady_=function(){for(var e=!0,t=0,r=this.layers_.length;t<r;++t)if(this.layers_[t].getSource().getState()!==_State.default.READY){e=!1;break}return e},t.prototype.getImage=function(e,t,r,a){if(!this.allSourcesReady_())return null;var n=this.updateFrameState_(e,t,a);if(this.requestedFrameState_=n,this.renderedImageCanvas_){var i=this.renderedImageCanvas_.getResolution(),s=this.renderedImageCanvas_.getExtent();t===i&&(0,_extent.equals)(e,s)||(this.renderedImageCanvas_=null)}return this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_(),n.tileQueue.loadMoreTiles(16,16),n.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_},t.prototype.processSources_=function(){for(var e=this.requestedFrameState_,t=this.layers_.length,r=new Array(t),a=0;a<t;++a){e.layerIndex=a;var n=getImageData(this.layers_[a],e);if(!n)return;r[a]=n}var i={};this.dispatchEvent(new RasterSourceEvent(RasterEventType.BEFOREOPERATIONS,e,i)),this.processor_.process(r,i,this.onWorkerComplete_.bind(this,e))},t.prototype.onWorkerComplete_=function(e,t,r,a){if(!t&&r){var n=e.extent,i=e.viewState.resolution;if(i===this.requestedFrameState_.viewState.resolution&&(0,_extent.equals)(n,this.requestedFrameState_.extent)){var s;if(this.renderedImageCanvas_)s=this.renderedImageCanvas_.getImage().getContext("2d");else{var o=Math.round((0,_extent.getWidth)(n)/i),u=Math.round((0,_extent.getHeight)(n)/i);s=(0,_dom.createCanvasContext2D)(o,u),this.renderedImageCanvas_=new _ImageCanvas.default(n,i,1,s.canvas)}s.putImageData(r,0,0),this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new RasterSourceEvent(RasterEventType.AFTEROPERATIONS,e,a))}}},t.prototype.getImageInternal=function(){return null},t.prototype.disposeInternal=function(){this.processor_&&this.processor_.dispose(),e.prototype.disposeInternal.call(this)},t}(_Image2.default);RasterSource.prototype.dispose;var sharedContext=null;function getImageData(e,t){var r=e.getRenderer();if(!r)throw new Error("Unsupported layer type: "+e);if(!r.prepareFrame(t))return null;var a,n=t.size[0],i=t.size[1],s=r.renderFrame(t,null);if(s&&(a=s.firstElementChild),!(a instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+a);if(a.width===n&&a.height===i)return a.getContext("2d").getImageData(0,0,n,i);if(sharedContext){var o=sharedContext.canvas;o.width!==n||o.height!==i?sharedContext=(0,_dom.createCanvasContext2D)(n,i):sharedContext.clearRect(0,0,n,i)}else sharedContext=(0,_dom.createCanvasContext2D)(n,i);return sharedContext.drawImage(a,0,0,n,i),sharedContext.getImageData(0,0,n,i)}function getLayerStatesArray(e){return e.map(function(e){return e.getLayerState()})}function createLayers(e){for(var t=e.length,r=new Array(t),a=0;a<t;++a)r[a]=createLayer(e[a]);return r}function createLayer(e){var t;return e instanceof _Source.default?e instanceof _Tile2.default?t=new _Tile.default({source:e}):e instanceof _Image2.default&&(t=new _Image.default({source:e})):t=e,t}var _default=RasterSource;exports.default=_default;

},{"../Disposable.js":12,"../ImageCanvas.js":17,"../TileQueue.js":36,"../dom.js":62,"../events/Event.js":65,"../events/EventType.js":66,"../extent.js":70,"../layer/Image.js":191,"../layer/Tile.js":194,"../obj.js":203,"../transform.js":311,"./Image.js":257,"./Source.js":265,"./State.js":267,"./Tile.js":268}],265:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Object=_interopRequireDefault(require("../Object.js")),_State=_interopRequireDefault(require("./State.js")),_util=require("../util.js"),_proj=require("../proj.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),Source=function(t){function e(e){var r=t.call(this)||this;return r.projection_=(0,_proj.get)(e.projection),r.attributions_=adaptAttributions(e.attributions),r.attributionsCollapsible_=void 0===e.attributionsCollapsible||e.attributionsCollapsible,r.loading=!1,r.state_=void 0!==e.state?e.state:_State.default.READY,r.wrapX_=void 0!==e.wrapX&&e.wrapX,r}return __extends(e,t),e.prototype.getAttributions=function(){return this.attributions_},e.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},e.prototype.getProjection=function(){return this.projection_},e.prototype.getResolutions=function(){return(0,_util.abstract)()},e.prototype.getState=function(){return this.state_},e.prototype.getWrapX=function(){return this.wrapX_},e.prototype.getContextOptions=function(){},e.prototype.refresh=function(){this.changed()},e.prototype.setAttributions=function(t){this.attributions_=adaptAttributions(t),this.changed()},e.prototype.setState=function(t){this.state_=t,this.changed()},e}(_Object.default);function adaptAttributions(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}var _default=Source;exports.default=_default;

},{"../Object.js":28,"../proj.js":205,"../util.js":313,"./State.js":267}],266:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _XYZ=_interopRequireDefault(require("./XYZ.js")),_OSM=require("./OSM.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(o,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var n in o)o.hasOwnProperty(n)&&(e[n]=o[n])})(o,n)};return function(o,n){function t(){this.constructor=o}e(o,n),o.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}}(),ATTRIBUTIONS=['Map tiles by <a href="https://stamen.com/" target="_blank">Stamen Design</a>, under <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC BY 3.0</a>.',_OSM.ATTRIBUTION],LayerConfig={terrain:{extension:"jpg",opaque:!0},"terrain-background":{extension:"jpg",opaque:!0},"terrain-labels":{extension:"png",opaque:!1},"terrain-lines":{extension:"png",opaque:!1},"toner-background":{extension:"png",opaque:!0},toner:{extension:"png",opaque:!0},"toner-hybrid":{extension:"png",opaque:!1},"toner-labels":{extension:"png",opaque:!1},"toner-lines":{extension:"png",opaque:!1},"toner-lite":{extension:"png",opaque:!0},watercolor:{extension:"jpg",opaque:!0}},ProviderConfig={terrain:{minZoom:0,maxZoom:18},toner:{minZoom:0,maxZoom:20},watercolor:{minZoom:0,maxZoom:18}},Stamen=function(e){function o(o){var n=o.layer.indexOf("-"),t=-1==n?o.layer:o.layer.slice(0,n),r=ProviderConfig[t],a=LayerConfig[o.layer],i=void 0!==o.url?o.url:"https://stamen-tiles-{a-d}.a.ssl.fastly.net/"+o.layer+"/{z}/{x}/{y}."+a.extension;return e.call(this,{attributions:ATTRIBUTIONS,cacheSize:o.cacheSize,crossOrigin:"anonymous",imageSmoothing:o.imageSmoothing,maxZoom:null!=o.maxZoom?o.maxZoom:r.maxZoom,minZoom:null!=o.minZoom?o.minZoom:r.minZoom,opaque:a.opaque,reprojectionErrorThreshold:o.reprojectionErrorThreshold,tileLoadFunction:o.tileLoadFunction,transition:o.transition,url:i,wrapX:o.wrapX})||this}return __extends(o,e),o}(_XYZ.default),_default=Stamen;exports.default=_default;

},{"./OSM.js":263,"./XYZ.js":283}],267:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"};exports.default=_default;

},{}],268:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.TileSourceEvent=void 0;var _Event=_interopRequireDefault(require("../events/Event.js")),_Source=_interopRequireDefault(require("./Source.js")),_TileCache=_interopRequireDefault(require("../TileCache.js")),_TileState=_interopRequireDefault(require("../TileState.js")),_util=require("../util.js"),_proj=require("../proj.js"),_tilecoord=require("../tilecoord.js"),_tilegrid=require("../tilegrid.js"),_size=require("../size.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),TileSource=function(e){function t(t){var i=e.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX})||this;i.opaque_=void 0!==t.opaque&&t.opaque,i.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,i.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;var r=t.tileGrid;return r&&(0,_size.toSize)(r.getTileSize(r.getMinZoom()),[256,256]),i.tileCache=new _TileCache.default(t.cacheSize||0),i.tmpSize=[0,0],i.key_=t.key||"",i.tileOptions={transition:t.transition},i.zDirection=t.zDirection?t.zDirection:0,i}return __extends(t,e),t.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},t.prototype.expireCache=function(e,t){var i=this.getTileCacheForProjection(e);i&&i.expireCache(t)},t.prototype.forEachLoadedTile=function(e,t,i,r){var o=this.getTileCacheForProjection(e);if(!o)return!1;for(var n,u,l,a=!0,c=i.minX;c<=i.maxX;++c)for(var p=i.minY;p<=i.maxY;++p)u=(0,_tilecoord.getKeyZXY)(t,c,p),l=!1,o.containsKey(u)&&(l=(n=o.get(u)).getState()===_TileState.default.LOADED)&&(l=!1!==r(n)),l||(a=!1);return a},t.prototype.getGutterForProjection=function(e){return 0},t.prototype.getKey=function(){return this.key_},t.prototype.setKey=function(e){this.key_!==e&&(this.key_=e,this.changed())},t.prototype.getOpaque=function(e){return this.opaque_},t.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},t.prototype.getTile=function(e,t,i,r,o){return(0,_util.abstract)()},t.prototype.getTileGrid=function(){return this.tileGrid},t.prototype.getTileGridForProjection=function(e){return this.tileGrid?this.tileGrid:(0,_tilegrid.getForProjection)(e)},t.prototype.getTileCacheForProjection=function(e){var t=this.getProjection();return t&&!(0,_proj.equivalent)(t,e)?null:this.tileCache},t.prototype.getTilePixelRatio=function(e){return this.tilePixelRatio_},t.prototype.getTilePixelSize=function(e,t,i){var r=this.getTileGridForProjection(i),o=this.getTilePixelRatio(t),n=(0,_size.toSize)(r.getTileSize(e),this.tmpSize);return 1==o?n:(0,_size.scale)(n,o,this.tmpSize)},t.prototype.getTileCoordForTileUrlFunction=function(e,t){var i=void 0!==t?t:this.getProjection(),r=this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=(0,_tilegrid.wrapX)(r,e,i)),(0,_tilecoord.withinExtentAndZ)(e,r)?e:null},t.prototype.clear=function(){this.tileCache.clear()},t.prototype.refresh=function(){this.clear(),e.prototype.refresh.call(this)},t.prototype.updateCacheSize=function(e,t){var i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)},t.prototype.useTile=function(e,t,i,r){},t}(_Source.default),TileSourceEvent=function(e){function t(t,i){var r=e.call(this,t)||this;return r.tile=i,r}return __extends(t,e),t}(_Event.default);exports.TileSourceEvent=TileSourceEvent;var _default=TileSource;exports.default=_default;

},{"../TileCache.js":35,"../TileState.js":38,"../events/Event.js":65,"../proj.js":205,"../size.js":251,"../tilecoord.js":305,"../tilegrid.js":306,"../util.js":313,"./Source.js":265}],269:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _TileImage=_interopRequireDefault(require("./TileImage.js")),_uri=require("../uri.js"),_obj=require("../obj.js"),_extent=require("../extent.js"),_math=require("../math.js"),_size=require("../size.js"),_tilecoord=require("../tilecoord.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),TileArcGISRest=function(e){function t(t){var r=this,i=t||{};return(r=e.call(this,{attributions:i.attributions,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,imageSmoothing:i.imageSmoothing,projection:i.projection,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileGrid:i.tileGrid,tileLoadFunction:i.tileLoadFunction,url:i.url,urls:i.urls,wrapX:void 0===i.wrapX||i.wrapX,transition:i.transition})||this).params_=i.params||{},r.hidpi_=void 0===i.hidpi||i.hidpi,r.tmpExtent_=(0,_extent.createEmpty)(),r.setKey(r.getKeyForParams_()),r}return __extends(t,e),t.prototype.getKeyForParams_=function(){var e=0,t=[];for(var r in this.params_)t[e++]=r+"-"+this.params_[r];return t.join("/")},t.prototype.getParams=function(){return this.params_},t.prototype.getRequestUrl_=function(e,t,r,i,o,n){var a=this.urls;if(a){var s,u=o.getCode().split(":").pop();if(n.SIZE=t[0]+","+t[1],n.BBOX=r.join(","),n.BBOXSR=u,n.IMAGESR=u,n.DPI=Math.round(n.DPI?n.DPI*i:90*i),1==a.length)s=a[0];else s=a[(0,_math.modulo)((0,_tilecoord.hash)(e),a.length)];var p=s.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return(0,_uri.appendParams)(p,n)}},t.prototype.getTilePixelRatio=function(e){return this.hidpi_?e:1},t.prototype.updateParams=function(e){(0,_obj.assign)(this.params_,e),this.setKey(this.getKeyForParams_())},t.prototype.tileUrlFunction=function(e,t,r){var i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(r)),!(i.getResolutions().length<=e[0])){1==t||this.hidpi_||(t=1);var o=i.getTileCoordExtent(e,this.tmpExtent_),n=(0,_size.toSize)(i.getTileSize(e[0]),this.tmpSize);1!=t&&(n=(0,_size.scale)(n,t,this.tmpSize));var a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return(0,_obj.assign)(a,this.params_),this.getRequestUrl_(e,n,o,t,r,a)}},t}(_TileImage.default),_default=TileArcGISRest;exports.default=_default;

},{"../extent.js":70,"../math.js":201,"../obj.js":203,"../size.js":251,"../tilecoord.js":305,"../uri.js":312,"./TileImage.js":272}],270:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Tile=_interopRequireDefault(require("../Tile.js")),_TileState=_interopRequireDefault(require("../TileState.js")),_XYZ=_interopRequireDefault(require("./XYZ.js")),_dom=require("../dom.js"),_tilecoord=require("../tilecoord.js"),_size=require("../size.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),LabeledTile=function(e){function t(t,i,r){var n=e.call(this,t,_TileState.default.LOADED)||this;return n.tileSize_=i,n.text_=r,n.canvas_=null,n}return __extends(t,e),t.prototype.getImage=function(){if(this.canvas_)return this.canvas_;var e=this.tileSize_,t=(0,_dom.createCanvasContext2D)(e[0],e[1]);return t.strokeStyle="grey",t.strokeRect(.5,.5,e[0]+.5,e[1]+.5),t.fillStyle="grey",t.strokeStyle="white",t.textAlign="center",t.textBaseline="middle",t.font="24px sans-serif",t.lineWidth=4,t.strokeText(this.text_,e[0]/2,e[1]/2,e[0]),t.fillText(this.text_,e[0]/2,e[1]/2,e[0]),this.canvas_=t.canvas,t.canvas},t.prototype.load=function(){},t}(_Tile.default),TileDebug=function(e){function t(t){var i=t||{};return e.call(this,{opaque:!1,projection:i.projection,tileGrid:i.tileGrid,wrapX:void 0===i.wrapX||i.wrapX,zDirection:i.zDirection})||this}return __extends(t,e),t.prototype.getTile=function(e,t,i){var r=(0,_tilecoord.getKeyZXY)(e,t,i);if(this.tileCache.containsKey(r))return this.tileCache.get(r);var n=(0,_size.toSize)(this.tileGrid.getTileSize(e)),o=[e,t,i],l=this.getTileCoordForTileUrlFunction(o),a=void 0;a=l?"z:"+l[0]+" x:"+l[1]+" y:"+l[2]:"none";var u=new LabeledTile(o,n,a);return this.tileCache.set(r,u),u},t}(_XYZ.default),_default=TileDebug;exports.default=_default;

},{"../Tile.js":34,"../TileState.js":38,"../dom.js":62,"../size.js":251,"../tilecoord.js":305,"./XYZ.js":283}],271:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};exports.default=_default;

},{}],272:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_ImageTile=_interopRequireDefault(require("../ImageTile.js")),_Tile=_interopRequireDefault(require("../reproj/Tile.js")),_TileCache=_interopRequireDefault(require("../TileCache.js")),_TileState=_interopRequireDefault(require("../TileState.js")),_UrlTile=_interopRequireDefault(require("./UrlTile.js")),_common=require("../reproj/common.js"),_common2=require("./common.js"),_proj=require("../proj.js"),_tilecoord=require("../tilecoord.js"),_tilegrid=require("../tilegrid.js"),_util=require("../util.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),TileImage=function(e){function t(t){var i=e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return i.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,i.tileClass=void 0!==t.tileClass?t.tileClass:_ImageTile.default,i.tileCacheForProjection={},i.tileGridForProjection={},i.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,i.contextOptions_=!1===t.imageSmoothing?_common2.IMAGE_SMOOTHING_DISABLED:void 0,i.renderReprojectionEdges_=!1,i}return __extends(t,e),t.prototype.canExpireCache=function(){if(!_common.ENABLE_RASTER_REPROJECTION)return e.prototype.canExpireCache.call(this);if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},t.prototype.expireCache=function(t,i){if(_common.ENABLE_RASTER_REPROJECTION){var r=this.getTileCacheForProjection(t);for(var o in this.tileCache.expireCache(this.tileCache==r?i:{}),this.tileCacheForProjection){var n=this.tileCacheForProjection[o];n.expireCache(n==r?i:{})}}else e.prototype.expireCache.call(this,t,i)},t.prototype.getContextOptions=function(){return this.contextOptions_},t.prototype.getGutterForProjection=function(e){return _common.ENABLE_RASTER_REPROJECTION&&this.getProjection()&&e&&!(0,_proj.equivalent)(this.getProjection(),e)?0:this.getGutter()},t.prototype.getGutter=function(){return 0},t.prototype.getKey=function(){return e.prototype.getKey.call(this)+(this.contextOptions_?"\n"+JSON.stringify(this.contextOptions_):"")},t.prototype.getOpaque=function(t){return!(_common.ENABLE_RASTER_REPROJECTION&&this.getProjection()&&t&&!(0,_proj.equivalent)(this.getProjection(),t))&&e.prototype.getOpaque.call(this,t)},t.prototype.getTileGridForProjection=function(t){if(!_common.ENABLE_RASTER_REPROJECTION)return e.prototype.getTileGridForProjection.call(this,t);var i=this.getProjection();if(!this.tileGrid||i&&!(0,_proj.equivalent)(i,t)){var r=(0,_util.getUid)(t);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=(0,_tilegrid.getForProjection)(t)),this.tileGridForProjection[r]}return this.tileGrid},t.prototype.getTileCacheForProjection=function(t){if(!_common.ENABLE_RASTER_REPROJECTION)return e.prototype.getTileCacheForProjection.call(this,t);var i=this.getProjection();if(!i||(0,_proj.equivalent)(i,t))return this.tileCache;var r=(0,_util.getUid)(t);return r in this.tileCacheForProjection||(this.tileCacheForProjection[r]=new _TileCache.default(this.tileCache.highWaterMark)),this.tileCacheForProjection[r]},t.prototype.createTile_=function(e,t,i,r,o,n){var l=[e,t,i],c=this.getTileCoordForTileUrlFunction(l,o),a=c?this.tileUrlFunction(c,r,o):void 0,s=new this.tileClass(l,void 0!==a?_TileState.default.IDLE:_TileState.default.EMPTY,void 0!==a?a:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return s.key=n,s.addEventListener(_EventType.default.CHANGE,this.handleTileChange.bind(this)),s},t.prototype.getTile=function(e,t,i,r,o){var n=this.getProjection();if(_common.ENABLE_RASTER_REPROJECTION&&n&&o&&!(0,_proj.equivalent)(n,o)){var l=this.getTileCacheForProjection(o),c=[e,t,i],a=void 0,s=(0,_tilecoord.getKey)(c);l.containsKey(s)&&(a=l.get(s));var u=this.getKey();if(a&&a.key==u)return a;var h=this.getTileGridForProjection(n),p=this.getTileGridForProjection(o),_=this.getTileCoordForTileUrlFunction(c,o),d=new _Tile.default(n,h,o,p,c,_,this.getTilePixelRatio(r),this.getGutter(),function(e,t,i,r){return this.getTileInternal(e,t,i,r,n)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.contextOptions_);return d.key=u,a?(d.interimTile=a,d.refreshInterimChain(),l.replace(s,d)):l.set(s,d),d}return this.getTileInternal(e,t,i,r,n||o)},t.prototype.getTileInternal=function(e,t,i,r,o){var n=null,l=(0,_tilecoord.getKeyZXY)(e,t,i),c=this.getKey();if(this.tileCache.containsKey(l)){if((n=this.tileCache.get(l)).key!=c){var a=n;n=this.createTile_(e,t,i,r,o,c),a.getState()==_TileState.default.IDLE?n.interimTile=a.interimTile:n.interimTile=a,n.refreshInterimChain(),this.tileCache.replace(l,n)}}else n=this.createTile_(e,t,i,r,o,c),this.tileCache.set(l,n);return n},t.prototype.setRenderReprojectionEdges=function(e){if(_common.ENABLE_RASTER_REPROJECTION&&this.renderReprojectionEdges_!=e){for(var t in this.renderReprojectionEdges_=e,this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}},t.prototype.setTileGridForProjection=function(e,t){if(_common.ENABLE_RASTER_REPROJECTION){var i=(0,_proj.get)(e);if(i){var r=(0,_util.getUid)(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=t)}}},t}(_UrlTile.default);function defaultTileLoadFunction(e,t){e.getImage().src=t}var _default=TileImage;exports.default=_default;

},{"../ImageTile.js":19,"../TileCache.js":35,"../TileState.js":38,"../events/EventType.js":66,"../proj.js":205,"../reproj/Tile.js":246,"../reproj/common.js":248,"../tilecoord.js":305,"../tilegrid.js":306,"../util.js":313,"./UrlTile.js":276,"./common.js":285}],273:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _State=_interopRequireDefault(require("./State.js")),_TileImage=_interopRequireDefault(require("./TileImage.js")),_extent=require("../extent.js"),_asserts=require("../asserts.js"),_tileurlfunction=require("../tileurlfunction.js"),_tilegrid=require("../tilegrid.js"),_proj=require("../proj.js"),_net=require("../net.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),TileJSON=function(e){function t(t){var r=e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,imageSmoothing:t.imageSmoothing,projection:(0,_proj.get)("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:_State.default.LOADING,tileLoadFunction:t.tileLoadFunction,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition})||this;if(r.tileJSON_=null,r.tileSize_=t.tileSize,t.url)if(t.jsonp)(0,_net.jsonp)(t.url,r.handleTileJSONResponse.bind(r),r.handleTileJSONError.bind(r));else{var i=new XMLHttpRequest;i.addEventListener("load",r.onXHRLoad_.bind(r)),i.addEventListener("error",r.onXHRError_.bind(r)),i.open("GET",t.url),i.send()}else t.tileJSON?r.handleTileJSONResponse(t.tileJSON):(0,_asserts.assert)(!1,51);return r}return __extends(t,e),t.prototype.onXHRLoad_=function(e){var t=e.target;if(!t.status||t.status>=200&&t.status<300){var r=void 0;try{r=JSON.parse(t.responseText)}catch(e){return void this.handleTileJSONError()}this.handleTileJSONResponse(r)}else this.handleTileJSONError()},t.prototype.onXHRError_=function(e){this.handleTileJSONError()},t.prototype.getTileJSON=function(){return this.tileJSON_},t.prototype.handleTileJSONResponse=function(e){var t,r=(0,_proj.get)("EPSG:4326"),i=this.getProjection();if(void 0!==e.bounds){var o=(0,_proj.getTransformFromProjections)(r,i);t=(0,_extent.applyTransform)(e.bounds,o)}var n=e.minzoom||0,s=e.maxzoom||22,a=(0,_tilegrid.createXYZ)({extent:(0,_tilegrid.extentFromProjection)(i),maxZoom:s,minZoom:n,tileSize:this.tileSize_});if(this.tileGrid=a,this.tileUrlFunction=(0,_tileurlfunction.createFromTemplates)(e.tiles,a),void 0!==e.attribution&&!this.getAttributions()){var l=void 0!==t?t:r.getExtent();this.setAttributions(function(t){return(0,_extent.intersects)(l,t.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState(_State.default.READY)},t.prototype.handleTileJSONError=function(){this.setState(_State.default.ERROR)},t}(_TileImage.default),_default=TileJSON;exports.default=_default;

},{"../asserts.js":45,"../extent.js":70,"../net.js":202,"../proj.js":205,"../tilegrid.js":306,"../tileurlfunction.js":310,"./State.js":267,"./TileImage.js":272}],274:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _common=require("./common.js"),_TileImage=_interopRequireDefault(require("./TileImage.js")),_WMSServerType=_interopRequireDefault(require("./WMSServerType.js")),_uri=require("../uri.js"),_asserts=require("../asserts.js"),_obj=require("../obj.js"),_extent=require("../extent.js"),_size=require("../size.js"),_reproj=require("../reproj.js"),_string=require("../string.js"),_proj=require("../proj.js"),_math=require("../math.js"),_tilecoord=require("../tilecoord.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),TileWMS=function(e){function t(t){var r=this,i=t||{},o=i.params||{},s=!("TRANSPARENT"in o)||o.TRANSPARENT;return(r=e.call(this,{attributions:i.attributions,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,imageSmoothing:i.imageSmoothing,opaque:!s,projection:i.projection,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileClass:i.tileClass,tileGrid:i.tileGrid,tileLoadFunction:i.tileLoadFunction,url:i.url,urls:i.urls,wrapX:void 0===i.wrapX||i.wrapX,transition:i.transition})||this).gutter_=void 0!==i.gutter?i.gutter:0,r.params_=o,r.v13_=!0,r.serverType_=i.serverType,r.hidpi_=void 0===i.hidpi||i.hidpi,r.tmpExtent_=(0,_extent.createEmpty)(),r.updateV13_(),r.setKey(r.getKeyForParams_()),r}return __extends(t,e),t.prototype.getFeatureInfoUrl=function(e,t,r,i){var o=(0,_proj.get)(r),s=this.getProjection(),n=this.getTileGrid();n||(n=this.getTileGridForProjection(o));var a=n.getZForResolution(t,this.zDirection),_=n.getTileCoordForCoordAndZ(e,a);if(!(n.getResolutions().length<=_[0])){var u=n.getResolution(_[0]),p=n.getTileCoordExtent(_,this.tmpExtent_),l=(0,_size.toSize)(n.getTileSize(_[0]),this.tmpSize),h=this.gutter_;0!==h&&(l=(0,_size.buffer)(l,h,this.tmpSize),p=(0,_extent.buffer)(p,u*h,p)),s&&s!==o&&(u=(0,_reproj.calculateSourceResolution)(s,o,e,u),p=(0,_proj.transformExtent)(p,o,s),e=(0,_proj.transform)(e,o,s));var S={SERVICE:"WMS",VERSION:_common.DEFAULT_WMS_VERSION,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};(0,_obj.assign)(S,this.params_,i);var c=Math.floor((e[0]-p[0])/u),g=Math.floor((p[3]-e[1])/u);return S[this.v13_?"I":"X"]=c,S[this.v13_?"J":"Y"]=g,this.getRequestUrl_(_,l,p,1,s||o,S)}},t.prototype.getLegendUrl=function(e,t){if(void 0!==this.urls[0]){var r={SERVICE:"WMS",VERSION:_common.DEFAULT_WMS_VERSION,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===t||void 0===t.LAYER){var i=this.params_.LAYERS;if(!(!Array.isArray(i)||1===i.length))return;r.LAYER=i}if(void 0!==e){var o=this.getProjection()?this.getProjection().getMetersPerUnit():1;r.SCALE=e*o*39.37*(25.4/.28)}return(0,_obj.assign)(r,t),(0,_uri.appendParams)(this.urls[0],r)}},t.prototype.getGutter=function(){return this.gutter_},t.prototype.getParams=function(){return this.params_},t.prototype.getRequestUrl_=function(e,t,r,i,o,s){var n=this.urls;if(n){if(s.WIDTH=t[0],s.HEIGHT=t[1],s[this.v13_?"CRS":"SRS"]=o.getCode(),"STYLES"in this.params_||(s.STYLES=""),1!=i)switch(this.serverType_){case _WMSServerType.default.GEOSERVER:var a=90*i+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+a:s.FORMAT_OPTIONS="dpi:"+a;break;case _WMSServerType.default.MAPSERVER:s.MAP_RESOLUTION=90*i;break;case _WMSServerType.default.CARMENTA_SERVER:case _WMSServerType.default.QGIS:s.DPI=90*i;break;default:(0,_asserts.assert)(!1,52)}var _,u=o.getAxisOrientation(),p=r;if(this.v13_&&"ne"==u.substr(0,2)){var l=void 0;l=r[0],p[0]=r[1],p[1]=l,l=r[2],p[2]=r[3],p[3]=l}if(s.BBOX=p.join(","),1==n.length)_=n[0];else _=n[(0,_math.modulo)((0,_tilecoord.hash)(e),n.length)];return(0,_uri.appendParams)(_,s)}},t.prototype.getTilePixelRatio=function(e){return this.hidpi_&&void 0!==this.serverType_?e:1},t.prototype.getKeyForParams_=function(){var e=0,t=[];for(var r in this.params_)t[e++]=r+"-"+this.params_[r];return t.join("/")},t.prototype.updateParams=function(e){(0,_obj.assign)(this.params_,e),this.updateV13_(),this.setKey(this.getKeyForParams_())},t.prototype.updateV13_=function(){var e=this.params_.VERSION||_common.DEFAULT_WMS_VERSION;this.v13_=(0,_string.compareVersions)(e,"1.3")>=0},t.prototype.tileUrlFunction=function(e,t,r){var i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(r)),!(i.getResolutions().length<=e[0])){1==t||this.hidpi_&&void 0!==this.serverType_||(t=1);var o=i.getResolution(e[0]),s=i.getTileCoordExtent(e,this.tmpExtent_),n=(0,_size.toSize)(i.getTileSize(e[0]),this.tmpSize),a=this.gutter_;0!==a&&(n=(0,_size.buffer)(n,a,this.tmpSize),s=(0,_extent.buffer)(s,o*a,s)),1!=t&&(n=(0,_size.scale)(n,t,this.tmpSize));var _={SERVICE:"WMS",VERSION:_common.DEFAULT_WMS_VERSION,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};return(0,_obj.assign)(_,this.params_),this.getRequestUrl_(e,n,s,t,r,_)}},t}(_TileImage.default),_default=TileWMS;exports.default=_default;

},{"../asserts.js":45,"../extent.js":70,"../math.js":201,"../obj.js":203,"../proj.js":205,"../reproj.js":244,"../size.js":251,"../string.js":287,"../tilecoord.js":305,"../uri.js":312,"./TileImage.js":272,"./WMSServerType.js":280,"./common.js":285}],275:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.CustomTile=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_State=_interopRequireDefault(require("./State.js")),_Tile=_interopRequireDefault(require("../Tile.js")),_Tile2=_interopRequireDefault(require("./Tile.js")),_TileState=_interopRequireDefault(require("../TileState.js")),_extent=require("../extent.js"),_asserts=require("../asserts.js"),_tileurlfunction=require("../tileurlfunction.js"),_tilegrid=require("../tilegrid.js"),_tilecoord=require("../tilecoord.js"),_proj=require("../proj.js"),_events=require("../events.js"),_net=require("../net.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),CustomTile=function(t){function e(e,i,r,n,o,s){var a=t.call(this,e,i)||this;return a.src_=r,a.extent_=n,a.preemptive_=o,a.grid_=null,a.keys_=null,a.data_=null,a.jsonp_=s,a}return __extends(e,t),e.prototype.getImage=function(){return null},e.prototype.getData=function(t){if(!this.grid_||!this.keys_)return null;var e=(t[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),i=(t[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),r=this.grid_[Math.floor((1-i)*this.grid_.length)];if("string"!=typeof r)return null;var n=r.charCodeAt(Math.floor(e*r.length));n>=93&&n--,n>=35&&n--;var o=null;if((n-=32)in this.keys_){var s=this.keys_[n];o=this.data_&&s in this.data_?this.data_[s]:s}return o},e.prototype.forDataAtCoordinate=function(t,e,i){this.state==_TileState.default.EMPTY&&!0===i?(this.state=_TileState.default.IDLE,(0,_events.listenOnce)(this,_EventType.default.CHANGE,function(i){e(this.getData(t))},this),this.loadInternal_()):!0===i?setTimeout(function(){e(this.getData(t))}.bind(this),0):e(this.getData(t))},e.prototype.getKey=function(){return this.src_},e.prototype.handleError_=function(){this.state=_TileState.default.ERROR,this.changed()},e.prototype.handleLoad_=function(t){this.grid_=t.grid,this.keys_=t.keys,this.data_=t.data,this.state=_TileState.default.LOADED,this.changed()},e.prototype.loadInternal_=function(){if(this.state==_TileState.default.IDLE)if(this.state=_TileState.default.LOADING,this.jsonp_)(0,_net.jsonp)(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{var t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",this.src_),t.send()}},e.prototype.onXHRLoad_=function(t){var e=t.target;if(!e.status||e.status>=200&&e.status<300){var i=void 0;try{i=JSON.parse(e.responseText)}catch(t){return void this.handleError_()}this.handleLoad_(i)}else this.handleError_()},e.prototype.onXHRError_=function(t){this.handleError_()},e.prototype.load=function(){this.preemptive_?this.loadInternal_():this.setState(_TileState.default.EMPTY)},e}(_Tile.default);exports.CustomTile=CustomTile;var UTFGrid=function(t){function e(e){var i=t.call(this,{projection:(0,_proj.get)("EPSG:3857"),state:_State.default.LOADING})||this;if(i.preemptive_=void 0===e.preemptive||e.preemptive,i.tileUrlFunction_=_tileurlfunction.nullTileUrlFunction,i.template_=void 0,i.jsonp_=e.jsonp||!1,e.url)if(i.jsonp_)(0,_net.jsonp)(e.url,i.handleTileJSONResponse.bind(i),i.handleTileJSONError.bind(i));else{var r=new XMLHttpRequest;r.addEventListener("load",i.onXHRLoad_.bind(i)),r.addEventListener("error",i.onXHRError_.bind(i)),r.open("GET",e.url),r.send()}else e.tileJSON?i.handleTileJSONResponse(e.tileJSON):(0,_asserts.assert)(!1,51);return i}return __extends(e,t),e.prototype.onXHRLoad_=function(t){var e=t.target;if(!e.status||e.status>=200&&e.status<300){var i=void 0;try{i=JSON.parse(e.responseText)}catch(t){return void this.handleTileJSONError()}this.handleTileJSONResponse(i)}else this.handleTileJSONError()},e.prototype.onXHRError_=function(t){this.handleTileJSONError()},e.prototype.getTemplate=function(){return this.template_},e.prototype.forDataAtCoordinateAndResolution=function(t,e,i,r){if(this.tileGrid){var n=this.tileGrid.getZForResolution(e,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(t,n);this.getTile(o[0],o[1],o[2],1,this.getProjection()).forDataAtCoordinate(t,i,r)}else!0===r?setTimeout(function(){i(null)},0):i(null)},e.prototype.handleTileJSONError=function(){this.setState(_State.default.ERROR)},e.prototype.handleTileJSONResponse=function(t){var e,i=(0,_proj.get)("EPSG:4326"),r=this.getProjection();if(void 0!==t.bounds){var n=(0,_proj.getTransformFromProjections)(i,r);e=(0,_extent.applyTransform)(t.bounds,n)}var o=t.minzoom||0,s=t.maxzoom||22,a=(0,_tilegrid.createXYZ)({extent:(0,_tilegrid.extentFromProjection)(r),maxZoom:s,minZoom:o});this.tileGrid=a,this.template_=t.template;var l=t.grids;if(l){if(this.tileUrlFunction_=(0,_tileurlfunction.createFromTemplates)(l,a),void 0!==t.attribution){var u=void 0!==e?e:i.getExtent();this.setAttributions(function(e){return(0,_extent.intersects)(u,e.extent)?[t.attribution]:null})}this.setState(_State.default.READY)}else this.setState(_State.default.ERROR)},e.prototype.getTile=function(t,e,i,r,n){var o=(0,_tilecoord.getKeyZXY)(t,e,i);if(this.tileCache.containsKey(o))return this.tileCache.get(o);var s=[t,e,i],a=this.getTileCoordForTileUrlFunction(s,n),l=this.tileUrlFunction_(a,r,n),u=new CustomTile(s,void 0!==l?_TileState.default.IDLE:_TileState.default.EMPTY,void 0!==l?l:"",this.tileGrid.getTileCoordExtent(s),this.preemptive_,this.jsonp_);return this.tileCache.set(o,u),u},e.prototype.useTile=function(t,e,i){var r=(0,_tilecoord.getKeyZXY)(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)},e}(_Tile2.default),_default=UTFGrid;exports.default=_default;

},{"../Tile.js":34,"../TileState.js":38,"../asserts.js":45,"../events.js":64,"../events/EventType.js":66,"../extent.js":70,"../net.js":202,"../proj.js":205,"../tilecoord.js":305,"../tilegrid.js":306,"../tileurlfunction.js":310,"./State.js":267,"./Tile.js":268}],276:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _TileEventType=_interopRequireDefault(require("./TileEventType.js")),_Tile=_interopRequireWildcard(require("./Tile.js")),_TileState=_interopRequireDefault(require("../TileState.js")),_tileurlfunction=require("../tileurlfunction.js"),_tilecoord=require("../tilecoord.js"),_util=require("../util.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return _getRequireWildcardCache=function(){return t},t}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;if(null===t||"object"!==_typeof(t)&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=r?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(i,n,o):i[n]=t[n]}return i.default=t,e&&e.set(t,i),i}function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),UrlTile=function(t){function e(i){var r=t.call(this,{attributions:i.attributions,cacheSize:i.cacheSize,opaque:i.opaque,projection:i.projection,state:i.state,tileGrid:i.tileGrid,tilePixelRatio:i.tilePixelRatio,wrapX:i.wrapX,transition:i.transition,key:i.key,attributionsCollapsible:i.attributionsCollapsible,zDirection:i.zDirection})||this;return r.generateTileUrlFunction_=r.tileUrlFunction===e.prototype.tileUrlFunction,r.tileLoadFunction=i.tileLoadFunction,i.tileUrlFunction&&(r.tileUrlFunction=i.tileUrlFunction.bind(r)),r.urls=null,i.urls?r.setUrls(i.urls):i.url&&r.setUrl(i.url),r.tileLoadingKeys_={},r}return __extends(e,t),e.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},e.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},e.prototype.getUrls=function(){return this.urls},e.prototype.handleTileChange=function(t){var e,i=t.target,r=(0,_util.getUid)(i),n=i.getState();n==_TileState.default.LOADING?(this.tileLoadingKeys_[r]=!0,e=_TileEventType.default.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],e=n==_TileState.default.ERROR?_TileEventType.default.TILELOADERROR:n==_TileState.default.LOADED?_TileEventType.default.TILELOADEND:void 0),null!=e&&this.dispatchEvent(new _Tile.TileSourceEvent(e,i))},e.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},e.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()},e.prototype.setUrl=function(t){var e=(0,_tileurlfunction.expandUrl)(t);this.urls=e,this.setUrls(e)},e.prototype.setUrls=function(t){this.urls=t;var e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction((0,_tileurlfunction.createFromTemplates)(t,this.tileGrid),e):this.setKey(e)},e.prototype.tileUrlFunction=function(t,e,i){},e.prototype.useTile=function(t,e,i){var r=(0,_tilecoord.getKeyZXY)(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)},e}(_Tile.default),_default=UrlTile;exports.default=_default;

},{"../TileState.js":38,"../tilecoord.js":305,"../tileurlfunction.js":310,"../util.js":313,"./Tile.js":268,"./TileEventType.js":271}],277:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.VectorSourceEvent=void 0;var _Collection=_interopRequireDefault(require("../Collection.js")),_CollectionEventType=_interopRequireDefault(require("../CollectionEventType.js")),_Event=_interopRequireDefault(require("../events/Event.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_ObjectEventType=_interopRequireDefault(require("../ObjectEventType.js")),_RBush=_interopRequireDefault(require("../structs/RBush.js")),_Source=_interopRequireDefault(require("./Source.js")),_State=_interopRequireDefault(require("./State.js")),_VectorEventType=_interopRequireDefault(require("./VectorEventType.js")),_functions=require("../functions.js"),_loadingstrategy=require("../loadingstrategy.js"),_asserts=require("../asserts.js"),_extent=require("../extent.js"),_array=require("../array.js"),_util=require("../util.js"),_obj=require("../obj.js"),_events=require("../events.js"),_featureloader=require("../featureloader.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),VectorSourceEvent=function(e){function t(t,r){var n=e.call(this,t)||this;return n.feature=r,n}return __extends(t,e),t}(_Event.default);exports.VectorSourceEvent=VectorSourceEvent;var VectorSource=function(e){function t(t){var r=this,n=t||{};(r=e.call(this,{attributions:n.attributions,projection:void 0,state:_State.default.READY,wrapX:void 0===n.wrapX||n.wrapX})||this).loader_=_functions.VOID,r.format_=n.format,r.overlaps_=void 0===n.overlaps||n.overlaps,r.url_=n.url,void 0!==n.loader?r.loader_=n.loader:void 0!==r.url_&&((0,_asserts.assert)(r.format_,7),r.loader_=(0,_featureloader.xhr)(r.url_,r.format_)),r.strategy_=void 0!==n.strategy?n.strategy:_loadingstrategy.all;var o,i,s=void 0===n.useSpatialIndex||n.useSpatialIndex;return r.featuresRtree_=s?new _RBush.default:null,r.loadedExtentsRtree_=new _RBush.default,r.nullGeometryFeatures_={},r.idIndex_={},r.uidIndex_={},r.featureChangeKeys_={},r.featuresCollection_=null,Array.isArray(n.features)?i=n.features:n.features&&(i=(o=n.features).getArray()),s||void 0!==o||(o=new _Collection.default(i)),void 0!==i&&r.addFeaturesInternal(i),void 0!==o&&r.bindFeaturesCollection_(o),r}return __extends(t,e),t.prototype.addFeature=function(e){this.addFeatureInternal(e),this.changed()},t.prototype.addFeatureInternal=function(e){var t=(0,_util.getUid)(e);if(this.addToIndex_(t,e)){this.setupChangeEvents_(t,e);var r=e.getGeometry();if(r){var n=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new VectorSourceEvent(_VectorEventType.default.ADDFEATURE,e))}else this.featuresCollection_&&this.featuresCollection_.remove(e)},t.prototype.setupChangeEvents_=function(e,t){this.featureChangeKeys_[e]=[(0,_events.listen)(t,_EventType.default.CHANGE,this.handleFeatureChange_,this),(0,_events.listen)(t,_ObjectEventType.default.PROPERTYCHANGE,this.handleFeatureChange_,this)]},t.prototype.addToIndex_=function(e,t){var r=!0,n=t.getId();return void 0!==n&&(n.toString()in this.idIndex_?r=!1:this.idIndex_[n.toString()]=t),r&&((0,_asserts.assert)(!(e in this.uidIndex_),30),this.uidIndex_[e]=t),r},t.prototype.addFeatures=function(e){this.addFeaturesInternal(e),this.changed()},t.prototype.addFeaturesInternal=function(e){for(var t=[],r=[],n=[],o=0,i=e.length;o<i;o++){var s=e[o],a=(0,_util.getUid)(s);this.addToIndex_(a,s)&&r.push(s)}o=0;for(var u=r.length;o<u;o++){s=r[o],a=(0,_util.getUid)(s);this.setupChangeEvents_(a,s);var l=s.getGeometry();if(l){var _=l.getExtent();t.push(_),n.push(s)}else this.nullGeometryFeatures_[a]=s}this.featuresRtree_&&this.featuresRtree_.load(t,n);o=0;for(var f=r.length;o<f;o++)this.dispatchEvent(new VectorSourceEvent(_VectorEventType.default.ADDFEATURE,r[o]))},t.prototype.bindFeaturesCollection_=function(e){var t=!1;this.addEventListener(_VectorEventType.default.ADDFEATURE,function(r){t||(t=!0,e.push(r.feature),t=!1)}),this.addEventListener(_VectorEventType.default.REMOVEFEATURE,function(r){t||(t=!0,e.remove(r.feature),t=!1)}),e.addEventListener(_CollectionEventType.default.ADD,function(e){t||(t=!0,this.addFeature(e.element),t=!1)}.bind(this)),e.addEventListener(_CollectionEventType.default.REMOVE,function(e){t||(t=!0,this.removeFeature(e.element),t=!1)}.bind(this)),this.featuresCollection_=e},t.prototype.clear=function(e){if(e){for(var t in this.featureChangeKeys_){this.featureChangeKeys_[t].forEach(_events.unlistenByKey)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_)for(var r in this.featuresRtree_.forEach(this.removeFeatureInternal.bind(this)),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var n=new VectorSourceEvent(_VectorEventType.default.CLEAR);this.dispatchEvent(n),this.changed()},t.prototype.forEachFeature=function(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},t.prototype.forEachFeatureAtCoordinateDirect=function(e,t){var r=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(r,function(r){return r.getGeometry().intersectsCoordinate(e)?t(r):void 0})},t.prototype.forEachFeatureInExtent=function(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},t.prototype.forEachFeatureIntersectingExtent=function(e,t){return this.forEachFeatureInExtent(e,function(r){if(r.getGeometry().intersectsExtent(e)){var n=t(r);if(n)return n}})},t.prototype.getFeaturesCollection=function(){return this.featuresCollection_},t.prototype.getFeatures=function(){var e;return this.featuresCollection_?e=this.featuresCollection_.getArray():this.featuresRtree_&&(e=this.featuresRtree_.getAll(),(0,_obj.isEmpty)(this.nullGeometryFeatures_)||(0,_array.extend)(e,(0,_obj.getValues)(this.nullGeometryFeatures_))),e},t.prototype.getFeaturesAtCoordinate=function(e){var t=[];return this.forEachFeatureAtCoordinateDirect(e,function(e){t.push(e)}),t},t.prototype.getFeaturesInExtent=function(e){return this.featuresRtree_?this.featuresRtree_.getInExtent(e):this.featuresCollection_?this.featuresCollection_.getArray():[]},t.prototype.getClosestFeatureToCoordinate=function(e,t){var r=e[0],n=e[1],o=null,i=[NaN,NaN],s=1/0,a=[-1/0,-1/0,1/0,1/0],u=t||_functions.TRUE;return this.featuresRtree_.forEachInExtent(a,function(e){if(u(e)){var t=e.getGeometry(),l=s;if((s=t.closestPointXY(r,n,i,s))<l){o=e;var _=Math.sqrt(s);a[0]=r-_,a[1]=n-_,a[2]=r+_,a[3]=n+_}}}),o},t.prototype.getExtent=function(e){return this.featuresRtree_.getExtent(e)},t.prototype.getFeatureById=function(e){var t=this.idIndex_[e.toString()];return void 0!==t?t:null},t.prototype.getFeatureByUid=function(e){var t=this.uidIndex_[e];return void 0!==t?t:null},t.prototype.getFormat=function(){return this.format_},t.prototype.getOverlaps=function(){return this.overlaps_},t.prototype.getUrl=function(){return this.url_},t.prototype.handleFeatureChange_=function(e){var t=e.target,r=(0,_util.getUid)(t),n=t.getGeometry();if(n){var o=n.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}else r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[r]=t);var i=t.getId();if(void 0!==i){var s=i.toString();this.idIndex_[s]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[s]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[r]=t;this.changed(),this.dispatchEvent(new VectorSourceEvent(_VectorEventType.default.CHANGEFEATURE,t))},t.prototype.hasFeature=function(e){var t=e.getId();return void 0!==t?t in this.idIndex_:(0,_util.getUid)(e)in this.uidIndex_},t.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&(0,_obj.isEmpty)(this.nullGeometryFeatures_)},t.prototype.loadFeatures=function(e,t,r){var n=this.loadedExtentsRtree_,o=this.strategy_(e,t);this.loading=!1;for(var i=function(e,i){var a=o[e];n.forEachInExtent(a,function(e){return(0,_extent.containsExtent)(e.extent,a)})||(s.loader_.call(s,a,t,r),n.insert(a,{extent:a.slice()}),s.loading=s.loader_!==_functions.VOID)},s=this,a=0,u=o.length;a<u;++a)i(a)},t.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),e.prototype.refresh.call(this)},t.prototype.removeLoadedExtent=function(e){var t,r=this.loadedExtentsRtree_;r.forEachInExtent(e,function(r){if((0,_extent.equals)(r.extent,e))return t=r,!0}),t&&r.remove(t)},t.prototype.removeFeature=function(e){var t=(0,_util.getUid)(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e),this.changed()},t.prototype.removeFeatureInternal=function(e){var t=(0,_util.getUid)(e);this.featureChangeKeys_[t].forEach(_events.unlistenByKey),delete this.featureChangeKeys_[t];var r=e.getId();void 0!==r&&delete this.idIndex_[r.toString()],delete this.uidIndex_[t],this.dispatchEvent(new VectorSourceEvent(_VectorEventType.default.REMOVEFEATURE,e))},t.prototype.removeFromIdIndex_=function(e){var t=!1;for(var r in this.idIndex_)if(this.idIndex_[r]===e){delete this.idIndex_[r],t=!0;break}return t},t.prototype.setLoader=function(e){this.loader_=e},t.prototype.setUrl=function(e){(0,_asserts.assert)(this.format_,7),this.setLoader((0,_featureloader.xhr)(e,this.format_))},t}(_Source.default),_default=VectorSource;exports.default=_default;

},{"../Collection.js":10,"../CollectionEventType.js":11,"../ObjectEventType.js":29,"../array.js":44,"../asserts.js":45,"../events.js":64,"../events/Event.js":65,"../events/EventType.js":66,"../extent.js":70,"../featureloader.js":73,"../functions.js":125,"../loadingstrategy.js":200,"../obj.js":203,"../structs/RBush.js":290,"../util.js":313,"./Source.js":265,"./State.js":267,"./VectorEventType.js":278}],278:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"};exports.default=_default;

},{}],279:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultLoadFunction=defaultLoadFunction,exports.default=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_VectorTile=_interopRequireDefault(require("../VectorTile.js")),_TileCache=_interopRequireDefault(require("../TileCache.js")),_TileState=_interopRequireDefault(require("../TileState.js")),_UrlTile=_interopRequireDefault(require("./UrlTile.js")),_VectorRenderTile=_interopRequireDefault(require("../VectorRenderTile.js")),_extent=require("../extent.js"),_tilegrid=require("../tilegrid.js"),_array=require("../array.js"),_tilecoord=require("../tilecoord.js"),_featureloader=require("../featureloader.js"),_size=require("../size.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),VectorTile=function(e){function t(t){var i=this,r=t.projection||"EPSG:3857",o=t.extent||(0,_tilegrid.extentFromProjection)(r),l=t.tileGrid||(0,_tilegrid.createXYZ)({extent:o,maxResolution:t.maxResolution,maxZoom:void 0!==t.maxZoom?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});return(i=e.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,opaque:!1,projection:r,state:t.state,tileGrid:l,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:defaultLoadFunction,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,zDirection:void 0===t.zDirection?1:t.zDirection})||this).format_=t.format?t.format:null,i.loadingTiles_={},i.sourceTileCache=new _TileCache.default(i.tileCache.highWaterMark),i.overlaps_=null==t.overlaps||t.overlaps,i.tileClass=t.tileClass?t.tileClass:_VectorTile.default,i.tileGrids_={},i}return __extends(t,e),t.prototype.getFeaturesInExtent=function(e){var t=[],i=this.tileCache;if(0===i.getCount())return t;var r=(0,_tilecoord.fromKey)(i.peekFirstKey())[0],o=this.tileGrid;return i.forEach(function(i){if(i.tileCoord[0]===r&&i.getState()===_TileState.default.LOADED)for(var l=i.getSourceTiles(),a=0,n=l.length;a<n;++a){var u=l[a],s=u.tileCoord;if((0,_extent.intersects)(e,o.getTileCoordExtent(s))){var c=u.getFeatures();if(c)for(var d=0,f=c.length;d<f;++d){var h=c[d],_=h.getGeometry();(0,_extent.intersects)(e,_.getExtent())&&t.push(h)}}}}),t},t.prototype.getOverlaps=function(){return this.overlaps_},t.prototype.clear=function(){this.tileCache.clear(),this.sourceTileCache.clear()},t.prototype.expireCache=function(t,i){e.prototype.expireCache.call(this,t,i),this.sourceTileCache.expireCache({})},t.prototype.getSourceTiles=function(e,t,i){var r=i.wrappedTileCoord,o=this.getTileGridForProjection(t),l=o.getTileCoordExtent(r),a=r[0],n=o.getResolution(a);(0,_extent.buffer)(l,-n,l);var u=this.tileGrid,s=u.getExtent();s&&(0,_extent.getIntersection)(l,s,l);var c,d,f,h=u.getZForResolution(n,1),_=u.getMinZoom(),T=i.sourceTiles;if(T&&T.length>0&&T[0].tileCoord[0]===h)c=T,d=!0,f=h;else{c=[],f=h+1;do{--f,d=!0,u.forEachTileCoord(l,f,function(r){var o,l=this.tileUrlFunction(r,e,t);if(void 0!==l)if(this.sourceTileCache.containsKey(l)){var a=(o=this.sourceTileCache.get(l)).getState();if(a===_TileState.default.LOADED||a===_TileState.default.ERROR||a===_TileState.default.EMPTY)return void c.push(o)}else f===h&&((o=new this.tileClass(r,_TileState.default.IDLE,l,this.format_,this.tileLoadFunction)).extent=u.getTileCoordExtent(r),o.projection=t,o.resolution=u.getResolution(r[0]),this.sourceTileCache.set(l,o),o.addEventListener(_EventType.default.CHANGE,this.handleTileChange.bind(this)),o.load());d=d&&o&&o.getState()===_TileState.default.LOADED,o&&o.getState()!==_TileState.default.EMPTY&&i.getState()===_TileState.default.IDLE&&(i.loadingSourceTiles++,o.addEventListener(_EventType.default.CHANGE,function e(){var t=o.getState(),r=o.getKey();if(t===_TileState.default.LOADED||t===_TileState.default.ERROR){t===_TileState.default.LOADED?(o.removeEventListener(_EventType.default.CHANGE,e),i.loadingSourceTiles--,delete i.errorSourceTileKeys[r]):t===_TileState.default.ERROR&&(i.errorSourceTileKeys[r]=!0);var l=Object.keys(i.errorSourceTileKeys).length;i.loadingSourceTiles-l==0&&(i.hifi=0===l,i.sourceZ=h,i.setState(_TileState.default.LOADED))}}))}.bind(this)),d||(c.length=0)}while(!d&&f>_)}return i.getState()===_TileState.default.IDLE&&i.setState(_TileState.default.LOADING),d&&(i.hifi=h===f,i.sourceZ=f,i.getState()<_TileState.default.LOADED?i.setState(_TileState.default.LOADED):T&&(0,_array.equals)(c,T)||(i.sourceTiles=c)),c},t.prototype.getTile=function(e,t,i,r,o){var l,a=(0,_tilecoord.getKeyZXY)(e,t,i),n=this.getKey();if(this.tileCache.containsKey(a)&&(l=this.tileCache.get(a)).key===n)return l;var u=[e,t,i],s=this.getTileCoordForTileUrlFunction(u,o),c=this.getTileGrid().getExtent(),d=this.getTileGridForProjection(o);if(s&&c){var f=d.getTileCoordExtent(s);(0,_extent.buffer)(f,-d.getResolution(e),f),(0,_extent.intersects)(c,f)||(s=null)}var h=!0;if(null!==s){var _=this.tileGrid,T=d.getResolution(e),p=_.getZForResolution(T,1),g=d.getTileCoordExtent(s);(0,_extent.buffer)(g,-T,g),_.forEachTileCoord(g,p,function(e){h=h&&!this.tileUrlFunction(e,r,o)}.bind(this))}var v=new _VectorRenderTile.default(u,h?_TileState.default.EMPTY:_TileState.default.IDLE,s,this.getSourceTiles.bind(this,r,o));return v.key=n,l?(v.interimTile=l,v.refreshInterimChain(),this.tileCache.replace(a,v)):this.tileCache.set(a,v),v},t.prototype.getTileGridForProjection=function(e){var t=e.getCode(),i=this.tileGrids_[t];if(!i){var r=this.tileGrid;i=(0,_tilegrid.createForProjection)(e,void 0,r?r.getTileSize(r.getMinZoom()):void 0),this.tileGrids_[t]=i}return i},t.prototype.getTilePixelRatio=function(e){return e},t.prototype.getTilePixelSize=function(e,t,i){var r=this.getTileGridForProjection(i),o=(0,_size.toSize)(r.getTileSize(e),this.tmpSize);return[Math.round(o[0]*t),Math.round(o[1]*t)]},t.prototype.updateCacheSize=function(t,i){e.prototype.updateCacheSize.call(this,2*t,i)},t}(_UrlTile.default),_default=VectorTile;function defaultLoadFunction(e,t){var i=(0,_featureloader.loadFeaturesXhr)(t,e.getFormat(),e.onLoad.bind(e),e.onError.bind(e));e.setLoader(i)}exports.default=_default;

},{"../TileCache.js":35,"../TileState.js":38,"../VectorRenderTile.js":39,"../VectorTile.js":40,"../array.js":44,"../events/EventType.js":66,"../extent.js":70,"../featureloader.js":73,"../size.js":251,"../tilecoord.js":305,"../tilegrid.js":306,"./UrlTile.js":276}],280:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={CARMENTA_SERVER:"carmentaserver",GEOSERVER:"geoserver",MAPSERVER:"mapserver",QGIS:"qgis"};exports.default=_default;

},{}],281:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.optionsFromCapabilities=optionsFromCapabilities,exports.default=void 0;var _TileImage=_interopRequireDefault(require("./TileImage.js")),_WMTSRequestEncoding=_interopRequireDefault(require("./WMTSRequestEncoding.js")),_uri=require("../uri.js"),_obj=require("../obj.js"),_WMTS=require("../tilegrid/WMTS.js"),_tileurlfunction=require("../tileurlfunction.js"),_proj=require("../proj.js"),_array=require("../array.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),WMTS=function(e){function t(t){var i=this,r=void 0!==t.requestEncoding?t.requestEncoding:_WMTSRequestEncoding.default.KVP,n=t.tileGrid,o=t.urls;return void 0===o&&void 0!==t.url&&(o=(0,_tileurlfunction.expandUrl)(t.url)),(i=e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,imageSmoothing:t.imageSmoothing,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:o,wrapX:void 0!==t.wrapX&&t.wrapX,transition:t.transition})||this).version_=void 0!==t.version?t.version:"1.0.0",i.format_=void 0!==t.format?t.format:"image/jpeg",i.dimensions_=void 0!==t.dimensions?t.dimensions:{},i.layer_=t.layer,i.matrixSet_=t.matrixSet,i.style_=t.style,i.requestEncoding_=r,i.setKey(i.getKeyForDimensions_()),o&&o.length>0&&(i.tileUrlFunction=(0,_tileurlfunction.createFromTileUrlFunctions)(o.map(i.createFromWMTSTemplate.bind(i)))),i}return __extends(t,e),t.prototype.setUrls=function(e){this.urls=e;var t=e.join("\n");this.setTileUrlFunction((0,_tileurlfunction.createFromTileUrlFunctions)(e.map(this.createFromWMTSTemplate.bind(this))),t)},t.prototype.getDimensions=function(){return this.dimensions_},t.prototype.getFormat=function(){return this.format_},t.prototype.getLayer=function(){return this.layer_},t.prototype.getMatrixSet=function(){return this.matrixSet_},t.prototype.getRequestEncoding=function(){return this.requestEncoding_},t.prototype.getStyle=function(){return this.style_},t.prototype.getVersion=function(){return this.version_},t.prototype.getKeyForDimensions_=function(){var e=0,t=[];for(var i in this.dimensions_)t[e++]=i+"-"+this.dimensions_[i];return t.join("/")},t.prototype.updateDimensions=function(e){(0,_obj.assign)(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())},t.prototype.createFromWMTSTemplate=function(e){var t=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t==_WMTSRequestEncoding.default.KVP&&(0,_obj.assign)(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t==_WMTSRequestEncoding.default.KVP?(0,_uri.appendParams)(e,i):e.replace(/\{(\w+?)\}/g,function(e,t){return t.toLowerCase()in i?i[t.toLowerCase()]:e});var r=this.tileGrid,n=this.dimensions_;return function(i,o,a){if(i){var s={TileMatrix:r.getMatrixId(i[0]),TileCol:i[1],TileRow:i[2]};(0,_obj.assign)(s,n);var u=e;return u=t==_WMTSRequestEncoding.default.KVP?(0,_uri.appendParams)(u,s):u.replace(/\{(\w+?)\}/g,function(e,t){return s[t]})}}},t}(_TileImage.default),_default=WMTS;function optionsFromCapabilities(e,t){var i=e.Contents.Layer,r=(0,_array.find)(i,function(e,i,r){return e.Identifier==t.layer});if(null===r)return null;var n,o=e.Contents.TileMatrixSet;(n=r.TileMatrixSetLink.length>1?"projection"in t?(0,_array.findIndex)(r.TileMatrixSetLink,function(e,i,r){var n=(0,_array.find)(o,function(t){return t.Identifier==e.TileMatrixSet}).SupportedCRS,a=(0,_proj.get)(n.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||(0,_proj.get)(n),s=(0,_proj.get)(t.projection);return a&&s?(0,_proj.equivalent)(a,s):n==t.projection}):(0,_array.findIndex)(r.TileMatrixSetLink,function(e,i,r){return e.TileMatrixSet==t.matrixSet}):0)<0&&(n=0);var a=r.TileMatrixSetLink[n].TileMatrixSet,s=r.TileMatrixSetLink[n].TileMatrixSetLimits,u=r.Format[0];"format"in t&&(u=t.format),(n=(0,_array.findIndex)(r.Style,function(e,i,r){return"style"in t?e.Title==t.style:e.isDefault}))<0&&(n=0);var l=r.Style[n].Identifier,c={};"Dimension"in r&&r.Dimension.forEach(function(e,t,i){var r=e.Identifier,n=e.Default;void 0===n&&(n=e.Value[0]),c[r]=n});var f,p=e.Contents.TileMatrixSet,d=(0,_array.find)(p,function(e,t,i){return e.Identifier==a}),_=d.SupportedCRS;if(_&&(f=(0,_proj.get)(_.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||(0,_proj.get)(_)),"projection"in t){var T=(0,_proj.get)(t.projection);T&&(f&&!(0,_proj.equivalent)(T,f)||(f=T))}var g="ne"==f.getAxisOrientation().substr(0,2),m=d.TileMatrix[0],y={MinTileCol:0,MinTileRow:0,MaxTileCol:m.MatrixWidth-1,MaxTileRow:m.MatrixHeight-1};s&&(y=s[s.length-1],m=(0,_array.find)(d.TileMatrix,function(e){return e.Identifier===y.TileMatrix}));var h=28e-5*m.ScaleDenominator/f.getMetersPerUnit(),M=g?[m.TopLeftCorner[1],m.TopLeftCorner[0]]:m.TopLeftCorner,S=m.TileWidth*h,x=m.TileHeight*h,v=[M[0]+S*y.MinTileCol,M[1]-x*(1+y.MaxTileRow),M[0]+S*(1+y.MaxTileCol),M[1]-x*y.MinTileRow];null===f.getExtent()&&f.setExtent(v);var j=(0,_WMTS.createFromCapabilitiesMatrixSet)(d,v,s),q=[],R=t.requestEncoding;if(R=void 0!==R?R:"","OperationsMetadata"in e&&"GetTile"in e.OperationsMetadata)for(var E=e.OperationsMetadata.GetTile.DCP.HTTP.Get,C=0,F=E.length;C<F;++C)if(E[C].Constraint){var W=(0,_array.find)(E[C].Constraint,function(e){return"GetEncoding"==e.name}).AllowedValues.Value;if(""===R&&(R=W[0]),R!==_WMTSRequestEncoding.default.KVP)break;(0,_array.includes)(W,_WMTSRequestEncoding.default.KVP)&&q.push(E[C].href)}else E[C].href&&(R=_WMTSRequestEncoding.default.KVP,q.push(E[C].href));return 0===q.length&&(R=_WMTSRequestEncoding.default.REST,r.ResourceURL.forEach(function(e){"tile"===e.resourceType&&(u=e.format,q.push(e.template))})),{urls:q,layer:t.layer,matrixSet:a,format:u,projection:f,requestEncoding:R,tileGrid:j,style:l,dimensions:c,wrapX:!1,crossOrigin:t.crossOrigin}}exports.default=_default;

},{"../array.js":44,"../obj.js":203,"../proj.js":205,"../tilegrid/WMTS.js":308,"../tileurlfunction.js":310,"../uri.js":312,"./TileImage.js":272,"./WMTSRequestEncoding.js":282}],282:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={KVP:"KVP",REST:"REST"};exports.default=_default;

},{}],283:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _TileImage=_interopRequireDefault(require("./TileImage.js")),_tilegrid=require("../tilegrid.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),XYZ=function(t){function e(e){var i=e||{},o=void 0!==i.projection?i.projection:"EPSG:3857",r=void 0!==i.tileGrid?i.tileGrid:(0,_tilegrid.createXYZ)({extent:(0,_tilegrid.extentFromProjection)(o),maxResolution:i.maxResolution,maxZoom:i.maxZoom,minZoom:i.minZoom,tileSize:i.tileSize});return t.call(this,{attributions:i.attributions,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,imageSmoothing:i.imageSmoothing,opaque:i.opaque,projection:o,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileGrid:r,tileLoadFunction:i.tileLoadFunction,tilePixelRatio:i.tilePixelRatio,tileUrlFunction:i.tileUrlFunction,url:i.url,urls:i.urls,wrapX:void 0===i.wrapX||i.wrapX,transition:i.transition,attributionsCollapsible:i.attributionsCollapsible,zDirection:i.zDirection})||this}return __extends(e,t),e}(_TileImage.default),_default=XYZ;exports.default=_default;

},{"../tilegrid.js":306,"./TileImage.js":272}],284:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.CustomTile=void 0;var _common=require("../tilegrid/common.js"),_ImageTile=_interopRequireDefault(require("../ImageTile.js")),_TileGrid=_interopRequireDefault(require("../tilegrid/TileGrid.js")),_TileImage=_interopRequireDefault(require("./TileImage.js")),_TileState=_interopRequireDefault(require("../TileState.js")),_asserts=require("../asserts.js"),_dom=require("../dom.js"),_tileurlfunction=require("../tileurlfunction.js"),_extent=require("../extent.js"),_size=require("../size.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),TierSizeCalculation={DEFAULT:"default",TRUNCATED:"truncated"},CustomTile=function(e){function t(t,i,r,o,n,a,l){var u=e.call(this,i,r,o,n,a,l)||this;return u.zoomifyImage_=null,u.tileSize_=t,u}return __extends(t,e),t.prototype.getImage=function(){if(this.zoomifyImage_)return this.zoomifyImage_;var t=e.prototype.getImage.call(this);if(this.state==_TileState.default.LOADED){var i=this.tileSize_;if(t.width==i[0]&&t.height==i[1])return this.zoomifyImage_=t,t;var r=(0,_dom.createCanvasContext2D)(i[0],i[1]);return r.drawImage(t,0,0),this.zoomifyImage_=r.canvas,r.canvas}return t},t}(_ImageTile.default);exports.CustomTile=CustomTile;var Zoomify=function(e){function t(t){var i=this,r=t,o=r.size,n=void 0!==r.tierSizeCalculation?r.tierSizeCalculation:TierSizeCalculation.DEFAULT,a=r.tilePixelRatio||1,l=o[0],u=o[1],s=[],c=r.tileSize||_common.DEFAULT_TILE_SIZE,f=c*a;switch(n){case TierSizeCalculation.DEFAULT:for(;l>f||u>f;)s.push([Math.ceil(l/f),Math.ceil(u/f)]),f+=f;break;case TierSizeCalculation.TRUNCATED:for(var _=l,d=u;_>f||d>f;)s.push([Math.ceil(_/f),Math.ceil(d/f)]),_>>=1,d>>=1;break;default:(0,_asserts.assert)(!1,53)}s.push([1,1]),s.reverse();for(var m=[a],p=[0],h=1,T=s.length;h<T;h++)m.push(a<<h),p.push(s[h-1][0]*s[h-1][1]+p[h-1]);m.reverse();var g=new _TileGrid.default({tileSize:c,extent:r.extent||[0,-u,l,0],resolutions:m}),v=r.url;v&&-1==v.indexOf("{TileGroup}")&&-1==v.indexOf("{tileIndex}")&&(v+="{TileGroup}/{z}-{x}-{y}.jpg");var z=(0,_tileurlfunction.expandUrl)(v),x=c*a;var C=(0,_tileurlfunction.createFromTileUrlFunctions)(z.map(function(e){return function(t,i,r){if(t){var o=t[0],n=t[1],a=t[2],l=n+a*s[o][0],u={z:o,x:n,y:a,tileIndex:l,TileGroup:"TileGroup"+((l+p[o])/x|0)};return e.replace(/\{(\w+?)\}/g,function(e,t){return u[t]})}}})),I=CustomTile.bind(null,(0,_size.toSize)(c*a));(i=e.call(this,{attributions:r.attributions,cacheSize:r.cacheSize,crossOrigin:r.crossOrigin,imageSmoothing:r.imageSmoothing,projection:r.projection,tilePixelRatio:a,reprojectionErrorThreshold:r.reprojectionErrorThreshold,tileClass:I,tileGrid:g,tileUrlFunction:C,transition:r.transition})||this).zDirection=r.zDirection;var S=C(g.getTileCoordForCoordAndResolution((0,_extent.getCenter)(g.getExtent()),m[m.length-1]),1,null),j=new Image;return j.addEventListener("error",function(){x=c,this.changed()}.bind(i)),j.src=S,i}return __extends(t,e),t}(_TileImage.default),_default=Zoomify;exports.default=_default;

},{"../ImageTile.js":19,"../TileState.js":38,"../asserts.js":45,"../dom.js":62,"../extent.js":70,"../size.js":251,"../tilegrid/TileGrid.js":307,"../tilegrid/common.js":309,"../tileurlfunction.js":310,"./TileImage.js":272}],285:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.IMAGE_SMOOTHING_DISABLED=exports.DEFAULT_WMS_VERSION=void 0;var DEFAULT_WMS_VERSION="1.3.0";exports.DEFAULT_WMS_VERSION=DEFAULT_WMS_VERSION;var IMAGE_SMOOTHING_DISABLED={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1};exports.IMAGE_SMOOTHING_DISABLED=IMAGE_SMOOTHING_DISABLED;

},{}],286:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDistance=getDistance,exports.getLength=getLength,exports.getArea=getArea,exports.offset=offset,exports.DEFAULT_RADIUS=void 0;var _GeometryType=_interopRequireDefault(require("./geom/GeometryType.js")),_math=require("./math.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var DEFAULT_RADIUS=6371008.8;function getDistance(e,t,a){var r=a||DEFAULT_RADIUS,n=(0,_math.toRadians)(e[1]),o=(0,_math.toRadians)(t[1]),s=(o-n)/2,h=(0,_math.toRadians)(t[0]-e[0])/2,_=Math.sin(s)*Math.sin(s)+Math.sin(h)*Math.sin(h)*Math.cos(n)*Math.cos(o);return 2*r*Math.atan2(Math.sqrt(_),Math.sqrt(1-_))}function getLengthInternal(e,t){for(var a=0,r=0,n=e.length;r<n-1;++r)a+=getDistance(e[r],e[r+1],t);return a}function getLength(e,t){var a=t||{},r=a.radius||DEFAULT_RADIUS,n=a.projection||"EPSG:3857",o=e.getType();o!==_GeometryType.default.GEOMETRY_COLLECTION&&(e=e.clone().transform(n,"EPSG:4326"));var s,h,_,i,g,T,f=0;switch(o){case _GeometryType.default.POINT:case _GeometryType.default.MULTI_POINT:break;case _GeometryType.default.LINE_STRING:case _GeometryType.default.LINEAR_RING:f=getLengthInternal(s=e.getCoordinates(),r);break;case _GeometryType.default.MULTI_LINE_STRING:case _GeometryType.default.POLYGON:for(_=0,i=(s=e.getCoordinates()).length;_<i;++_)f+=getLengthInternal(s[_],r);break;case _GeometryType.default.MULTI_POLYGON:for(_=0,i=(s=e.getCoordinates()).length;_<i;++_)for(g=0,T=(h=s[_]).length;g<T;++g)f+=getLengthInternal(h[g],r);break;case _GeometryType.default.GEOMETRY_COLLECTION:var u=e.getGeometries();for(_=0,i=u.length;_<i;++_)f+=getLength(u[_],t);break;default:throw new Error("Unsupported geometry type: "+o)}return f}function getAreaInternal(e,t){for(var a=0,r=e.length,n=e[r-1][0],o=e[r-1][1],s=0;s<r;s++){var h=e[s][0],_=e[s][1];a+=(0,_math.toRadians)(h-n)*(2+Math.sin((0,_math.toRadians)(o))+Math.sin((0,_math.toRadians)(_))),n=h,o=_}return a*t*t/2}function getArea(e,t){var a=t||{},r=a.radius||DEFAULT_RADIUS,n=a.projection||"EPSG:3857",o=e.getType();o!==_GeometryType.default.GEOMETRY_COLLECTION&&(e=e.clone().transform(n,"EPSG:4326"));var s,h,_,i,g,T,f=0;switch(o){case _GeometryType.default.POINT:case _GeometryType.default.MULTI_POINT:case _GeometryType.default.LINE_STRING:case _GeometryType.default.MULTI_LINE_STRING:case _GeometryType.default.LINEAR_RING:break;case _GeometryType.default.POLYGON:for(s=e.getCoordinates(),f=Math.abs(getAreaInternal(s[0],r)),_=1,i=s.length;_<i;++_)f-=Math.abs(getAreaInternal(s[_],r));break;case _GeometryType.default.MULTI_POLYGON:for(_=0,i=(s=e.getCoordinates()).length;_<i;++_)for(h=s[_],f+=Math.abs(getAreaInternal(h[0],r)),g=1,T=h.length;g<T;++g)f-=Math.abs(getAreaInternal(h[g],r));break;case _GeometryType.default.GEOMETRY_COLLECTION:var u=e.getGeometries();for(_=0,i=u.length;_<i;++_)f+=getArea(u[_],t);break;default:throw new Error("Unsupported geometry type: "+o)}return f}function offset(e,t,a,r){var n=r||DEFAULT_RADIUS,o=(0,_math.toRadians)(e[1]),s=(0,_math.toRadians)(e[0]),h=t/n,_=Math.asin(Math.sin(o)*Math.cos(h)+Math.cos(o)*Math.sin(h)*Math.cos(a)),i=s+Math.atan2(Math.sin(a)*Math.sin(h)*Math.cos(o),Math.cos(h)-Math.sin(o)*Math.sin(_));return[(0,_math.toDegrees)(i),(0,_math.toDegrees)(_)]}exports.DEFAULT_RADIUS=DEFAULT_RADIUS;

},{"./geom/GeometryType.js":131,"./math.js":201}],287:[function(require,module,exports){
"use strict";function padNumber(e,r,t){var n=void 0!==t?e.toFixed(t):""+e,o=n.indexOf(".");return(o=-1===o?n.length:o)>r?n:new Array(1+r-o).join("0")+n}function compareVersions(e,r){for(var t=(""+e).split("."),n=(""+r).split("."),o=0;o<Math.max(t.length,n.length);o++){var s=parseInt(t[o]||"0",10),a=parseInt(n[o]||"0",10);if(s>a)return 1;if(a>s)return-1}return 0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.padNumber=padNumber,exports.compareVersions=compareVersions;

},{}],288:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _asserts=require("../asserts.js"),LRUCache=function(){function e(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return e.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},e.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},e.prototype.containsKey=function(e){return this.entries_.hasOwnProperty(e)},e.prototype.forEach=function(e){for(var t=this.oldest_;t;)e(t.value_,t.key_,this),t=t.newer},e.prototype.get=function(e,t){var s=this.entries_[e];return(0,_asserts.assert)(void 0!==s,15),s===this.newest_?s.value_:(s===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(s.newer.older=s.older,s.older.newer=s.newer),s.newer=null,s.older=this.newest_,this.newest_.newer=s,this.newest_=s,s.value_)},e.prototype.remove=function(e){var t=this.entries_[e];return(0,_asserts.assert)(void 0!==t,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_},e.prototype.getCount=function(){return this.count_},e.prototype.getKeys=function(){var e,t=new Array(this.count_),s=0;for(e=this.newest_;e;e=e.older)t[s++]=e.key_;return t},e.prototype.getValues=function(){var e,t=new Array(this.count_),s=0;for(e=this.newest_;e;e=e.older)t[s++]=e.value_;return t},e.prototype.peekLast=function(){return this.oldest_.value_},e.prototype.peekLastKey=function(){return this.oldest_.key_},e.prototype.peekFirstKey=function(){return this.newest_.key_},e.prototype.pop=function(){var e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_},e.prototype.replace=function(e,t){this.get(e),this.entries_[e].value_=t},e.prototype.set=function(e,t){(0,_asserts.assert)(!(e in this.entries_),16);var s={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=s:this.oldest_=s,this.newest_=s,this.entries_[e]=s,++this.count_},e.prototype.setSize=function(e){this.highWaterMark=e},e}(),_default=LRUCache;exports.default=_default;

},{"../asserts.js":45}],289:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.DROP=void 0;var _asserts=require("../asserts.js"),_obj=require("../obj.js"),DROP=1/0;exports.DROP=DROP;var PriorityQueue=function(){function t(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return t.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,(0,_obj.clear)(this.queuedElements_)},t.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,i=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));var n=this.keyFunction_(i);return delete this.queuedElements_[n],i},t.prototype.enqueue=function(t){(0,_asserts.assert)(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=DROP&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},t.prototype.getCount=function(){return this.elements_.length},t.prototype.getLeftChildIndex_=function(t){return 2*t+1},t.prototype.getRightChildIndex_=function(t){return 2*t+2},t.prototype.getParentIndex_=function(t){return t-1>>1},t.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)},t.prototype.isEmpty=function(){return 0===this.elements_.length},t.prototype.isKeyQueued=function(t){return t in this.queuedElements_},t.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))},t.prototype.siftUp_=function(t){for(var e=this.elements_,i=this.priorities_,n=e.length,s=e[t],r=i[t],o=t;t<n>>1;){var u=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),p=h<n&&i[h]<i[u]?h:u;e[t]=e[p],i[t]=i[p],t=p}e[t]=s,i[t]=r,this.siftDown_(o,t)},t.prototype.siftDown_=function(t,e){for(var i=this.elements_,n=this.priorities_,s=i[e],r=n[e];e>t;){var o=this.getParentIndex_(e);if(!(n[o]>r))break;i[e]=i[o],n[e]=n[o],e=o}i[e]=s,n[e]=r},t.prototype.reprioritize=function(){var t,e,i,n=this.priorityFunction_,s=this.elements_,r=this.priorities_,o=0,u=s.length;for(e=0;e<u;++e)(i=n(t=s[e]))==DROP?delete this.queuedElements_[this.keyFunction_(t)]:(r[o]=i,s[o++]=t);s.length=o,r.length=o,this.heapify_()},t}(),_default=PriorityQueue;exports.default=_default;

},{"../asserts.js":45,"../obj.js":203}],290:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _rbush=_interopRequireDefault(require("rbush/rbush.js")),_extent=require("../extent.js"),_util=require("../util.js"),_obj=require("../obj.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var RBush=function(){function t(t){this.rbush_=new _rbush.default(t),this.items_={}}return t.prototype.insert=function(t,e){var r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(r),this.items_[(0,_util.getUid)(e)]=r},t.prototype.load=function(t,e){for(var r=new Array(e.length),i=0,n=e.length;i<n;i++){var u=t[i],o=e[i],s={minX:u[0],minY:u[1],maxX:u[2],maxY:u[3],value:o};r[i]=s,this.items_[(0,_util.getUid)(o)]=s}this.rbush_.load(r)},t.prototype.remove=function(t){var e=(0,_util.getUid)(t),r=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(r)},t.prototype.update=function(t,e){var r=this.items_[(0,_util.getUid)(e)],i=[r.minX,r.minY,r.maxX,r.maxY];(0,_extent.equals)(i,t)||(this.remove(e),this.insert(t,e))},t.prototype.getAll=function(){return this.rbush_.all().map(function(t){return t.value})},t.prototype.getInExtent=function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(t){return t.value})},t.prototype.forEach=function(t){return this.forEach_(this.getAll(),t)},t.prototype.forEachInExtent=function(t,e){return this.forEach_(this.getInExtent(t),e)},t.prototype.forEach_=function(t,e){for(var r,i=0,n=t.length;i<n;i++)if(r=e(t[i]))return r;return r},t.prototype.isEmpty=function(){return(0,_obj.isEmpty)(this.items_)},t.prototype.clear=function(){this.rbush_.clear(),this.items_={}},t.prototype.getExtent=function(t){var e=this.rbush_.toJSON();return(0,_extent.createOrUpdate)(e.minX,e.minY,e.maxX,e.maxY,t)},t.prototype.concat=function(t){for(var e in this.rbush_.load(t.rbush_.all()),t.items_)this.items_[e]=t.items_[e]},t}(),_default=RBush;exports.default=_default;

},{"../extent.js":70,"../obj.js":203,"../util.js":313,"rbush/rbush.js":324}],291:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"Circle",{enumerable:!0,get:function(){return _Circle.default}}),Object.defineProperty(exports,"Fill",{enumerable:!0,get:function(){return _Fill.default}}),Object.defineProperty(exports,"Icon",{enumerable:!0,get:function(){return _Icon.default}}),Object.defineProperty(exports,"IconImage",{enumerable:!0,get:function(){return _IconImage.default}}),Object.defineProperty(exports,"Image",{enumerable:!0,get:function(){return _Image.default}}),Object.defineProperty(exports,"RegularShape",{enumerable:!0,get:function(){return _RegularShape.default}}),Object.defineProperty(exports,"Stroke",{enumerable:!0,get:function(){return _Stroke.default}}),Object.defineProperty(exports,"Style",{enumerable:!0,get:function(){return _Style.default}}),Object.defineProperty(exports,"Text",{enumerable:!0,get:function(){return _Text.default}});var _Circle=_interopRequireDefault(require("./style/Circle.js")),_Fill=_interopRequireDefault(require("./style/Fill.js")),_Icon=_interopRequireDefault(require("./style/Icon.js")),_IconImage=_interopRequireDefault(require("./style/IconImage.js")),_Image=_interopRequireDefault(require("./style/Image.js")),_RegularShape=_interopRequireDefault(require("./style/RegularShape.js")),_Stroke=_interopRequireDefault(require("./style/Stroke.js")),_Style=_interopRequireDefault(require("./style/Style.js")),_Text=_interopRequireDefault(require("./style/Text.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}

},{"./style/Circle.js":292,"./style/Fill.js":293,"./style/Icon.js":294,"./style/IconImage.js":296,"./style/Image.js":299,"./style/RegularShape.js":300,"./style/Stroke.js":301,"./style/Style.js":302,"./style/Text.js":303}],292:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _RegularShape=_interopRequireDefault(require("./RegularShape.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),CircleStyle=function(e){function t(t){var r=t||{};return e.call(this,{points:1/0,fill:r.fill,radius:r.radius,stroke:r.stroke,displacement:void 0!==r.displacement?r.displacement:[0,0]})||this}return __extends(t,e),t.prototype.clone=function(){var e=new t({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),displacement:this.getDisplacement().slice()});return e.setOpacity(this.getOpacity()),e.setScale(this.getScale()),e},t.prototype.setRadius=function(e){this.radius_=e,this.render()},t}(_RegularShape.default),_default=CircleStyle;exports.default=_default;

},{"./RegularShape.js":300}],293:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Fill=function(){function o(o){var t=o||{};this.color_=void 0!==t.color?t.color:null}return o.prototype.clone=function(){var t=this.getColor();return new o({color:Array.isArray(t)?t.slice():t||void 0})},o.prototype.getColor=function(){return this.color_},o.prototype.setColor=function(o){this.color_=o},o}(),_default=Fill;exports.default=_default;

},{}],294:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _EventType=_interopRequireDefault(require("../events/EventType.js")),_IconAnchorUnits=_interopRequireDefault(require("./IconAnchorUnits.js")),_IconOrigin=_interopRequireDefault(require("./IconOrigin.js")),_ImageState=_interopRequireDefault(require("../ImageState.js")),_Image=_interopRequireDefault(require("./Image.js")),_color=require("../color.js"),_asserts=require("../asserts.js"),_IconImage=require("./IconImage.js"),_util=require("../util.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])})(i,e)};return function(i,e){function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Icon=function(t){function i(i){var e=this,n=i||{},o=void 0!==n.opacity?n.opacity:1,r=void 0!==n.rotation?n.rotation:0,s=void 0!==n.scale?n.scale:1,c=void 0!==n.rotateWithView&&n.rotateWithView;(e=t.call(this,{opacity:o,rotation:r,scale:s,displacement:void 0!==n.displacement?n.displacement:[0,0],rotateWithView:c})||this).anchor_=void 0!==n.anchor?n.anchor:[.5,.5],e.normalizedAnchor_=null,e.anchorOrigin_=void 0!==n.anchorOrigin?n.anchorOrigin:_IconOrigin.default.TOP_LEFT,e.anchorXUnits_=void 0!==n.anchorXUnits?n.anchorXUnits:_IconAnchorUnits.default.FRACTION,e.anchorYUnits_=void 0!==n.anchorYUnits?n.anchorYUnits:_IconAnchorUnits.default.FRACTION,e.crossOrigin_=void 0!==n.crossOrigin?n.crossOrigin:null;var a=void 0!==n.img?n.img:null,_=void 0!==n.imgSize?n.imgSize:null,h=n.src;(0,_asserts.assert)(!(void 0!==h&&a),4),(0,_asserts.assert)(!a||a&&_,5),void 0!==h&&0!==h.length||!a||(h=a.src||(0,_util.getUid)(a)),(0,_asserts.assert)(void 0!==h&&h.length>0,6);var u=void 0!==n.src?_ImageState.default.IDLE:_ImageState.default.LOADED;return e.color_=void 0!==n.color?(0,_color.asArray)(n.color):null,e.iconImage_=(0,_IconImage.get)(a,h,_,e.crossOrigin_,u,e.color_),e.offset_=void 0!==n.offset?n.offset:[0,0],e.offsetOrigin_=void 0!==n.offsetOrigin?n.offsetOrigin:_IconOrigin.default.TOP_LEFT,e.origin_=null,e.size_=void 0!==n.size?n.size:null,e}return __extends(i,t),i.prototype.clone=function(){var t=this.getScale();return new i({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},i.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var t=this.anchor_,i=this.getSize();if(this.anchorXUnits_==_IconAnchorUnits.default.FRACTION||this.anchorYUnits_==_IconAnchorUnits.default.FRACTION){if(!i)return null;t=this.anchor_.slice(),this.anchorXUnits_==_IconAnchorUnits.default.FRACTION&&(t[0]*=i[0]),this.anchorYUnits_==_IconAnchorUnits.default.FRACTION&&(t[1]*=i[1])}if(this.anchorOrigin_!=_IconOrigin.default.TOP_LEFT){if(!i)return null;t===this.anchor_&&(t=this.anchor_.slice()),this.anchorOrigin_!=_IconOrigin.default.TOP_RIGHT&&this.anchorOrigin_!=_IconOrigin.default.BOTTOM_RIGHT||(t[0]=-t[0]+i[0]),this.anchorOrigin_!=_IconOrigin.default.BOTTOM_LEFT&&this.anchorOrigin_!=_IconOrigin.default.BOTTOM_RIGHT||(t[1]=-t[1]+i[1])}return this.normalizedAnchor_=t,this.normalizedAnchor_},i.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},i.prototype.getColor=function(){return this.color_},i.prototype.getImage=function(t){return this.iconImage_.getImage(t)},i.prototype.getPixelRatio=function(t){return this.iconImage_.getPixelRatio(t)},i.prototype.getImageSize=function(){return this.iconImage_.getSize()},i.prototype.getHitDetectionImageSize=function(){return this.getImageSize()},i.prototype.getImageState=function(){return this.iconImage_.getImageState()},i.prototype.getHitDetectionImage=function(t){return this.iconImage_.getHitDetectionImage(t)},i.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_,i=this.getDisplacement();if(this.offsetOrigin_!=_IconOrigin.default.TOP_LEFT){var e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),this.offsetOrigin_!=_IconOrigin.default.TOP_RIGHT&&this.offsetOrigin_!=_IconOrigin.default.BOTTOM_RIGHT||(t[0]=n[0]-e[0]-t[0]),this.offsetOrigin_!=_IconOrigin.default.BOTTOM_LEFT&&this.offsetOrigin_!=_IconOrigin.default.BOTTOM_RIGHT||(t[1]=n[1]-e[1]-t[1])}return t[0]+=i[0],t[1]+=i[1],this.origin_=t,this.origin_},i.prototype.getSrc=function(){return this.iconImage_.getSrc()},i.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},i.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(_EventType.default.CHANGE,t)},i.prototype.load=function(){this.iconImage_.load()},i.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(_EventType.default.CHANGE,t)},i}(_Image.default),_default=Icon;exports.default=_default;

},{"../ImageState.js":18,"../asserts.js":45,"../color.js":47,"../events/EventType.js":66,"../util.js":313,"./IconAnchorUnits.js":295,"./IconImage.js":296,"./IconOrigin.js":298,"./Image.js":299}],295:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={FRACTION:"fraction",PIXELS:"pixels"};exports.default=_default;

},{}],296:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.get=get,exports.default=void 0;var _Target=_interopRequireDefault(require("../events/Target.js")),_EventType=_interopRequireDefault(require("../events/EventType.js")),_ImageState=_interopRequireDefault(require("../ImageState.js")),_dom=require("../dom.js"),_IconImageCache=require("./IconImageCache.js"),_Image=require("../Image.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),taintedTestContext=null,IconImage=function(t){function e(e,i,a,n,o,s){var r=t.call(this)||this;return r.hitDetectionImage_={},r.image_=e||new Image,null!==n&&(r.image_.crossOrigin=n),r.canvas_={},r.color_=s,r.unlisten_=null,r.imageState_=o,r.size_=a,r.src_=i,r.tainted_,r}return __extends(e,t),e.prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===_ImageState.default.LOADED){taintedTestContext||(taintedTestContext=(0,_dom.createCanvasContext2D)(1,1)),taintedTestContext.drawImage(this.image_,0,0);try{taintedTestContext.getImageData(0,0,1,1),this.tainted_=!1}catch(t){taintedTestContext=null,this.tainted_=!0}}return!0===this.tainted_},e.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(_EventType.default.CHANGE)},e.prototype.handleImageError_=function(){this.imageState_=_ImageState.default.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.handleImageLoad_=function(){this.imageState_=_ImageState.default.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},e.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},e.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},e.prototype.getImageState=function(){return this.imageState_},e.prototype.getHitDetectionImage=function(t){if(!this.hitDetectionImage_[t])if(this.isTainted_()){var e=this.color_?t:1,i=this.size_[0],a=this.size_[1],n=(0,_dom.createCanvasContext2D)(Math.ceil(i*e),Math.ceil(a*e));n.scale(e,e),n.fillRect(0,0,i,a),this.hitDetectionImage_[t]=n.canvas}else this.hitDetectionImage_[t]=this.image_;return this.hitDetectionImage_[t]},e.prototype.getSize=function(){return this.size_},e.prototype.getSrc=function(){return this.src_},e.prototype.load=function(){if(this.imageState_==_ImageState.default.IDLE){this.imageState_=_ImageState.default.LOADING;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=(0,_Image.listenImage)(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},e.prototype.replaceColor_=function(t){if(this.color_&&!this.canvas_[t]){var e=document.createElement("canvas");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);var i=e.getContext("2d");if(i.scale(t,t),i.drawImage(this.image_,0,0),this.isTainted_()){var a=this.color_;return i.globalCompositeOperation="multiply",i.fillStyle="rgb("+a[0]+","+a[1]+","+a[2]+")",i.fillRect(0,0,e.width,e.height),i.globalCompositeOperation="destination-in",void i.drawImage(this.image_,0,0)}for(var n=i.getImageData(0,0,e.width,e.height),o=n.data,s=this.color_[0]/255,r=this.color_[1]/255,_=this.color_[2]/255,h=0,c=o.length;h<c;h+=4)o[h]*=s,o[h+1]*=r,o[h+2]*=_;i.putImageData(n,0,0)}},e.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},e}(_Target.default);function get(t,e,i,a,n,o){var s=_IconImageCache.shared.get(e,a,o);return s||(s=new IconImage(t,e,i,a,n,o),_IconImageCache.shared.set(e,a,o,s)),s}var _default=IconImage;exports.default=_default;

},{"../Image.js":15,"../ImageState.js":18,"../dom.js":62,"../events/EventType.js":66,"../events/Target.js":68,"./IconImageCache.js":297}],297:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shared=exports.default=void 0;var _color=require("../color.js"),IconImageCache=function(){function e(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return e.prototype.clear=function(){this.cache_={},this.cacheSize_=0},e.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},e.prototype.expire=function(){if(this.canExpireCache()){var e=0;for(var t in this.cache_){var c=this.cache_[t];0!=(3&e++)||c.hasListener()||(delete this.cache_[t],--this.cacheSize_)}}},e.prototype.get=function(e,t,c){var a=getKey(e,t,c);return a in this.cache_?this.cache_[a]:null},e.prototype.set=function(e,t,c,a){var i=getKey(e,t,c);this.cache_[i]=a,++this.cacheSize_},e.prototype.setSize=function(e){this.maxCacheSize_=e,this.expire()},e}();function getKey(e,t,c){return t+":"+e+":"+(c?(0,_color.asString)(c):"null")}var _default=IconImageCache;exports.default=_default;var shared=new IconImageCache;exports.shared=shared;

},{"../color.js":47}],298:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"};exports.default=_default;

},{}],299:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _util=require("../util.js"),_size=require("../size.js"),ImageStyle=function(){function t(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=(0,_size.toSize)(t.scale),this.displacement_=t.displacement}return t.prototype.clone=function(){var e=this.getScale();return new t({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},t.prototype.getOpacity=function(){return this.opacity_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getScaleArray=function(){return this.scaleArray_},t.prototype.getDisplacement=function(){return this.displacement_},t.prototype.getAnchor=function(){return(0,_util.abstract)()},t.prototype.getImage=function(t){return(0,_util.abstract)()},t.prototype.getHitDetectionImage=function(t){return(0,_util.abstract)()},t.prototype.getPixelRatio=function(t){return 1},t.prototype.getImageState=function(){return(0,_util.abstract)()},t.prototype.getImageSize=function(){return(0,_util.abstract)()},t.prototype.getHitDetectionImageSize=function(){return(0,_util.abstract)()},t.prototype.getOrigin=function(){return(0,_util.abstract)()},t.prototype.getSize=function(){return(0,_util.abstract)()},t.prototype.setOpacity=function(t){this.opacity_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=(0,_size.toSize)(t)},t.prototype.listenImageChange=function(t){(0,_util.abstract)()},t.prototype.load=function(){(0,_util.abstract)()},t.prototype.unlistenImageChange=function(t){(0,_util.abstract)()},t}(),_default=ImageStyle;exports.default=_default;

},{"../size.js":251,"../util.js":313}],300:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _ImageState=_interopRequireDefault(require("../ImageState.js")),_Image=_interopRequireDefault(require("./Image.js")),_color=require("../color.js"),_colorlike=require("../colorlike.js"),_dom=require("../dom.js"),_canvas=require("../render/canvas.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var __extends=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),RegularShape=function(t){function e(e){var i=this,s=void 0!==e.rotateWithView&&e.rotateWithView;return(i=t.call(this,{opacity:1,rotateWithView:s,rotation:void 0!==e.rotation?e.rotation:0,scale:1,displacement:void 0!==e.displacement?e.displacement:[0,0]})||this).canvas_={},i.hitDetectionCanvas_={},i.fill_=void 0!==e.fill?e.fill:null,i.origin_=[0,0],i.points_=e.points,i.radius_=void 0!==e.radius?e.radius:e.radius1,i.radius2_=e.radius2,i.angle_=void 0!==e.angle?e.angle:0,i.stroke_=void 0!==e.stroke?e.stroke:null,i.anchor_=null,i.size_=null,i.imageSize_=null,i.hitDetectionImageSize_=null,i.render(),i}return __extends(e,t),e.prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t},e.prototype.getAnchor=function(){return this.anchor_},e.prototype.getAngle=function(){return this.angle_},e.prototype.getFill=function(){return this.fill_},e.prototype.getHitDetectionImage=function(t){if(!this.hitDetectionCanvas_[t||1]){var e=this.createRenderOptions();this.createHitDetectionCanvas_(e,t||1)}return this.hitDetectionCanvas_[t||1]},e.prototype.getImage=function(t){if(!this.canvas_[t||1]){var e=this.createRenderOptions(),i=(0,_dom.createCanvasContext2D)(e.size*t||1,e.size*t||1);this.draw_(e,i,0,0,t||1),this.canvas_[t||1]=i.canvas}return this.canvas_[t||1]},e.prototype.getPixelRatio=function(t){return t},e.prototype.getImageSize=function(){return this.imageSize_},e.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},e.prototype.getImageState=function(){return _ImageState.default.LOADED},e.prototype.getOrigin=function(){return this.origin_},e.prototype.getPoints=function(){return this.points_},e.prototype.getRadius=function(){return this.radius_},e.prototype.getRadius2=function(){return this.radius2_},e.prototype.getSize=function(){return this.size_},e.prototype.getStroke=function(){return this.stroke_},e.prototype.listenImageChange=function(t){},e.prototype.load=function(){},e.prototype.unlistenImageChange=function(t){},e.prototype.createRenderOptions=function(){var t,e=_canvas.defaultLineCap,i=_canvas.defaultLineJoin,s=0,a=null,n=0,o=0;return this.stroke_&&(null===(t=this.stroke_.getColor())&&(t=_canvas.defaultStrokeStyle),t=(0,_colorlike.asColorLike)(t),void 0===(o=this.stroke_.getWidth())&&(o=_canvas.defaultLineWidth),a=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset(),void 0===(i=this.stroke_.getLineJoin())&&(i=_canvas.defaultLineJoin),void 0===(e=this.stroke_.getLineCap())&&(e=_canvas.defaultLineCap),void 0===(s=this.stroke_.getMiterLimit())&&(s=_canvas.defaultMiterLimit)),{strokeStyle:t,strokeWidth:o,size:2*(this.radius_+o)+1,lineCap:e,lineDash:a,lineDashOffset:n,lineJoin:i,miterLimit:s}},e.prototype.render=function(){var t=this.createRenderOptions(),e=(0,_dom.createCanvasContext2D)(t.size,t.size);this.draw_(t,e,0,0,1),this.canvas_[1]=e.canvas;var i=e.canvas.width,s=i,a=this.getDisplacement();this.hitDetectionImageSize_=[t.size,t.size],this.createHitDetectionCanvas_(t,1),this.anchor_=[i/2-a[0],i/2+a[1]],this.size_=[i,i],this.imageSize_=[s,s]},e.prototype.draw_=function(t,e,i,s,a){var n,o,r;e.setTransform(a,0,0,a,0,0),e.translate(i,s),e.beginPath();var l=this.points_;if(l===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var h=void 0!==this.radius2_?this.radius2_:this.radius_;for(h!==this.radius_&&(l*=2),n=0;n<=l;n++)o=2*n*Math.PI/l-Math.PI/2+this.angle_,r=n%2==0?this.radius_:h,e.lineTo(t.size/2+r*Math.cos(o),t.size/2+r*Math.sin(o))}if(this.fill_){var u=this.fill_.getColor();null===u&&(u=_canvas.defaultFillStyle),e.fillStyle=(0,_colorlike.asColorLike)(u),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke()),e.closePath()},e.prototype.createHitDetectionCanvas_=function(t,e){if(this.hitDetectionCanvas_[e]=this.getImage(e),this.fill_){var i=this.fill_.getColor(),s=0;if("string"==typeof i&&(i=(0,_color.asArray)(i)),null===i?s=1:Array.isArray(i)&&(s=4===i.length?i[3]:1),0===s){var a=(0,_dom.createCanvasContext2D)(t.size*e,t.size*e);this.hitDetectionCanvas_[e]=a.canvas,this.drawHitDetectionCanvas_(t,a,0,0,e)}}},e.prototype.drawHitDetectionCanvas_=function(t,e,i,s,a){e.setTransform(a,0,0,a,0,0),e.translate(i,s),e.beginPath();var n=this.points_;if(n===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var o=void 0!==this.radius2_?this.radius2_:this.radius_;o!==this.radius_&&(n*=2);var r=void 0,l=void 0,h=void 0;for(r=0;r<=n;r++)h=2*r*Math.PI/n-Math.PI/2+this.angle_,l=r%2==0?this.radius_:o,e.lineTo(t.size/2+l*Math.cos(h),t.size/2+l*Math.sin(h))}e.fillStyle=_canvas.defaultFillStyle,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.stroke()),e.closePath()},e}(_Image.default),_default=RegularShape;exports.default=_default;

},{"../ImageState.js":18,"../color.js":47,"../colorlike.js":48,"../dom.js":62,"../render/canvas.js":219,"./Image.js":299}],301:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var Stroke=function(){function t(t){var i=t||{};this.color_=void 0!==i.color?i.color:null,this.lineCap_=i.lineCap,this.lineDash_=void 0!==i.lineDash?i.lineDash:null,this.lineDashOffset_=i.lineDashOffset,this.lineJoin_=i.lineJoin,this.miterLimit_=i.miterLimit,this.width_=i.width}return t.prototype.clone=function(){var i=this.getColor();return new t({color:Array.isArray(i)?i.slice():i||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},t.prototype.getColor=function(){return this.color_},t.prototype.getLineCap=function(){return this.lineCap_},t.prototype.getLineDash=function(){return this.lineDash_},t.prototype.getLineDashOffset=function(){return this.lineDashOffset_},t.prototype.getLineJoin=function(){return this.lineJoin_},t.prototype.getMiterLimit=function(){return this.miterLimit_},t.prototype.getWidth=function(){return this.width_},t.prototype.setColor=function(t){this.color_=t},t.prototype.setLineCap=function(t){this.lineCap_=t},t.prototype.setLineDash=function(t){this.lineDash_=t},t.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t},t.prototype.setLineJoin=function(t){this.lineJoin_=t},t.prototype.setMiterLimit=function(t){this.miterLimit_=t},t.prototype.setWidth=function(t){this.width_=t},t}(),_default=Stroke;exports.default=_default;

},{}],302:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.toFunction=toFunction,exports.createDefaultStyle=createDefaultStyle,exports.createEditingStyle=createEditingStyle,exports.default=void 0;var _Circle=_interopRequireDefault(require("./Circle.js")),_Fill=_interopRequireDefault(require("./Fill.js")),_GeometryType=_interopRequireDefault(require("../geom/GeometryType.js")),_Stroke=_interopRequireDefault(require("./Stroke.js")),_asserts=require("../asserts.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Style=function(){function e(e){var t=e||{};this.geometry_=null,this.geometryFunction_=defaultGeometryFunction,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}return e.prototype.clone=function(){var t=this.getGeometry();return t&&"object"===_typeof(t)&&(t=t.clone()),new e({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},e.prototype.getRenderer=function(){return this.renderer_},e.prototype.setRenderer=function(e){this.renderer_=e},e.prototype.getGeometry=function(){return this.geometry_},e.prototype.getGeometryFunction=function(){return this.geometryFunction_},e.prototype.getFill=function(){return this.fill_},e.prototype.setFill=function(e){this.fill_=e},e.prototype.getImage=function(){return this.image_},e.prototype.setImage=function(e){this.image_=e},e.prototype.getStroke=function(){return this.stroke_},e.prototype.setStroke=function(e){this.stroke_=e},e.prototype.getText=function(){return this.text_},e.prototype.setText=function(e){this.text_=e},e.prototype.getZIndex=function(){return this.zIndex_},e.prototype.setGeometry=function(e){"function"==typeof e?this.geometryFunction_=e:"string"==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=defaultGeometryFunction,this.geometry_=e},e.prototype.setZIndex=function(e){this.zIndex_=e},e}();function toFunction(e){var t;if("function"==typeof e)t=e;else{var o;if(Array.isArray(e))o=e;else(0,_asserts.assert)("function"==typeof e.getZIndex,41),o=[e];t=function(){return o}}return t}var defaultStyles=null;function createDefaultStyle(e,t){if(!defaultStyles){var o=new _Fill.default({color:"rgba(255,255,255,0.4)"}),r=new _Stroke.default({color:"#3399CC",width:1.25});defaultStyles=[new Style({image:new _Circle.default({fill:o,stroke:r,radius:5}),fill:o,stroke:r})]}return defaultStyles}function createEditingStyle(){var e={},t=[255,255,255,1],o=[0,153,255,1];return e[_GeometryType.default.POLYGON]=[new Style({fill:new _Fill.default({color:[255,255,255,.5]})})],e[_GeometryType.default.MULTI_POLYGON]=e[_GeometryType.default.POLYGON],e[_GeometryType.default.LINE_STRING]=[new Style({stroke:new _Stroke.default({color:t,width:5})}),new Style({stroke:new _Stroke.default({color:o,width:3})})],e[_GeometryType.default.MULTI_LINE_STRING]=e[_GeometryType.default.LINE_STRING],e[_GeometryType.default.CIRCLE]=e[_GeometryType.default.POLYGON].concat(e[_GeometryType.default.LINE_STRING]),e[_GeometryType.default.POINT]=[new Style({image:new _Circle.default({radius:6,fill:new _Fill.default({color:o}),stroke:new _Stroke.default({color:t,width:1.5})}),zIndex:1/0})],e[_GeometryType.default.MULTI_POINT]=e[_GeometryType.default.POINT],e[_GeometryType.default.GEOMETRY_COLLECTION]=e[_GeometryType.default.POLYGON].concat(e[_GeometryType.default.LINE_STRING],e[_GeometryType.default.POINT]),e}function defaultGeometryFunction(e){return e.getGeometry()}var _default=Style;exports.default=_default;

},{"../asserts.js":45,"../geom/GeometryType.js":131,"./Circle.js":292,"./Fill.js":293,"./Stroke.js":301}],303:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _Fill=_interopRequireDefault(require("./Fill.js")),_TextPlacement=_interopRequireDefault(require("./TextPlacement.js")),_size=require("../size.js");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var DEFAULT_FILL_COLOR="#333",Text=function(){function t(t){var e=t||{};this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=(0,_size.toSize)(void 0!==e.scale?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.textBaseline_=e.textBaseline,this.fill_=void 0!==e.fill?e.fill:new _Fill.default({color:DEFAULT_FILL_COLOR}),this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4,this.placement_=void 0!==e.placement?e.placement:_TextPlacement.default.POINT,this.overflow_=!!e.overflow,this.stroke_=void 0!==e.stroke?e.stroke:null,this.offsetX_=void 0!==e.offsetX?e.offsetX:0,this.offsetY_=void 0!==e.offsetY?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=void 0===e.padding?null:e.padding}return t.prototype.clone=function(){var e=this.getScale();return new t({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()})},t.prototype.getOverflow=function(){return this.overflow_},t.prototype.getFont=function(){return this.font_},t.prototype.getMaxAngle=function(){return this.maxAngle_},t.prototype.getPlacement=function(){return this.placement_},t.prototype.getOffsetX=function(){return this.offsetX_},t.prototype.getOffsetY=function(){return this.offsetY_},t.prototype.getFill=function(){return this.fill_},t.prototype.getRotateWithView=function(){return this.rotateWithView_},t.prototype.getRotation=function(){return this.rotation_},t.prototype.getScale=function(){return this.scale_},t.prototype.getScaleArray=function(){return this.scaleArray_},t.prototype.getStroke=function(){return this.stroke_},t.prototype.getText=function(){return this.text_},t.prototype.getTextAlign=function(){return this.textAlign_},t.prototype.getTextBaseline=function(){return this.textBaseline_},t.prototype.getBackgroundFill=function(){return this.backgroundFill_},t.prototype.getBackgroundStroke=function(){return this.backgroundStroke_},t.prototype.getPadding=function(){return this.padding_},t.prototype.setOverflow=function(t){this.overflow_=t},t.prototype.setFont=function(t){this.font_=t},t.prototype.setMaxAngle=function(t){this.maxAngle_=t},t.prototype.setOffsetX=function(t){this.offsetX_=t},t.prototype.setOffsetY=function(t){this.offsetY_=t},t.prototype.setPlacement=function(t){this.placement_=t},t.prototype.setRotateWithView=function(t){this.rotateWithView_=t},t.prototype.setFill=function(t){this.fill_=t},t.prototype.setRotation=function(t){this.rotation_=t},t.prototype.setScale=function(t){this.scale_=t,this.scaleArray_=(0,_size.toSize)(void 0!==t?t:1)},t.prototype.setStroke=function(t){this.stroke_=t},t.prototype.setText=function(t){this.text_=t},t.prototype.setTextAlign=function(t){this.textAlign_=t},t.prototype.setTextBaseline=function(t){this.textBaseline_=t},t.prototype.setBackgroundFill=function(t){this.backgroundFill_=t},t.prototype.setBackgroundStroke=function(t){this.backgroundStroke_=t},t.prototype.setPadding=function(t){this.padding_=t},t}(),_default=Text;exports.default=_default;

},{"../size.js":251,"./Fill.js":293,"./TextPlacement.js":304}],304:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={POINT:"point",LINE:"line"};exports.default=_default;

},{}],305:[function(require,module,exports){
"use strict";function createOrUpdate(e,t,n,r){return void 0!==r?(r[0]=e,r[1]=t,r[2]=n,r):[e,t,n]}function getKeyZXY(e,t,n){return e+"/"+t+"/"+n}function getKey(e){return getKeyZXY(e[0],e[1],e[2])}function fromKey(e){return e.split("/").map(Number)}function hash(e){return(e[1]<<e[0])+e[2]}function withinExtentAndZ(e,t){var n=e[0],r=e[1],o=e[2];if(t.getMinZoom()>n||n>t.getMaxZoom())return!1;var i,u=t.getExtent();return!(i=u?t.getTileRangeForExtentAndZ(u,n):t.getFullTileRange(n))||i.containsXY(r,o)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createOrUpdate=createOrUpdate,exports.getKeyZXY=getKeyZXY,exports.getKey=getKey,exports.fromKey=fromKey,exports.hash=hash,exports.withinExtentAndZ=withinExtentAndZ;

},{}],306:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getForProjection=getForProjection,exports.wrapX=wrapX,exports.createForExtent=createForExtent,exports.createXYZ=createXYZ,exports.createForProjection=createForProjection,exports.extentFromProjection=extentFromProjection;var _Corner=_interopRequireDefault(require("./extent/Corner.js")),_TileGrid=_interopRequireDefault(require("./tilegrid/TileGrid.js")),_Units=_interopRequireDefault(require("./proj/Units.js")),_common=require("./tilegrid/common.js"),_proj=require("./proj.js"),_extent=require("./extent.js"),_size=require("./size.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function getForProjection(e){var t=e.getDefaultTileGrid();return t||(t=createForProjection(e),e.setDefaultTileGrid(t)),t}function wrapX(e,t,r){var o=t[0],n=e.getTileCoordCenter(t),i=extentFromProjection(r);if((0,_extent.containsCoordinate)(i,n))return t;var u=(0,_extent.getWidth)(i),a=Math.ceil((i[0]-n[0])/u);return n[0]+=u*a,e.getTileCoordForCoordAndZ(n,o)}function createForExtent(e,t,r,o){var n=void 0!==o?o:_Corner.default.TOP_LEFT,i=resolutionsFromExtent(e,t,r);return new _TileGrid.default({extent:e,origin:(0,_extent.getCorner)(e,n),resolutions:i,tileSize:r})}function createXYZ(e){var t=e||{},r=t.extent||(0,_proj.get)("EPSG:3857").getExtent(),o={extent:r,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:resolutionsFromExtent(r,t.maxZoom,t.tileSize,t.maxResolution)};return new _TileGrid.default(o)}function resolutionsFromExtent(e,t,r,o){for(var n=void 0!==t?t:_common.DEFAULT_MAX_ZOOM,i=(0,_extent.getHeight)(e),u=(0,_extent.getWidth)(e),a=(0,_size.toSize)(void 0!==r?r:_common.DEFAULT_TILE_SIZE),c=o>0?o:Math.max(u/a[0],i/a[1]),s=n+1,_=new Array(s),x=0;x<s;++x)_[x]=c/Math.pow(2,x);return _}function createForProjection(e,t,r,o){return createForExtent(extentFromProjection(e),t,r,o)}function extentFromProjection(e){var t=(e=(0,_proj.get)(e)).getExtent();if(!t){var r=180*_proj.METERS_PER_UNIT[_Units.default.DEGREES]/e.getMetersPerUnit();t=(0,_extent.createOrUpdate)(-r,-r,r,r)}return t}

},{"./extent.js":70,"./extent/Corner.js":71,"./proj.js":205,"./proj/Units.js":207,"./size.js":251,"./tilegrid/TileGrid.js":307,"./tilegrid/common.js":309}],307:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _TileRange=_interopRequireWildcard(require("../TileRange.js")),_common=require("./common.js"),_asserts=require("../asserts.js"),_math=require("../math.js"),_extent=require("../extent.js"),_tilecoord=require("../tilecoord.js"),_array=require("../array.js"),_size=require("../size.js");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return _getRequireWildcardCache=function(){return t},t}function _interopRequireWildcard(t){if(t&&t.__esModule)return t;if(null===t||"object"!==_typeof(t)&&"function"!=typeof t)return{default:t};var e=_getRequireWildcardCache();if(e&&e.has(t))return e.get(t);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=o?Object.getOwnPropertyDescriptor(t,r):null;n&&(n.get||n.set)?Object.defineProperty(i,r,n):i[r]=t[r]}return i.default=t,e&&e.set(t,i),i}var tmpTileCoord=[0,0,0],TileGrid=function(){function t(t){var e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,(0,_asserts.assert)((0,_array.isSorted)(this.resolutions_,function(t,e){return e-t},!0),17),!t.origins)for(var i=0,o=this.resolutions_.length-1;i<o;++i)if(e){if(this.resolutions_[i]/this.resolutions_[i+1]!==e){e=void 0;break}}else e=this.resolutions_[i]/this.resolutions_[i+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,(0,_asserts.assert)(this.origins_.length==this.resolutions_.length,20));var r=t.extent;void 0===r||this.origin_||this.origins_||(this.origin_=(0,_extent.getTopLeft)(r)),(0,_asserts.assert)(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,(0,_asserts.assert)(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:_common.DEFAULT_TILE_SIZE,(0,_asserts.assert)(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==r?r:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,e){return new _TileRange.default(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1))},this):r&&this.calculateTileRanges_(r)}return t.prototype.forEachTileCoord=function(t,e,i){for(var o=this.getTileRangeForExtentAndZ(t,e),r=o.minX,n=o.maxX;r<=n;++r)for(var s=o.minY,l=o.maxY;s<=l;++s)i([e,r,s])},t.prototype.forEachTileCoordParentTileRange=function(t,e,i,o){var r,n,s,l=null,a=t[0]-1;for(2===this.zoomFactor_?(n=t[1],s=t[2]):l=this.getTileCoordExtent(t,o);a>=this.minZoom;){if(2===this.zoomFactor_?(n=Math.floor(n/2),s=Math.floor(s/2),r=(0,_TileRange.createOrUpdate)(n,n,s,s,i)):r=this.getTileRangeForExtentAndZ(l,a,i),e(a,r))return!0;--a}return!1},t.prototype.getExtent=function(){return this.extent_},t.prototype.getMaxZoom=function(){return this.maxZoom},t.prototype.getMinZoom=function(){return this.minZoom},t.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},t.prototype.getResolution=function(t){return this.resolutions_[t]},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getTileCoordChildTileRange=function(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var o=2*t[1],r=2*t[2];return(0,_TileRange.createOrUpdate)(o,o+1,r,r+1,e)}var n=this.getTileCoordExtent(t,i);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null},t.prototype.getTileRangeExtent=function(t,e,i){var o=this.getOrigin(t),r=this.getResolution(t),n=(0,_size.toSize)(this.getTileSize(t),this.tmpSize_),s=o[0]+e.minX*n[0]*r,l=o[0]+(e.maxX+1)*n[0]*r,a=o[1]+e.minY*n[1]*r,u=o[1]+(e.maxY+1)*n[1]*r;return(0,_extent.createOrUpdate)(s,a,l,u,i)},t.prototype.getTileRangeForExtentAndZ=function(t,e,i){var o=tmpTileCoord;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,o);var r=o[1],n=o[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,o),(0,_TileRange.createOrUpdate)(r,o[1],n,o[2],i)},t.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),i=this.getResolution(t[0]),o=(0,_size.toSize)(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*o[0]*i,e[1]-(t[2]+.5)*o[1]*i]},t.prototype.getTileCoordExtent=function(t,e){var i=this.getOrigin(t[0]),o=this.getResolution(t[0]),r=(0,_size.toSize)(this.getTileSize(t[0]),this.tmpSize_),n=i[0]+t[1]*r[0]*o,s=i[1]-(t[2]+1)*r[1]*o,l=n+r[0]*o,a=s+r[1]*o;return(0,_extent.createOrUpdate)(n,s,l,a,e)},t.prototype.getTileCoordForCoordAndResolution=function(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)},t.prototype.getTileCoordForXYAndResolution_=function(t,e,i,o,r){var n=this.getZForResolution(i),s=i/this.getResolution(n),l=this.getOrigin(n),a=(0,_size.toSize)(this.getTileSize(n),this.tmpSize_),u=o?.5:0,h=o?.5:0,_=Math.floor((t-l[0])/i+u),g=Math.floor((l[1]-e)/i+h),f=s*_/a[0],p=s*g/a[1];return o?(f=Math.ceil(f)-1,p=Math.ceil(p)-1):(f=Math.floor(f),p=Math.floor(p)),(0,_tilecoord.createOrUpdate)(n,f,p,r)},t.prototype.getTileCoordForXYAndZ_=function(t,e,i,o,r){var n=this.getOrigin(i),s=this.getResolution(i),l=(0,_size.toSize)(this.getTileSize(i),this.tmpSize_),a=o?.5:0,u=o?.5:0,h=Math.floor((t-n[0])/s+a),_=Math.floor((n[1]-e)/s+u),g=h/l[0],f=_/l[1];return o?(g=Math.ceil(g)-1,f=Math.ceil(f)-1):(g=Math.floor(g),f=Math.floor(f)),(0,_tilecoord.createOrUpdate)(i,g,f,r)},t.prototype.getTileCoordForCoordAndZ=function(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)},t.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},t.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},t.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:null},t.prototype.getZForResolution=function(t,e){var i=(0,_array.linearFindNearest)(this.resolutions_,t,e||0);return(0,_math.clamp)(i,this.minZoom,this.maxZoom)},t.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,i=new Array(e),o=this.minZoom;o<e;++o)i[o]=this.getTileRangeForExtentAndZ(t,o);this.fullTileRanges_=i},t}(),_default=TileGrid;exports.default=_default;

},{"../TileRange.js":37,"../array.js":44,"../asserts.js":45,"../extent.js":70,"../math.js":201,"../size.js":251,"../tilecoord.js":305,"./common.js":309}],308:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createFromCapabilitiesMatrixSet=createFromCapabilitiesMatrixSet,exports.default=void 0;var _TileGrid=_interopRequireDefault(require("./TileGrid.js")),_array=require("../array.js"),_proj=require("../proj.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),WMTSTileGrid=function(e){function t(t){var r=e.call(this,{extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes})||this;return r.matrixIds_=t.matrixIds,r}return __extends(t,e),t.prototype.getMatrixId=function(e){return this.matrixIds_[e]},t.prototype.getMatrixIds=function(){return this.matrixIds_},t}(_TileGrid.default),_default=WMTSTileGrid;function createFromCapabilitiesMatrixSet(e,t,r){var i=[],n=[],o=[],a=[],s=[],u=void 0!==r?r:[],l=e.SupportedCRS,f=(0,_proj.get)(l.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||(0,_proj.get)(l),p=f.getMetersPerUnit(),d="ne"==f.getAxisOrientation().substr(0,2);return e.TileMatrix.sort(function(e,t){return t.ScaleDenominator-e.ScaleDenominator}),e.TileMatrix.forEach(function(t){if(!(u.length>0)||(0,_array.find)(u,function(r){return t.Identifier==r.TileMatrix||-1===t.Identifier.indexOf(":")&&e.Identifier+":"+t.Identifier===r.TileMatrix})){n.push(t.Identifier);var r=28e-5*t.ScaleDenominator/p,l=t.TileWidth,f=t.TileHeight;d?o.push([t.TopLeftCorner[1],t.TopLeftCorner[0]]):o.push(t.TopLeftCorner),i.push(r),a.push(l==f?l:[l,f]),s.push([t.MatrixWidth,t.MatrixHeight])}}),new WMTSTileGrid({extent:t,origins:o,resolutions:i,matrixIds:n,tileSizes:a,sizes:s})}exports.default=_default;

},{"../array.js":44,"../proj.js":205,"./TileGrid.js":307}],309:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DEFAULT_TILE_SIZE=exports.DEFAULT_MAX_ZOOM=void 0;var DEFAULT_MAX_ZOOM=42;exports.DEFAULT_MAX_ZOOM=DEFAULT_MAX_ZOOM;var DEFAULT_TILE_SIZE=256;exports.DEFAULT_TILE_SIZE=DEFAULT_TILE_SIZE;

},{}],310:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createFromTemplate=createFromTemplate,exports.createFromTemplates=createFromTemplates,exports.createFromTileUrlFunctions=createFromTileUrlFunctions,exports.nullTileUrlFunction=nullTileUrlFunction,exports.expandUrl=expandUrl;var _asserts=require("./asserts.js"),_math=require("./math.js"),_tilecoord=require("./tilecoord.js");function createFromTemplate(e,r){var t=/\{z\}/g,n=/\{x\}/g,o=/\{y\}/g,a=/\{-y\}/g;return function(l,i,c){return l?e.replace(t,l[0].toString()).replace(n,l[1].toString()).replace(o,l[2].toString()).replace(a,function(){var e=l[0],t=r.getFullTileRange(e);return(0,_asserts.assert)(t,55),(t.getHeight()-l[2]-1).toString()}):void 0}}function createFromTemplates(e,r){for(var t=e.length,n=new Array(t),o=0;o<t;++o)n[o]=createFromTemplate(e[o],r);return createFromTileUrlFunctions(n)}function createFromTileUrlFunctions(e){return 1===e.length?e[0]:function(r,t,n){if(r){var o=(0,_tilecoord.hash)(r),a=(0,_math.modulo)(o,e.length);return e[a](r,t,n)}}}function nullTileUrlFunction(e,r,t){}function expandUrl(e){var r=[],t=/\{([a-z])-([a-z])\}/.exec(e);if(t){var n=t[1].charCodeAt(0),o=t[2].charCodeAt(0),a=void 0;for(a=n;a<=o;++a)r.push(e.replace(t[0],String.fromCharCode(a)));return r}if(t=/\{(\d+)-(\d+)\}/.exec(e)){for(var l=parseInt(t[2],10),i=parseInt(t[1],10);i<=l;i++)r.push(e.replace(t[0],i.toString()));return r}return r.push(e),r}

},{"./asserts.js":45,"./math.js":201,"./tilecoord.js":305}],311:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.create=create,exports.reset=reset,exports.multiply=multiply,exports.set=set,exports.setFromArray=setFromArray,exports.apply=apply,exports.rotate=rotate,exports.scale=scale,exports.makeScale=makeScale,exports.translate=translate,exports.compose=compose,exports.composeCssTransform=composeCssTransform,exports.invert=invert,exports.makeInverse=makeInverse,exports.determinant=determinant,exports.toString=toString;var _asserts=require("./asserts.js"),tmp_=new Array(6);function create(){return[1,0,0,1,0,0]}function reset(t){return set(t,1,0,0,1,0,0)}function multiply(t,e){var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],u=t[5],p=e[0],i=e[1],c=e[2],m=e[3],l=e[4],f=e[5];return t[0]=r*p+s*i,t[1]=n*p+o*i,t[2]=r*c+s*m,t[3]=n*c+o*m,t[4]=r*l+s*f+a,t[5]=n*l+o*f+u,t}function set(t,e,r,n,s,o,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=o,t[5]=a,t}function setFromArray(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function apply(t,e){var r=e[0],n=e[1];return e[0]=t[0]*r+t[2]*n+t[4],e[1]=t[1]*r+t[3]*n+t[5],e}function rotate(t,e){var r=Math.cos(e),n=Math.sin(e);return multiply(t,set(tmp_,r,n,-n,r,0,0))}function scale(t,e,r){return multiply(t,set(tmp_,e,0,0,r,0,0))}function makeScale(t,e,r){return set(t,e,0,0,r,0,0)}function translate(t,e,r){return multiply(t,set(tmp_,1,0,0,1,e,r))}function compose(t,e,r,n,s,o,a,u){var p=Math.sin(o),i=Math.cos(o);return t[0]=n*i,t[1]=s*p,t[2]=-n*p,t[3]=s*i,t[4]=a*n*i-u*n*p+e,t[5]=a*s*p+u*s*i+r,t}function composeCssTransform(t,e,r,n,s,o,a){return toString(compose(create(),t,e,r,n,s,o,a))}function invert(t){return makeInverse(t,t)}function makeInverse(t,e){var r=determinant(e);(0,_asserts.assert)(0!==r,32);var n=e[0],s=e[1],o=e[2],a=e[3],u=e[4],p=e[5];return t[0]=a/r,t[1]=-s/r,t[2]=-o/r,t[3]=n/r,t[4]=(o*p-a*u)/r,t[5]=-(n*p-s*u)/r,t}function determinant(t){return t[0]*t[3]-t[1]*t[2]}function toString(t){return"matrix("+t.join(", ")+")"}

},{"./asserts.js":45}],312:[function(require,module,exports){
"use strict";function appendParams(e,n){var a=[];Object.keys(n).forEach(function(e){null!==n[e]&&void 0!==n[e]&&a.push(e+"="+encodeURIComponent(n[e]))});var r=a.join("&");return(e=-1===(e=e.replace(/[?&]$/,"")).indexOf("?")?e+"?":e+"&")+r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.appendParams=appendParams;

},{}],313:[function(require,module,exports){
"use strict";function _abstract(){return function(){throw new Error("Unimplemented abstract method.")}()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.abstract=_abstract,exports.getUid=getUid,exports.VERSION=void 0;var uidCounter_=0;function getUid(t){return t.ol_uid||(t.ol_uid=String(++uidCounter_))}var VERSION="6.4.0";exports.VERSION=VERSION;

},{}],314:[function(require,module,exports){
"use strict";function create(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fromTransform(r,e){return r[0]=e[0],r[1]=e[1],r[4]=e[2],r[5]=e[3],r[12]=e[4],r[13]=e[5],r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.create=create,exports.fromTransform=fromTransform;

},{}],315:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getContext=getContext,exports.getSupportedExtensions=getSupportedExtensions,exports.FLOAT=exports.UNSIGNED_INT=exports.UNSIGNED_SHORT=exports.UNSIGNED_BYTE=exports.DYNAMIC_DRAW=exports.STATIC_DRAW=exports.STREAM_DRAW=exports.ELEMENT_ARRAY_BUFFER=exports.ARRAY_BUFFER=void 0;var ARRAY_BUFFER=34962;exports.ARRAY_BUFFER=ARRAY_BUFFER;var ELEMENT_ARRAY_BUFFER=34963;exports.ELEMENT_ARRAY_BUFFER=ELEMENT_ARRAY_BUFFER;var STREAM_DRAW=35040;exports.STREAM_DRAW=STREAM_DRAW;var STATIC_DRAW=35044;exports.STATIC_DRAW=STATIC_DRAW;var DYNAMIC_DRAW=35048;exports.DYNAMIC_DRAW=DYNAMIC_DRAW;var UNSIGNED_BYTE=5121;exports.UNSIGNED_BYTE=UNSIGNED_BYTE;var UNSIGNED_SHORT=5123;exports.UNSIGNED_SHORT=UNSIGNED_SHORT;var UNSIGNED_INT=5125;exports.UNSIGNED_INT=UNSIGNED_INT;var FLOAT=5126;exports.FLOAT=FLOAT;var supportedExtensions,CONTEXT_IDS=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function getContext(e,t){for(var r=CONTEXT_IDS.length,E=0;E<r;++E)try{var o=e.getContext(CONTEXT_IDS[E],t);if(o)return o}catch(e){}return null}function getSupportedExtensions(){if(!supportedExtensions){var e=getContext(document.createElement("canvas"));e&&(supportedExtensions=e.getSupportedExtensions())}return supportedExtensions}

},{}],316:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getArrayClassForType=getArrayClassForType,exports.default=exports.BufferUsage=void 0;var _webgl=require("../webgl.js"),_asserts=require("../asserts.js"),BufferUsage={STATIC_DRAW:_webgl.STATIC_DRAW,STREAM_DRAW:_webgl.STREAM_DRAW,DYNAMIC_DRAW:_webgl.DYNAMIC_DRAW};exports.BufferUsage=BufferUsage;var WebGLArrayBuffer=function(){function r(r,e){this.array=null,this.type=r,(0,_asserts.assert)(r===_webgl.ARRAY_BUFFER||r===_webgl.ELEMENT_ARRAY_BUFFER,62),this.usage=void 0!==e?e:BufferUsage.STATIC_DRAW}return r.prototype.ofSize=function(r){this.array=new(getArrayClassForType(this.type))(r)},r.prototype.fromArray=function(r){this.array=getArrayClassForType(this.type).from(r)},r.prototype.fromArrayBuffer=function(r){this.array=new(getArrayClassForType(this.type))(r)},r.prototype.getType=function(){return this.type},r.prototype.getArray=function(){return this.array},r.prototype.getUsage=function(){return this.usage},r.prototype.getSize=function(){return this.array?this.array.length:0},r}();function getArrayClassForType(r){switch(r){case _webgl.ARRAY_BUFFER:return Float32Array;case _webgl.ELEMENT_ARRAY_BUFFER:return Uint32Array;default:return Float32Array}}var _default=WebGLArrayBuffer;exports.default=_default;

},{"../asserts.js":45,"../webgl.js":315}],317:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _default={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"};exports.default=_default;

},{}],318:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.computeAttributesStride=computeAttributesStride,exports.default=exports.AttributeType=exports.DefaultUniform=exports.ShaderType=void 0;var _ContextEventType=_interopRequireDefault(require("../webgl/ContextEventType.js")),_Disposable=_interopRequireDefault(require("../Disposable.js")),_PostProcessingPass=_interopRequireDefault(require("./PostProcessingPass.js")),_webgl=require("../webgl.js"),_asserts=require("../asserts.js"),_obj=require("../obj.js"),_transform=require("../transform.js"),_mat=require("../vec/mat4.js"),_util=require("../util.js"),_array=require("../array.js");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __extends=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),ShaderType={FRAGMENT_SHADER:35632,VERTEX_SHADER:35633};exports.ShaderType=ShaderType;var DefaultUniform={PROJECTION_MATRIX:"u_projectionMatrix",OFFSET_SCALE_MATRIX:"u_offsetScaleMatrix",OFFSET_ROTATION_MATRIX:"u_offsetRotateMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution"};exports.DefaultUniform=DefaultUniform;var AttributeType={UNSIGNED_BYTE:_webgl.UNSIGNED_BYTE,UNSIGNED_SHORT:_webgl.UNSIGNED_SHORT,UNSIGNED_INT:_webgl.UNSIGNED_INT,FLOAT:_webgl.FLOAT};exports.AttributeType=AttributeType;var WebGLHelper=function(e){function t(t){var r=e.call(this)||this,o=t||{};r.boundHandleWebGLContextLost_=r.handleWebGLContextLost.bind(r),r.boundHandleWebGLContextRestored_=r.handleWebGLContextRestored.bind(r),r.canvas_=document.createElement("canvas"),r.canvas_.style.position="absolute",r.canvas_.style.left="0",r.gl_=(0,_webgl.getContext)(r.canvas_);var a=r.getGL();if(r.bufferCache_={},r.currentProgram_=null,(0,_asserts.assert)((0,_array.includes)((0,_webgl.getSupportedExtensions)(),"OES_element_index_uint"),63),a.getExtension("OES_element_index_uint"),r.canvas_.addEventListener(_ContextEventType.default.LOST,r.boundHandleWebGLContextLost_),r.canvas_.addEventListener(_ContextEventType.default.RESTORED,r.boundHandleWebGLContextRestored_),r.offsetRotateMatrix_=(0,_transform.create)(),r.offsetScaleMatrix_=(0,_transform.create)(),r.tmpMat4_=(0,_mat.create)(),r.uniformLocations_={},r.attribLocations_={},r.uniforms_=[],o.uniforms)for(var i in o.uniforms)r.uniforms_.push({name:i,value:o.uniforms[i]});return r.postProcessPasses_=o.postProcesses?o.postProcesses.map(function(e){return new _PostProcessingPass.default({webGlContext:a,scaleRatio:e.scaleRatio,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms})}):[new _PostProcessingPass.default({webGlContext:a})],r.shaderCompileErrors_=null,r.startTime_=Date.now(),r}return __extends(t,e),t.prototype.bindBuffer=function(e){var t=this.getGL(),r=(0,_util.getUid)(e),o=this.bufferCache_[r];o||(o={buffer:e,webGlBuffer:t.createBuffer()},this.bufferCache_[r]=o);t.bindBuffer(e.getType(),o.webGlBuffer)},t.prototype.flushBufferData=function(e){var t=this.getGL();this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())},t.prototype.deleteBuffer=function(e){var t=this.getGL(),r=(0,_util.getUid)(e),o=this.bufferCache_[r];t.isContextLost()||t.deleteBuffer(o.buffer),delete this.bufferCache_[r]},t.prototype.disposeInternal=function(){this.canvas_.removeEventListener(_ContextEventType.default.LOST,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(_ContextEventType.default.RESTORED,this.boundHandleWebGLContextRestored_)},t.prototype.prepareDraw=function(e){var t=this.getGL(),r=this.getCanvas(),o=e.size,a=e.pixelRatio;r.width=o[0]*a,r.height=o[1]*a,r.style.width=o[0]+"px",r.style.height=o[1]+"px",t.useProgram(this.currentProgram_);for(var i=this.postProcessPasses_.length-1;i>=0;i--)this.postProcessPasses_[i].init(e);t.bindTexture(t.TEXTURE_2D,null),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.useProgram(this.currentProgram_),this.applyFrameState(e),this.applyUniforms(e)},t.prototype.prepareDrawToRenderTarget=function(e,t,r){var o=this.getGL(),a=t.getSize();o.bindFramebuffer(o.FRAMEBUFFER,t.getFramebuffer()),o.viewport(0,0,a[0],a[1]),o.bindTexture(o.TEXTURE_2D,t.getTexture()),o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT),o.enable(o.BLEND),o.blendFunc(o.ONE,r?o.ZERO:o.ONE_MINUS_SRC_ALPHA),o.useProgram(this.currentProgram_),this.applyFrameState(e),this.applyUniforms(e)},t.prototype.drawElements=function(e,t){var r=this.getGL(),o=r.UNSIGNED_INT,a=t-e,i=4*e;r.drawElements(r.TRIANGLES,a,o,i)},t.prototype.finalizeDraw=function(e){for(var t=0;t<this.postProcessPasses_.length;t++)this.postProcessPasses_[t].apply(e,this.postProcessPasses_[t+1]||null)},t.prototype.getCanvas=function(){return this.canvas_},t.prototype.getGL=function(){return this.gl_},t.prototype.applyFrameState=function(e){var t=e.size,r=e.viewState.rotation,o=(0,_transform.reset)(this.offsetScaleMatrix_);(0,_transform.scale)(o,2/t[0],2/t[1]);var a=(0,_transform.reset)(this.offsetRotateMatrix_);0!==r&&(0,_transform.rotate)(a,-r),this.setUniformMatrixValue(DefaultUniform.OFFSET_SCALE_MATRIX,(0,_mat.fromTransform)(this.tmpMat4_,o)),this.setUniformMatrixValue(DefaultUniform.OFFSET_ROTATION_MATRIX,(0,_mat.fromTransform)(this.tmpMat4_,a)),this.setUniformFloatValue(DefaultUniform.TIME,.001*(Date.now()-this.startTime_)),this.setUniformFloatValue(DefaultUniform.ZOOM,e.viewState.zoom),this.setUniformFloatValue(DefaultUniform.RESOLUTION,e.viewState.resolution)},t.prototype.applyUniforms=function(e){var t,r=this.getGL(),o=0;this.uniforms_.forEach(function(a){if((t="function"==typeof a.value?a.value(e):a.value)instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof ImageData)a.texture||(a.prevValue=void 0,a.texture=r.createTexture()),r.activeTexture(r["TEXTURE"+o]),r.bindTexture(r.TEXTURE_2D,a.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),(!(t instanceof HTMLImageElement)||t.complete)&&a.prevValue!==t&&(a.prevValue=t,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)),r.uniform1i(this.getUniformLocation(a.name),o++);else if(Array.isArray(t)&&6===t.length)this.setUniformMatrixValue(a.name,(0,_mat.fromTransform)(this.tmpMat4_,t));else if(Array.isArray(t)&&t.length<=4)switch(t.length){case 2:return void r.uniform2f(this.getUniformLocation(a.name),t[0],t[1]);case 3:return void r.uniform3f(this.getUniformLocation(a.name),t[0],t[1],t[2]);case 4:return void r.uniform4f(this.getUniformLocation(a.name),t[0],t[1],t[2],t[3]);default:return}else"number"==typeof t&&r.uniform1f(this.getUniformLocation(a.name),t)}.bind(this))},t.prototype.useProgram=function(e){return e!=this.currentProgram_&&(this.getGL().useProgram(e),this.currentProgram_=e,this.uniformLocations_={},this.attribLocations_={},!0)},t.prototype.compileShader=function(e,t){var r=this.getGL(),o=r.createShader(t);return r.shaderSource(o,e),r.compileShader(o),o},t.prototype.getProgram=function(e,t){var r=this.getGL(),o=this.compileShader(e,r.FRAGMENT_SHADER),a=this.compileShader(t,r.VERTEX_SHADER);this.shaderCompileErrors_=null,r.getShaderInfoLog(o)&&(this.shaderCompileErrors_="Fragment shader compilation failed:\n"+r.getShaderInfoLog(o)),r.getShaderInfoLog(a)&&(this.shaderCompileErrors_=(this.shaderCompileErrors_||"")+"Vertex shader compilation failed:\n"+r.getShaderInfoLog(a));var i=r.createProgram();return r.attachShader(i,o),r.attachShader(i,a),r.linkProgram(i),i},t.prototype.getShaderCompileErrors=function(){return this.shaderCompileErrors_},t.prototype.getUniformLocation=function(e){return void 0===this.uniformLocations_[e]&&(this.uniformLocations_[e]=this.getGL().getUniformLocation(this.currentProgram_,e)),this.uniformLocations_[e]},t.prototype.getAttributeLocation=function(e){return void 0===this.attribLocations_[e]&&(this.attribLocations_[e]=this.getGL().getAttribLocation(this.currentProgram_,e)),this.attribLocations_[e]},t.prototype.makeProjectionTransform=function(e,t){var r=e.size,o=e.viewState.rotation,a=e.viewState.resolution,i=e.viewState.center;return(0,_transform.reset)(t),(0,_transform.compose)(t,0,0,2/(a*r[0]),2/(a*r[1]),-o,-i[0],-i[1]),t},t.prototype.setUniformFloatValue=function(e,t){this.getGL().uniform1f(this.getUniformLocation(e),t)},t.prototype.setUniformMatrixValue=function(e,t){this.getGL().uniformMatrix4fv(this.getUniformLocation(e),!1,t)},t.prototype.enableAttributeArray_=function(e,t,r,o,a){var i=this.getAttributeLocation(e);i<0||(this.getGL().enableVertexAttribArray(i),this.getGL().vertexAttribPointer(i,t,r,!1,o,a))},t.prototype.enableAttributes=function(e){for(var t=computeAttributesStride(e),r=0,o=0;o<e.length;o++){var a=e[o];this.enableAttributeArray_(a.name,a.size,a.type||_webgl.FLOAT,t,r),r+=a.size*getByteSizeFromType(a.type)}},t.prototype.handleWebGLContextLost=function(){(0,_obj.clear)(this.bufferCache_),this.currentProgram_=null},t.prototype.handleWebGLContextRestored=function(){},t.prototype.createTexture=function(e,t,r){var o=this.getGL(),a=r||o.createTexture(),i=o.RGBA,n=o.RGBA,s=o.UNSIGNED_BYTE;return o.bindTexture(o.TEXTURE_2D,a),t?o.texImage2D(o.TEXTURE_2D,0,i,n,s,t):o.texImage2D(o.TEXTURE_2D,0,i,e[0],e[1],0,n,s,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),a},t}(_Disposable.default);function computeAttributesStride(e){for(var t=0,r=0;r<e.length;r++){var o=e[r];t+=o.size*getByteSizeFromType(o.type)}return t}function getByteSizeFromType(e){switch(e){case AttributeType.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case AttributeType.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case AttributeType.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case AttributeType.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var _default=WebGLHelper;exports.default=_default;

},{"../Disposable.js":12,"../array.js":44,"../asserts.js":45,"../obj.js":203,"../transform.js":311,"../util.js":313,"../vec/mat4.js":314,"../webgl.js":315,"../webgl/ContextEventType.js":317,"./PostProcessingPass.js":319}],319:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var DEFAULT_VERTEX_SHADER="\n  precision mediump float;\n  \n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n  \n  uniform vec2 u_screenSize;\n   \n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n",DEFAULT_FRAGMENT_SHADER="\n  precision mediump float;\n   \n  uniform sampler2D u_image;\n   \n  varying vec2 v_texCoord;\n   \n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord);\n  }\n",WebGLPostProcessingPass=function(){function e(e){this.gl_=e.webGlContext;var r=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=r.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=r.createFramebuffer();var t=r.createShader(r.VERTEX_SHADER);r.shaderSource(t,e.vertexShader||DEFAULT_VERTEX_SHADER),r.compileShader(t);var i=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(i,e.fragmentShader||DEFAULT_FRAGMENT_SHADER),r.compileShader(i),this.renderTargetProgram_=r.createProgram(),r.attachShader(this.renderTargetProgram_,t),r.attachShader(this.renderTargetProgram_,i),r.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),r.STATIC_DRAW),this.renderTargetAttribLocation_=r.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetTextureLocation_=r.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(function(t){this.uniforms_.push({value:e.uniforms[t],location:r.getUniformLocation(this.renderTargetProgram_,t)})}.bind(this))}return e.prototype.getGL=function(){return this.gl_},e.prototype.init=function(e){var r=this.getGL(),t=[r.drawingBufferWidth*this.scaleRatio_,r.drawingBufferHeight*this.scaleRatio_];if(r.bindFramebuffer(r.FRAMEBUFFER,this.getFrameBuffer()),r.viewport(0,0,t[0],t[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==t[0]||this.renderTargetTextureSize_[1]!==t[1]){this.renderTargetTextureSize_=t;var i=r.RGBA,a=r.RGBA,n=r.UNSIGNED_BYTE;r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),r.texImage2D(r.TEXTURE_2D,0,i,t[0],t[1],0,a,n,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.renderTargetTexture_,0)}},e.prototype.apply=function(e,r){var t=this.getGL(),i=e.size;t.bindFramebuffer(t.FRAMEBUFFER,r?r.getFrameBuffer():null),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.useProgram(this.renderTargetProgram_),t.enableVertexAttribArray(this.renderTargetAttribLocation_),t.vertexAttribPointer(this.renderTargetAttribLocation_,2,t.FLOAT,!1,0,0),t.uniform2f(this.renderTargetUniformLocation_,i[0],i[1]),t.uniform1i(this.renderTargetTextureLocation_,0),this.applyUniforms(e),t.drawArrays(t.TRIANGLES,0,6)},e.prototype.getFrameBuffer=function(){return this.frameBuffer_},e.prototype.applyUniforms=function(e){var r,t=this.getGL(),i=1;this.uniforms_.forEach(function(a){if((r="function"==typeof a.value?a.value(e):a.value)instanceof HTMLCanvasElement||r instanceof ImageData)a.texture||(a.texture=t.createTexture()),t.activeTexture(t["TEXTURE"+i]),t.bindTexture(t.TEXTURE_2D,a.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,r.width,r.height,0,t.UNSIGNED_BYTE,new Uint8Array(r.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.uniform1i(a.location,i++);else if(Array.isArray(r))switch(r.length){case 2:return void t.uniform2f(a.location,r[0],r[1]);case 3:return void t.uniform3f(a.location,r[0],r[1],r[2]);case 4:return void t.uniform4f(a.location,r[0],r[1],r[2],r[3]);default:return}else"number"==typeof r&&t.uniform1f(a.location,r)})},e}(),_default=WebGLPostProcessingPass;exports.default=_default;

},{}],320:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _array=require("../array.js"),tmpArray4=new Uint8Array(4),WebGLRenderTarget=function(){function t(t,e){this.helper_=t;var r=t.getGL();this.texture_=r.createTexture(),this.framebuffer_=r.createFramebuffer(),this.size_=e||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}return t.prototype.setSize=function(t){(0,_array.equals)(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())},t.prototype.getSize=function(){return this.size_},t.prototype.clearCachedData=function(){this.dataCacheDirty_=!0},t.prototype.readAll=function(){if(this.dataCacheDirty_){var t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_},t.prototype.readPixel=function(t,e){if(t<0||e<0||t>this.size_[0]||e>=this.size_[1])return tmpArray4[0]=0,tmpArray4[1]=0,tmpArray4[2]=0,tmpArray4[3]=0,tmpArray4;this.readAll();var r=Math.floor(t)+(this.size_[1]-Math.floor(e)-1)*this.size_[0];return tmpArray4[0]=this.data_[4*r],tmpArray4[1]=this.data_[4*r+1],tmpArray4[2]=this.data_[4*r+2],tmpArray4[3]=this.data_[4*r+3],tmpArray4},t.prototype.getTexture=function(){return this.texture_},t.prototype.getFramebuffer=function(){return this.framebuffer_},t.prototype.updateSize_=function(){var t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),this.data_=new Uint8Array(t[0]*t[1]*4)},t}(),_default=WebGLRenderTarget;exports.default=_default;

},{"../array.js":44}],321:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.create=create;var source='var e="function"==typeof Object.assign?Object.assign:function(e,n){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1,o=arguments.length;r<o;++r){var i=arguments[r];if(null!=i)for(var f in i)i.hasOwnProperty(f)&&(t[f]=i[f])}return t},n="GENERATE_BUFFERS",t=[],r={vertexPosition:0,indexPosition:0};function o(e,n,t,r,o){e[n+0]=t,e[n+1]=r,e[n+2]=o}function i(e,n,i,f,s,u){var a=3+s,l=e[n+0],v=e[n+1],c=t;c.length=s;for(var g=0;g<c.length;g++)c[g]=e[n+2+g];var b=u?u.vertexPosition:0,h=u?u.indexPosition:0,d=b/a;return o(i,b,l,v,0),c.length&&i.set(c,b+3),o(i,b+=a,l,v,1),c.length&&i.set(c,b+3),o(i,b+=a,l,v,2),c.length&&i.set(c,b+3),o(i,b+=a,l,v,3),c.length&&i.set(c,b+3),b+=a,f[h++]=d,f[h++]=d+1,f[h++]=d+3,f[h++]=d+1,f[h++]=d+2,f[h++]=d+3,r.vertexPosition=b,r.indexPosition=h,r}var f=self;f.onmessage=function(t){var r=t.data;if(r.type===n){for(var o=r.customAttributesCount,s=2+o,u=new Float32Array(r.renderInstructions),a=u.length/s,l=4*a*(o+3),v=new Uint32Array(6*a),c=new Float32Array(l),g=null,b=0;b<u.length;b+=s)g=i(u,b,c,v,o,g);var h=e({vertexBuffer:c.buffer,indexBuffer:v.buffer,renderInstructions:u.buffer},r);f.postMessage(h,[c.buffer,v.buffer,u.buffer])}};',blob=new Blob([source],{type:"application/javascript"}),url=URL.createObjectURL(blob);function create(){return new Worker(url)}

},{}],322:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createElementNS=createElementNS,exports.getAllTextContent=getAllTextContent,exports.getAllTextContent_=getAllTextContent_,exports.isDocument=isDocument,exports.getAttributeNS=getAttributeNS,exports.parse=parse,exports.makeArrayExtender=makeArrayExtender,exports.makeArrayPusher=makeArrayPusher,exports.makeReplacer=makeReplacer,exports.makeObjectPropertyPusher=makeObjectPropertyPusher,exports.makeObjectPropertySetter=makeObjectPropertySetter,exports.makeChildAppender=makeChildAppender,exports.makeArraySerializer=makeArraySerializer,exports.makeSimpleNodeFactory=makeSimpleNodeFactory,exports.makeSequence=makeSequence,exports.makeStructureNS=makeStructureNS,exports.parseNode=parseNode,exports.pushParseAndPop=pushParseAndPop,exports.serialize=serialize,exports.pushSerializeAndPop=pushSerializeAndPop,exports.registerXMLSerializer=registerXMLSerializer,exports.getXMLSerializer=getXMLSerializer,exports.registerDocument=registerDocument,exports.getDocument=getDocument,exports.OBJECT_PROPERTY_NODE_FACTORY=exports.XML_SCHEMA_INSTANCE_URI=void 0;var _array=require("./array.js"),XML_SCHEMA_INSTANCE_URI="http://www.w3.org/2001/XMLSchema-instance";function createElementNS(e,r){return getDocument().createElementNS(e,r)}function getAllTextContent(e,r){return getAllTextContent_(e,r,[]).join("")}function getAllTextContent_(e,r,t){if(e.nodeType==Node.CDATA_SECTION_NODE||e.nodeType==Node.TEXT_NODE)r?t.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):t.push(e.nodeValue);else{var n=void 0;for(n=e.firstChild;n;n=n.nextSibling)getAllTextContent_(n,r,t)}return t}function isDocument(e){return"documentElement"in e}function getAttributeNS(e,r,t){return e.getAttributeNS(r,t)||""}function parse(e){return(new DOMParser).parseFromString(e,"application/xml")}function makeArrayExtender(e,r){return function(t,n){var o=e.call(void 0!==r?r:this,t,n);if(void 0!==o){var i=n[n.length-1];(0,_array.extend)(i,o)}}}function makeArrayPusher(e,r){return function(t,n){var o=e.call(void 0!==r?r:this,t,n);void 0!==o&&n[n.length-1].push(o)}}function makeReplacer(e,r){return function(t,n){var o=e.call(void 0!==r?r:this,t,n);void 0!==o&&(n[n.length-1]=o)}}function makeObjectPropertyPusher(e,r,t){return function(n,o){var i=e.call(void 0!==t?t:this,n,o);if(void 0!==i){var a=o[o.length-1],l=void 0!==r?r:n.localName,u=void 0;l in a?u=a[l]:(u=[],a[l]=u),u.push(i)}}}function makeObjectPropertySetter(e,r,t){return function(n,o){var i=e.call(void 0!==t?t:this,n,o);void 0!==i&&(o[o.length-1][void 0!==r?r:n.localName]=i)}}function makeChildAppender(e,r){return function(t,n,o){e.call(void 0!==r?r:this,t,n,o),o[o.length-1].node.appendChild(t)}}function makeArraySerializer(e,r){var t,n;return function(r,o,i){if(void 0===t){t={};var a={};a[r.localName]=e,t[r.namespaceURI]=a,n=makeSimpleNodeFactory(r.localName)}serialize(t,n,o,i)}}function makeSimpleNodeFactory(e,r){var t=e;return function(e,n,o){var i=n[n.length-1].node,a=t;return void 0===a&&(a=o),createElementNS(void 0!==r?r:i.namespaceURI,a)}}exports.XML_SCHEMA_INSTANCE_URI=XML_SCHEMA_INSTANCE_URI;var OBJECT_PROPERTY_NODE_FACTORY=makeSimpleNodeFactory();function makeSequence(e,r){for(var t=r.length,n=new Array(t),o=0;o<t;++o)n[o]=e[r[o]];return n}function makeStructureNS(e,r,t){var n,o,i=void 0!==t?t:{};for(n=0,o=e.length;n<o;++n)i[e[n]]=r;return i}function parseNode(e,r,t,n){var o;for(o=r.firstElementChild;o;o=o.nextElementSibling){var i=e[o.namespaceURI];if(void 0!==i){var a=i[o.localName];void 0!==a&&a.call(n,o,t)}}}function pushParseAndPop(e,r,t,n,o){return n.push(e),parseNode(r,t,n,o),n.pop()}function serialize(e,r,t,n,o,i){for(var a,l,u=(void 0!==o?o:t).length,c=0;c<u;++c)void 0!==(a=t[c])&&void 0!==(l=r.call(void 0!==i?i:this,a,n,void 0!==o?o[c]:void 0))&&e[l.namespaceURI][l.localName].call(i,l,a,n)}function pushSerializeAndPop(e,r,t,n,o,i,a){return o.push(e),serialize(r,t,n,o,i,a),o.pop()}exports.OBJECT_PROPERTY_NODE_FACTORY=OBJECT_PROPERTY_NODE_FACTORY;var xmlSerializer_=void 0;function registerXMLSerializer(e){xmlSerializer_=e}function getXMLSerializer(){return void 0===xmlSerializer_&&"undefined"!=typeof XMLSerializer&&(xmlSerializer_=new XMLSerializer),xmlSerializer_}var document_=void 0;function registerDocument(e){document_=e}function getDocument(){return void 0===document_&&"undefined"!=typeof document&&(document_=document.implementation.createDocument("","",null)),document_}

},{"./array.js":44}],323:[function(require,module,exports){
"use strict";module.exports=Pbf;var ieee754=require("ieee754");function Pbf(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;var SHIFT_LEFT_32=4294967296,SHIFT_RIGHT_32=1/SHIFT_LEFT_32,TEXT_DECODER_MIN_LENGTH=12,utf8TextDecoder="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function readVarintRemainder(t,i,e){var r,s,n=e.buf;if(r=(112&(s=n[e.pos++]))>>4,s<128)return toNum(t,r,i);if(r|=(127&(s=n[e.pos++]))<<3,s<128)return toNum(t,r,i);if(r|=(127&(s=n[e.pos++]))<<10,s<128)return toNum(t,r,i);if(r|=(127&(s=n[e.pos++]))<<17,s<128)return toNum(t,r,i);if(r|=(127&(s=n[e.pos++]))<<24,s<128)return toNum(t,r,i);if(r|=(1&(s=n[e.pos++]))<<31,s<128)return toNum(t,r,i);throw new Error("Expected varint not more than 10 bytes")}function readPackedEnd(t){return t.type===Pbf.Bytes?t.readVarint()+t.pos:t.pos+1}function toNum(t,i,e){return e?4294967296*i+(t>>>0):4294967296*(i>>>0)+(t>>>0)}function writeBigVarint(t,i){var e,r;if(t>=0?(e=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(e=~(-t%4294967296))?e=e+1|0:(e=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),writeBigVarintLow(e,r,i),writeBigVarintHigh(r,i)}function writeBigVarintLow(t,i,e){e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos]=127&t}function writeBigVarintHigh(t,i){var e=(7&t)<<4;i.buf[i.pos++]|=e|((t>>>=3)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t)))))}function makeRoomForExtraLength(t,i,e){var r=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));e.realloc(r);for(var s=e.pos-1;s>=t;s--)e.buf[s+r]=e.buf[s]}function _writePackedVarint(t,i){for(var e=0;e<t.length;e++)i.writeVarint(t[e])}function _writePackedSVarint(t,i){for(var e=0;e<t.length;e++)i.writeSVarint(t[e])}function _writePackedFloat(t,i){for(var e=0;e<t.length;e++)i.writeFloat(t[e])}function _writePackedDouble(t,i){for(var e=0;e<t.length;e++)i.writeDouble(t[e])}function _writePackedBoolean(t,i){for(var e=0;e<t.length;e++)i.writeBoolean(t[e])}function _writePackedFixed(t,i){for(var e=0;e<t.length;e++)i.writeFixed32(t[e])}function _writePackedSFixed(t,i){for(var e=0;e<t.length;e++)i.writeSFixed32(t[e])}function _writePackedFixed2(t,i){for(var e=0;e<t.length;e++)i.writeFixed64(t[e])}function _writePackedSFixed2(t,i){for(var e=0;e<t.length;e++)i.writeSFixed64(t[e])}function readUInt32(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16)+16777216*t[i+3]}function writeInt32(t,i,e){t[e]=i,t[e+1]=i>>>8,t[e+2]=i>>>16,t[e+3]=i>>>24}function readInt32(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16)+(t[i+3]<<24)}function readUtf8(t,i,e){for(var r="",s=i;s<e;){var n,o,a,h=t[s],u=null,f=h>239?4:h>223?3:h>191?2:1;if(s+f>e)break;1===f?h<128&&(u=h):2===f?128==(192&(n=t[s+1]))&&(u=(31&h)<<6|63&n)<=127&&(u=null):3===f?(n=t[s+1],o=t[s+2],128==(192&n)&&128==(192&o)&&((u=(15&h)<<12|(63&n)<<6|63&o)<=2047||u>=55296&&u<=57343)&&(u=null)):4===f&&(n=t[s+1],o=t[s+2],a=t[s+3],128==(192&n)&&128==(192&o)&&128==(192&a)&&((u=(15&h)<<18|(63&n)<<12|(63&o)<<6|63&a)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,f=1):u>65535&&(u-=65536,r+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),r+=String.fromCharCode(u),s+=f}return r}function readUtf8TextDecoder(t,i,e){return utf8TextDecoder.decode(t.subarray(i,e))}function writeUtf8(t,i,e){for(var r,s,n=0;n<i.length;n++){if((r=i.charCodeAt(n))>55295&&r<57344){if(!s){r>56319||n+1===i.length?(t[e++]=239,t[e++]=191,t[e++]=189):s=r;continue}if(r<56320){t[e++]=239,t[e++]=191,t[e++]=189,s=r;continue}r=s-55296<<10|r-56320|65536,s=null}else s&&(t[e++]=239,t[e++]=191,t[e++]=189,s=null);r<128?t[e++]=r:(r<2048?t[e++]=r>>6|192:(r<65536?t[e++]=r>>12|224:(t[e++]=r>>18|240,t[e++]=r>>12&63|128),t[e++]=r>>6&63|128),t[e++]=63&r|128)}return e}Pbf.prototype={destroy:function(){this.buf=null},readFields:function(t,i,e){for(e=e||this.length;this.pos<e;){var r=this.readVarint(),s=r>>3,n=this.pos;this.type=7&r,t(s,i,this),this.pos===n&&this.skip(r)}return i},readMessage:function(t,i){return this.readFields(t,i,this.readVarint()+this.pos)},readFixed32:function(){var t=readUInt32(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=readInt32(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=readUInt32(this.buf,this.pos)+readUInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,t},readSFixed64:function(){var t=readUInt32(this.buf,this.pos)+readInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,t},readFloat:function(){var t=ieee754.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ieee754.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var i,e,r=this.buf;return i=127&(e=r[this.pos++]),e<128?i:(i|=(127&(e=r[this.pos++]))<<7,e<128?i:(i|=(127&(e=r[this.pos++]))<<14,e<128?i:(i|=(127&(e=r[this.pos++]))<<21,e<128?i:readVarintRemainder(i|=(15&(e=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,i=this.pos;return this.pos=t,t-i>=TEXT_DECODER_MIN_LENGTH&&utf8TextDecoder?readUtf8TextDecoder(this.buf,i,t):readUtf8(this.buf,i,t)},readBytes:function(){var t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i},readPackedVarint:function(t,i){if(this.type!==Pbf.Bytes)return t.push(this.readVarint(i));var e=readPackedEnd(this);for(t=t||[];this.pos<e;)t.push(this.readVarint(i));return t},readPackedSVarint:function(t){if(this.type!==Pbf.Bytes)return t.push(this.readSVarint());var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Pbf.Bytes)return t.push(this.readBoolean());var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Pbf.Bytes)return t.push(this.readFloat());var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Pbf.Bytes)return t.push(this.readDouble());var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Pbf.Bytes)return t.push(this.readFixed32());var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Pbf.Bytes)return t.push(this.readSFixed32());var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Pbf.Bytes)return t.push(this.readFixed64());var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Pbf.Bytes)return t.push(this.readSFixed64());var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed64());return t},skip:function(t){var i=7&t;if(i===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(i===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Pbf.Fixed32)this.pos+=4;else{if(i!==Pbf.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(t,i){this.writeVarint(t<<3|i)},realloc:function(t){for(var i=this.length||16;i<this.pos+t;)i*=2;if(i!==this.length){var e=new Uint8Array(i);e.set(this.buf),this.buf=e,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),writeInt32(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),writeInt32(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),writeInt32(this.buf,-1&t,this.pos),writeInt32(this.buf,Math.floor(t*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),writeInt32(this.buf,-1&t,this.pos),writeInt32(this.buf,Math.floor(t*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?writeBigVarint(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var i=this.pos;this.pos=writeUtf8(this.buf,t,this.pos);var e=this.pos-i;e>=128&&makeRoomForExtraLength(i,e,this),this.pos=i-1,this.writeVarint(e),this.pos+=e},writeFloat:function(t){this.realloc(4),ieee754.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ieee754.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var i=t.length;this.writeVarint(i),this.realloc(i);for(var e=0;e<i;e++)this.buf[this.pos++]=t[e]},writeRawMessage:function(t,i){this.pos++;var e=this.pos;t(i,this);var r=this.pos-e;r>=128&&makeRoomForExtraLength(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,i,e){this.writeTag(t,Pbf.Bytes),this.writeRawMessage(i,e)},writePackedVarint:function(t,i){i.length&&this.writeMessage(t,_writePackedVarint,i)},writePackedSVarint:function(t,i){i.length&&this.writeMessage(t,_writePackedSVarint,i)},writePackedBoolean:function(t,i){i.length&&this.writeMessage(t,_writePackedBoolean,i)},writePackedFloat:function(t,i){i.length&&this.writeMessage(t,_writePackedFloat,i)},writePackedDouble:function(t,i){i.length&&this.writeMessage(t,_writePackedDouble,i)},writePackedFixed32:function(t,i){i.length&&this.writeMessage(t,_writePackedFixed,i)},writePackedSFixed32:function(t,i){i.length&&this.writeMessage(t,_writePackedSFixed,i)},writePackedFixed64:function(t,i){i.length&&this.writeMessage(t,_writePackedFixed2,i)},writePackedSFixed64:function(t,i){i.length&&this.writeMessage(t,_writePackedSFixed2,i)},writeBytesField:function(t,i){this.writeTag(t,Pbf.Bytes),this.writeBytes(i)},writeFixed32Field:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeSFixed64(i)},writeVarintField:function(t,i){this.writeTag(t,Pbf.Varint),this.writeVarint(i)},writeSVarintField:function(t,i){this.writeTag(t,Pbf.Varint),this.writeSVarint(i)},writeStringField:function(t,i){this.writeTag(t,Pbf.Bytes),this.writeString(i)},writeFloatField:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeFloat(i)},writeDoubleField:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeDouble(i)},writeBooleanField:function(t,i){this.writeVarintField(t,Boolean(i))}};

},{"ieee754":2}],324:[function(require,module,exports){
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,i){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).RBush=i()}(void 0,function(){function t(t,r,e,o,a){!function t(n,r,e,o,a){for(;o>e;){if(o-e>600){var h=o-e+1,s=r-e+1,l=Math.log(h),f=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*f*(h-f)/h)*(s-h/2<0?-1:1),m=Math.max(e,Math.floor(r-s*f/h+u)),p=Math.min(o,Math.floor(r+(h-s)*f/h+u));t(n,r,m,p,a)}var c=n[r],d=e,x=o;for(i(n,e,r),a(n[o],c)>0&&i(n,e,o);d<x;){for(i(n,d,x),d++,x--;a(n[d],c)<0;)d++;for(;a(n[x],c)>0;)x--}0===a(n[e],c)?i(n,e,x):i(n,++x,o),x<=r&&(e=x+1),r<=x&&(o=x-1)}}(t,r,e||0,o||t.length-1,a||n)}function i(t,i,n){var r=t[i];t[i]=t[n],t[n]=r}function n(t,i){return t<i?-1:t>i?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function e(t,i,n){if(!n)return i.indexOf(t);for(var r=0;r<i.length;r++)if(n(t,i[r]))return r;return-1}function o(t,i){a(t,0,t.children.length,i,t)}function a(t,i,n,r,e){e||(e=c(null)),e.minX=1/0,e.minY=1/0,e.maxX=-1/0,e.maxY=-1/0;for(var o=i;o<n;o++){var a=t.children[o];h(e,t.leaf?r(a):a)}return e}function h(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function s(t,i){return t.minX-i.minX}function l(t,i){return t.minY-i.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function m(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function p(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function c(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(i,n,r,e,o){for(var a=[n,r];a.length;)if(!((r=a.pop())-(n=a.pop())<=e)){var h=n+Math.ceil((r-n)/e/2)*e;t(i,h,n,r,o),a.push(n,h,h,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var i=this.data,n=[];if(!p(t,i))return n;for(var r=this.toBBox,e=[];i;){for(var o=0;o<i.children.length;o++){var a=i.children[o],h=i.leaf?r(a):a;p(t,h)&&(i.leaf?n.push(a):m(t,h)?this._all(a,n):e.push(a))}i=e.pop()}return n},r.prototype.collides=function(t){var i=this.data;if(!p(t,i))return!1;for(var n=[];i;){for(var r=0;r<i.children.length;r++){var e=i.children[r],o=i.leaf?this.toBBox(e):e;if(p(t,o)){if(i.leaf||m(t,o))return!0;n.push(e)}}i=n.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0;i<t.length;i++)this.insert(t[i]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=c([]),this},r.prototype.remove=function(t,i){if(!t)return this;for(var n,r,o,a=this.data,h=this.toBBox(t),s=[],l=[];a||s.length;){if(a||(a=s.pop(),r=s[s.length-1],n=l.pop(),o=!0),a.leaf){var f=e(t,a.children,i);if(-1!==f)return a.children.splice(f,1),s.push(a),this._condense(s),this}o||a.leaf||!m(a,h)?r?(n++,a=r.children[n],o=!1):a=null:(s.push(a),l.push(n),n=0,r=a,a=a.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,i){return t.minX-i.minX},r.prototype.compareMinY=function(t,i){return t.minY-i.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},r.prototype._build=function(t,i,n,r){var e,a=n-i+1,h=this._maxEntries;if(a<=h)return o(e=c(t.slice(i,n+1)),this.toBBox),e;r||(r=Math.ceil(Math.log(a)/Math.log(h)),h=Math.ceil(a/Math.pow(h,r-1))),(e=c([])).leaf=!1,e.height=r;var s=Math.ceil(a/h),l=s*Math.ceil(Math.sqrt(h));d(t,i,n,l,this.compareMinX);for(var f=i;f<=n;f+=l){var u=Math.min(f+l-1,n);d(t,f,u,s,this.compareMinY);for(var m=f;m<=u;m+=s){var p=Math.min(m+s-1,u);e.children.push(this._build(t,m,p,r-1))}}return o(e,this.toBBox),e},r.prototype._chooseSubtree=function(t,i,n,r){for(;r.push(i),!i.leaf&&r.length-1!==n;){for(var e=1/0,o=1/0,a=void 0,h=0;h<i.children.length;h++){var s=i.children[h],l=f(s),u=(m=t,p=s,(Math.max(p.maxX,m.maxX)-Math.min(p.minX,m.minX))*(Math.max(p.maxY,m.maxY)-Math.min(p.minY,m.minY))-l);u<o?(o=u,e=l<e?l:e,a=s):u===o&&l<e&&(e=l,a=s)}i=a||i.children[0]}var m,p;return i},r.prototype._insert=function(t,i,n){var r=n?t:this.toBBox(t),e=[],o=this._chooseSubtree(r,this.data,i,e);for(o.children.push(t),h(o,r);i>=0&&e[i].children.length>this._maxEntries;)this._split(e,i),i--;this._adjustParentBBoxes(r,e,i)},r.prototype._split=function(t,i){var n=t[i],r=n.children.length,e=this._minEntries;this._chooseSplitAxis(n,e,r);var a=this._chooseSplitIndex(n,e,r),h=c(n.children.splice(a,n.children.length-a));h.height=n.height,h.leaf=n.leaf,o(n,this.toBBox),o(h,this.toBBox),i?t[i-1].children.push(h):this._splitRoot(n,h)},r.prototype._splitRoot=function(t,i){this.data=c([t,i]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,i,n){for(var r,e,o,h,s,l,u,m=1/0,p=1/0,c=i;c<=n-i;c++){var d=a(t,0,c,this.toBBox),x=a(t,c,n,this.toBBox),v=(e=d,o=x,h=void 0,s=void 0,l=void 0,u=void 0,h=Math.max(e.minX,o.minX),s=Math.max(e.minY,o.minY),l=Math.min(e.maxX,o.maxX),u=Math.min(e.maxY,o.maxY),Math.max(0,l-h)*Math.max(0,u-s)),y=f(d)+f(x);v<m?(m=v,r=c,p=y<p?y:p):v===m&&y<p&&(p=y,r=c)}return r||n-i},r.prototype._chooseSplitAxis=function(t,i,n){var r=t.leaf?this.compareMinX:s,e=t.leaf?this.compareMinY:l;this._allDistMargin(t,i,n,r)<this._allDistMargin(t,i,n,e)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,i,n,r){t.children.sort(r);for(var e=this.toBBox,o=a(t,0,i,e),s=a(t,n-i,n,e),l=u(o)+u(s),f=i;f<n-i;f++){var m=t.children[f];h(o,t.leaf?e(m):m),l+=u(o)}for(var p=n-i-1;p>=i;p--){var c=t.children[p];h(s,t.leaf?e(c):c),l+=u(s)}return l},r.prototype._adjustParentBBoxes=function(t,i,n){for(var r=n;r>=0;r--)h(i[r],t)},r.prototype._condense=function(t){for(var i=t.length-1,n=void 0;i>=0;i--)0===t[i].children.length?i>0?(n=t[i-1].children).splice(n.indexOf(t[i]),1):this.clear():o(t[i],this.toBBox)},r});

},{}]},{},[1]);
;/**
 * This file is part of TWCC.
 *
 * TWCC is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * TWCC is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with TWCC.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @copyright Copyright (c) 2010-2014 Clément Ronzon
 * @license http://www.gnu.org/licenses/agpl.txt
 */

/**
 * Events triggered by TWCCUi and attached to the body:
 *  - ui.clickconvert (selctor)
 *  - ui.modechanged (mode)
 */

(function ($, ClipboardJS) {
    "use strict";
    /*global window, document */

    if (window.TWCCUi !== undefined) {
        return;
    }

    var instance;

    function init(opts) {
        var _clipboardJsClient,
            _dfd = null,
            _convergenceConvention = true,
            _options = $.extend(true, {}, opts),
            _SHDelay = 250,
            _paletteTimer = {};

        function _trigger(eventName, data) {
            var $anchor = $('body');
            _options.utils.trigger($anchor, eventName, data);
        }

        function _t() {
            return _options.utils.t.apply(this, arguments);
        }

        function _newDeferred() {
            return _options.utils.newDeferred.apply(this, arguments);
        }

        function _initBeautyTipsUi() {
            var btOptions = {
                trigger: 'none',
                showTip: function (box) {
                    $(box).fadeIn(_SHDelay);
                },
                hideTip: function (box, callback) {
                    $(box).animate({opacity: 0}, _SHDelay, callback);
                },
                shrinkToFit: true,
                padding: '0px',
                windowMargin: '0px',
                fill: 'rgba(0, 0, 0, .9)',
                cornerRadius: 10,
                strokeWidth: 1,
                shadow: true,
                shadowOffsetX: 3,
                shadowOffsetY: 3,
                shadowBlur: 3,
                shadowColor: 'rgba(6,6,6,.5)',
                shadowOverlap: false,
                noShadowOpts: {strokeStyle: '#666', strokeWidth: 1},
                positions: ['left', 'top'],
                cssStyles: {color: '#FFF'},
                closeWhenOthersOpen: true,
                clickAnywhereToClose: false
            }, $crsList = $('.crs-list');
            $.extend($.bt.defaults, btOptions);
            $crsList.first().bt({contentSelector: "$('.help-1')"});
            $crsList.last().bt({contentSelector: "$('.help-2')"});
            $('.source .container').bt({contentSelector: "$('.help-3')"});
            $('.source .convert-button').bt({contentSelector: "$('.help-4')"});
            $('.next_button').button({icons: {secondary: 'ui-icon-seek-next'}});
        }

        function _initConverterUi() {
            $('.previous.history').button({icons: {primary: 'ui-icon-seek-first'}, text: false});
            $('#help').button({icons: {primary: 'ui-icon-help'}, text: false});
            $('.next.history').button({icons: {primary: 'ui-icon-seek-end'}, text: false});
            $('.source .convert-button').button({icons: {primary: 'ui-icon-arrowthick-1-s'}});
            $('.destination .convert-button').button({icons: {primary: 'ui-icon-arrowthick-1-n'}});
            $('#converter').draggable({handle: '.drag-handle'});
            $('input[type="text"]', '#p-research').addClass('ui-corner-all');
            $('#p-new').dialog({
                closeText: _t('close'),
                modal: true,
                title: _t('customSystem'),
                width: 400,
                autoOpen: false
            });
            $('#p-crs').dialog({
                closeText: _t('close'),
                modal: true,
                title: _t('systemDefinition'),
                width: 500,
                autoOpen: false
            });
            $('#p-research').dialog({
                closeText: _t('close'),
                modal: true,
                title: _t('research'),
                width: 400,
                autoOpen: false
            });
            _setHistoryButtons(0, 0);
        }

        function _initOptionsUi() {
            $('.button-set').buttonset();
            $('#auto-zoom-toggle').button({icons: {primary: 'ui-icon-zoomin'}, text: false, disabled: true});
            /*$('#print-map').button({icons: {primary: 'ui-icon-print'}, text: false});*/
            $('#full-screen')
                .button({icons: {primary: 'ui-icon-arrow-4-diag'}, text: false})
                .closest('p').toggle($(document).fullScreen() !== null);
            $('#o-container').accordion({
                collapsible: true,
                active: false,
                heightStyle: 'content',
                icons: {header: 'ui-icon-gear'}
            });
            $('#p-convention_help').dialog({
                closeText: _t('close'),
                modal: true,
                title: _t('conventionTitle'),
                width: '840px',
                autoOpen: false
            });
        }

        function _initAdsenseUi() {
            var parameters = _options.system.adsense.parameters;
            window.adsbygoogle = window.adsbygoogle || [];
            $('ins.adsbygoogle').each(function () {
                window.adsbygoogle.push({params: $.extend({}, parameters)});
            });
        }

        function _initGeneralUi() {
            var hash = _getAddressBarAnchor(),
                $pDonate = $('#p-donate'),
                $pLoading = $('#p-loading'),
                progressbar = $pLoading.find('.progressbar'),
                progressLabel = $('.progress-label');
            $('.section, .searchbtn').addClass('ui-corner-all');
            $('.view').addClass('ui-corner-br ui-corner-tr');
            $('.search-field').addClass('ui-corner-bl ui-corner-tl');
            $('#p-poll').dialog({
                closeText: _t('close'),
                modal: true,
                title: _t('poll'),
                width: 500,
                open: function () {
                    _addAnchorToAddressBar('poll');
                },
                close: function () {
                    _removeAnchorFromAddressBar('poll');
                },
                autoOpen: hash == 'poll'
            });
            if (_options.system.raterMasterSw && !_options.context.session.userHasRatedOne) {
                _showPoll(false);
            }
            $('#p-contact').dialog({
                closeText: _t('close'),
                modal: true,
                title: _t('contactUs'),
                width: 500,
                open: function () {
                    _addAnchorToAddressBar('contact');
                },
                close: function () {
                    _removeAnchorFromAddressBar('contact');
                },
                autoOpen: hash == 'contact'
            });
            $('.contact-button').button({icons: {secondary: 'ui-icon-mail-closed'}});
            $pDonate.find('input.dont-show-again').prop('checked', _getPreferenceCookie('p-donate'));
            $('.help-1').find('input.dont-show-again').prop('checked', _getPreferenceCookie('help-1'));
            $pDonate.dialog({
                closeText: _t('close'),
                modal: true,
                title: _t('donate'),
                width: 750,
                open: function () {
                    _addAnchorToAddressBar('donate');
                },
                close: function () {
                    _removeAnchorFromAddressBar('donate');
                },
                autoOpen: hash == 'donate'
            });
            $pDonate.find('.progressbar').progressbar({
                value: _options.donations.total,
                max: _options.donations.max
            });
            progressbar.progressbar({
                value: false,
                change: function () {
                    progressLabel.text(Math.round(progressbar.progressbar('value')) + '%');
                },
                complete: function () {
                    progressLabel.text('Complete!');
                }
            });
            $('#p-about').dialog({
                closeText: _t('close'),
                modal: true,
                title: _t('about'),
                width: '70%',
                open: function () {
                    _addAnchorToAddressBar('about');
                },
                close: function () {
                    _removeAnchorFromAddressBar('about');
                },
                autoOpen: hash == 'about'
            });
            $('body').on('history.indexchanged', function (event, response) {
                var history = response.data;
                _setHistoryButtons(history.currentIndex, history.maxIndex);
            });
            $('#p-info').dialog({
                closeText: _t('close'),
                modal: true,
                title: 'Information',
                width: 750,
                autoOpen: true
            });
            $('#csvFeatures').hide();
            $('#language')
                .find('>dt>a')
                .button({icons: {secondary: 'ui-icon-triangle-1-s'}});
            if (_options.system.facebookEnabled) {
                window.fbAsyncInit = function () {
                    FB.init({
                        appId: _options.system.facebookAppId,
                        xfbml: true,
                        version: 'v2.2'
                    });
                };
                $.fn.getXDomain({
                    url: 'http://connect.facebook.net/' + _options.context.locale + '/sdk.js'
                });
            }
            if (!_options.context.isDevEnv) {
                window.___gcfg = {
                    lang: _options.context.googlePlusLocale,
                    parsetags: 'onload'
                };
                $.fn.getXDomain({
                    url: 'https://apis.google.com/js/plusone.js'
                });
            }
            $pLoading.dialog({
                dialogClass: 'no-close',
                modal: true,
                title: _t('loading'),
                autoOpen: true
            });
            $('.ui-widget-overlay').css({
                backgroundImage: 'none',
                opacity: 0.7
            });
        }

        function _getTarget($elt) {
            return $elt.closest('.converter-container').hasClass('source') ? 'source' : 'destination';
        }

        function _bindConverterPanelEvents() {
            var $snipet = $('a.snippet'),
                offset = 16,
                $converter = $('#converter'),
                $body = $('body');
            $snipet.on('mouseenter', function () {
                $('body').append('<div id="Tip" style="z-index:9999;" class="ui-corner-all"><img src="' + this.href + '" alt="' + this.href + '"><\/div>');
            });
            $snipet.on('mousemove', function (event) {
                $('#Tip')
                    .css({'left': event.pageX + offset, 'top': event.pageY + offset})
                    .show();
            });
            $snipet.on('mouseout', function () {
                $('#Tip').remove();
            });
            $snipet.click(function (event) {
                event.preventDefault();
            });
            $('.search-crs').click(function (event) {
                var target = _getTarget($(this));
                event.preventDefault();
                $('#select').val(target);
                $('#p-research').dialog('open');
            });
            $converter.on('converter.info', _showCrsInfo);
            $converter.on('click', '.show-p-new', function (event) {
                var target = _getTarget($(this));
                event.preventDefault();
                $('#new-form input[name="target"]').val(target);
                $('#p-new').dialog('open');
            });
            $body.on('click', '#view-reference', function (event) {
                var url = 'http://spatialreference.org/ref/?search=' + encodeURIComponent($('#find-reference').val());
                event.preventDefault();
                window.open(url);
            });
            $body.on('submit', '#reference-form', function (event) {
                event.preventDefault();
                $('#view-reference').click();
            });
            $('#crsResult').on('change', function (event) {
                _updateConverterWithSelectedSrs($(event.target).val());
            });
            $('#research').click(function (event) {
                event.preventDefault();
                _goResearch();
            });
            _clipboardJsClient = new ClipboardJS('#converter .octicon-clippy', {
                text: function (trigger) {
                    var $target = $(trigger),
                        $container = $target.closest('.converter-container');
                    if ($container.length) {
                        return $container.converter('value').toString();
                    }
                }
            });
            _clipboardJsClient.on('success', function (event) {
                $(event.trigger).animate({opacity: 0.3}, 500, function () {
                    $(this).animate({opacity: 1}, 500);
                });
                _trigger('clipboard.aftercopy');
            });
        }

        function _startHelp() {
            $('#help').animate({opacity: 'hide'}, _SHDelay);
            $('.crs-list').first().btOn();
        }

        function _startHelpIfCookieAllowsIt() {
            if (!_getPreferenceCookie('help-1')) {
                _startHelp();
            }
        }

        function _bindBeautyTipsEvents() {
            $('.close_button, .help-4 .next_button').click(function (event) {
                event.preventDefault();
                $('#help').animate({opacity: 'show'}, _SHDelay);
            });
            $('.next_button').click(function (event) {
                event.preventDefault();
            });
            $('.close_button', '.help-1').click(function () {
                $('.crs-list').first().btOff();
            });
            $('.close_button', '.help-2').click(function () {
                $('.crs-list').last().btOff();
            });
            $('.close_button', '.help-3').click(function () {
                $('.source .container').btOff();
            });
            $('.close_button, .next_button', '.help-4').click(function () {
                $('.source .convert-button').btOff();
            });
            $('.next_button', '.help-1').click(function () {
                $('.crs-list').last().btOn();
            });
            $('.next_button', '.help-2').click(function () {
                $('.source .container').btOn();
            });
            $('.next_button', '.help-3').click(function () {
                $('.source .convert-button').btOn();
            });
            $('.help-1').find('input.dont-show-again').on('change', function () {
                _setPreferenceCookie('help-1', $(this)[0].checked);
            });
            $('#help').click(function () {
                event.preventDefault();
                _startHelp();
            });
        }

        function _bindLanguageEvents() {
            var $ul = $('.dropdown dd ul'),
                $a = $('.dropdown dt a');

            $a.click(function (event) {
                event.preventDefault();
                $ul.slideToggle(200);
            });
            $ul.find('li a').click(function (event) {
                var html, value;
                event.preventDefault();
                html = $(this).html();
                value = $(this).parent().find('span.value').text();
                $a.find('span').html(html);
                $ul.hide();
                document.location.href = $(this).prop('href');
            });
            $(document).click(function (event) {
                var $clicked = $(event.target);
                if (!$clicked.parents().hasClass('dropdown')) {
                    $ul.hide();
                }
            });
        }

        function _setCsvMode(isCsv) {
            _setMode(isCsv);
            _trigger('ui.csv_changed', isCsv);
        }

        function _togglePalette(target, palette) {
            if ($(document).fullScreen()) {
                if ($(palette).is(':hidden')) {
                    $(palette).fadeIn();
                } else if ($(target).closest(palette).length) {
                    clearInterval(_paletteTimer[palette]);
                } else {
                    clearInterval(_paletteTimer[palette]);
                    _paletteTimer[palette] = setTimeout(function () {
                        if ($(document).fullScreen()) {
                            $(palette).fadeOut();
                        }
                    }, 1000);
                }
            }
        }

        function _bindOptionsPanelEvents() {
            $('.convention').click(function (event) {
                event.preventDefault();
                $('#p-convention_help').dialog('open');
            });
            /*$('#print-map').click(function(event) {
                event.preventDefault();
                _options.utils.openStaticMap();
            });*/
            $('#full-screen').click(function (event) {
                event.preventDefault();
                _trigger('ui.full_screen');
            });
            $('#auto-zoom-toggle').click(function () {
                _options.utils.enableAutoZoom($(this).is(':checked'));
            });
            $('input[name="csv"]').click(function () {
                var isCsv = !!+$(this).val();
                _setCsvMode(isCsv);
            });
            $('input[name="convention"]').click(function () {
                _setConvergenceConvention(!!+$(this).val());
            });
            $('body').on('converterset.csv_changed main.ready', function (event, obj) {
                var isCsv = obj.data === undefined ? obj.csv : obj.data.csv;
                _setCsvButtonset(isCsv);
                _setMode(isCsv);
            });
        }

        function _bindOtherPanelsEvents() {
            var $body = $('body');
            $('.toggle-next').click(function (event) {
                event.preventDefault();
                $(this).parent().find('.toogle-me').toggle();
            });
            $(document).on('fullscreenchange', function () {
                _hideAll();
                _togglePalettes();
            });
            $(document).on('mousemove', function (event) {
                _togglePalette(event.target, '.trsp-panel, #converter');
            });
            $body.on('click', '.show-p-poll', function (event) {
                event.preventDefault();
                _showPoll();
            });
            $body.on('mousedown', '#view-map, .donate_btn, .about, converter.info, .convert-button, .contact, .search-crs, .show-p-new', function () {
                _hideAll();
            });
            $body.on('map.metrics_changed', function (event, response) {
                _setMetrics(response.data);
            });
            $body.on('map.tiles_loaded', function () {
                _initAdsenseUi();
            });
            $body.on('converter.changed', function (event, response) {
                _setMagneticDeclination(response.data.magneticDeclinationInDegrees);
            });
            $('#p-donate').find('input.dont-show-again').on('change', function () {
                _setPreferenceCookie('p-donate', $(this)[0].checked);
            });
            $('.donate_btn').click(function (event) {
                event.preventDefault();
                $('#p-donate').dialog('open');
            });
            $('.about').click(function (event) {
                event.preventDefault();
                $('#p-about').dialog('open');
            });
            $body.one('main.ready', function () {
                setTimeout(_closeLoading, 800);
            });
            $body.on('main.start', _displayLoading);
            $body.on('main.failed', {
                message: ': failure! ' + _t('contactUs'),
                className: 'failure'
            }, function () {
                _displayLoading.apply(this, arguments);
                _closeLoading();
            });
            $body.on('main.succeeded', {
                message: ': success.',
                className: 'success'
            }, function () {
                var $progressBar = $('#p-loading').find('.progressbar'),
                    value = $progressBar.progressbar('value') || 0;
                _displayLoading.apply(this, arguments);
                $progressBar.progressbar('value', value + 100 / 5);
            });
            $body.on('click', '.ui-widget-overlay', function () {
                _hideAll();
            });
        }

        function _bindContactUsEvents(openDialogOnly) {
            $('.contact').click(function (event) {
                event.preventDefault();
                $('#p-contact').dialog('open');
            });
            if (!openDialogOnly) {
                $('#contact-form').on('submit', function (event) {
                    event.preventDefault();
                    $('#send-message').click();
                });
                $('#send-message').click(function (event) {
                    event.preventDefault();
                    $('#p-contact').dialog('close');
                    if (!_validateContactForm()) {
                        return;
                    }
                    _sendEmail();
                });
            }
        }

        function _bindKeysEvents() {
            var ESCAPE_KEY = 27,
                F11_KEY = 122;
            $(document).keyup(function (event) {
                switch (event.keyCode) {
                    case ESCAPE_KEY:
                        event.preventDefault();
                        _hideAll();
                        break;
                    case F11_KEY:
                        event.preventDefault();
                        _trigger('ui.full_screen');
                        break;
                }
            });
        }

        function _setupUiAndListeners() {
            _initConverterUi();
            _initOptionsUi();
            _initBeautyTipsUi();
            _initGeneralUi();
            _bindConverterPanelEvents();
            _bindOptionsPanelEvents();
            _bindBeautyTipsEvents();
            _bindOtherPanelsEvents();
            _bindContactUsEvents();
            _bindLanguageEvents();
            _bindKeysEvents();
        }

        function _closeLoading() {
            var $pLoading = $('#p-loading');
            if ($pLoading.find('.failure').length) {
                $pLoading.closest('.no-close').find('.ui-dialog-titlebar-close').show();
            } else {
                $pLoading.dialog('close');
                if (!_getPreferenceCookie('p-donate') && !_options.context.GET.isSetNoDonate) {
                    $('#p-donate').dialog('open');
                }
            }
            $('.ui-widget-overlay').removeAttr('style');
        }

        function _displayLoading(event, response) {
            var $elt,
                responseData = response.data,
                name = responseData.name,
                $loading = $('#p-loading .logs'),
                className = 'loading-' + name.toLowerCase().replace(/\s/ig, '-'),
                data = event.data,
                message = responseData.message ? ': ' + responseData.message : (data ? data.message : undefined);
            if (!$loading.find('.' + className).length) {
                var html = $('<div>', {class: className}).text('Loading ' + name);
                $loading.append(html);
            }
            $elt = $loading.find('.' + className);
            if (data && message && data.className) {
                if ($elt.length && !$elt.hasClass(data.className)) {
                    $elt.addClass(data.className).append(message);
                }
            }
        }

        function _setMetrics(metrics) {
            if (metrics !== undefined) {
                _setLength(metrics.length);
                _setArea(metrics.area);
            }
        }

        function _setLength(length) {
            var unit = _t('unitMeter'),
                precision = 0;
            if (!length || length === undefined) {
                $('#lengthContainer').text('-' + unit);
            } else {
                if (length > 999) {
                    unit = _t('unitKilometer');
                    length /= 1000;
                    precision = 1;
                }
                $('#lengthContainer').text(_options.math.round(length, precision).toString() + unit);
            }
        }

        function _setArea(area) {
            var unit = _t('unitMeter') + '<sup>2</sup>',
                precision = 0;
            if (!area || area === undefined) {
                $('#areaContainer').html('-' + unit);
            } else {
                if (area > 999999) {
                    unit = _t('unitKilometer') + '<sup>2</sup>';
                    area /= 1000000;
                    precision = 1;
                }
                $('#areaContainer').html(_options.math.round(area, precision).toString() + unit);
            }
        }

        function _goResearch() {
            var $crsResult = $('#crsResult');
            $crsResult
                .html('<option value="#" class="disabledoption">' + _t('loading') + '<\/option>')
                .prop('disabled', true);
            $.post(_options.system.httpServer + '/' + _options.system.dirWsIncludes + 'c.php', {
                l: _options.context.languageCode,
                i: $('#crsCountry').val(),
                c: $('#crsCode').val(),
                n: $('#crsName').val(),
                f: ''
            }).done(function (response) {
                $crsResult.html('');
                if (!$(response).length) {
                    $crsResult.append($('<option>', {
                        val: '',
                        text: _t('resultEmpty'),
                        classname: 'disabledoption'
                    }));
                } else {
                    $crsResult.prop('disabled', false);
                    $.each(response, function (country, obj) {
                        $.each(obj, function (srsCode, crs) {
                            _options.utils.addOptionToSelect(country, srsCode, $('#crsResult'), crs.def);
                        });
                    });
                }
            }).fail(function () {
                $crsResult.html('');
                $crsResult.append($('<option>', {val: '', text: _t('resultEmpty'), classname: 'disabledoption'}));
            });
        }

        function _updateConverterWithSelectedSrs(srsCode) {
            var target = $('#select').val();
            if ($('#closeSearch').prop('checked')) {
                $('#p-research').dialog('close');
            }
            App.TWCCConverter.setSelection(target, srsCode);
        }

        function _getLoadingHtml() {
            return '<div class="loading"><img src="' + _options.system.dirWsImages + 'loading.gif" alt="" width="35" height="35">' + _t('loading') + '<\/div>';
        }

        function _showPoll(hideAll) {
            hideAll = hideAll === undefined ? true : hideAll;
            $('#poll-info').html(_getLoadingHtml());
            if (hideAll) _hideAll();
            $('#p-poll').dialog('open');
            _loadPoll();
        }

        function _loadPoll(serializedValues) {
            serializedValues = serializedValues || '';
            $('#poll-info').html(_getLoadingHtml());
            $.post(_options.system.dirWsModules + 'rater/forms.php', 'rater=true&' + serializedValues, _buildPoll);
        }

        function _buildPoll(response) {
            var $pollInfo = $('#poll-info');
            $pollInfo.html(response);
            $pollInfo.find('form').each(function () {
                $(this).on('submit', function (event) {
                    event.preventDefault();
                    _loadPoll($(this).serialize());
                });
                _bindContactUsEvents(true);
            });
        }

        function _showCrsInfo(event, response) {
            var $crsInfo = $('#crs-info');
            $crsInfo.html(_getLoadingHtml());
            $.post(_options.system.dirWsIncludes + 'crs_info.php', {
                c: response.srsCode,
                d: response.definitionString,
                l: _options.context.languageCode
            }, function (response) {
                $crsInfo.html(response);
            });
            $('#p-crs').dialog('open');
        }

        function _removeAnchorFromAddressBar() {
            window.location.hash = '';
        }

        function _addAnchorToAddressBar(anchor) {
            window.location.hash = '#' + anchor;
        }

        function _getAddressBarAnchor() {
            return window.location.hash.replace('#', '');
        }

        function _validateContactForm() {
            if ($('#message').val().length < 1) {
                alert(_t('messageNotSent') + 'empty msg.');
                $('#p-contact').dialog('open');
                return false;
            }
            if ($('#email').val().length < 1) {
                alert(_t('messageWrongEmail'));
                $('#p-contact').dialog('open');
                return false;
            }
            return true;
        }

        function _sendEmail() {
            _options.utils.sendMsg($('#message').val(), $('#email').val(), _manageResponse);
        }

        function _manageResponse(response) {
            switch (response) {
                case '1':
                    alert(_t('messageSent'));
                    break;
                case '-3':
                    alert(_t('messageWrongEmail'));
                    break;
                default: //-1 & -2
                    alert(_t('messageNotSent') + response);
                    break;
            }
            if (response == '1') {
                $('#email').val('');
                $('#message').val('');
            } else {
                $('#p-contact').dialog('open');
            }
        }

        function _hideAll() {
            $('.crs-list, .source .container, .source .convert-button').each(function () {
                $(this).btOff();
            });
            $('#help').animate({opacity: 'show'}, _SHDelay);
            $('#p-new').dialog('close');
            $('#p-contact').dialog('close');
            $('#p-about').dialog('close');
            $('#p-crs').dialog('close');
            $('#p-poll').dialog('close');
            $('#p-info').dialog('close');
            $('#p-donate').dialog('close');
            $('#p-research').dialog('close');
            $('#p-convention_help').dialog('close');
        }

        function _setPreferenceCookie(prefId, prefValue) {
            _options.utils.setPreferenceCookie(prefId, prefValue);
        }

        function _getPreferenceCookie(prefId) {
            return _options.utils.getPreferenceCookie(prefId);
        }

        function _setCsvButtonset(isCsv) {
            if (isCsv !== _getMode()) {
                $('input[name="csv"][value="' + (+isCsv) + '"]').prop('checked', true);
                $('.csv-radio').buttonset('refresh');
            }
        }

        function _setMode(isCsv) {
            isCsv = !!isCsv;
            $('#manualFeatures').toggle(!isCsv);
            $('#csvFeatures').toggle(isCsv);
            if (isCsv) {
                $('#auto-zoom-toggle').button('enable');
                $('.convention-radio').buttonset('disable');
                _setMetrics();
            } else {
                $('#auto-zoom-toggle').button('disable');
                $('.convention-radio').buttonset('enable');
            }
        }

        function _getMode() {
            return !!+$('input[name="csv"]:checked').val();
        }

        function _setMagneticDeclination(angle) {
            var roundedAngle = angle === undefined ? '' : _options.math.round(angle, 4).toString();
            $('#magneticDeclinationContainer').text(roundedAngle);
        }

        function _setConvergenceConvention(isSurvey) {
            _convergenceConvention = isSurvey;
            _trigger('ui.convergence_changed');
        }

        function _setHistoryButtons(idx, max) {
            var min = 0,
                enableNextButton = idx < max,
                enablePreviousButton = idx > min;
            $('.previous.history').button('option', 'disabled', !enablePreviousButton);
            $('.next.history').button('option', 'disabled', !enableNextButton);
        }

        function _togglePalettes() {
            if ($(document).fullScreen()) {
                $('.trsp-panel, .spare, #converter, #h-container').fadeOut();
            } else {
                $('.trsp-panel, .spare, #converter, #h-container').fadeIn();
            }
        }

        function _adBlockDetected() {
            _dfd.reject(_t('pleaseDisableYourAdblock')); //please disable your AdBlock.
        }

        function _adBlockNotDetected() {
            _dfd.resolve();
        }

        function _checkAdBlocker() {
            if (!App.system.adsense.bannerAdsEnabled) {
                _adBlockNotDetected();
            } else {
                var a = window.adsbygoogle;
                if (a && a.loaded) {
                    _adBlockNotDetected();
                } else {
                    _adBlockDetected();
                }
            }
        }


        function _initUI() {
            _dfd = _newDeferred('UI');
            _setupUiAndListeners();
            $(window).load(_checkAdBlocker);
        }

        _initUI();
        return {
            promise: _dfd.promise(),
            getConvergenceConvention: function () {
                return _convergenceConvention;
            },
            startHelp: _startHelpIfCookieAllowsIt,
            setCsvMode: _setCsvMode
        };
    }

    // exports
    window.TWCCUi = {
        getInstance: function (opts) {
            instance = instance || init(opts);
            return instance;
        }
    };
})(jQuery, ClipboardJS); // jshint ignore:line
;/**
 * This file is part of TWCC.
 *
 * TWCC is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * TWCC is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with TWCC.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @copyright Copyright (c) 2010-2014 Clément Ronzon
 * @license http://www.gnu.org/licenses/agpl.txt
 */

/**
 * Events triggered by TWCCConverter and attached to the body:
 *  - converter.success (obj)
 */



(function($) {
    "use strict";
    /*global document, window, jQuery, console */

    if (window.TWCCConverter !== undefined) {
        return;
    }

    var instance,
    init = function(opts) {
        var _dfd = null,
            _converterWidget = null,
            _defIdx = 0,
            _options = $.extend(true, {}, opts);

        function _t() {
            return _options.utils.t.apply(this, arguments);
        }

        function _newDeferred() {
            return _options.utils.newDeferred.apply(this, arguments);
        }

        function _getErrorMessage(XMLHttpRequest) {
            return _t('errorContactUs').replace('%s', XMLHttpRequest.status.toString());
        }

        function _checkCRS(value, target) {
            var msg = '',
                reg = new RegExp("\\+title=[^\\+]+", "i");
            if (value === '') return '';
            value = value.toString().replace(reg, "");
            $.each(_converterWidget.options.definitions, function(country, crs) {
                $.each(crs, function(srsCode, definition) {
                    var definitionString = definition.def||"";
                    if (srsCode.toUpperCase() == value.toUpperCase() || definitionString.toUpperCase().replace(reg, "") == value.toUpperCase()) {
                        msg = _t('crsAlreadyExists')+country+" > "+(definitionString ? _options.utils.getTitleFromDefinitionString(definitionString, srsCode) : srsCode);
                        _selection(target, srsCode);
                        return false;
                    }
                });
                if (msg !== '') return false;
            });
            return msg;
        }

        function _addSystem(definitionString, srsCode) {
            var promise,
                definition = {'*[UD]':{}};
            definition['*[UD]'][srsCode] = {
                def: definitionString,
                isConnector: false
            };
            promise = _converterWidget.mergeDefinitions(definition);
            return  promise;
        }

        function _alertPNew(checkMsg, failed) {
            alert(checkMsg);
            $('#loadingxtra').hide();
            $('#new-form').show();
            if (!failed) {
                $('#p-new').dialog("close");
                $('#find-reference').val('');
                $('#add-reference').val('');
            } else {
                _defIdx--;
            }
        }

        function _getThirdPartyUrl(srsCode, baseUrl, toUpperCase) {
            var params = srsCode.split(':');
            toUpperCase = toUpperCase || false;
            return baseUrl.replace(/\$\{\d\}/ig, function(index) {
                index = index.match(/\d+/)[0];
                var value = params[index] || index;
                return toUpperCase ? value.toUpperCase() : value.toLowerCase();
            });
        }

        function _loadProj4jsFormat(srsCode, method, options) {
            window.Proj4js = {defs: {}};
            method(options).done(function() {
                _addNewReference(Proj4js.defs[srsCode]);
            }).fail(function(jqXHR) {
                _alertPNew(_getErrorMessage(jqXHR), true);
            }).always(function() {
                delete window.Proj4js;
            });
        }

        function _addSpatialReferenceDefinition(srsCode) {
            var url = _getThirdPartyUrl(srsCode, 'http://spatialreference.org/ref/${0}/${1}/proj4js/');
            window.Proj4js = {defs: {}};
            _loadProj4jsFormat(srsCode, $.fn.getXDomain, {
                url: url
            });
        }

        function _addLocalDefinition(srsCode) {
            var url = _getThirdPartyUrl(srsCode, '/js/data/defs/${0}${1}.js', true);
            _loadProj4jsFormat(srsCode, $.ajax, {
                url: url,
                cache: true,
                dataType: 'script'
            });
        }

        function _addNewReference(defData) {
            var title, srsCode, defMatch, checkMsg, newTitle,
                target = $("#new-form input[name='target']").val(),
                DEFDATA = defData.toUpperCase(),
                isEpsg = DEFDATA.indexOf("EPSG:") === 0,
                isEsri = DEFDATA.indexOf("ESRI:") === 0,
                isIau = DEFDATA.indexOf("IAU2000:") === 0,
                isSrOrg = DEFDATA.indexOf("SR-ORG:") === 0,
                isIgnf = DEFDATA.indexOf("IGNF:") === 0;
            $('#new-form').hide();
            $('#loadingxtra').show();
            checkMsg = _checkCRS(defData, target);
            if (checkMsg) {
                _alertPNew(checkMsg);
                return;
            }
            if (isEpsg || isEsri || isIau || isSrOrg) {
                srsCode = DEFDATA;
                _addSpatialReferenceDefinition(srsCode);
            } else if (isIgnf) {
                srsCode = DEFDATA;
                _addLocalDefinition(srsCode);
            } else {
                defMatch = defData.match(new RegExp("^[^\\[]+\\[\"([^\\]]+)\"\\][\\s=]+\"([^\"]+)\";$", "i"));
                if (defMatch !== null) {
                    defData = defMatch[2];
                }
                title = _options.utils.getTitleFromDefinitionString(defData, '');
                _defIdx ++;
                srsCode = 'UD'+_defIdx;
                if (title === undefined) {
                    title = _t('undefinedTitle');
                    defData = '+title='+title+' '+defData;
                }
                newTitle = srsCode+' '+title;
                defData = defData.replace('+title='+title, '+title='+newTitle);
                checkMsg = _checkCRS(srsCode, target);
                if (!checkMsg) {
                    checkMsg = _checkCRS(defData, target);
                }
                if (checkMsg) {
                    _alertPNew(checkMsg);
                    return;
                }
                _addSystem(defData, srsCode).done(function() {
                    $('#loadingxtra').hide();
                    $('#new-form').show();
                    var currentSelection = _selection(target);
                    try {
                        _selection(target, srsCode);
                        alert(_t('newSystemAdded')+'"'+newTitle+'".');
                        $('#p-new').dialog("close");
                        $('#find-reference').val('');
                        $('#add-reference').val('');
                        _options.utils.sendMsg('New user-defined system:\n\r'+srsCode+' = "'+defData+'"');
                    } catch (e) {
                        _defIdx --;
                        _selection(target, currentSelection);
                        _unload(srsCode);
                        if (defData === '') {
                            alert((_t('errorContactUs')).replace('%s', '-2 (NotFound)'));
                        } else {
                            alert((_t('errorContactUs')).replace('%s', '-1 (WrongFormat:'+defData+')'));
                        }
                    }
                });
            }
        }

        function _unload(srsCode) {
            _converterWidget.unloadCRS(srsCode);
        }

        function _selection(target, srsCode) {
            target = target.toLowerCase();
            var pushPull = 'pushPull' + target.charAt(0).toUpperCase() + target.slice(1);
            return _converterWidget[pushPull]('selection', srsCode);
        }

        function _initConverter() {
            var converterContext = _options.context.converter,
                sourceSrsCode = converterContext.defaultSourceSrs,
                destinationSrsCode = converterContext.defaultDestSrs,
                wgs84 = converterContext.defaultWgs84,
                wgs84IsValid = !(wgs84 === '' || wgs84.x === '' || wgs84.y === ''),
                $converter = $('#converter'),
                $body = $('body'),
                converterOptions = {
                    units: {
                        dms:{D:_t('unitDegree'), M:_t('unitMinute'), S:_t('unitSecond')},
                        dd:{x:{DD:_t('unitDegreeEast')}, y:{DD:_t('unitDegreeNorth')}},
                        cartesian:{XY:{m:_t('unitMeter'), km:_t('unitKilometer'), 'us-ft':_t('unitFeet')},CONVERGENCE:_t('unitDegree')}
                    },
                    labels:{
                        spherical:{x:_t('labelLng'), y:_t('labelLat'), convergence:_t('labelConvergence')},
                        cartesian:{x:_t('labelX'), y:_t('labelY'), z:_t('labelZone'), h:_t('labelHemi'), convergence:_t('labelConvergence')},
                        csv:{csv:_t('labelCsv'), l:_t('labelFormat')}
                    },
                    options:{
                        x:{E:_t('optionE'),W:_t('optionW')},
                        y:{N:_t('optionN'),S:_t('optionS')},
                        o:{_DMS:_t('optionDMS'), _DM:_t('optionDM'), _DD:_t('optionDD')},
                        h:{n:_t('optionNorth'), s:_t('optionSouth')},
                        u:{_M:_t('optionM'), _KM:_t('optionKM'), _F:_t('optionF')}
                    }
                };

            if (converterContext.fromUrl && !wgs84IsValid) {
                alert('Invalid URL');
            }
            wgs84 = (converterContext.fromUrl && wgs84IsValid) ? [wgs84] : converterContext.fromRss ? [{x:10,y:10}] : null;
            _options.context.converter.fromUrl = false;
            _options.context.converter.fromRss = false;
            _dfd = _newDeferred('Converter');
            _converterWidget = $converter.converterSet({
                units: converterOptions.units,
                labels: converterOptions.labels,
                options: converterOptions.options,
                wgs84: wgs84,
                defaultWgs84: [_options.utils.getRandomCityLocation()],
                value: {x:0, y:0},
                selections: {
                    source: sourceSrsCode,
                    destination: destinationSrsCode
                },
                url: _options.system.httpServer + '/' + _options.system.dirWsIncludes + 'c.php'
            }).data('twccConverterSet');
            $converter.one('converterset.done', function(event, data) {
                _dfd.resolve(data);
            });
            $converter.on('converterset.fail', function(event, data) {
                var errorMessage = _getErrorMessage.call(null, data);
                alert(errorMessage);
            });
            $body.on('click', '#new-reference', function(event) {
                event.preventDefault();
                var defData = $('#add-reference').val();
                _addNewReference(defData);
            });
            $body.on('submit', '#new-form', function(event) {
                event.preventDefault();
                $('#new-reference').click();
            });
            $body.on('ui.convergence_changed', function() {
                _converterWidget.setConvergence();
            });
            $body.on('ui.csv_changed', function(evt, response) {
                _converterWidget.csv(response.data);
            });
            $('.to-remove').remove();
        }

        _initConverter();
        return {
            promise: _dfd.promise(),
            converterWidget: _converterWidget,
            setSelection: _selection
        };
    };

    // exports
    window.TWCCConverter = {
        getInstance: function (opts) {
            instance = instance || init(opts);
            return instance;
        }
    };
})(jQuery);;/**
 * This file is part of TWCC.
 *
 * TWCC is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * TWCC is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with TWCC.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @copyright Copyright (c) 2010-2014 Clément Ronzon
 * @license http://www.gnu.org/licenses/agpl.txt
 */
(function(window, document, $, App) {
    "use strict";
    /*global ga */

    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments);
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-17790812-2', 'auto');
    ga('send', 'pageview');

    $(document).ready(function() {

        function trackEvent(category, action, opt_label, opt_quantity) {
            try {
                ga('send', 'event', category, action, opt_label, opt_quantity);
            } catch (err) {
            }
            }

        function trackTiming(category, variable, timeMs, opt_label) {
            try {
                ga('send', 'timing', category, variable, timeMs, opt_label);
            } catch (err) {
            }
        }

        function trackMainFailure(evt, obj) {
            trackEvent('main', 'fails', obj.data.name);
        }

        function trackXhrFailure(evt, obj) {
            trackEvent('xhr', 'fails', obj.data);
        }

        function trackMapLayerChange(evt, obj) {
            trackEvent('layer', 'change', obj.data);
        }

        function trackSelect(evt) {
            var $select = $(evt.target),
                crs = $select.find('option:selected').text();
            trackEvent('select', 'change', crs);
        }

        function trackDynamicRadio(evt) {
            var $radio = $(evt.target),
                value = $radio.val();
            trackEvent('radio', 'click', value);
        }

        function trackStaticRadio(evt) {
            var $radio = $(evt.target),
                name = $radio.prop('name');
            trackEvent('radio', 'click', name);
        }

        function trackClipboardClick() {
            trackEvent('clipboard', 'click');
        }

        function trackClipboardSuccess() {
            trackEvent('clipboard', 'success');
        }

        function trackConverterChanged() {
            trackEvent('converter', 'changed');
        }

        function trackLoadingTime() {
            var endTime = new Date().getTime(),
                timeSpent = endTime - App.context.startTime;
            trackTiming('TWCC', 'Render infowindow', timeSpent);
            trackEvent('infowindow', 'opened');
        }

        function init() {
            var $body = $('body');
            $body.on('change', '.crs-list', trackSelect);
            $body.on('click', '#converter input[type="radio"]', trackDynamicRadio);
            $body.on('click', '#o-container input[type="radio"]', trackStaticRadio);
            $body.on('click', '.octicon-clippy', trackClipboardClick);
            $body.on('clipboard.aftercopy', trackClipboardSuccess);
            $body.on('converter.changed', trackConverterChanged);
            $body.on('xhr.failed', trackXhrFailure);
            $body.on('map.layer.change', trackMapLayerChange);
            $body.one('infowindow.dom_ready', trackLoadingTime);
            $body.one('main.failed', trackMainFailure);
            $body.one('main.ready', function (event, obj) {
                var isCsv = obj.data === undefined ? obj.csv : obj.data.csv;
                if (isCsv) {
                    $body.off('infowindow.dom_ready', trackLoadingTime);
                }
            });
        }

        init();
    });
})(window, document, jQuery, App); // jshint ignore:line